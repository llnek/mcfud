!function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io.czlab.mcfud.core"]=function(){if(e)return e;const n=t.document,r=Object.prototype,i=Array.prototype.slice,o=r.toString,s={};function l(t){return"[object Object]"===o.call(t)}function c(t){return"[object Array]"===o.call(t)}function u(t){return"[object Map]"===o.call(t)}function a(t){return"[object Number]"===o.call(t)}function h(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function f(t){let e=t.lastIndexOf(".");return e>0?t.substring(e+1).toLowerCase():""}Date.now(),Date.now(),Date.now(),Date.now();let p=0;const m={feq:function(t,e){return Math.abs(t-e)<=1e-5},fgteq:function(t,e){return t>e||this.feq(t,e)},flteq:function(t,e){return t<e||this.feq(t,e)},pack:function(t){return JSON.stringify(t)},unpack:function(t){return JSON.parse(t)},v2:function(t,e){return[t,e]},p2:function(t,e){return{x:t,y:e}},numOrZero:function(t){return isNaN(t)?0:t},parseNumber:function(t,e){let n=parseFloat(t);return isNaN(n)&&a(e)?e:n},splitVerStr:function(t){let e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.parseNumber(e[0],0),this.parseNumber(e[1],0),this.parseNumber(e[2],0)]},cmpVerStrs:function(t,e){let n=this.splitVerStr(""+t),r=this.splitVerStr(""+e);return n[0]>r[0]?1:n[0]<r[0]?-1:n[1]>r[1]?1:n[1]<r[1]?-1:n[2]>r[2]?1:n[2]<r[2]?-1:0},findFiles:function(t,e){return t.filter(t=>e.indexOf(f(t))>-1)},pdef:function(t){return t.enumerable=!0,t.configurable=!0,t},partition:function(t,e){let n=[];for(let r,i=0;;){r=[];for(let o=0;o<t;++o){if(!(i<e.length))return r.length>0&&n.push(r),n;r.push(e[i]),++i}}},range:function(t,e){m.assert(void 0!==t);let n=[];1===arguments.length&&(e=t,t=0);for(let r=t;r<e;++r)n.push(r);return n},keys:function(t){return u(t)?Array.from(t.keys()):l(t)?Object.keys(t):[]},selectKeys:function(t,e){let n;return(u(t)||l(t))&&(n=u(t)?new Map:{},this.seq(e).forEach(e=>{u(t)?t.has(e)&&n.set(e,t.get(e)):r.hasOwnProperty.call(t,e)&&(n[e]=t[e])})),n},assert:function(t){if(!t)throw arguments.length<2?"Assert Failed!":i.call(arguments,1).join("");return!0},noSuchKeys:function(t,e){let n=this.some(this.seq(t),t=>this.has(e,t)?t:null);return n&&console.log("keyfound="+n),!n},randFloat:function(t,e){return t+Math.random()*(e-t)},randMinus1To1:function(){return 2*(Math.random()-.5)},randInt:function(t){return h(0,t)},randInt2:h,rand:function(){return Math.random()},inst:function(t,e){return e instanceof t},isPerc:function(t){return"string"==typeof t&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/)},jsMap:function(){return new Map},jsObj:function(){return{}},jsVec:function(...t){return 0===t.length?[]:t.slice()},floor:function(t){return Math.floor(t)},ceil:function(t){return Math.ceil(t)},abs:function(t){return Math.abs(t)},sqrt:function(t){return Math.sqrt(t)},min:function(t,e){return Math.min(t,e)},max:function(t,e){return Math.max(t,e)},slice:function(t,e){return i.call(t,e)},every:function(t,e){for(let n=0;n<t.length;++n)if(t[n]!==e)return!1;return t.length>0},notAny:function(t,e){for(let n=0;n<t.length;++n)if(t[n]===e)return!1;return t.length>0},copy:function(t,e){if(!e)return t;if(!t)return e.slice();let n=Math.min(t.length,e.length);for(let r=0;r<n;++r)t[r]=e[r];return t},append:function(t,e){if(!e)return t;if(!t)return e.slice();for(let n=0;n<e.length;++n)t.push(e[n]);return t},fill:function(t,e){if(t)for(let n=0;n<t.length;++n)t[n]=e;return t},size:function(t){let e=0;return c(t)?e=t.length:u(t)?e=t.size:t&&(e=m.keys(t).length),e},nextId:function(){return++p},now:function(){return Date.now()},fileExt:f,fileNoExt:function(t){let e=t.lastIndexOf(".");return e>0?t.substring(0,e):t},range:function(t,e,n=1){void 0===e&&(e=t,t=0,n=1);let r=[],i=(e-t)/n;i=Math.ceil(i),i=Math.max(0,i),r.length=i;for(let e=0;e<i;++e)r[e]=t,t+=n;return r},shuffle:function(t){let e=i.call(t,0);for(let t,n,r=e.length-1;r>0;--r)n=Math.floor(Math.random()*(r+1)),t=e[r],e[r]=e[n],e[n]=t;return e},uniq:function(t){let e=[],n=null;return(t=i.call(t).sort()).forEach(t=>{void 0!==t&&t!==n&&e.push(t),n=t}),e},map:function(t,e,n){let i=[];if(c(t))i=t.map(e,n);else if(u(t))t.forEach((r,o)=>{i.push(e.call(n,r,o,t))});else if(t)for(let o in t)r.hasOwnProperty.call(t,o)&&i.push(e.call(n,t[o],o,t));return i},find:function(t,e,n){let o=i.call(arguments,3);if(c(t)){for(let r=0,i=t.length;r<i;++r)if(e.apply(n,[t[r],r].concat(o)))return t[r]}else if(u(t)){let r=Array.from(t.keys());for(let i,s=0,l=r.length;s<l;++s)if(i=r[s],e.apply(n,[t.get(i),i].concat(o)))return[i,t.get(i)]}else if(t)for(let i in t)if(r.hasOwnProperty.call(t,i)&&e.apply(n,[t[i],i].concat(o)))return[i,t[i]]},some:function(t,e,n){let o,s=i.call(arguments,3);if(c(t)){for(let r=0,i=t.length;r<i;++r)if(o=e.apply(n,[t[r],r].concat(s)))return o}else if(u(t)){let r=Array.from(t.keys());for(let i,l=0,c=r.length;l<c;++l)if(i=r[l],o=e.apply(n,[t.get(i),i].concat(s)))return o}else if(t)for(let i in t)if(r.hasOwnProperty.call(t,i)&&(o=e.apply(n,[t[i],i].concat(s))))return o},invoke:function(t,e){let n=i.call(arguments,2);c(t)&&t.forEach(t=>t[e].apply(t,n))},timer:function(t,e=0){return setTimeout(t,e)},clear:function(t){clearTimeout(t)},rseq:function(t,e,n){if(c(t))for(let r=t.length-1;r>=0;--r)e.call(n,t[r],r)},doseq:function(t,e,n){if(c(t))t.forEach(e,n);else if(u(t))t.forEach((r,i)=>e.call(n,r,i,t));else if(t)for(let i in t)r.hasOwnProperty.call(t,i)&&e.call(n,t[i],i,t)},dissoc:function(t,e){if(arguments.length>2){let e,n=1;for(;n<arguments.length;++n)e=this.dissoc(t,arguments[n]);return e}{let n;return u(t)?(n=t.get(e),t.delete(e)):t&&(n=t[e],delete t[e]),n}},get:function(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc:function(t,e,n){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"ArityError: expecting even count of args.";let e,n=1;for(;n<arguments.length;)e=this.assoc(t,arguments[n],arguments[n+1]),n+=2;return e}{let r;return u(t)?(r=t.get(e),t.set(e,n)):t&&(r=t[e],t[e]=n),r}},disj:function(t,e){let n=t?t.indexOf(e):-1;return n>-1&&t.splice(n,1),n>-1},conj:function(t,...e){return t&&e.forEach(e=>t.push(e)),t},seq:function(t,e=","){return"string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),c(t)||(t=[t]),t},has:function(t,e){return!!e&&(u(t)?t.has(e):c(t)?-1!==t.indexOf(e):t?r.hasOwnProperty.call(t,e):void 0)},patch:function(t,e){return t=t||{},e&&Object.keys(e).forEach(n=>{void 0===t[n]&&(t[n]=e[n])}),t},clone:function(t){return t&&(t=JSON.parse(JSON.stringify(t))),t},inject:function(t){let e=i.call(arguments,1);return t=t||{},e.forEach(e=>{e&&Object.assign(t,e)}),t}};n&&(m.addEvent=function(t,e,n,r){c(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,n,r)},m.delEvent=function(t,e,n,r){c(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,n,r)});const d={fun:function(t){return"[object Function]"===o.call(t)},str:function(t){return"string"==typeof t},void0:function(t){return void 0===t},undef:function(t){return void 0===t},obj:l,map:u,num:a,vec:c,some:function(t){return m.size(t)>0},none:function(t){return 0===m.size(t)}},g={qSelector:function(t){return n.querySelectorAll(t)},qId:function(t){return n.getElementById(t)},parent:function(t){return t?t.parentNode:void 0},conj:function(t,e){return t.appendChild(e)},byTag:function(t,e){return d.str(e)?n.getElementsByTagNameNS(e,t):n.getElementsByTagName(id)},attrs:function(t,e){return!d.obj(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&m.doseq(e,(e,n)=>t.setAttribute(n,e)),t)},css:function(t,e){return!d.obj(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&m.doseq(e,(e,n)=>{t.style[n]=e}),t)},wrap:function(t,e){let n=t.parentNode;return e.appendChild(t),n.appendChild(e),e},newElm:function(t,e,r){let i=n.createElement(t);return this.attrs(i,e),this.css(i,r),i},newTxt:function(t,e,r){let i=n.createTextNode(t);return this.attrs(i,e),this.css(i,r),i}};return n&&(s.dom=g),s.EventBus=function(){let t=m.jsMap();return{sub:function(e,n,r){if(d.vec(e)&&1===arguments.length&&d.vec[e[0]])e.forEach(t=>{d.vec(t)&&this.sub.apply(this,t)});else{let i=e[0],o=e[1];m.seq(i).forEach(e=>{if(n||(n=e),d.str(n)&&(n=(r=r||o)[n]),!n)throw"Error: no callback for sub()";t.has(e)||t.set(e,m.jsMap());let i=t.get(e);!i.has(o)&&i.set(o,[]),i.get(o).push([n,r])}
//!m.has(e) && m.set(e,[]);
)}},pub:function(e,n){if(d.vec(e)&&1===arguments.length&&d.vec[e[0]])e.forEach(t=>{d.vec(t)&&this.pub.apply(this,t)});else{let r,i,o=e[0],s=e[1];m.seq(o).forEach(e=>{i=t.get(e),r=i&&i.get(s),r&&r.forEach(t=>t[0].call(t[1],n))})}},unsub:function(e,n,r){if(d.vec(e)&&1===arguments.length&&d.vec[e[0]])e.forEach(t=>{d.vec(t)&&this.unsub.apply(this,t)});else{let i,o,s=e[0],l=e[1];m.seq(s).forEach(e=>{if(i=t.get(e),o=i&&i.get(l),o)if(d.str(n)&&(n=(r=r||l)[n]),n)for(let t=o.length-1;t>=0;--t)o[t][0]===n&&o[t][1]===r&&o.splice(t,1);else i.delete(l)})}}}},s.u=m,s.is=d,e=s}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io.czlab.mcfud.math"]=function(){if(e)return e;const n=t["io.czlab.mcfud.core"](),r=n.u,i=n.is,o=1e-10,s=360,l=2*Math.PI,c=(Math.PI,Math.atan2),u=Math.acos,h=Math.cos,f=Math.sin,p=Math.tan,m={EPSILON:o};function d(t){return t%2!=0}function g(t){return t<0?- -t%s:t%s}m.xmod=function(t,e){return t<0?t- -(e+e*Math.floor(-t/e)):t%e},m.clamp=function(t,e,n){return n<t?t:n>e?e:n},m.sqr=function(t){return t*t},m.fuzzyEq=function(t,e){return Math.abs(t-e)<o},m.fuzzyZero=function(t){return this.fuzzyEq(t,0)},m.V2=function(t,e){return m.V2Pool.take(t,e)},m.V3=function(t,e,n){return[t||0,e||0,n||0]},m.V4=function(t,e,n,r){return[t||0,e||0,n||0,r||0]},m.radToDeg=function(t){return g(s*t/l)},m.degToRad=function(t){return l*g(t)/s};const v=(t,e)=>t+e,y=(t,e)=>t-e,M=(t,e)=>t*e,x=(t,e)=>t/e;function b(t,e,n,r){if(i.vec(n)&&e.length!==n.length)throw"Error: Mismatch vector length";let o=i.num(n),s=r?e:2===e.length?m.V2Pool.take():new Array(e.length);for(let r=0;r<e.length;++r)s[r]=t(e[r],o?n:n[r]);return s}function w(t,e,n,r){let i=n?n[0]:0,o=n?n[1]:0,s=t[0]-i,l=t[1]-o,c=h(e),u=f(e),a=i+(s*c-l*u),p=o+(s*u+l*c);return r?(t[0]=a,t[1]=p):t=m.V2Pool.take(a,p),t}function S(t,e,n,r){return r-1+(n-1)*e}function P(t,e,n){return{dim:[t,e],cells:n}}m.vecAdd=function(t,e){return b(v,t,e)},m.vecAddSelf=function(t,e){return b(v,t,e,1)},m.vecSub=function(t,e){return b(y,t,e)},m.vecSubSelf=function(t,e){return b(y,t,e,1)},m.vecMul=function(t,e){return b(M,t,e)},m.vecMulSelf=function(t,e){return b(M,t,e,1)},m.vecDiv=function(t,e){return b(x,t,e)},m.vecDivSelf=function(t,e){return b(x,t,e,1)},m.vecDot=function(t,e){if(t.length===e.length)return t.reduce((t,n,r)=>t+n*e[r],0)},m.vecLen2=function(t){return this.vecDot(t,t)},m.vecLen=function(t){return Math.sqrt(this.vecLen2(t))},m.vecDist2=function(t,e){return this.vecLen2(this.vecSub(e,t))},m.vecDist=function(t,e){return Math.sqrt(this.vecDist2(t,e))},m.vecUnit=function(t){let e=this.vecLen(t),n=2===t.length?m.V2Pool.take():new Array(t.length);for(let r=0;r<t.length;++r)n[r]=e>o?t[r]/e:0;return n},m.vecUnitSelf=function(t){for(let e=this.vecLen(t),n=0;n<t.length;++n)t[n]=e>o?t[n]/e:0;return t},m.vecSet=function(t,e){r.assert(t.length===e.length);for(let n=0;n<e.length;++n)t[n]=e[n];return t},m.vecClone=function(t){let e=2===t.length?m.V2Pool.take():new Array(t.length);for(let n=0;n<t.length;++n)e[n]=t[n];return e},m.vecCopy=function(t,...e){r.assert(t.length===e.length);for(let n=0;n<e.length;++n)t[n]=e[n];return t},m.vec2Rot=function(t,e,n){return w(t,e,n)},m.vec2RotSelf=function(t,e,n){return w(t,e,n,1)},m.vec2Cross=function(t,e){return i.vec(t)&&i.vec(e)?t[0]*e[1]-t[1]*e[0]:i.vec(t)&&i.num(a)?m.V2Pool.take(e*t[1],-e*t[0]):i.num(t)&&i.vec(e)?m.V2Pool.take(-t*e[1],t*e[0]):void 0},m.vec3Cross=function(t,e){return this.V3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},m.vecAngle=function(t,e){return u(this.vecDot(t,e)/(this.vecLen(t)*this.vecLen(e)))},m.perpSelf=function(t){let e=t[0];return t[0]=t[1],t[1]=-e,t},m.perp=function(t){return m.V2Pool.take(t[1],-t[0])},m.proj=function(t,e){return this.vecDot(t,e)/this.vecLen(e)},m.vecProj=function(t,e){return this.vecMul(e,this.vec2Dot(t,e)/this.vec2Len2(e))},m.vecPerp=function(t,e){return this.vecSub(t,this.vecProj(t,e))},m.vecReflect=function(t,e){return this.vecSub(t,this.vecMul(e,2*this.vecDot(t,e)))},m.vecFlip=function(t){return this.vecMul(t,-1)},m.vecFlipSelf=function(t){return this.vecMulSelf(t,-1)},m.vecNormal=function(t,e){let n=t[1]-0,r=t[0]-0;return e?m.V2Pool.take(-n,r):m.V2Pool.take(n,-r)},m.vecMin=function(t,e){let n=[];if(t.length===e.length)for(let r=0;r<t.length;++r)n.push(Math.min(t[r],e[r]));return n},m.vecMax=function(t,e){let n=[];if(t.length===e.length)for(let r=0;r<t.length;++r)n.push(Math.max(t[r],e[r]));return n},m.matrix=function(t,...e){let n=t[0],i=t[1],o=n*i;return 0===e.length?function(t,e){return P(t,e,r.fill(new Array(t*e),0))}(n,i):r.assert(o===e.length)&&P(n,i,e)},m.matIdentity=function(t){let e=r.fill(new Array(t*t),0);for(let n=0;n<t;++n)e[S(0,t,n+1,n+1)]=1;return P(t,t,e)},m.matZero=function(t){return r.assert(t>0)&&P(t,t,r.fill(new Array(t*t),0))},m.mat2=function(t,e,n,r){return this.matrix([2,2],t,e,n,r)},m.mat3=function(t,e,n,r,i,o,s,l,c){return this.matrix([3,3],t,e,n,r,i,o,s,l,c)},m.mat4=function(t,e,n,r,i,o,s,l,c,u,a,h,f,p,m,d){return this.matrix([4,4],t,e,n,r,i,o,s,l,c,u,a,h,f,p,m,d)},m.matEq=function(t,e){return t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&this.arrayEq(t.cells,e.cells)},m.matNeq=function(t,e){return!this.matEq(t,e)},m.matXpose=function(t){let e=t.dim[0],n=t.dim[1],r=e*n,i=[];for(let o=0;o<r;++o)i.push(t.cells[o/e+n*(o%e)]);return P(n,e,i)},m.mat3FastInverse=function(t){return r.assert(3===t.dim[0]&&3===t.dim[1])&&this.matXpose(t)},m.mat4FastInverse=function(t){_assert(4===t.dim[0]&&4===t.dim[1]);t.dim[0];let e=t.dim[1],n=this.matXpose(t),i=r.partition(e,t.cells),o=i[0],s=i[1],l=i[2],c=i[3],u=o.slice(0,3),a=s.slice(0,3),h=l.slice(0,3),f=c.slice(0,3);return t.cells[S(0,4,1,4)]=0,t.cells[S(0,4,2,4)]=0,t.cells[S(0,4,3,4)]=0,t.cells[S(0,4,4,1)]=-this.vecDot(u,f),t.cells[S(0,4,4,2)]=-this.vecDot(a,f),t.cells[S(0,4,4,3)]=-this.vecDot(h,f),n},m.matScale=function(t,e){return P(t.dim[0],t.dim[1],t.cells.map(t=>t*e))},m.matMult=function(t,e){let n=t.dim[0],i=t.dim[1],o=t.cells,s=e.dim[0],l=e.dim[1],c=e.cells;r.assert(i===s,"mismatch matrices");let u=new Array(n*l);for(let t=0;t<n;++t)for(let e=0;e<l;++e)u[e+t*l]=r.range(s).reduce((n,r)=>n+o[r+t*i]*c[e+r*l],0);return P(n,l,u)},m.matDet=function(t){t.dim[0];let e=t.dim[1],n=[];for(let i=0;i<e;++i)r.conj(n,this.matDet(this.matCut(t,1,i+1)));return r.range(e).reduce((e,r)=>{let i=n[r];return e+t.cells[r]*(d(r)?-i:i)},0)},m.matDet2x2=function(t){return r.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]},m.matCut=function(t,e,n){let i=t.dim[0],o=t.dim[1],s=e-1,l=n-1,c=[];for(let e=0;e<i;++e)for(let n=0;n<o;++n)e!==s&&n!==l&&r.conj(c,t.cells[n+e*o]);return P(i-1,o-1,c)},m.matMinor=function(t){let e=t.dim[0],n=t.dim[1],i=[];for(let o=0;o<e;++o)for(let e=0;e<n;++e)r.conj(i,this.matDet(this.matCut(t,o+1,e+1)));return P(e,n,i)},m.matMinor2x2=function(t){return r.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},m.matCofactor=function(t){let e=this.matMinor(t),n=e.dim[0],r=e.dim[1],i=t.cells.slice();for(let t=n*r,e=0;e<t;++e)d(e)&&(i[e]=-i[e]);return P(n,r,i)},m.matAdjugate=function(t){return this.matXpose(this.matCofactor(t))},m.matInverse2x2=function(t){let e=t.dim[0],n=t.dim[1];r.assert(4===t.cells.length&&2===e&&2===n);let i,o=t.cells,s=o[0]*o[3]-o[1]*o[2];if(this.fuzzyZero(s))i=this.matIdentity(e);else{let t=1/s;i=this.mat2(o[3]*t,-o[1]*t,-o[2]*t,o[0]*t)}return i},m.matInverse=function(t){let e=t.dim[0],n=(t.dim[1],this.matDet(t));return this.fuzzyZero(n)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/n)},m.matFromColMajor=function(t){return this.matXpose(t)},m.matToColMajor=function(t){return this.matXpose(t)},m.mat4Txlate=function(t){let e=r.assert(3===t.length)&&this.matIdentity(4);return e.cells[S(0,4,4,1)]=t[0],e.cells[S(0,4,4,2)]=t[1],e.cells[S(0,4,4,3)]=t[2],e},m.matFromMX_3x3=function(t){r.assert(9===t.cells.length);let e=t.dim[0],n=t.dim[1],i=r.partition(n,t.cells),o=i[0],s=i[1],l=i[2];return P(e+1,n+1,o.concat(0,s,0,l,0,[0,0,0,1]))},m.getTranslation4x4=function(t){r.assert(16===t.cells.length);let e=t.cells;return this.V3(e[S(0,4,4,1)],e[S(0,4,4,2)],e[S(0,4,4,3)])},m.matFromVX_V3=function(t){r.assert(3===t.length);let e=this.matIdentity(4),n=e.cells;return n[S(0,4,1,1)]=t[0],n[S(0,4,2,2)]=t[1],n[S(0,4,3,3)]=t[2],e},m.getScaleFromMX_4x4=function(t){r.assert(16===t.cells.length);t.dim[0];let e=t.dim[1],n=r.partition(e,t.cells),i=n[0],o=n[1],s=n[2];return this.V3(i[0],o[1],s[2])},m.matVMult=function(t,e){let n=t.dim[1],i=e.length;r.assert(n===i);let o=this.matMult(t,P(i,1,e)),s=o.cells;return o.cells=null,s},m.rotation2x2=function(t){return this.mat2(h(t),-f(t),f(t),h(t))},m.yawPitchRoll=function(t,e,n){return this.mat4(h(n)*h(t)+f(n)*f(e)*f(t),f(n)*h(e),h(n)*-f(t)+f(n)*f(e)*h(t),0,-f(n)*h(t)+h(n)*f(e)*f(t),h(n)*h(e),f(n)*f(t)+h(n)*f(e)*h(t),0,h(e)*f(t),-f(e),h(e)*h(t),0,0,0,0,1)},m.xRotation=function(t){return this.mat4(1,0,0,0,0,h(t),f(t),0,0,-f(t),h(t),0,0,0,0,1)},m.xRotation3x3=function(t){return this.mat3(1,0,0,0,h(t),f(t),0,-f(t),h(t))},m.yRotation=function(t){return this.mat4(h(t),0,-f(t),0,0,1,0,0,f(t),0,h(t),0,0,0,0,1)},m.yRotation3x3=function(t){return this.mat3(h(t),0,-f(t),0,1,0,f(t),0,h(t))},m.zRotation=function(t){return this.mat4(h(t),f(t),0,0,-f(t),h(t),0,0,0,0,1,0,0,0,0,1)},m.zRotation3x3=function(t){return this.mat3(h(t),f(t),0,-f(t),h(t),0,0,0,1)},m.mat4Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation(n),this.xRotation(t)),this.yRotation(e))},m.mat3Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation3x3(n),this.xRotation3x3(t)),this.yRotation3x3(e))},m.matOrthogonal4x4=function(t){r.assert(16===t.cells.length);t.dim[0];let e=t.dim[1],n=r.partition(e,t.cells),i=n[0],o=n[1],s=n[2],l=n[3],c=i.slice(0,3),u=o.slice(0,3),a=this.vec3Cross(c,u),h=this.vec3Cross(u,a),f=this.vec3Cross(a,c),p=this.vec3Cross(c,u);return this.mat4(h[0],h[1],h[2],i[3],f[0],f[1],f[2],o[3],p[0],p[1],p[2],s[3],l[0],l[1],l[2],l[3])},m.matOrthogonal3x3=function(t){r.assert(9===t.cells.length);t.dim[0];let e=t.dim[1],n=r.partition(e,t.cells),i=n[0],o=n[1],s=(n[2],i),l=o,c=this.vec3Cross(s,l),u=this.vec3Cross(l,c),a=this.vec3Cross(c,s),h=this.vec3Cross(s,l);return this.mat3(u[0],u[1],u[2],a[0],a[1],a[2],h[0],h[1],h[2])},m.mat4AxisAngle=function(t,e){r.assert(3===t.length);let n=t[0],i=t[1],o=t[2],s=this.vecLen(t),l=h(e),c=f(e),u=1-l;if(!this.fuzzyEq(s,1)){let t=1/s;n*=t,i*=t,o*=t}return this.mat4(l+u*n*n,u*n*i+c*o,u*n*o-c*i,0,u*n*i-c*o,l+u*i*i,u*i*o+c*n,0,u*n*o+c*i,u*i*o-c*n,l+u*o*o,0,0,0,0,1)},m.axisAngle3x3=function(t,e){r.assert(3===t.length);let n=t[0],i=t[1],o=t[2],s=h(e),l=f(e),c=1-s,u=this.vecLen(t);if(!this.fuzzyEq(u,1)){let t=1/u;n*=t,i*=t,o*=t}return this.mat3(s+c*n*n,c*n*i+l*o,c*n*o-l*i,c*n*i-l*o,s+c*i*i,c*i*o+l*n,c*n*o+l*i,c*i*o-l*n,s+c*o*o)},m.matMultV3M4=function(t,e){r.assert(3===t.length&&16===e.cells.length);let n=t[0],i=t[1],o=t[2],s=r.partition(4,e.cells),l=s[0],c=s[1],u=s[2],a=s[3];return this.V3(n*l[0]+i*c[0]+o*u[0]+1*a[0],n*l[1]+i*c[1]+o*u[1]+1*a[1],n*l[2]+i*c[2]+o*u[2]+1*a[2])},m.mat3MultVX_4x4=function(t,e){r.assert(3===t.length&&16===e.cells.length);let n=t[0],i=t[1],o=t[2],s=r.partition(4,e.cells),l=s[0],c=s[1],u=s[2],a=s[3];return this.V3(n*l[0]+i*c[0]+o*u[0]+0*a[0],n*l[1]+i*c[1]+o*u[1]+0*a[1],n*l[2]+i*c[2]+o*u[2]+0*a[2])},m.mat3MultVX_3x3=function(t,e){r.assert(3===t.length&&9===e.cells.length);t[0],t[1],t[2];let n=r.partition(3,e.cells),i=n[0],o=n[1],s=n[2];return this.V3(this.vecDot(t,this.V3(i[0],o[0],s[0])),this.vecDot(t,this.V3(i[1],o[1],s[1])),this.vecDot(t,this.V3(i[2],o[2],s[2])))},m.mat4TxformViaRotation=function(t,e,n){r.assert(3===e.length);let i=e[0],o=e[1],s=e[2];return this.matMult(this.matMult(this.matFromVX(t),this.mat4Rotation(i,o,s)),this.mat4Txlate(n))},m.mat4TxformViaAxisAngle=function(t,e,n,r){return this.matMult(this.matMult(this.matFromVX(t),this.mat4AxisAngle(e,n)),this.mat4Txlate(r))},m.mat4LookAt=function(t,e,n){let r=this.vecUnit(this.vecSub(e,t)),i=this.vecUnit(this.vec3Cross(n,r)),o=this.vecCross(r,i);return this.mat4(i[0],o[0],r[0],0,i[1],o[1],r[1],0,i[2],o[2],r[2],0,-this.vecDot(i,t),-this.vecDot(o,t),-this.vecDot(r,t),1)},m.mat4Proj=function(t,e,n,r){let i=1/p(.5*t),o=i/e,s=r/(r-n),l=this.matIdentity(4);return l.cells[S(0,4,1,1)]=o,l.cells[S(0,4,2,2)]=i,l.cells[S(0,4,3,3)]=s,l.cells[S(0,4,3,4)]=1,l.cells[S(0,4,4,3)]=-n*s,l.cells[S(0,4,4,4)]=0,l},m.mat4Ortho=function(t,e,n,r,i,o){let s=(e-t)/2,l=(r-n)/2,c=(o-i)/1,u=(t+e)/(t-e),a=(r+n)/(n-r),h=i/(i-o);return this.mat4(s,0,0,0,0,l,0,0,0,0,c,0,u,a,h,1)},m.matDecompose3x3=function(t){let e=this.matXpose(t),n=r.partition(3,e),i=n[0],o=n[1],s=n[2],l=Math.sqrt(i[0]*i[0]+o[0]*o[0]);return l<1e-6?this.V3(c(-o[2],o[1]),c(-s[0],l),0):this.V3(c(s[1],s[2]),c(-s[0],l),c(o[0],i[0]))},m.pythagSQ=function(t,e){return t*t+e*e},m.pythag=function(t,e){return Math.sqrt(t*t+e*e)},m.wrap=function(t,e){return(t+1)%e},m.biasGreater=function(t,e){return t>=.95*e+.01*t};return e=r.inject(m,{V2Pool:new class{constructor(){this.pool=[];for(let t=0;t<16;++t)this.pool.push([0,0])}take(t,e){let n=this.pool.length>0?this.pool.pop():[0,0];return n[0]=t||0,n[1]=e||0,n}drop(...t){return t.forEach(t=>{t&&2===t.length&&this.pool.push(t)}),this}}})}}(this),function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;const n=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",r=n.length;t["io.czlab.mcfud.crypt"]=function(){t["io.czlab.mcfud.core"]().u;const i={};function o(t){return Math.abs(t)%r}function s(t,e){return(e||n).charAt(t)}function l(t){for(let e=0;e<r;++e)if(charat(e)===t)return e;return-1}function c(t,e){let n=e+t;return s(n>=r?n-r:n)}function u(t,e){let n=e-t;return s(n<0?r+n:n)}return i.encrypt=function(t,e){if(0===e)return t;let n=[],r=o(e);return t.split().forEach(t=>{let i=l(t);n.push(i<0?t:function(t,e,n){return t<0?c(e,n):u(e,n)}(e,r,i))}),n.join("")},i.decrypt=function(t,e){if(0===e)return t;let n,r=[],i=o(e);return t.split("").forEach(t=>{n=l(t),r.push(n<0?t:function(t,e,n){return t<0?u(e,n):c(e,n)}(e,i,n))}),r.join("")},e=i}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io.czlab.mcfud.gfx"]=function(){if(e)return e;const n=t["io.czlab.mcfud.core"](),r=(t["io.czlab.mcfud.math"](),n.u,{}),i=2*Math.PI;return r.textStyle=function(t,e,n,r){return{font:t,fill:e,align:n,base:r}},r.drawShape=function(t,e,...n){e.draw&&e.draw(t,...n)},r.cfgStyle=function(t,e){if(e){let n=e.line,r=e.stroke;n&&(n.cap&&(t.lineCap=n.cap),n.width&&(t.lineWidth=n.width)),r&&r.style&&(t.strokeStyle=r.style)}},r.drawPoints=function(t,e,n){void 0===n&&(n=e.length),t.beginPath();for(let r=0;r<n;++r){let i=(r+1)%n,o=e[r],s=e[i];t.moveTo(o[0],o[1]),t.lineTo(s[0],s[1])}t.stroke()},r.drawShapePoly=function(t,e){return this.drawPoints(t,e.points)},r.drawCircle=function(t,e,n,r){t.beginPath(),t.arc(e,n,r,0,i,!0),t.closePath(),t.stroke()},r.drawShapeCircle=function(t,e){this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},r.drawRect=function(t,e,n,r,i,o){let s=e,l=n-i;t.save(),t.translate(s,l),t.rotate(o),t.strokeRect(0,0,r,i),t.restore()},r.drawShapeRect=function(t,e){return this.drawRet(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},r.drawLine=function(t,e,n,r,i){t.beginPath(),t.moveTo(e,n),t.lineTo(r,i),t.stroke()},r.drawShapeLine=function(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])},e=r}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io.czlab.mcfud.geo2d"]=function(){if(e)return e;const n=t["io.czlab.mcfud.core"](),r=t["io.czlab.mcfud.math"](),i=r.V2Pool,o=n.u,s={};class l{constructor(t,e,n,i){2===arguments.length?(this.width=t,this.height=e,this.pos=r.V2()):(this.pos=r.V2(t,e),this.width=n,this.height=i)}}class c{constructor(t,e){this.width=t,this.height=e}half(){return new c(this.width/2,this.height/2)}}s.polyArea=function(t){let e=0;for(let n,r,i,o=t.length,s=0;s<o;++s)i=(s+1)%o,n=poly.points[s],r=poly.points[i],e+=n[0]*r[1]-r[0]*n[1];return Math.abs(e)/2},s.calcPolyCenter=function(t){let e=6*this.polyArea(t),n=0,i=0;for(let e,r,o,s=0,l=t.length;s<l;++s)o=(s+1)%l,e=t[s],r=t[o],n+=(e[0]+r[0])*(e[0]*r[1]-r[0]*e[1]),i+=(e[1]+r[1])*(e[0]*r[1]-r[0]*e[1]);return r.V2(n/e,i/e)};class u{constructor(t,e,n,i){this.p=r.V2(t,e),this.q=r.V2(n,i)}}class a{constructor(){this.orient=0,this.pos=r.V2()}setPos(t,e){return r.vecCopy(this.pos,t,e),this}set(t){t=function(t){let e=t.length;o.assert(e>2&&e<=64);let n=0,i=t[0][0];for(let o,s=1;s<e;++s)o=t[s][0],o>i?(i=o,n=s):r.fuzzyEq(o,i)&&t[s][1]<t[n][1]&&(n=s);let s=new Array(64),l=0,c=n;for(;;){s[l]=c;let i=0;for(let n=1;n<e;++n){if(i===c){i=n;continue}let e=r.vecSub(t[i],t[s[l]]),o=r.vecSub(t[n],t[s[l]]),u=r.vec2Cross(e,o);u<0&&(i=n),r.fuzzyZero(u)&&r.vecLen2(o)>r.vecLen2(e)&&(i=n)}if(++l,c=i,i===n)break}const u=[];for(let e=0;e<l;++e)u.push(r.vecClone(t[s[e]]));return u}(t),this.calcPoints?this.calcPoints.length=0:this.calcPoints=[],this.normals?this.normals.length=0:this.normals=[],this.edges?this.edges.length=0:this.edges=[];for(let e=0;e<t.length;++e)this.calcPoints.push(r.V2()),this.edges.push(r.V2()),this.normals.push(r.V2());return this.points=t,this._recalc(),this}setOrient(t){return this.orient=t,this._recalc(),this}translate(t,e){for(let n=0;n<this.points.length;++n)this.points[n][0]+=t,this.points[n][1]+=e;return this._recalc(),this}_recalc(){for(let t=0;t<this.points.length;++t)r.vecSet(this.calcPoints[t],this.points[t]),r.fuzzyZero(this.orient)||r.vec2RotSelf(this.calcPoints[t],this.orient);for(let t,e,n,i=0;i<this.points.length;++i)e=this.calcPoints[i],t=(i+1)%this.calcPoints.length,n=this.calcPoints[t],this.edges[i]=r.vecSub(n,e),this.normals[i]=r.vecUnit(r.perp(this.edges[i]));return this}}class h extends l{constructor(t,e,n,r){super(t,e,n,r)}toPolygon(){return(new a).setPos(this.pos[0],this.pos[1]).set([r.V2(this.width,0),r.V2(this.width,this.height),r.V2(0,this.height),r.V2()])}}class f{constructor(t,e){this.A=t,this.B=e,this.overlapN=r.V2(),this.overlapV=r.V2(),this.clear()}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function p(t,e){let n=1/0,o=-1/0;for(let i,s=0;s<t.length;++s)i=r.vecDot(t[s],e),i<n&&(n=i),i>o&&(o=i);return i.take(n,o)}function m(t,e){let n=r.vecDot(e,t),i=r.vecLen2(t);return n<0?-1:n>i?1:0}function d(t,e,n,o,s,l){let c,u=r.vecSub(n,t),a=r.vecDot(u,s),[h,f]=p(e,s),[m,d]=p(o,s);if(m+=a,d+=a,h>d||m>f)c=!0;else if(l){let t=0;if(h<m)if(l.AInB=!1,f<d)t=f-m,l.BInA=!1;else{let[e,n]=[f-m,d-h];t=e<n?e:-n}else if(l.BInA=!1,f>d)t=h-d,l.AInB=!1;else{let[e,n]=[f-m,d-h];t=e<n?e:-n}let e=Math.abs(t);e<l.overlap&&(l.overlap=e,r.vecSet(l.overlapN,s),t<0&&r.vecFlipSelf(l.overlapN))}return i.drop(u),c}s.getAABB=function(t){if(o.has(t,"radius"))return new s.Rect(t.pos[0]-t.radius,t.pos[1]-t.radius,2*t.radius,2*t.radius);{let e=t.calcPoints,n=e[0][0],r=e[0][1],i=n,o=r;for(let t,s=1;s<e.length;++s)t=e[s],t[0]<n&&(n=t[0]),t[0]>i&&(i=t[0]),t[1]<r&&(r=t[1]),t[1]>o&&(o=t[1]);return new s.Rect(t.pos[0]+n,t.pos[1]+r,i-n,o-r)}},s.shiftPoints=function(t,e){return t.map(t=>r.vecAdd(t,e))},s.rotPoints=function(t,e,n){return t.map(t=>r.vec2Rot(t,e,n))},s.calcRectPoints=function(t,e){return[r.V2(hw,-hh),r.V2(hw,hh),r.V2(-hw,hh),r.V2(-hw,-hh)]},s.line=function(t,e,n,r){return new u(t,e,n,r)},s.rectEqRect=function(t,e){return t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1]},s.rectContainsRect=function(t,e){return!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height)},s.rectGetMaxX=function(t){return t.pos[0]+t.width},s.rectGetMidX=function(t){return t.pos[0]+t.width/2},s.rectGetMinX=function(t){return t.pos[0]},s.rectGetMaxY=function(t){return t.pos[1]+t.height},s.rectGetMidY=function(t){return t.pos[1]+t.height/2},s.rectGetMinY=function(t){return t.pos[1]},s.containsPoint=function(t,e,n){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&n>=this.rectGetMinY(t)&&n<=this.rectGetMaxY(t)},s.rectIntersectsRect=function(t,e){return!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1])},s.rectUnionsRect=function(t,e){let n=Math.min(t.pos[0],e.pos[0]),r=Math.min(t.pos[1],e.pos[1]);return new l(n,r,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-r)},s.rectIntersectsRect=function(t,e){let n=Math.max(t.pos[0],e.pos[0]),r=Math.max(t.pos[1],e.pos[1]);return new l(n,r,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-r)},s.hitTestPointCircle=function(t,e){return r.vecLen2(r.vecSub(t,e.pos))<=e.radius*e.radius};const g=new f,v=new h(0,0,1,1).toPolygon();function y(t,e,n){let o=t.radius+e.radius,s=r.vecSub(e.pos,t.pos),l=o*o,c=r.vecLen2(s),u=!(c>l);if(u&&n){let i=Math.sqrt(c);n.A=t,n.B=e,n.overlap=o-i,r.vecSet(n.overlapN,r.vecUnitSelf(s)),r.vecSet(n.overlapV,r.vecMul(s,n.overlap)),n.AInB=t.radius<=e.radius&&i<=e.radius-t.radius,n.BInA=e.radius<=t.radius&&i<=t.radius-e.radius}return i.drop(s),u}function M(t,e,n){let o=r.vecSub(e.pos,t.pos),s=e.radius*e.radius,l=t.calcPoints,c=i.take(),u=i.take();for(let a=l.length,h=0;h<a;++h){let f=h===a-1?0:h+1,p=0===h?a-1:h-1,d=0,g=null;r.vecSet(c,t.edges[h]),r.vecSet(u,r.vecSub(o,l[h])),n&&r.vecLen2(u)>s&&(n.AInB=!1);let v=m(c,u);if(-1===v){r.vecSet(c,t.edges[p]);let s=r.vecSub(o,l[p]);if(v=m(c,s),1===v){let t=r.vecLen(u);if(t>e.radius)return i.drop(o,c,u,s),!1;n&&(n.BInA=!1,g=r.vecUnit(u),d=e.radius-t)}i.drop(s)}else if(1===v){if(r.vecSet(c,t.edges[f]),r.vecSubSelf(r.vecSet(u,o),l[f]),v=m(c,u),-1===v){let t=r.vecLen(u);if(t>e.radius)return i.drop(o,c,u),!1;n&&(n.BInA=!1,g=r.vecUnit(u),d=e.radius-t)}}else{let t=r.vecUnitSelf(r.perp(c)),s=r.vecDot(u,t),l=Math.abs(s);if(s>0&&l>e.radius)return i.drop(o,t,u),!1;n&&(g=t,d=e.radius-s,(s>=0||d<2*e.radius)&&(n.BInA=!1))}g&&n&&Math.abs(d)<Math.abs(n.overlap)&&(n.overlap=d,r.vecSet(n.overlapN,g))}return n&&(n.A=t,n.B=e,r.vecMulSelf(r.vecSet(n.overlapV,n.overlapN),n.overlap)),i.drop(o,c,u),!0}function x(t,e,n){let i=M(e,t,n);if(i&&n){let t=n.A,e=n.AInB;r.vecFlipSelf(n.overlapN),r.vecFlipSelf(n.overlapV),n.A=n.B,n.B=t,n.AInB=n.BInA,n.BInA=e}return i}function b(t,e,n){let i=t.calcPoints,o=e.calcPoints;for(let r=0;r<i.length;++r)if(d(t.pos,i,e.pos,o,t.normals[r],n))return!1;for(let r=0;r<o.length;++r)if(d(t.pos,i,e.pos,o,e.normals[r],n))return!1;return n&&(n.A=t,n.B=e,r.vecMulSelf(r.vecSet(n.overlapV,n.overlapN),n.overlap)),!0}return s.hitTestPointPolygon=function(t,e){return r.vecSet(v.pos,t),!!this.hitTestPolygonPolygon(v,e,g.clear())&&g.AInB},s.hitCircleCircle=function(t,e){let n=new f;return y(t,e,n)?n:null},s.hitTestCircleCircle=function(t,e){return y(t,e)},s.hitPolygonCircle=function(t,e){let n=new f;return M(t,e,n)?n:null},s.hitTestPolygonCircle=function(t,e){return M(t,e)},s.hitCirclePolygon=function(t,e){let n=new f;return x(t,e,n)?n:null},s.hitTestCirclePolygon=function(t,e){return x(t,e)},s.hitPolygonPolygon=function(t,e){let n=new f;return b(t,e,n)?n:null},s.hitTestPolygonPolygon=function(t,e){return b(t,e)},e=o.inject(s,{Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=r.V2()}setOrient(t){return this.orient=t,this}setPos(t,e){return r.vecCopy(this.pos,t,e),this}},Line:u,Box:h,Manifold:f,Polygon:a,Rect:l,Area:c})}}(this),function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io.czlab.mcfud.negamax"]=function(){if(e)return e;const n=t["io.czlab.mcfud.core"]().u,r={},i=1e6;function o(t,e,r,s,l,c){if(0===s||t.isOver(e))return t.evalScore(e);let u=t.getNextMoves(e),a=-i,h=u[0];s===r&&(e.lastBestMove=u[0]);for(let i,f,p=0;p<u.length&&(f=u[p],t.makeMove(e,f),t.switchPlayer(e),i=-o(t,e,r,s-1,-c,-l),t.switchPlayer(e),t.undoMove(e,f),a=n.max(a,i),!(l<i&&(l=i,h=f,s===r&&(e.lastBestMove=f),l>=c)));++p);return a}return r.evalNegaMax=function(t){let e=t.takeFFrame();return o(t,e,10,10,-i,i),e.lastBestMove},e=n.inject(r,{FFrame:class{constructor(t){this.state=n.fill(new Array(t*t),0),this.lastBestMove=0,this.other=0,this.cur=0}},GameBoard:class{constructor(){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}undoMove(t,e){}makeMove(t,e){}switchPlayer(t){}takeFFrame(){}}})}}(this);