!function(t,e,r){var s,i=256,n="random",o=r.pow(i,6),l=r.pow(2,52),a=2*l,h=255;function u(h,u,g){function m(){for(var t=x.g(6),e=o,r=0;t<l;)t=(t+r)*i,e*=i,r=x.g(1);for(;a<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var y=[],w=d(function t(e,r){var s,i=[],n=typeof e;if(r&&"object"==n)for(s in e)try{i.push(t(e[s],r-1))}catch(t){}return i.length?i:"string"==n?e:e+"\0"}((u=1==u?{entropy:!0}:u||{}).entropy?[h,p(e)]:null==h?function(){try{var r;return s&&(r=s.randomBytes)?r=r(i):(r=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(r)),p(r)}catch(r){var n=t.navigator,o=n&&n.plugins;return[+new Date,t,o,t.screen,p(e)]}}():h,3),y),x=new c(y);return m.int32=function(){return 0|x.g(4)},m.quick=function(){return x.g(4)/4294967296},m.double=m,d(p(x.S),e),(u.pass||g||function(t,e,s,i){return i&&(i.S&&f(i,x),t.state=function(){return f(x,{})}),s?(r[n]=t,e):t})(m,w,"global"in u?u.global:this==r,u.state)}function c(t){var e,r=t.length,s=this,n=0,o=s.i=s.j=0,l=s.S=[];for(r||(t=[r++]);n<i;)l[n]=n++;for(n=0;n<i;n++)l[n]=l[o=h&o+t[n%r]+(e=l[n])],l[o]=e;(s.g=function(t){for(var e,r=0,n=s.i,o=s.j,l=s.S;t--;)e=l[n=h&n+1],r=r*i+l[h&(l[n]=l[o=h&o+e])+(l[o]=e)];return s.i=n,s.j=o,r})(i)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var r,s=t+"",i=0;i<s.length;)e[h&i]=h&(r^=19*e[h&i])+s.charCodeAt(i++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(d(r.random(),e),"object"==typeof module&&module.exports){module.exports=u;try{s=require("crypto")}catch(u){}}else"function"==typeof define&&define.amd?define((function(){return u})):r["seed"+n]=u}("undefined"!=typeof self?self:this,[],Math),function(t,e,r){"use strict";function s(){const s=t,i=Math.floor,n=Array.prototype.slice,o=Object.prototype.toString;function l(t){return"[object Object]"==o.call(t)}function a(t){return"[object Function]"==o.call(t)}function h(t){return"[object Array]"==o.call(t)}function u(t){return"[object Map]"==o.call(t)}function c(t){return"[object Set]"==o.call(t)}function f(t){return"[object String]"==o.call(t)}function d(t){return"[object Number]"==o.call(t)}function p(t){return"[object Boolean]"==o.call(t)}function g(t){return t>0?t%2==0:-t%2==0}function m(t){return void 0===t}function y(t){return h(t)||u(t)||l(t)}let w=r?r():new Math.seedrandom;function x(t,e){for(let r,s=0;s<t.length;++s)if(r=t[s],!r[0](r[1]))throw new TypeError("wanted "+e);return!0}function v(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError("wanted "+e)}function b(t,e,r){if(t(e))return!0;throw new TypeError("wanted "+r)}const E=/(\/|\\\\)([^(\/|\\\\)]+)$/g,M=/(\.[^\.\/\?\\]*)(\?.*)?$/;function k(t,e){let r=M.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}let q=0;function j(t,e,r){let s=t(e);switch(r.length){case 0:return s;case 1:return s&&t(r[0]);case 2:return s&&t(r[0])&&t(r[1]);case 3:return s&&t(r[0])&&t(r[1])&&t(r[2]);default:return s&&r.every(e=>t(e))}}const A={},N={fun:(t,...e)=>j(a,t,e),str:(t,...e)=>j(f,t,e),undef:(t,...e)=>j(m,t,e),map:(t,...e)=>j(u,t,e),set:(t,...e)=>j(c,t,e),num:(t,...e)=>j(d,t,e),bool:(t,...e)=>j(p,t,e),pos:t=>d(t)&&t>0,neg:t=>d(t)&&t<0,vec:(t,...e)=>j(h,t,e),obj:(t,...e)=>j(l,t,e),some:t=>P.size(t)>0,none:t=>0===P.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},P={error(...t){console.error(...t)},log(...t){console.log(...t)},srand(){w=r?r():new Math.seedrandom},feq0:t=>Math.abs(t)<1e-10,feq:(t,e)=>Math.abs(t-e)<1e-10,pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec(t,...e){e.forEach((e,r)=>t[r]=e)},evenN:(t,e)=>g(t=Math.floor(t))?t:e?t+1:t-1,nichts:t=>null==t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const r=parseFloat(t);return isNaN(r)&&d(e)?e:r},percentRemain:(t,e,r)=>(t>e&&(t=r?t%e:e),Math.max(0,e-t)/e),splitVerStr(t){const e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),s=this.splitVerStr(""+e);return r[0]>s[0]?1:r[0]<s[0]?-1:r[1]>s[1]?1:r[1]<s[1]?-1:r[2]>s[2]?1:r[2]<s[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter(t=>e.indexOf(k(t,1))>-1),partition(t,e){const r=[];for(let s,i,n=0;;){for(s=[],i=0;i<t;++i){if(!(n<e.length)){i=-1;break}s.push(e[n++])}if(s.length>0&&r.push(s),i<0)break}return r},keys:t=>u(t)?Array.from(t.keys()):l(t)?Object.keys(t):[],selectNotKeys(t,e){v([[u,t],[l,t]],"map/object");const r=u(t)?new Map:{};return e=this.seq(e),this.doseq(t,(t,s)=>!e.includes(s)&&this.assoc(r,s,t)),r},selectKeys(t,e){v([[u,t],[l,t]],"map/object");const r=u(t)?new Map:{};return this.seq(e).forEach(e=>{u(t)?t.has(e)&&r.set(e,t.get(e)):N.own(t,e)&&(r[e]=t[e])}),r},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0===e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),t=>this.has(e,t)?t:null)},randInt2:(t,e)=>function(t,e){return i(w()*(e-t+1)+t)}(t,e),randFloat:(t,e)=>t+w()*(e-t),randMinus1To1:()=>2*(w()-.5),randInt:t=>i(w()*t),rand:(t=!1)=>t?Math.random():w(),randSign:()=>w()>.5?-1:1,inst:(t,e)=>e instanceof t,hashCode(t){let e=0;for(let r=0;r<t.length;++r)e=Math.imul(31,e)+t.charCodeAt(r);return e},randItem(t,e){let r,s=-1;if(t)switch(t.length){case 0:case 1:r=t[s=0];break;case 2:r=t[s=this.randSign()>0?1:0];break;default:r=t[s=i(w()*t.length)]}return e?[r,s]:r},isPerc:t=>f(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>g(t),jsMap(...t){b(g,t.length,"even n# of args");let e=new Map;for(let r=0;r<t.length;)e.set(t[r],t[r+1]),r+=2;return e},jsObj(...t){b(g,t.length,"even n# of args");let e={};for(let r=0;r<t.length;)e[t[r]]=t[r+1],r+=2;return e},jsVec:(...t)=>0===t.length?[]:t.slice(),lastIndex:t=>h(t)&&t.length>0?t.length-1:-1,first(t){if(h(t)&&t.length>0)return t[0]},last(t){if(h(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>n.call(t,e),every(t,e){b(h,t,"array");for(let r=0;r<t.length;++r)if(a(e)){if(!e(t[r]))return!1}else if(t[r]!=e)return!1;return t.length>0},notAny(t,e){b(h,t,"array");for(let r=0;r<t.length;++r)if(a(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){x([[h,t],[h,e]],"arrays");const r=Math.min(t.length,e.length);for(let s=0;s<r;++s)t[s]=e[s];return t},append(t,e=[]){x([[h,t],[h,e]],"arrays");for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e,...r){if(d(t)&&(t=new Array(t)),h(t))for(let s=0;s<t.length;++s)t[s]=a(e)?e(s,...r):e;return t},size(t){return h(t)||f(t)?t.length:c(t)||u(t)?t.size:t?this.keys(t).length:0},nextId:()=>++q,now:()=>Date.now(),fileExt:t=>k(t),fileBase(t){let e,r,s=t.indexOf("?");return s>0&&(t=t.substring(0,s)),t=t.replace(/(\/|\\\\)$/,""),r=E.exec(t),e="",r&&(e=r[2],s=e.lastIndexOf("."),s>0&&(e=e.substring(0,s))),e},range(t,e,r=1){1===arguments.length&&(e=t,t=0,r=1);let s=(e-t)/r;const i=[];s=Math.ceil(s),s=Math.max(0,s),i.length=s;for(let e=0;e<s;++e)i[e]=t,t+=r;return i},shuffle(t,e=!0){b(h,t,"array");const r=n.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,s=r.length-1;s>0;--s)e=i(w()*(s+1)),t=r[s],r[s]=r[e],r[e]=t}return e?this.copy(t,r):r},shuffle2(t,e=!0){if(b(h,t,"array"),t.length<3)t=this.shuffle(t,e);else{const e=t.length;n.call(t,0);for(let r,s,n=0;n<e;++n)s=n+i(w()*(e-n)),r=t[s],t[s]=t[n],t[n]=r}return t},uniq:t=>(b(h,t,"array"),Array.from(new Set(t))),map(t,e,r){if(b(y,t,"array/map/object"),h(t))return t.map(e,r);{const s=u(t)?new Map:{};return this.doseq(t,(i,n)=>{this.assoc(s,n,e.call(r,i,n,t))}),s}},find(t,e,r){let s,i=!0,o=n.call(arguments,3);return this.doseq(t,(t,n)=>{i&&e.apply(r,[t,n].concat(o))&&(s=[n,t],i=!1)}),s},some(t,e,r){let s,i=!0,o=n.call(arguments,3);return this.doseq(t,(t,n)=>{i&&(s=e.apply(r,[t,n].concat(o)),s?i=!1:s=void 0)}),s},invoke(t,e){let r=n.call(arguments,2);h(t)&&t.forEach(t=>t[e].apply(t,r))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):N.pos(t)&&clearTimeout(t)},dotimes(t,e,r,...s){for(let i=0;i<t;++i)e.call(r,i,...s)},rseq(t,e,r){if(b(h,t,"array"),t.length>0)for(let s=t.length-1;s>=0;--s)e.call(r,t[s],s,t)},doseq(t,e,r){h(t)?t.forEach(e,r):u(t)?t.forEach((s,i)=>e.call(r,s,i,t)):l(t)&&Object.keys(t).forEach(s=>e.call(r,t[s],s,t))},doseqEx(t,e,r){this.doseq(t,(s,i)=>null!=s&&e.call(r,s,i,t))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return u(t)?(r=t.get(e),t.delete(e)):l(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let s;return u(t)?(s=t.get(e),t.set(e,r)):t&&(s=t[e],t[e]=r),s}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach(e=>t.push(e)),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),h(t)||(t=[t]),t),has(t,e){return 1!==arguments.length&&(u(t)?t.has(e):h(t)?-1!==t.indexOf(e):!!l(t)&&N.own(t,e))},patch(t,e){return b(l,t=t||{},"object"),e&&Object.keys(e).forEach(r=>{this.has(t,r)||(t[r]=e[r])}),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach(e=>e&&function(t,e){let r=Object.keys(e).reduce((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t),{});return Object.getOwnPropertySymbols(e).forEach(t=>{let s=Object.getOwnPropertyDescriptor(e,t);s.enumerable&&(r[t]=s)}),Object.defineProperties(t,r),t}(t,e)),t),deepCopyArray(t){b(h,t,"array");const e=[];for(let r=0,s=t.length;r<s;++r)e[r]=h(t[r])?this.deepCopyArray(t[r]):t[r];return e},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach(s=>{r=e[s],"object"==typeof r&&null!==r&&t[s]?("object"!=typeof t[s]&&(t[s]=r instanceof Array?[]:{}),this.merge(t[s],r)):t[s]=r}),t},throttle(t,e,r){let s=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return l(r)&&(s="leading"in r?!!r.leading:s,i="trailing"in r?!!r.trailing:i),this.debounce(t,e,{leading:s,trailing:i,maxWait:e})},debounce(t,e,r){let i,n,o,a,h,u,c=0,f=!1,d=!1,p=!0;const g=!e&&0!==e&&"function"==typeof s.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){const r=i,s=n;return i=n=void 0,c=e,a=t.apply(s,r),a}function y(t,e){return g?(s.cancelAnimationFrame(h),s.requestAnimationFrame(t)):setTimeout(t,e)}function w(t){const r=t-u;return void 0===u||r>=e||r<0||d&&t-c>=o}function x(){const t=Date.now();if(w(t))return v(t);h=y(x,function(t){const r=t-c,s=e-(t-u);return d?Math.min(s,o-r):s}(t))}function v(t){return h=void 0,p&&i?m(t):(i=n=void 0,a)}function b(...t){const r=Date.now(),s=w(r);if(i=t,n=this,u=r,s){if(void 0===h)return function(t){return c=t,h=y(x,e),f?m(t):a}(u);if(d)return h=y(x,e),m(u)}return void 0===h&&(h=y(x,e)),a}return e=+e||0,l(r)&&(f=!!r.leading,d="maxWait"in r,o=d?Math.max(+r.maxWait||0,e):o,p="trailing"in r?!!r.trailing:p),b.cancel=function(){void 0!==h&&function(t){if(g)return s.cancelAnimationFrame(t);clearTimeout(t)}(h),c=0,i=u=n=h=void 0},b.flush=function(){return void 0===h?a:v(Date.now())},b.pending=function(){return void 0!==h},b},negate:t=>(b(a,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter(t=>t.length>0),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2){return this.strPadLeft(Number(t).toString(),e,"0")},prettyMillis(t){let e,r,s=i(t/1e3);r=i(s/60),t-=1e3*s,s-=60*r,e=i(r/60),r-=60*e;let n=[];return n.push(`${s}.${t} secs`),(r>0||e>0)&&n.push(r+" mins, "),e>0&&n.push(e+" hrs, "),n.reverse().join("")},dropArgs:(t,e)=>t.length>e?n.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2===arguments.length&&911===arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let s=e.indexOf("/",t+3);return(s<0?e:e.substring(0,s))!=r.location.origin}}},addEvent(t,e,r,s){h(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,r,s)},delEvent(t,e,r,s){h(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,r,s)}},_={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>f(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!l(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&P.doseq(e,(e,r)=>t.setAttribute(r,e)),t)},css(t,e){return!l(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&P.doseq(e,(e,r)=>t.style[r]=e),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,s){const i=e.createElement(t);return this.attrs(i,r),this.css(i,s),i},newTxt(t,r,s){const i=e.createTextNode(t);return this.attrs(i,r),this.css(i,s),i}},S={},T=[];class z{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,r,s){let i=t[0],n=t[1];return n&&!this._targets.has(n)&&this._targets.set(n,1),P.seq(i).forEach(t=>{if(e||(e=t),f(e)&&(e=(r=r||n)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,P.jsMap());let i=this._tree.get(t);n=n||S,!i.has(n)&&i.set(n,[]),i.get(n).push([e,r,s])}),this}pub(t,...e){let r,s,i=t[0],n=t[1]||S;return(n===S||this._targets.has(n))&&P.seq(i).forEach(t=>{s=this._tree.get(t),r=s&&s.get(n),r&&r.forEach(t=>{t[0].apply(t[1],e.concat(t[2]||T))})}),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let r=e.next();!r.done;)r.value.delete(t),r=e.next()}return this}unsub(t,e,r){if(1!==arguments.length||N.vec(t)){let s=t[0],i=t[1]||S;if(i===S||this._targets.has(i)){let t,n;P.seq(s).forEach(s=>{if(t=this._tree.get(s),n=t&&t.get(i),n&&(f(e)&&(e=(r=r||i)[e]),e))for(let t=n.length-1;t>=0;--t)n[t][0]===e&&n[t][1]===r&&n.splice(t,1)})}}else this.drop(t);return this}}return e?A.dom=_:(delete P.addEvent,delete P.delEvent),A.EventBus=function(){return new z},A.is=N,A.u=P,A}"object"==typeof module&&module.exports?r=require("../tpcl/seedrandom.min"):e=t.document,"object"==typeof module&&module.exports?module.exports=s():t["io/czlab/mcfud/core"]=s}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,s=2*Math.PI,{is:i,u:n}=(Math.PI,e);function o(t){return t<0?- -t%r:t%r}return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*Math.floor(-t/e)):t%e,clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>n.feq(t,e),fuzzyZero:t=>n.feq0(t),radToDeg:t=>o(r*t/s),degToRad:t=>s*o(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/math"]=e}(this),function(t){"use strict";function e(e=null){e||(e=t["io/czlab/mcfud/core"]());const{u:r,is:s}=e;function i(t,e){r.assert(!s.num(t)&&!s.num(e)&&t&&e,"wanted 2 vecs")}function n(t,e=0,r=0){return t?[e,r]:{x:e,y:r}}const o={};class l{constructor(){this.x=0,this.y=0}unit(t){return s.bool(t)&&(t=n(t)),s.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return s.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,r){let i=o.take();switch(i.x=this.x,i.y=this.y,t){case"+":s.num(e)&&(i.x+=e),s.num(r)&&(i.y+=r);break;case"-":s.num(e)&&(i.x-=e),s.num(r)&&(i.y-=r);break;case"*":s.num(e)&&(i.x*=e),s.num(r)&&(i.y*=r);break;case"/":s.num(e)&&(i.x/=e),s.num(r)&&(i.y/=r)}return i}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function a(t,e,r,i,n,o,l){const a=t-n,h=e-o,u=n+(a*r-h*i),c=o+(a*i+h*r);return s.vec(l)?(l[0]=u,l[1]=c):(l.x=u,l.y=c),l}function h(t,e,r,i){let n,l,a=o.take().bind(t);if(s.num(e))l=a.op(r,e,e);else{let t=o.take().bind(e);l=a[r](t),o.drop(t)}return n=l.unit(i?t:s.vec(t)),o.drop(a,l),n}r.inject(o,{take(){return this._pool.pop()},drop(...t){t.forEach(t=>{t.x=0,t.y=0,this._pool.push(t)})},_pool:r.fill(16,()=>new l)});return{vec:(t=0,e=0)=>n(!0,t,e),vecXY:(t=0,e=0)=>n(!1,t,e),add(t,e){return r.assert(2===arguments.length)&&h(t,e,"+")},add$(t,e){return r.assert(2===arguments.length)&&h(t,e,"+",!0)},sub(t,e){return r.assert(2===arguments.length)&&h(t,e,"-")},sub$(t,e){return r.assert(2===arguments.length)&&h(t,e,"-",!0)},mul(t,e){return r.assert(2===arguments.length)&&h(t,e,"*")},mul$(t,e){return r.assert(2===arguments.length)&&h(t,e,"*",!0)},div(t,e){return r.assert(2===arguments.length)&&h(t,e,"/")},div$(t,e){return r.assert(2===arguments.length)&&h(t,e,"/",!0)},dot(t,e){i(t,e);let r=o.take().bind(t),s=o.take().bind(e),n=r.x*s.x+r.y*s.y;return o.drop(r,s),n},equals(t,e){let r=o.take().bind(t),s=o.take().bind(e);return ok=r.x==s.x&&r.y==s.y,o.drop(r,s),ok},vecAB(t,e){i(t,e);let r=o.take().bind(t),n=o.take().bind(e),l=o.take();l.x=n.x-r.x,l.y=n.y-r.y;let a=l.unit(s.vec(t));return o.drop(r,n,l),a},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e=o.take().bind(t),i=this.len(t);r.feq0(i)?(e.x=0,e.y=0):(e.x/=i,e.y/=i);let n=e.unit(s.vec(t));return o.drop(e),n},unit$(t){let e=o.take().bind(t),s=this.len(t);r.feq0(s)?(e.x=0,e.y=0):(e.x/=s,e.y/=s);let i=e.unit(t);return o.drop(e),i},copy(t,e){i(t,e);let r=o.take().bind(t),s=o.take().bind(e);r.x=s.x,r.y=s.y;let n=r.unit(t);return o.drop(r,s),n},clone(t){let e=o.take().bind(t),r=e.unit(s.vec(t));return o.drop(e),r},set(t,e,r){let i=o.take().bind(t);s.num(e)&&(i.x=e),s.num(r)&&(i.y=r);let n=i.unit(t);return o.drop(i),n},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,r=null){let i=o.take().bind(t),l=0,h=0;if(r){let t=o.take().bind(r);l=t.x,h=t.y,o.drop(t)}let u=a(i.x,i.y,Math.cos(e),Math.sin(e),l,h,n(s.vec(t)));return o.drop(i),u},rot$(t,e,r){let s=o.take().bind(t),i=0,n=0;if(r){let t=o.take().bind(r);i=t.x,n=t.y,o.drop(t)}let l=a(s.x,s.y,Math.cos(e),Math.sin(e),i,n,t);return o.drop(s),l},cross(t,e){let r;if(s.num(t)){let i=o.take().bind(e),n=o.take();n.x=-t*i.y,n.y=t*i.x,r=n.unit(s.vec(e)),o.drop(i,n)}else if(s.num(e)){let i=o.take().bind(t),n=o.take();n.x=e*i.y,n.y=-e*i.x,r=n.unit(s.vec(t)),o.drop(i,n)}else{i(t,e);let s=o.take().bind(t),n=o.take().bind(e);r=s.x*n.y-s.y*n.x,o.drop(s,n)}return r},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let r=o.take().bind(t),i=o.take();e?(i.x=-r.y,i.y=r.x):(i.x=r.y,i.y=-r.x);let n=i.unit(s.vec(t));return o.drop(r,i),n},normal$(t,e=!1){let r=o.take().bind(t),s=o.take();e?(s.x=-r.y,s.y=r.x):(s.x=r.y,s.y=-r.x);let i=s.unit(t);return o.drop(r,s),i},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);this.mul$(r,this.dot(t,r));let i=o.take().bind(r),n=i.unit(s.vec(t));return o.drop(i),n},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){let r=2*this.dot(t,e);return this.sub(t,this.mul(e,r))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let r,i,n,l,a=o.take().bind(t);return 1===e.length&&s.vec(e[0])&&!s.num(e[0][0])&&(e=e[0]),n=e.map(t=>(i=o.take().bind(t),r=i["+"](a),l=r.unit(s.vec(t)),o.drop(i,r),l)),o.drop(a),n}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/vec2"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const r=Math.cos,s=Math.sin,i=(Math.tan,Math.floor),{u:n,is:o}=e;function l(t){return t%2!=0}function a(t,e,r,s){return s-1+(r-1)*e}function h(t,e,r){return{dim:[t,e],cells:r}}function u(t,e){return h(t,e,n.fill(t*e,0))}return{v4:(t=0,e=0,r=0,s=0)=>[t,e,r,s],v3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!n.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return o.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return o.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return o.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return o.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const s=t*e;return 0===r.length?u(t,e):n.assert(s===r.length)&&h(t,e,r)},matCell(t,e,r,s){const i=a(t.dim[0],t.dim[1],e,r);if(i>=0&&i<t.cells.length)return o.num(s)?(t.cells[i]=s,t):t.cells[i]},matIdentity(t){const e=n.assert(t>0)&&n.fill(t*t,0);for(let r=0;r<t;++r)e[a(0,t,r+1,r+1)]=1;return h(t,t,e)},matZero:t=>n.assert(t>0)&&h(t,t,n.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return n.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,s=[];for(let i,n=0;n<r;++n){i=[];for(let s=0;s<e;++s)i.push(t.cells[s*r+n]);s.push(i)}return s},mat2(t,e,r,s){return this.matrix([2,2],t,e,r,s)},mat3(t,e,r,s,i,n,o,l,a){return this.matrix([3,3],t,e,r,s,i,n,o,l,a)},mat4(t,e,r,s,i,n,o,l,a,h,u,c,f,d,p,g){return this.matrix([4,4],t,e,r,s,i,n,o,l,a,h,u,c,f,d,p,g)},matEq:(t,e)=>t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&function(t,e){for(let r=0;r<t.length;++r)if(!n.feq(t[r],e[r]))return!1;return!0}(t.cells,e.cells),matXpose(t){const[e,r]=t.dim,s=e*r,n=[];for(let o=0;o<s;++o)n.push(t.cells[i(o/e)+r*(o%e)]);return h(r,e,n)},matScale:(t,e)=>h(t.dim[0],t.dim[1],t.cells.map(t=>t*e)),matMult(t,e){let[r,s]=t.dim,[i,o]=e.dim,l=t.cells,a=e.cells;n.assert(s===i,"mismatch matrices");let u=new Array(r*o);for(let t=0;t<r;++t)for(let e=0;e<o;++e)u[e+t*o]=n.range(i).reduce((r,i)=>r+l[i+t*s]*a[e+i*o],0);return h(r,o,u)},matDet(t){let[e,r]=t.dim,s=[];if(2===r)return this._matDet2x2(t);for(let e=0;e<r;++e)n.conj(s,this.matDet(this.matCut(t,1,e+1)));return n.range(r).reduce((e,r)=>{let i=s[r];return e+t.cells[r]*(l(r)?-i:i)},0)},_matDet2x2:t=>(n.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){const[s,i]=t.dim;let o=e-1,l=r-1,a=[];for(let e=0;e<s;++e)for(let r=0;r<i;++r)e!==o&&r!==l&&n.conj(a,t.cells[r+e*i]);return h(s-1,i-1,a)},matMinor(t){const[e,r]=t.dim;let s=[];if(n.assert(e===r),2===r)return this._matMinor2x2(t);for(let i=0;i<e;++i)for(let e=0;e<r;++e)n.conj(s,this.matDet(this.matCut(t,i+1,e+1)));return h(e,r,s)},_matMinor2x2(t){return n.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[r,s]=e.dim;let i=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<s;++r)e=t*s+r,l(t+r)&&(i[e]=-i[e]);return h(r,s,i)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,r]=t.dim;n.assert(4===t.cells.length&&2===e&&2===r);let s,i=t.cells,o=i[0]*i[3]-i[1]*i[2];if(n.feq0(o))s=this.matIdentity(e);else{let t=1/o;s=this.mat2(i[3]*t,-i[1]*t,-i[2]*t,i[0]*t)}return s},matInv(t){const[e,r]=t.dim;if(2===r)return this._minv2x2(t);let s=this.matDet(t);return n.feq0(s)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/s)},matFromColMajor(t){let e=t.length,r=u(t[0].length,e);for(let s,i=0;i<t.length;++i){s=t[i];for(let t=0;t<s.length;++t)r.cells[t*e+i]=s[t]}return r},matToColMajor(t){const[e,r]=t.dim,s=[];t.cells.slice();for(let i,n=0;n<r;++n){i=[];for(let s=0;s<e;++s)i.push(t.cells[s*r+n]);s.push(i)}return s},scale3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,1,1)]=t[0],e.cells[a(0,4,2,2)]=t[1],e.cells[a(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,4,1)]=t[0],e.cells[a(0,4,4,2)]=t[1],e.cells[a(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],s=e.length;n.assert(r===s);let i=this.matMult(t,h(s,1,e)),o=i.cells;return i.cells=null,o},rot2D(t){return this.mat2(r(t),-s(t),s(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-s(t),0,0,s(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,s(t),0,0,1,0,0,-s(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-s(t),0,0,s(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e===r){for(let s,i=0;i<e;++i)for(let e=0;e<r;++e)if(s=t.cells[i*r+e],i+1===e+1){if(1!==s)return!1}else if(0!==s)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1===Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/matrix"]=e}(this),function(t){"use strict";const e=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",r=e.length;function s(s){s||(s=t["io/czlab/mcfud/core"]());const{u:i}=s;function n(t){return Math.abs(t)%r}function o(t,r){return(r||e).charAt(t)}function l(t){for(let e=0;e<r;++e)if(o(e)===t)return e;return-1}function a(t,e){let s=e+t;return o(s>=r?s-r:s)}function h(t,e){let s=e-t;return o(s<0?r+s:s)}return{encrypt(t,e){if(0===e)return t;let r,s=[],i=n(e);return t.split("").forEach(t=>{r=l(t),s.push(r<0?t:function(t,e,r){return t<0?a(e,r):h(e,r)}(e,i,r))}),s.join("")},decrypt(t,e){if(0===e)return t;let r,s=[],i=n(e);return t.split("").forEach(t=>{r=l(t),s.push(r<0?t:function(t,e,r){return t<0?h(e,r):a(e,r)}(e,i,r))}),s.join("")}}}"object"==typeof module&&module.exports?module.exports=s(require("./core")):t["io/czlab/mcfud/crypt"]=s}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change",s){const i=t[e],n=i&&i.transitions[r];if(n){const r=n.target,o=t[r];if(o)return i.exit&&i.exit(),o.enter&&o.enter(),s&&s.action?s.action():n.action&&(s?n.action(s):n.action()),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/fsm"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());const s=2*Math.PI,{u:i}=e;return{TXMatrix2D:class{constructor(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]}identity(){const t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this}clone(t){let e=this.m,r=t.m;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],this}multiply(t){let e=this.m,r=t.m,s=e[0]*r[0]+e[1]*r[3],i=e[0]*r[1]+e[1]*r[4],n=e[0]*r[2]+e[1]*r[5]+e[2],o=e[3]*r[0]+e[4]*r[3],l=e[3]*r[1]+e[4]*r[4],a=e[3]*r[2]+e[4]*r[5]+e[5];return e[0]=s,e[1]=i,e[2]=n,e[3]=o,e[4]=l,e[5]=a,this}rotate(t){if(!i.feq0(t)){let e=this.m,r=Math.cos(t),s=Math.sin(t),i=e[0]*r+e[1]*s,n=-e[0]*s+e[1]*r,o=e[3]*r+e[4]*s,l=-e[3]*s+e[4]*r;e[0]=i,e[1]=n,e[3]=o,e[4]=l}return this}rotateDeg(t){return i.feq0(t)?this:this.rotate(Math.PI*t/180)}scale(t,e){let r=this.m;return void 0===e&&(e=t),r[0]*=t,r[1]*=e,r[3]*=t,r[4]*=e,this}translate(t,e){let r=this.m;return r[2]+=r[0]*t+r[1]*e,r[5]+=r[3]*t+r[4]*e,this}transform(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]}transformPoint(t){const[e,r]=this.transform(t.x,t.y);return t.x=e,t.y=r,t}transformArray(t){return this.transform(t[0],t[1])}setContextTransform(t){const e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}},textStyle(t,e,r,s){const i={font:t,fill:e};return r&&(i.align=r),s&&(i.base=s),i},drawShape(t,e,...r){e&&e.draw&&e.draw(t,...r)},cfgStyle(t,e){const{line:r,stroke:s}=e;r&&(r.cap&&(t.lineCap=r.cap),r.width&&(t.lineWidth=r.width)),s&&s.style&&(t.strokeStyle=s.style)},drawPoints(t,e,r){void 0===r&&(r=e.length),i.assert(r<=e.length),t.beginPath();for(let s,i,n,o=0;o<r;++o)n=(o+1)%r,s=e[o],i=e[n],t.moveTo(s[0],s[1]),t.lineTo(i[0],i[1]);t.stroke()},drawShapePoly(t,e){return this.drawPoints(t,e.points)},drawCircle(t,e,r,i){t.beginPath(),t.arc(e,r,i,0,s,!0),t.closePath(),t.stroke()},drawShapeCircle(t,e){return this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},drawRect(t,e,r,s,i,n){let o=e,l=r-i;t.save(),t.translate(o,l),t.rotate(n),t.strokeRect(0,0,s,i),t.restore()},drawShapeRect(t,e){return this.drawRect(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},drawLine(t,e,r,s,i){t.beginPath(),t.moveTo(e,r),t.lineTo(s,i),t.stroke()},drawShapeLine(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])}}}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math")):t["io/czlab/mcfud/gfx"]=e}(this),function(t){"use strict";const[e,r,s]=[1,0,-1];function i(i,n,o){i||(i=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]()),o||(o=t["io/czlab/mcfud/vec2"]());const l=Math.floor,a=Math.abs,{u:h}=i;function u(t){const e=t.length,r=h.assert(e<=36)&&h.fill(36);let s=0,i=t[0][0];for(let r,n=1;n<e;++n)r=t[n][0],r>i?(i=r,s=n):h.feq(r,i)&&t[n][1]<t[s][1]&&(s=n);let n=0,l=s;for(;;){r[n]=l;let i=0,a=r[n];for(let r,s,n,u=1;u<e;++u)i!==l?(r=o.sub(t[i],t[a]),s=o.sub(t[u],t[a]),n=o.cross(r,s),n<0&&(i=u),h.feq0(n)&&o.len2(s)>o.len2(r)&&(i=u)):i=u;if(l=i,++n,i===s)break}const a=[];for(let e=0;e<n;++e)a.push(o.clone(t[r[e]]));return a}class c{constructor(t,e,r,s){switch(arguments.length){case 2:this.pos=o.vec(),this.width=t,this.height=e;break;case 4:this.pos=o.vec(t,e),this.width=r,this.height=s;break;default:throw"Error: bad input to Rect()"}}}class f{constructor(t,e){this.width=t,this.height=e}half(){return new f(l(this.width/2),l(this.height/2))}}class d{constructor(t,e,r,s){this.p=o.vec(t,e),this.q=o.vec(r,s)}}class p{constructor(t,e){this.calcPoints=null,this.normals=null,this.edges=null,this.points=null,this.orient=0,this.pos=o.vec(),this.setPos(t,e)}setPos(t=0,e=0){return o.set(this.pos,t,e),this}set(t){return this.calcPoints=this.calcPoints||[],this.normals=this.normals||[],this.edges=this.edges||[],this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=h.assert(t.length>2)&&u(t),h.doseq(this.points,t=>{this.calcPoints.push(o.vec()),this.edges.push(o.vec()),this.normals.push(o.vec())}),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}translate(t,e){return h.doseq(this.points,r=>{r[0]+=t,r[1]+=e}),this._recalc()}_recalc(){if(this.points){let t,e,r;h.doseq(this.points,(t,e)=>{o.copy(this.calcPoints[e],t),h.feq0(this.orient)||o.rot$(this.calcPoints[e],this.orient)}),h.doseq(this.points,(s,i)=>{t=(i+1)%this.calcPoints.length,e=this.calcPoints[i],r=this.calcPoints[t],this.edges[i]=o.sub(r,e),this.normals[i]=o.unit(o.normal(this.edges[i]))})}return this}static translateCalcPoints(t){return o.translate(t.pos,t.calcPoints)}}class g{constructor(t,e){this.overlapN=o.vec(),this.overlapV=o.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new g,e=this.AInB,r=this.BInA,s=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=s,t.AInB=r,t.BInA=e,t.overlapN=o.flip(this.overlapN),t.overlapV=o.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function m(t,e){let r=1/0,s=-1/0;for(let i,n=0;n<t.length;++n)i=o.dot(t[n],e),i<r&&(r=i),i>s&&(s=i);return[r,s]}function y(t,i){let n=o.len2(t),l=o.dot(i,t);return l<0?e:l>n?s:r}function w(t,e,r,s,i,n){let[l,a]=m(e,i),[h,u]=m(s,i),c=o.vecAB(t,r),f=o.dot(c,i);if(h+=f,u+=f,l>u||h>a)return!0;if(n){let t=0;if(l<h)if(n.AInB=!1,a<u)t=a-h,n.BInA=!1;else{let[e,r]=[a-h,u-l];t=e<r?e:-r}else if(n.BInA=!1,a>u)t=l-u,n.AInB=!1;else{let[e,r]=[a-h,u-l];t=e<r?e:-r}let e=Math.abs(t);e<n.overlap&&(n.overlap=e,o.copy(n.overlapN,i),t<0&&o.flip$(n.overlapN))}}new g,x=new c(0,0,1,1),new p(x.pos[0],x.pos[1]).set([o.vec(x.width,0),o.vec(x.width,x.height),o.vec(0,x.height),o.vec()]);var x;function v(t,e,r){let s=o.vecAB(t.pos,e.pos),i=t.radius+e.radius,n=i*i,l=o.len2(s),a=!(l>n);if(a&&r){let n=Math.sqrt(l);r.A=t,r.B=e,r.overlap=i-n,o.copy(r.overlapN,o.unit$(s)),o.copy(r.overlapV,o.mul(s,r.overlap)),r.AInB=t.radius<=e.radius&&n<=e.radius-t.radius,r.BInA=e.radius<=t.radius&&n<=t.radius-e.radius}return a}function b(t,r,i){let n,l=o.vecAB(t.pos,r.pos),a=r.radius*r.radius,h=t.calcPoints,u=o.vec();for(let c,f,d,p,g=h.length,m=0;m<g;++m){c=m===g-1?0:m+1,f=0===m?g-1:m-1,d=0,p=null,o.copy(u,t.edges[m]),n=o.vecAB(h[m],l),i&&o.len2(n)>a&&(i.AInB=!1);let w=y(u,n);if(w===e){if(o.copy(u,t.edges[f]),w=y(u,o.vecAB(h[f],l)),w===s){let t=o.len(n);if(t>r.radius)return!1;i&&(i.BInA=!1,p=o.unit(n),d=r.radius-t)}}else if(w===s){if(o.copy(u,t.edges[c]),o.sub$(o.copy(n,l),h[c]),w=y(u,n),w===e){let t=o.len(n);if(t>r.radius)return!1;i&&(i.BInA=!1,p=o.unit(n),d=r.radius-t)}}else{let t=o.unit$(o.normal(u)),e=o.dot(n,t),s=Math.abs(e);if(e>0&&s>r.radius)return!1;i&&(p=t,d=r.radius-e,(e>=0||d<2*r.radius)&&(i.BInA=!1))}p&&i&&Math.abs(d)<Math.abs(i.overlap)&&(i.overlap=d,o.copy(i.overlapN,p))}return i&&(i.A=t,i.B=r,o.mul$(o.copy(i.overlapV,i.overlapN),i.overlap)),!0}function E(t,e,r){let s=b(e,t,r);if(s&&r){let t=r.A,e=r.AInB;o.flip$(r.overlapN),o.flip$(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return s}function M(t,e,r){let s=t.calcPoints,i=e.calcPoints;for(let n=0;n<s.length;++n)if(w(t.pos,s,e.pos,i,t.normals[n],r))return!1;for(let n=0;n<i.length;++n)if(w(t.pos,s,e.pos,i,e.normals[n],r))return!1;if(r){if(0===r.overlap||h.feq0(r.overlap))return!1;r.A=t,r.B=e,o.copy(r.overlapV,r.overlapN),o.mul$(r.overlapV,r.overlap)}return!0}return{Rect:c,Area:f,Line:d,Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=o.vec()}setOrient(t){return this.orient=t,this}setPos(t,e){return o.set(this.pos,t,e),this}},Polygon:p,Manifold:g,orderVertices:t=>u(t),polyArea(t,e=!1){let r=e?this.orderVertices(t):t,s=0;for(let t,e,i,n=r.length,o=0;o<n;++o)i=(o+1)%n,t=r[o],e=r[i],s+=t[0]*e[1]-e[0]*t[1];return l(a(s)/2)},calcPolygonCenter(t,e=!1){const r=e?this.orderVertices(t):t,s=6*this.polyArea(r);let i=0,n=0;for(let t,e,s,o=0,l=r.length;o<l;++o)s=(o+1)%l,t=r[o],e=r[s],i+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),n+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return o.vec(l(i/s),l(n/s))},getAABB(t,e=null){if(e||(e=t.pos),h.has(t,"radius"))return new c(e[0]-t.radius,e[1]-t.radius,2*t.radius,2*t.radius);{let r=o.translate(e,t.calcPoints),s=r[0][0],i=r[0][1],n=s,l=i;for(let t,e=1;e<r.length;++e)t=r[e],t[0]<s&&(s=t[0]),t[0]>n&&(n=t[0]),t[1]<i&&(i=t[1]),t[1]>l&&(l=t[1]);return new c(s,i,n-s,l-i)}},shiftPoints:(t,e)=>t.map(t=>o.add(t,e)),rotPoints:(t,e,r)=>t.map(t=>o.rot(t,e,r)),calcRectPoints(t,e){const r=l(t/2),s=l(e/2);return[o.vec(r,-s),o.vec(r,s),o.vec(-r,s),o.vec(-r,-s)]},line:(t,e,r,s)=>new d(t,e,r,s),rectEqRect:(t,e)=>t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+l(t.width/2),rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+l(t.height/2),rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const r=Math.min(t.pos[0],e.pos[0]),s=Math.min(t.pos[1],e.pos[1]);return new c(r,s,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-s)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const r=Math.max(t.pos[0],e.pos[0]),s=Math.max(t.pos[1],e.pos[1]);return new c(r,s,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-s)}},hitTestPointCircle(t,e,r){let s=t-r.pos[0],i=e-r.pos[1];return s*s+i*i<=r.radius*r.radius},hitCircleCircle(t,e){let r=new g;if(v(t,e,r))return r},hitTestCircleCircle:(t,e)=>v(t,e,new g),hitPolygonCircle(t,e){let r=new g;if(b(t,e,r))return r},hitTestPolygonCircle:(t,e)=>b(t,e,new g),hitCirclePolygon(t,e){let r=new g;if(E(t,e,r))return r},hitTestCirclePolygon:(t,e)=>E(t,e,new g),hitPolygonPolygon(t,e){let r=new g;if(M(t,e,r))return r},hitTestPolygonPolygon:(t,e)=>M(t,e,new g),hitTestPointInPolygon(t,e,r){let s;for(let i,n,o=r.length,l=0,a=o-1;l<o;)i=r[l],n=r[a],i[1]>e!=n[1]>e&&t<(n[0]-i[0])*(e-i[1])/(n[1]-i[1])+i[0]&&(s=!s),a=l,++l;return s},hitTestPointPolygon(t,e,r){return this.hitTestPointInPolygon(t,e,o.translate(r.pos,r.calcPoints))},hitTestLinePolygon(t,e,r){let s=p.translateCalcPoints(r);for(let r=0,i=0;r<s.length;++r){i=r+1,i==s.length&&(i=0);let[n,o]=this.lineIntersect2D(t,e,s[r],s[i]);if(n)return[n,o]}return[!1]},lineIntersect2D(t,e,r,s){let i,n,o=t[0],l=t[1],a=e[0],u=e[1],c=r[0],f=r[1],d=s[0],p=s[1],g=(o-a)*(f-p)-(l-u)*(c-d);return h.feq0(g)?[!1]:(i=(o-c)*(f-p)-(l-f)*(c-d),i/=g,n=(o-c)*(l-u)-(l-f)*(o-a),n/=g,0<=i&&i<=1&&0<=n&&n<=1?[!0,i,[o+i*(a-o),l+i*(u-l)]]:[!1])}}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("./math"),require("./vec2")):t["io/czlab/mcfud/geo2d"]=i}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=Math.floor,{u:s,is:i}=e;return{spatialGrid:(t=320,e=320)=>function(t,e){const n=new Map;return{searchAndExec(t,e){let r,s=t.getSpatial();for(let i,o,l=s.y1;l<=s.y2;++l)if(o=n.get(l))for(let n,a,h=s.x1;h<=s.x2;++h)if(i=o.get(h))for(n=i.values(),a=n.next();!a.done;){if(t!==a.value&&(r=e(t,a.value))){h=l=1/0;break}r=null,a=n.next()}return r},search(t,e=!1){let r,s,i=[],o=t.getSpatial();for(let l=o.y1;l<=o.y2;++l)if(s=n.get(l))for(let n=o.x1;n<=o.x2;++n)(r=s.get(n))&&r.forEach(r=>{(r!==t||e)&&i.push(r)});return i},engrid(s,i){if(!s)return;let n=s.getBBox(),o=s.getSpatial(),l=r(n.x1/t),a=r(n.y1/e),h=r(n.x2/t),u=r(n.y2/e);return o.x1===l&&o.x2===h&&o.y1===a&&o.y2===u||(this.degrid(s),o.x1=l,o.x2=h,o.y1=a,o.y2=u,i||this._register(s)),s},reset(){n.clear()},_register(t){let e=t.getSpatial();if(i.num(e.x1))for(let r,i,o=e.y1;o<=e.y2;++o){n.has(o)||n.set(o,new Map),i=n.get(o);for(let n=e.x1;n<=e.x2;++n)i.has(n)||i.set(n,new Map),r=i.get(n),s.assoc(r,t.getGuid(),t)}},degrid(t){if(t){let e=t.getSpatial();if(i.num(e.x1))for(let r,i,o=e.y1;o<=e.y2;++o)if(i=n.get(o))for(let n=e.x1;n<=e.x2;++n)(r=i.get(n))&&s.dissoc(r,t.getGuid())}}}}(t,e)}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/spatial"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=Math.floor,{u:s}=e;function i(t,e,o,l,a,h,u){let c=null,f=[],d=o<l,p=r((t+e)/2),g=r((o+l)/2);function m(t){let e,r,s,i;if(t.getBBox){let{x1:n,x2:o,y1:l,y2:a}=t.getBBox();e=n,r=l,s=o-n,i=d?a-l:l-a}else void 0!==t.x&&void 0!==t.y&&void 0!==t.width&&void 0!==t.height&&(e=t.x,r=t.y,s=t.width,i=t.height);let n=[],o=e<p,l=e+s>p,a=d?r+i>g:r<g;return(d?r<g:r+i>g)&&(o&&n.push(3),l&&n.push(0)),a&&(o&&n.push(2),l&&n.push(1)),n}function y(){s.assert(null===c),c=[i(p,e,o,g,a,h,u+1),i(p,e,g,l,a,h,u+1),i(t,p,g,l,a,h,u+1),i(t,p,o,g,a,h,u+1)]}const w={x1:t,x2:e,y1:o,y2:l};return{boundingBox:()=>w,subTrees:()=>c,dbg:t=>t(f,c,a,h,u),insert:function(t){for(let e=0;e<arguments.length;++e)t=arguments[e],c?m(t).forEach(e=>c[e].insert(t)):(f.push(t),f.length>a&&u<h&&(y(),f.forEach(t=>m(t).forEach(e=>c[e].insert(t))),f.length=0))},remove(t){c?c.forEach(e=>e.remove(t)):s.disj(f,t)},isLeaf:()=>null===c?-1:f.length,prune(){if(c){let t=0,e=0;for(let r,s=0;s<c.length;++s)r=c[s],r.prune(),n=r.isLeaf(),n>=0&&(++t,e+=n);t===c.length&&e<a&&(s.assert(0===f.length,"quadtree wanted zero items"),c.forEach(t=>t._swap(f)),c=null)}},_swap(t){f.forEach(e=>t.push(e)),f.length=0},reset(){f.length=0,c&&c.forEach(t=>t.reset()),c=null},searchAndExec(t,e,r){let s;if(c){let i=m(t);for(let n=0;n<i.length&&(s=c[i[n]].searchAndExec(t,e,r),!s);++n);}else for(let i,n=0;n<f.length&&(i=f[n],r&&i===t||!(s=e(i,t)));++n);return s},search(t,e){const r=new Map,s=[];return e&&r.set(t,null),c&&m(t).forEach(e=>{c[e].search(t).forEach(t=>{r.has(t)||(r.set(t,null),s.push(t))})}),f.forEach(t=>{r.has(t)||(r.set(t,null),s.push(t))}),r.clear(),s}}}return{quadtree(t,e=12,r=5){const{left:s,right:n,top:o,bottom:l}=t;return i(s,n,o,l,e,r,0)}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/qtree"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e;class s{constructor(t,e){this.lastBestMove=null,this.state=null,this.other=e,this.cur=t}clone(t){const e=new s;return e.state=t(this.state),e.lastBestMove=this.lastBestMove,e.other=this.other,e.cur=this.cur,e}}function i(t,e,r,s){return t.evalScore(e,r,s)*(1+.001*r)}function n(t,e,s,o,l,a){if(0===s||t.isOver(e))return{depth:s,value:i(t,e,s,o)};let h=e,u=t.getStateCopier(),c=r.shuffle(t.getNextMoves(e));for(let i,f,d=0;d<c.length;++d)if(f=c[d],t.undoMove||(r.assert(u,"Missing state copier!"),e=h.clone(u)),t.makeMove(e,f),i=n(t,e,s-1,o,{value:-a.value,move:a.move},{value:-l.value,move:l.move}),t.undoMove&&t.unmakeMove(e,f),i.value=-i.value,i.move=f,i.value>l.value&&(l={value:i.value,move:f,depth:i.depth}),l.value>=a.value)return a;return JSON.parse(JSON.stringify(l))}function o(t,e,s,n,l,a){if(0===s||t.isOver(e))return[i(t,e,s,n),null];let h=r.shuffle(t.getNextMoves(e)),u=t.getStateCopier(),c=e,f=-1/0,d=h[0];s===n&&(c.lastBestMove=d);for(let i,p,g=0;g<h.length&&(t.undoMove||(r.assert(u,"Missing state copier!"),e=c.clone(u)),p=h[g],t.makeMove(e,p),i=-o(t,e,s-1,n,-a,-l)[0],t.undoMove&&t.unmakeMove(e,p),f<i&&(f=i,d=p),!(l<i&&(l=i,s===n&&(c.lastBestMove=p),l>=a)));++g);return[f,c.lastBestMove]}const l={algo:"negamax",GFrame:s,GameBoard:class{constructor(){}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}takeGFrame(){}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let s=this.getFirstMove();return r.nichts(s)&&(s=l.evalNegaMax(this)),s}},XXevalNegaMax(t){const e=t.takeGFrame(),s=t.depth;let i,n;return[i,n]=o(t,e,s,s,-1/0,1/0),r.nichts(n)&&console.log(`evalNegaMax: score=${i}, pos= ${n}, lastBestMove=${n}`),n},evalNegaMax(t){const e=t.takeGFrame(),s=t.depth;let{value:i,move:o}=n(t,e,s,s,{value:-1/0},{value:1/0});return r.nichts(o)&&console.log(`evalNegaMax: score= ${i}, pos= ${o}`),o}};return l}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/negamax"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e;class s{constructor(t,e){this.cur=t,this.state=null,this.other=e}clone(t){const e=new s;return e.state=t(this.state),e.other=this.other,e.cur=this.cur,e}}function i(t,e,r,s){return t.evalScore(e,r,s)}function n(t,e,s,o,l,a,h){if(0===s||t.isOver(e))return[i(t,e,s,o),null];let u=e,c=t.getStateCopier(),f=r.shuffle(t.getNextMoves(e));if(h){let i,d,p=f[0],g=-1/0;for(let m=0;m<f.length&&(t.undoMove||(r.assert(c,"Missing state copier!"),e=u.clone(c)),d=f[m],t.makeMove(e,d),i=n(t,e,s-1,o,l,a,!h)[0],t.undoMove&&t.unmakeMove(e,d),l=Math.max(i,l),i>g&&(g=i,p=d),!(a<=l));++m);return[g,p]}{let i,d,p=f[0],g=1/0;for(let m=0;m<f.length&&(t.undoMove||(r.assert(c,"Missing state copier!"),e=u.clone(c)),d=f[m],t.makeMove(e,d),i=n(t,e,s-1,o,l,a,!h)[0],t.undoMove&&t.unmakeMove(e,d),a=Math.min(i,a),i<g&&(g=i,p=d),!(a<=l));++m);return[g,p]}}const o={algo:"minimax",GFrame:s,GameBoard:class{constructor(){this.aiActor=null}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t,e,r){}isStalemate(t){}isOver(t,e){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}takeGFrame(){}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let s=this.getFirstMove();return r.nichts(s)&&(s=o.evalMiniMax(this)),s}},evalMiniMax(t){const e=t.takeGFrame(),s=t.depth;let i,o;return[i,o]=n(t,e,s,s,-1/0,1/0,!0),r.nichts(o)&&console.log(`evalMiniMax: score=${i}, pos= ${o}`),o}};return o}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/minimax"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=(t,e)=>t<e?-1:t>e?1:0,s=Math.floor,{is:i,u:n}=e;function o(t){let e="";for(let r=t.iterator();r.hasNext();)e+=r.next()+" ";return e}function l(t){if(!i.num(t)&&!i.str(t))throw Error("expected either number or string");return!0}class a{constructor(){this.root=null,this.n=0}size(){return this.n}contains(t){return void 0!==this.get(t)}get(t){if(l(t),this.n>0)return function t(e,r,s){return r&&(s=e<r.key?t(e,r.left):e>r.key?t(e,r.right):r.value),s}(t,this.root)}set(t,e){let r=this;l(t),this.root=function t(e,s,i){return i?(e<i.key?i.left=t(e,s,i.left):e>i.key?i.right=t(e,s,i.right):i.value=s,i):(r.n+=1,{key:e,value:s,left:null,right:null})}(t,e,this.root)}_getMaxNode(t){for(;null!==t&&null!==t.right;)t=t.right;return t}_getMaxKey(){let t=this._getMaxNode(this.root);if(t)return t.key}_getMinNode(t){for(;null!==t&&null!==t.left;)t=t.left;return t}_getMinKey(){let t=this._getMinNode(this.root);if(t)return t.key}remove(t){let e=this;l(t),this.root=function t(r,s){if(s)if(r<s.key)s.left=t(r,s.left);else if(r>s.key)s.right=t(r,s.right);else if(s.left&&s.right){let i=e._getMaxNode(s.left),n=i.key,o=i.value;i.value=s.value,i.key=s.key,s.key=n,s.value=o,s.left=t(r,s.left)}else s.left?(s=s.left,e.n-=1):s.right?(s=s.right,e.n-=1):(s=null,e.n-=1);return s}(t,this.root)}keys(){let t=new d;return this.forEach((e,r)=>t.enqueue(r)),t}firstKey(){let t,e;return this.n>0&&(t=this.keys(),e=t.head()),e}lastKey(){let t,e;return this.n>0&&(t=this.keys(),e=t.tail()),e}forEach(t,e){function r(t,e){return e&&e.apply(t,Array.prototype.slice.call(arguments,2))}!function t(e,s,i,n){if(!e)return r(i,n);t(e.left,s,i,(function(){r(i,s,e.value,e.key),t(e.right,s,i,(function(){r(i,n)}))}))}(this.root,t,e)}static test(){let t=new a;t.set(3,"3"),t.set(2,"2"),t.set(7,"7"),t.set(1,"1"),console.log("firstKey= "+t.firstKey()),console.log("lastKey= "+t.lastKey()),console.log(o(t.keys())),console.log("k= "+t.get(3)),console.log("has 2 = "+t.contains(2)),console.log("has size = "+t.size()),t.remove(1),console.log("has size = "+t.size()),console.log(o(t.keys())),console.log("k= "+t.get(2))}}function h(t,e=null){return{item:t,next:e}}class u{constructor(){this.first=null,this.n=0}isEmpty(){return null==this.first}size(){return this.n}add(t){this.first=h(t,this.first),this.n++}iterator(){let t=this.first;return{remove(){throw Error("Unsupported")},hasNext:()=>null!=t,next(){if(!this.hasNext())throw Error("NoSuchElementException");let e=t.item;return t=t.next,e}}}static test(){let t=new u;for("to be or not to - be - - that - - - is".split(" ").forEach(e=>t.add(e)),console.log("size of bag = "+t.size()),t=t.iterator();t.hasNext();)console.log(t.next())}}class c{constructor(){this.first=null,this.n=0}isEmpty(){return null==this.first}size(){return this.n}push(t){this.first=h(t,this.first),this.n++}pop(){if(this.isEmpty())throw Error("Stack underflow");let t=this.first.item;return this.first=this.first.next,--this.n,t}peek(){if(this.isEmpty())throw Error("Stack underflow");return this.first.item}toString(){let t="",e=this.iterator();for(;e.hasNext();)t+=e.next()+" ";return t}iterator(){let t=this.first;return{remove(){throw Error("Unsupported")},hasNext:()=>null!=t,next(){if(!this.hasNext())throw Error("NoSuchElementException");let e=t.item;return t=t.next,e}}}static test(){let t=new c;"to be or not to - be - - that - - - is".split(" ").forEach(e=>{"-"!=e?t.push(e):t.isEmpty()||console.log(t.pop()+" ")}),console.log("("+t.size()+" left on stack)")}}class f{constructor(){this.first=null,this.last=null,this.n=0}isEmpty(){return null==this.first}size(){return this.n}peek(){if(this.isEmpty())throw Error("Queue underflow");return this.first.item}enqueue(t){let e=this.last;this.last=h(t),this.isEmpty()?this.first=this.last:e.next=this.last,++this.n}dequeue(){if(this.isEmpty())throw Error("Queue underflow");let t=this.first.item;return this.first=this.first.next,--this.n,this.isEmpty()&&(this.last=null),t}toString(){let t="",e=this.iterator();for(;e.hasNext();)t+=e.next()+" ";return t}iterator(){let t=this.first;return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>null!=t,next(){if(!this.hasNext())throw Error("NoSuchElementException");let e=t.item;return t=t.next,e}}}static test(){let t=new f;"to be or not to - be - - that - - - is".split(" ").forEach(e=>{"-"!=e?t.enqueue(e):t.isEmpty()||console.log(t.dequeue()+" ")}),console.log("("+t.size()+" left on queue)")}}class d{constructor(){this.first=null,this.last=null,this.n=0}isEmpty(){return null==this.first}size(){return this.n}head(){return this.first&&this.first.item}tail(){return this.last&&this.last.item}peek(){if(this.isEmpty())throw Error("Queue underflow");return this.first.item}enqueue(t){let e=this.last;this.last=h(t),this.isEmpty()?this.first=this.last:e.next=this.last,this.n+=1}dequeue(){if(this.isEmpty())throw Error("Queue underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,this.isEmpty()&&(this.last=null),t}toString(){let t="";for(let e,r=this.iterator();r.hasNext();)t+=e+" ";return t}iterator(){let t=this.first;return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>null!=t,next(){if(!this.hasNext())throw Error("NoSuchElementException");let e=t.item;return t=t.next,e}}}static test(){let t=new d;"to be or not to - be - - that - - - is".split(/\s+/).forEach(e=>{"-"!=e?t.enqueue(e):t.isEmpty()||console.log(t.dequeue()+" ")}),console.log("("+t.size()+" left on queue)")}}class p{constructor(){this.st=new a}get(t){if(n.nichts(t))throw Error("calls get() with null key");return this.st.get(t)}put(t,e){if(n.nichts(t))throw Error("calls put() with null key");void 0===e?this.st.remove(t):this.st.set(t,e)}remove(t){if(n.nichts(t))throw Error("calls remove() with null key");this.st.remove(t)}contains(t){if(n.nichts(t))throw Error("calls contains() with null key");return this.st.contains(t)}size(){return this.st.size()}isEmpty(){return 0==this.size()}keys(){return this.st.keys()}min(){if(this.isEmpty())throw Error("calls min() with empty symbol table");return this.st.firstKey()}max(){if(this.isEmpty())throw Error("calls max() with empty symbol table");return this.st.lastKey()}ceiling(t){if(n.nichts(t))throw Error("argument to ceiling() is null");let e,r,s=this.st.keys().iterator();for(;s.hasNext();)if(r=s.next(),r==t||r>t){e=r;break}if(void 0===e)throw Error("argument to ceiling() is too large");return e}floor(t){if(n.nichts(t))throw Error("argument to floor() is null");let e,r,s=this.st.keys().iterator();for(;s.hasNext();)r=s.next(),(r==t||r<t)&&(e=r);if(void 0===e)throw Error("argument to floor() is too small");return e}static test(){let t=new p;t.put("a",1),t.put("g",9),t.put("c",3),t.put("j",10),t.put("z",26),t.put("x",24),console.log("isEmpty= "+t.isEmpty()),console.log("size= "+t.size()),console.log("get-c= "+t.get("c")),console.log("contains z= "+t.contains("z")),console.log("contains m= "+t.contains("m")),console.log(o(t.keys())),console.log("ceil w= "+t.ceiling("w")),console.log("floor k= "+t.floor("k")),console.log("min = "+t.min()),console.log("max = "+t.max()),t.remove("x"),console.log(o(t.keys()))}}class g{constructor(t,e){if(t<0)throw Error("IllegalArgumentException");this.compare=e,this.maxN=t,this.n=0,this.mKeys=new Array(t+1),this.pq=new Array(t+1),this.qp=new Array(t+1);for(let e=0;e<=t;e++)this.qp[e]=-1}isEmpty(){return 0==this.n}contains(t){return this.validateIndex(t),-1!=this.qp[t]}size(){return this.n}insert(t,e){if(this.validateIndex(t),this.contains(t))throw Error("index is already in the priority queue");this.n++,this.qp[t]=this.n,this.pq[this.n]=t,this.mKeys[t]=e,this.swim(this.n)}minIndex(){if(0==this.n)throw Error("Priority queue underflow");return this.pq[1]}minKey(){if(0==this.n)throw Error("Priority queue underflow");return this.mKeys[this.pq[1]]}delMin(){if(0==this.n)throw Error("Priority queue underflow");let t=this.pq[1];return this.exch(1,this.n--),this.sink(1),n.assert(t==this.pq[this.n+1],"No good"),this.qp[t]=-1,this.mKeys[t]=null,this.pq[this.n+1]=-1,t}keyOf(t){if(this.validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");return this.mKeys[t]}changeKey(t,e){if(this.validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");this.mKeys[t]=e,this.swim(this.qp[t]),this.sink(this.qp[t])}decreaseKey(t,e){if(this.validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.compare(this.mKeys[t],e);if(0==r)throw Error("Calling decreaseKey() with a key equal to the key in the priority queue");if(r<0)throw Error("Calling decreaseKey() with a key strictly greater than the key in the priority queue");this.mKeys[t]=e,this.swim(this.qp[t])}increaseKey(t,e){if(this.validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let r=this.compare(this.mKeys[t],e);if(0==r)throw Error("Calling increaseKey() with a key equal to the key in the priority queue");if(r>0)throw Error("Calling increaseKey() with a key strictly less than the key in the priority queue");this.mKeys[t]=e,this.sink(this.qp[t])}delete(t){if(this.validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let e=this.qp[t];this.exch(e,this.n--),this.swim(e),this.sink(e),this.mKeys[t]=null,this.qp[t]=-1}validateIndex(t){if(t<0)throw Error("index is negative: "+t);if(t>=this.maxN)throw Error("index >= capacity: "+t)}greater(t,e){return this.compare(this.mKeys[this.pq[t]],this.mKeys[this.pq[e]])>0}exch(t,e){let r=this.pq[t];this.pq[t]=this.pq[e],this.pq[e]=r,this.qp[this.pq[t]]=t,this.qp[this.pq[e]]=e}swim(t){for(;t>1&&this.greater(t/2,t);)this.exch(t,t/2),t/=2}sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this.greater(e,e+1)&&e++,!this.greater(t,e))break;this.exch(t,e),t=e}}iterator(){let t=new g(this.pq.length-1,this.compare);for(let e=1;e<=this.n;e++)t.insert(this.pq[e],this.mKeys[this.pq[e]]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new g(t.length,r);for(let r=0;r<t.length;r++)e.insert(r,t[r]);for(;!e.isEmpty();){let r=e.delMin();console.log(r+" "+t[r])}console.log("");for(let r=0;r<t.length;r++)e.insert(r,t[r]);for(let r,s=e.iterator();s.hasNext();)r=s.next(),console.log(r+" "+t[r]);for(;!e.isEmpty();)e.delMin()}}class m{static M=4;Node(t){return{m:t,children:new Array(m.M)}}Entry(t,e,r=null){return{key:t,val:e,next:r}}constructor(t){this.root=this.Node(0),this.compare=t,this._height=0,this.n=0}isEmpty(){return 0==this.size()}size(){return this.n}height(){return this._height}get(t){if(n.nichts(t))throw Error("argument to get() is null");return this._search(this.root,t,this._height)}_search(t,e,r){let s=t.children;if(0==r){for(let r=0;r<t.m;r++)if(0==this.compare(e,s[r].key))return s[r].val}else for(let i=0;i<t.m;i++)if(i+1==t.m||this.compare(e,s[i+1].key)<0)return this._search(s[i].next,e,r-1)}put(t,e){if(n.nichts(t))throw Error("argument key to put() is null");let r=this._insert(this.root,t,e,this._height);if(this.n++,!r)return;let s=this.Node(2);s.children[0]=this.Entry(this.root.children[0].key,null,this.root),s.children[1]=this.Entry(r.children[0].key,null,r),this.root=s,this._height++}_insert(t,e,r,s){let i,n=this.Entry(e,r);if(0==s)for(i=0;i<t.m&&!(this.compare(e,t.children[i].key)<0);i++);else for(i=0;i<t.m;i++)if(i+1==t.m||this.compare(e,t.children[i+1].key)<0){let o=this._insert(t.children[i++].next,e,r,s-1);if(!o)return null;n.key=o.children[0].key,n.val=null,n.next=o;break}for(let e=t.m;e>i;e--)t.children[e]=t.children[e-1];if(t.children[i]=n,t.m++,t.m>=m.M)return this._split(t)}_split(t){let e=s(m.M/2),r=this.Node(e);t.m=e;for(let s=0;s<e;s++)r.children[s]=t.children[e+s];return r}toString(){return function t(e,r,s){let i="",n=e.children;if(0==r)for(let t=0;t<e.m;t++)i+=`${s}${n[t].key} ${n[t].val}\n`;else for(let o=0;o<e.m;o++)o>0&&(i+=`${s}(${n[o].key})\n`),i+=t(n[o].next,r-1,s+"     ");return i}(this.root,this._height,"")+"\n"}static test(){let t=new m(r);t.put("www.cs.princeton.edu","128.112.136.12"),t.put("www.cs.princeton.edu","128.112.136.11"),t.put("www.princeton.edu","128.112.128.15"),t.put("www.yale.edu","130.132.143.21"),t.put("www.simpsons.com","209.052.165.60"),t.put("www.apple.com","17.112.152.32"),t.put("www.amazon.com","207.171.182.16"),t.put("www.ebay.com","66.135.192.87"),t.put("www.cnn.com","64.236.16.20"),t.put("www.google.com","216.239.41.99"),t.put("www.nytimes.com","199.239.136.200"),t.put("www.microsoft.com","207.126.99.140"),t.put("www.dell.com","143.166.224.230"),t.put("www.slashdot.org","66.35.250.151"),t.put("www.espn.com","199.181.135.201"),t.put("www.weather.com","63.111.66.11"),t.put("www.yahoo.com","216.109.118.65"),console.log("cs.princeton.edu:  "+t.get("www.cs.princeton.edu")),console.log("hardvardsucks.com: "+t.get("www.harvardsucks.com")),console.log("simpsons.com:      "+t.get("www.simpsons.com")),console.log("apple.com:         "+t.get("www.apple.com")),console.log("ebay.com:          "+t.get("www.ebay.com")),console.log("dell.com:          "+t.get("www.dell.com")),console.log(""),console.log("size:    "+t.size()),console.log("height:  "+t.height()),console.log(t.toString()),console.log("")}}return{BTree:m,Bag:u,Stack:c,LinkedQueue:f,Queue:d,ST:p,TreeMap:a,IndexMinPQ:g}}"object"==typeof module&&module.exports?module.exports=e(require("../main/core")):t["io/czlab/mcfud/algo/basic"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/algo/basic"]());const s=(t,e)=>t<e?-1:t>e?1:0,i=Math.floor,{is:n,u:o}=e,{Bag:l,Stack:a,Node:h}=r;function u(t,e,r){return r(t,e)<0}function c(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}function f(t){for(let e=0;e<t.length;++e)console.log(t[e])}class d{static sort(t,e){const r=t.length;for(let s=1;s<r;++s)for(let r=s;r>0&&u(t[r],t[r-1],e);--r)c(t,r,r-1);return t}static sortRange(t,e,r,s){for(let i=e+1;i<r;++i)for(let r=i;r>e&&u(t[r],t[r-1],s);--r)c(t,r,r-1);return t}static indexSort(t,e){let r=t.length,s=new Array(r);for(let t=0;t<r;++t)s[t]=t;for(let i=1;i<r;++i)for(let r=i;r>0&&u(t[s[r]],t[s[r-1]],e);--r)c(s,r,r-1);return s}static test(){let t="SORTEXAMPLE".split("");f(d.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(d.sortRange(t,0,t.length,s))}}class p{static sort(t,e){let r,s,n,o=t.length;for(let l,a=1;a<o;++a){for(s=0,n=a,l=t[a];s<n;)r=s+i((n-s)/2),u(l,t[r],e)?n=r:s=r+1;for(let e=a;e>s;--e)t[e]=t[e-1];t[s]=l}return t}static test(){let t="SORTEXAMPLE".split("");f(p.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(p.sort(t,s))}}class g{static sort(t,e){let r,s=t.length;for(let i=0;i<s;++i){r=i;for(let n=i+1;n<s;++n)u(t[n],t[r],e)&&(r=n);c(t,i,r)}return t}static test(){let t="SORTEXAMPLE".split("");f(g.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(g.sort(t,s))}}class m{static sort(t,e){let r=t.length,s=1,n=i(r/3);for(;s<n;)s=3*s+1;for(;s>=1;){for(let i=s;i<r;++i)for(let r=i;r>=s&&u(t[r],t[r-s],e);r-=s)c(t,r,r-s);s=i(s/3)}return t}static test(){let t="SORTEXAMPLE".split("");f(m.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(m.sort(t,s))}}function y(t,e,r,s,n){if(s<=r);else{let o=r+i((s-r)/2);y(t,e,r,o),y(t,e,o+1,s),function(t,e,r,s,i,n){for(let s=r;s<=i;++s)e[s]=t[s];let o=r,l=s+1;for(let a=r;a<=i;++a)o>s?t[a]=e[l++]:l>i?t[a]=e[o++]:u(e[l],e[o],n)?t[a]=e[l++]:t[a]=e[o++]}(t,e,r,o,s,n)}return t}function w(t,e,r,s,n,o){if(n<=s);else{let l=s+i((n-s)/2);w(t,e,r,s,l,o),w(t,e,r,l+1,n,o),function(t,e,r,s,i,n,o){for(let t=s;t<=n;++t)r[t]=e[t];let l=s,a=i+1;for(let h=s;h<=n;++h)l>i?e[h]=r[a++]:a>n?e[h]=r[l++]:u(t[r[a]],t[r[l]],o)?e[h]=r[a++]:e[h]=r[l++]}(t,e,r,s,l,n,o)}return t}class x{static sort(t,e){let r=new Array(t.length);return y(t,r,0,t.length-1),t}static indexSort(t,e){let r=t.length,s=new Array(r);for(let t=0;t<r;++t)s[t]=t;return w(t,s,new Array(r),0,r-1,e),s}static test(){let t="SORTEXAMPLE".split("");f(x.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(x.sort(t,s))}}function y(t,e,r,s){if(r<=e);else{let i=v(t,e,r,s);y(t,e,i-1,s),y(t,i+1,r,s)}return t}function v(t,e,r,s){let i=e,n=t[e],o=r+1;for(;;){for(;u(t[++i],n,s)&&i!=r;);for(;u(n,t[--o],s)&&o!=e;);if(i>=o)break;c(t,i,o)}return c(t,e,o),o}class b{static sort(t,e){return o.shuffle(t),y(t,0,t.length-1,e),t}static select(t,e,r){if(e<0||e>=t.length)throw Error(`index is not between 0 and ${t.length}: ${e}`);o.shuffle(t);let s=0,i=t.length-1;for(;i>s;){let n=v(t,s,i,r);if(n>e)i=n-1;else{if(!(n<e))return t[n];s=n+1}}return t[s]}static test(){let t="bed bug dad yes zoo all bad yet".split(" ");f(b.sort(t,s)),t="SORTEXAMPLE".split(""),f(b.sort(t,s)),o.shuffle(t),t.forEach((e,r)=>console.log(b.select(t,r,s)))}}function E(t,e,r,s){return u(t[e],t[r],s)}function M(t,e){let r;for(;2*t<=e.n&&(r=2*t,r<e.n&&E(e.pq,r,r+1,e.comparator)&&r++,E(e.pq,t,r,e.comparator));)c(e.pq,t,r),t=r}function k(t,e){const r=new Array(t);for(let t=1;t<=e.n;++t)r[t]=e.pq[t];e.pq=r}class q{constructor(t,e){if(this.comparator=t,this.n=0,n.vec(e)){this.pq=new Array(e.length+1),this.n=e.length;for(let t=0;t<this.n;++t)this.pq[t+1]=e[t];for(let t=i(this.n/2);t>=1;--t)M(t,this)}this.pq=new Array(n.num(e)?e:2)}isEmpty(){return 0==this.n}size(){return this.n}max(){if(this.isEmpty())throw Error("Priority queue underflow");return this.pq[1]}insert(t){this.n==this.pq.length-1&&k(2*this.pq.length,this),this.n+=1,this.pq[this.n]=t,function(t,e){for(;t>1&&E(e.pq,i(t/2),t,e.comparator);)c(e.pq,t,i(t/2)),t=i(t/2)}(this.n,this)}delMax(){if(this.isEmpty())throw Error("Priority queue underflow");let t=this.pq[1];return c(this.pq,1,this.n,this.comparator),this.n-=1,M(1,this),this.pq[this.n+1]=null,this.n>0&&this.n==(this.pq.length-1)/4&&k(i(this.pq.length/2),this),t}iterator(){const t=new q(this.comparator,this.size());for(let e=1;e<=this.n;++e)t.insert(this.pq[e]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMax()}}}static test(){let t="",e=new q(s);"PQE".split("").forEach(t=>e.insert(t)),t+=e.delMax()+" ","XAM".split("").forEach(t=>e.insert(t)),t+=e.delMax()+" ","PLE".split("").forEach(t=>e.insert(t)),t+=e.delMax()+" ",console.log(t),console.log("("+e.size()+" left on pq)")}}function j(t,e,r,s){return s(t[e-1],t[r-1])<0}function A(t,e,r){const s=t[e-1];t[e-1]=t[r-1],t[r-1]=s}function N(t,e,r,s){for(;2*e<=r;){let i=2*e;if(i<r&&j(t,i,i+1,s)&&i++,!j(t,e,i,s))break;A(t,e,i),e=i}}class P{static sort(t,e){let r=t.length;for(let s=i(r/2);s>=1;--s)N(t,s,r,e);let s=r;for(;s>1;)A(t,1,s--),N(t,1,s,e);return t}static test(){let t="SORTEXAMPLE".split("");f(P.sort(t,s)),t="bed bug dad yes zoo all bad yet".split(" "),f(P.sort(t,s))}}return{Insertion:d,BinaryInsertion:p,Selection:g,Shell:m,Merge:x,Quick:b,MaxPQ:q,Heap:P}}"object"==typeof module&&module.exports?module.exports=e(require("../main/core"),require("./basic")):t["io/czlab/mcfud/algo/sort"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/algo/basic"]());Math.floor;const{is:s,u:i}=e,{Bag:n,Stack:o,Node:l}=r;function a(t,e){if(t<0||t>=e)throw Error(`vertex ${t} is not between 0 and ${e-1}`)}class h{static copy(t){if(t.V()<0)throw Error("Number of vertices must be non-negative");let e=new h(t.V());e.edges=t.E(),e.adjls=new Array(t.V());for(let t=0;t<V;++t)e.adjls[t]=new n;for(let e=0;e<t.V();++e){let r=new o,s=t.adjls[e].iterator();for(;s.hasNext();)r.push(s.next());for(s=r.iterator();s.hasNext();)this.adjls[e].add(s.next())}return e}constructor(t){if(t<0)throw Error("Number of vertices must be non-negative");this.adjls=new Array(t),this.verts=t,this.edges=0;for(let e=0;e<t;++e)this.adjls[e]=new n}V(){return this.verts}E(){return this.edges}addEdge(t,e){a(t,this.verts),a(e,this.verts),this.edges++,this.adjls[t].add(e),this.adjls[e].add(t)}adj(t){return a(t,this.verts),this.adjls[t]}degree(t){return a(t,this.verts),this.adjls[t].size()}toString(){let t=`${this.verts} vertices, ${this.edges} edges\n`;for(let e,r=0;r<this.verts;++r){for(t+=r+": ",e=this.adjls[r].iterator();e.hasNext();)t+=e.next()+" ";t+="\n"}return t}static test(){let t=new h(13),e=[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3];for(let r=0;r<e.length;r+=2)t.addEdge(e[r],e[r+1]);console.log(t.toString())}}function u(t,e,r){let s,i=t.adj(e).iterator();for(r.nCount++,r.bMarked[e]=!0;i.hasNext();)s=i.next(),r.bMarked[s]||u(t,s,r)}function u(t,e,r){let s,i=t.adj(e).iterator();for(r.bMarked[e]=!0;i.hasNext();)s=i.next(),r.bMarked[s]||(r.edgeTo[s]=e,u(t,s,r))}class c{constructor(t,e){this.bMarked=new Array(t.V()),this.edgeTo=new Array(t.V()),this.s=e,a(e,this.bMarked.length),u(t,e,this)}hasPathTo(t){return a(t,this.bMarked.length),this.bMarked[t]}pathTo(t){if(a(t,this.bMarked.length),!this.hasPathTo(t))return null;let e=new o;for(let r=t;r!=this.s;r=this.edgeTo[r])e.push(r);return e.push(this.s),e}static test(){let t=new h(6),e=[0,5,2,4,2,3,1,2,0,1,3,4,3,5,0,2];for(let r=0;r<e.length;r+=2)t.addEdge(e[r],e[r+1]);let r=new c(t,0);for(let e,s,i,n=0;n<t.V();++n)if(r.hasPathTo(n)){for(e=`0 to ${n}:  `,s=r.pathTo(n).iterator();s.hasNext();)i=s.next(),e+=0==i?i:"-"+i;console.log(e)}else console.log(`0 to ${n}:  not connected\n`)}}c.test();return{}}"object"==typeof module&&module.exports?module.exports=e(require("../main/core"),require("./basic")):t["io/czlab/mcfud/algo/search"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/algo/basic"]());const s=(t,e)=>t<e?-1:t>e?1:0,{is:i,u:n}=(Math.floor,e),{Bag:o,Stack:l,Queue:a,ST:h,IndexMinPQ:u}=r;function c(t){let e="";for(let r=t.iterator();r.hasNext();)e+=r.next()+" ";return e}function f(t,e){if(t<0||t>=e)throw Error(`vertex ${t} is not between 0 and ${e-1}`)}class d{constructor(t,e,r){if(t<0)throw Error("Vertex names must be non-negative integers");if(e<0)throw Error("Vertex names must be non-negative integers");this.v=t,this.w=e,this._weight=r}from(){return this.v}to(){return this.w}weight(){return this._weight}toString(){return`${this.v}->${this.w} ${Number(this._weight).toFixed(2)}`}static test(){console.log(new d(12,34,5.67).toString())}}class p{constructor(t){if(t<0)throw Error("Number of vertices in a Digraph must be non-negative");this._V=t,this._E=0,this._indegree=new Array(t),this.adjls=new Array(t);for(let e=0;e<t;e++)this.adjls[e]=new o}static randGraph(t,e){if(e<0)throw Error("Number of edges in a Digraph must be non-negative");let r=new p(t);for(let s=0;s<e;s++)r.addEdge(new d(n.randInt2(0,t),n.randInt2(0,t),.01*_randInt2(0,100)));return r}static load(t,e){if(t<0)throw Error("number of vertices in a Digraph must be non-negative");let r=new p(t);for(let s=0;s<e.length;s+=3)f(e[s],t),f(e[s+1],t),r.addEdge(new d(e[s],e[s+1],e[s+2]));return r}clone(){let t=new p(this.V());t._E=this.E();for(let e=0;e<this.V();e++)t._indegree[e]=this._indegree(e);for(let e,r=0;r<this.V();r++){e=new l;for(let t=this.adjls[r].iterator();t.hasNext();)e.push(t.next());for(let s=e.iterator();s.hasNext();)t.adjls[r].add(s.next())}return t}V(){return this._V}E(){return this._E}addEdge(t){n.assert(t instanceof d,"Expected DirectedEdge");let e=t.from(),r=t.to();f(e,this._V),f(r,this._V),this.adjls[e].add(t),this._indegree[r]+=1,this._E++}adj(t){return f(t,this._V),this.adjls[t]}outdegree(t){return f(t,this._V),this.adjls[t].size()}indegree(t){return f(t,this._V),this._indegree[t]}edges(){let t=new o;for(let e=0;e<this._V;e++)for(let r=this.adj(e).iterator();r.hasNext();)t.add(r.next());return t}toString(){let t=`${this._V} ${this._E}\n`;for(let e=0;e<this._V;e++){t+=e+": ";for(let r=this.adjls[e].iterator();r.hasNext();)t+=r.next()+"  ";t+="\n"}return t}static test(){let t="4 5 0.35\n        5 4 0.35\n        4 7 0.37\n        5 7 0.28\n        7 5 0.28\n        5 1 0.32\n        0 4 0.38\n        0 2 0.26\n        7 3 0.39\n        1 3 0.29\n        2 7 0.34\n        6 2 0.40\n        3 6 0.52\n        6 0 0.58\n        6 4 0.93".split(/\s+/).map(t=>+t),e=p.load(8,t);console.log(e.toString())}}class g{constructor(t,e,r){n.assert(t instanceof p,"Expected EdgeWeightedDigraph");for(let e,r=t.edges().iterator();r.hasNext();)if(e=r.next(),e.weight()<0)throw Error(`edge ${e} has negative weight`);this._distTo=new Array(t.V()),this.edgeTo=new Array(t.V()),f(e,t.V());for(let e=0;e<t.V();e++)this._distTo[e]=1/0;for(this._distTo[e]=0,this.pq=new u(t.V(),r),this.pq.insert(e,this._distTo[e]);!this.pq.isEmpty();){let e=this.pq.delMin();for(let r=t.adj(e).iterator();r.hasNext();)this._relax(r.next())}}_relax(t){let e=t.from(),r=t.to();this._distTo[r]>this._distTo[e]+t.weight()&&(this._distTo[r]=this._distTo[e]+t.weight(),this.edgeTo[r]=t,this.pq.contains(r)?this.pq.decreaseKey(r,this._distTo[r]):this.pq.insert(r,this._distTo[r]))}distTo(t){return f(t,this._distTo.length),this._distTo[t]}hasPathTo(t){return f(t,this._distTo.length),this._distTo[t]<1/0}pathTo(t){if(f(t,this._distTo.length),!this.hasPathTo(t))return null;let e=new l;for(let r=this.edgeTo[t];null!=r;r=this.edgeTo[r.from()])e.push(r);return e}check(t,e){for(let e=t.edges().iterator();e.hasNext();)if(e.next().weight()<0)throw Error("negative edge weight detected");if(0!=this._distTo[e]||null!=this.edgeTo[e])throw Error("distTo[s] and edgeTo[s] inconsistent");for(let r=0;r<t.V();r++)if(r!=e&&null==this.edgeTo[r]&&this._distTo[r]!=1/0)throw Error("distTo[] and edgeTo[] inconsistent");for(let e=0;e<t.V();e++)for(let r,s,i=t.adj(e).iterator();i.hasNext();)if(s=i.next(),r=s.to(),this._distTo[e]+s.weight()<this._distTo[r])throw Error(`edge ${s} not relaxed`);for(let e,r,s=0;s<t.V();s++)if(null!=this.edgeTo[s]){if(r=this.edgeTo[s],e=r.from(),s!=r.to())throw Error("bad");if(this._distTo[e]+r.weight()!=this._distTo[s])throw Error(`edge ${r} on shortest path not tight`)}return!0}static test(){let t="4 5 0.35\n                  5 4 0.35\n                  4 7 0.37\n                  5 7 0.28\n                  7 5 0.28\n                  5 1 0.32\n                  0 4 0.38\n                  0 2 0.26\n                  7 3 0.39\n                  1 3 0.29\n                  2 7 0.34\n                  6 2 0.40\n                  3 6 0.52\n                  6 0 0.58\n                  6 4 0.93".split(/\s+/).map(t=>+t),e=p.load(8,t),r=new g(e,0,s);for(let t=0;t<e.V();t++)r.hasPathTo(t)?console.log(`0 to ${t} (${Number(r.distTo(t)).toFixed(2)})  ${c(r.pathTo(t))}`):console.log(`0 to ${t}         no path\n`)}}g.test();return{}}"object"==typeof module&&module.exports?module.exports=e(require("../main/core"),require("./basic")):t["io/czlab/mcfud/algo/graph"]=e}(this),function(t){"use strict";function e(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:s,u:i}=e;function n(t,e){let r="";for(;t>0;)r+=e,--t;return r}function o(t,e){let r=u;return e&&(s.str(t)?r="any"===t||t===e?c:u:t instanceof e&&(r=c)),r}function l(t,e,r){return new Promise((s,i)=>{let n;try{n=r.call(t),n instanceof Promise?n.then((function(t){s(`${t?c:u}: ${e}`)})):(n=n?709394===n?h:c:u,s(`${n}: ${e}`))}catch(t){n=u,s(`${n}: ${e}`)}})}function a(t,e,r,s){return new Promise((i,n)=>{let l;try{l=r.call(t),l=709394===l?c:o(s,null)}catch(t){l=o(s,t)}i(`${l}: ${e}`)})}const[h,u,c]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,s=t.total,o=e/s*100;console.log(r.white(n(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(n(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(n(78,"="))),console.log(r.yellow(["Passed: ",e,"/",s," [",0|o,"%]"].join(""))),console.log(r.magenta("Failed: "+(s-e))),console.log(r.white(["cpu-time: ",i.prettyMillis(t.duration)].join(""))),console.log(r.white(n(78,"=")))},deftest(t){let[e,r,s,i]=[null,null,null,null];const n={ensure:(t,e)=>(s.push([1,t,e]),n),eerror:(t,e)=>(s.push([911,t,e]),n),begin:t=>(i={},s=[],e=t,n),end(n){r=n;let o=function(){return new Promise((t,n)=>{e&&e(i);let o,h=[];for(let t,e,r=0;r<s.length;++r){switch(e=s[r],e[0]){case 1:t=l(i,e[1],e[2]);break;case 911:t=a(i,e[1],e[2],"any")}o=o?o.then((function(e){return h.push(e),t})):t}o&&o.then((function(e){h.push(e),s.length=0,r&&r(i),t(h)}))})};return(o.title=t)&&o}};return n},_run:t=>new Promise((e,r)=>{t().then((function(t){e(t)}))}),runtest(t,e){const r=Date.now();return this._run(t).then((function(s){const i=Date.now(),n={title:e||t.title,date:(new Date).toString(),total:s.length,duration:i-r,passed:s.filter(t=>"P"===t[0]),skippd:s.filter(t=>"S"===t[0]),failed:s.filter(t=>"F"===t[0])};return new Promise(t=>{t(n)})}))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=e}(this);