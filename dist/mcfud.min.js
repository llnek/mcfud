!function(t,e,n){var r,i=256,s="random",o=n.pow(i,6),l=n.pow(2,52),c=2*l,u=255;function a(u,a,p){function g(){for(var t=x.g(6),e=o,n=0;t<l;)t=(t+n)*i,e*=i,n=x.g(1);for(;c<=t;)t/=2,e/=2,n>>>=1;return(t+n)/e}var v=[],y=m(function t(e,n){var r,i=[],s=typeof e;if(n&&"object"==s)for(r in e)try{i.push(t(e[r],n-1))}catch(t){}return i.length?i:"string"==s?e:e+"\0"}((a=1==a?{entropy:!0}:a||{}).entropy?[u,d(e)]:null==u?function(){try{var n;return r&&(n=r.randomBytes)?n=n(i):(n=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(n)),d(n)}catch(n){var s=t.navigator,o=s&&s.plugins;return[+new Date,t,o,t.screen,d(e)]}}():u,3),v),x=new h(v);return g.int32=function(){return 0|x.g(4)},g.quick=function(){return x.g(4)/4294967296},g.double=g,m(d(x.S),e),(a.pass||p||function(t,e,r,i){return i&&(i.S&&f(i,x),t.state=function(){return f(x,{})}),r?(n[s]=t,e):t})(g,y,"global"in a?a.global:this==n,a.state)}function h(t){var e,n=t.length,r=this,s=0,o=r.i=r.j=0,l=r.S=[];for(n||(t=[n++]);s<i;)l[s]=s++;for(s=0;s<i;s++)l[s]=l[o=u&o+t[s%n]+(e=l[s])],l[o]=e;(r.g=function(t){for(var e,n=0,s=r.i,o=r.j,l=r.S;t--;)e=l[s=u&s+1],n=n*i+l[u&(l[s]=l[o=u&o+e])+(l[o]=e)];return r.i=s,r.j=o,n})(i)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,r=t+"",i=0;i<r.length;)e[u&i]=u&(n^=19*e[u&i])+r.charCodeAt(i++);return d(e)}function d(t){return String.fromCharCode.apply(0,t)}if(m(n.random(),e),"object"==typeof module&&module.exports){module.exports=a;try{r=require("crypto")}catch(a){}}else"function"==typeof define&&define.amd?define((function(){return a})):n["seed"+s]=a}("undefined"!=typeof self?self:this,[],Math),function(t,e,n){"use strict";function r(){const[r,i]=[Array.prototype.slice,Object.prototype.toString],s=Math.floor;function o(t){return"[object Object]"==i.call(t)}function l(t){return"[object Function]"==i.call(t)}function c(t){return"[object Array]"==i.call(t)}function u(t){return"[object Map]"==i.call(t)}function a(t){return"[object String]"==i.call(t)}function h(t){return"[object Number]"==i.call(t)}function f(t){return t>0?t%2==0:-t%2==0}function m(t){return c(t)||u(t)||o(t)}let d=n?n():new Math.seedrandom;function p(t,e){for(let n,r=0;r<t.length;++r)if(n=t[r],!n[0](n[1]))throw new TypeError("wanted "+e);return!0}function g(t,e){for(let e,n=0;n<t.length;++n)if(e=t[n],e[0](e[1]))return!0;throw new TypeError("wanted "+e)}function v(t,e,n){if(!t(e))throw new TypeError("wanted "+n);return!0}const y=/(\/|\\\\)([^(\/|\\\\)]+)$/g,x=/(\.[^\.\/\?\\]*)(\?.*)?$/;function b(t,e){let n=x.exec(t);return n&&n[1]?(n=n[1].toLowerCase(),e||(n=n.substring(1))):n="",n}let M=0;function w(t,e,n){let r=t(e);switch(n.length){case 0:return r;case 1:return r&&t(n[0]);case 2:return r&&t(n[0])&&t(n[1]);case 3:return r&&t(n[0])&&t(n[1])&&t(n[2]);default:return r&&n.every(e=>t(e))}}const j={fun:(t,...e)=>w(l,t,e),str:(t,...e)=>w(a,t,e),void0:t=>void 0===t,undef:t=>void 0===t,some:t=>S.size(t)>0,none:t=>0===S.size(t),map:(t,...e)=>w(u,t,e),num:(t,...e)=>w(h,t,e),vec:(t,...e)=>w(c,t,e),obj:(t,...e)=>w(o,t,e),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},S={srand(){d=n?n():new Math.seedrandom},feq0:t=>Math.abs(t)<1e-10,feq:(t,e)=>Math.abs(t-e)<1e-10,pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,or:(t,e)=>void 0===t?e:t,toNumber(t,e){const n=parseFloat(t);return isNaN(n)&&h(e)?e:n},splitVerStr(t){const e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.toNumber(e[0],0),this.toNumber(e[1],0),this.toNumber(e[2],0)]},cmpVerStrs(t,e){let n=this.splitVerStr(""+t),r=this.splitVerStr(""+e);return n[0]>r[0]?1:n[0]<r[0]?-1:n[1]>r[1]?1:n[1]<r[1]?-1:n[2]>r[2]?1:n[2]<r[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter(t=>e.indexOf(b(t,1))>-1),partition(t,e){const n=[];for(let r,i,s=0;;){for(r=[],i=0;i<t;++i){if(!(s<e.length)){i=-1;break}r.push(e[s++])}if(r.length>0&&n.push(r),i<0)break}return n},keys:t=>u(t)?Array.from(t.keys()):o(t)?Object.keys(t):[],selectNotKeys(t,e){g([[u,t],[o,t]],"map/object");const n=u(t)?new Map:{};return e=this.seq(e),this.doseq(t,(t,r)=>!e.includes(r)&&this.assoc(n,r,t)),n},selectKeys(t,e){g([[u,t],[o,t]],"map/object");const n=u(t)?new Map:{};return this.seq(e).forEach(e=>{u(t)?t.has(e)&&n.set(e,t.get(e)):j.own(t,e)&&(n[e]=t[e])}),n},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0===e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),t=>this.has(e,t)?t:null)},randInt2:function(t,e){return s(d()*(e-t+1)+t)},randFloat:(t,e)=>t+d()*(e-t),randMinus1To1:()=>2*(d()-.5),randInt:t=>s(d()*t),rand:()=>d(),randSign:()=>d()>.5?-1:1,inst:(t,e)=>e instanceof t,hashCode(t){let e=0;for(let n=0;n<t.length;++n)e=Math.imul(31,e)+t.charCodeAt(n);return e},randItem(t){if(t&&t.length>0)return 1===t.length?t[0]:t[s(d()*t.length)]},isPerc:t=>a(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:f,jsMap(...t){v(f,t.length,"even n# of args");let e=new Map;for(let n=0;n<t.length;)e.set(t[n],t[n+1]),n+=2;return e},jsObj(...t){v(f,t.length,"even n# of args");let e={};for(let n=0;n<t.length;)e[t[n]]=t[n+1],n+=2;return e},jsVec:(...t)=>0===t.length?[]:t.slice(),lastIndex:t=>c(t)&&t.length>0?t.length-1:-1,first(t){if(c(t)&&t.length>0)return t[0]},last(t){if(c(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>r.call(t,e),every(t,e){v(c,t,"array");for(let n=0;n<t.length;++n)if(l(e)){if(!e(t[n]))return!1}else if(t[n]!==e)return!1;return t.length>0},notAny(t,e){v(c,t,"array");for(let n=0;n<t.length;++n)if(l(e)){if(e(t[n]))return!1}else if(t[n]===e)return!1;return t.length>0},copy(t,e=[]){p([[c,t],[c,e]],"arrays");const n=Math.min(t.length,e.length);for(let r=0;r<n;++r)t[r]=e[r];return t},append(t,e=[]){p([[c,t],[c,e]],"arrays");for(let n=0;n<e.length;++n)t.push(e[n]);return t},fill(t,e){if(h(t)&&(t=new Array(t)),c(t))for(let n=0;n<t.length;++n)t[n]=l(e)?e():e;return t},size(t){return c(t)||a(t)?t.length:u(t)?t.size:t?this.keys(t).length:0},nextId:()=>++M,now:()=>Date.now(),fileExt:t=>b(t),fileBase(t){let e,n,r=t.indexOf("?");return r>0&&(t=t.substring(0,r)),t=t.replace(/(\/|\\\\)$/,""),n=y.exec(t),e="",n&&(e=n[2],r=e.lastIndexOf("."),r>0&&(e=e.substring(0,r))),e},range(t,e,n=1){1===arguments.length&&(e=t,t=0,n=1);let r=(e-t)/n;const i=[];r=Math.ceil(r),r=Math.max(0,r),i.length=r;for(let e=0;e<r;++e)i[e]=t,t+=n;return i},shuffle(t){v(c,t,"array");const e=r.call(t,0);for(let t,n,r=e.length-1;r>0;--r)n=s(d()*(r+1)),t=e[r],e[r]=e[n],e[n]=t;return this.copy(t,e)},uniq:t=>(v(c,t,"array"),Array.from(new Set(t))),map(t,e,n){if(v(m,t,"array/map/object"),c(t))return t.map(e,n);{const r={};return this.doseq(t,(i,s)=>{r[s]=e.call(n,i,s,t)}),r}},find(t,e,n){let i,s=!0,o=r.call(arguments,3);return this.doseq(t,(t,r)=>{s&&e.apply(n,[t,r].concat(o))&&(i=[r,t],s=!1)}),i},some(t,e,n){let i,s=!0,o=r.call(arguments,3);return this.doseq(t,(t,r)=>{s&&(i=e.apply(n,[t,r].concat(o)),i?s=!1:i=void 0)}),i},invoke(t,e){let n=r.call(arguments,2);c(t)&&t.forEach(t=>t[e].apply(t,n))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,n=!1)=>({repeat:!!n,id:n?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&(t.repeat?clearInterval(t.id):clearTimeout(t.id))},rseq(t,e,n){if(v(c,t,"array"),t.length>0)for(let r=t.length-1;r>=0;--r)e.call(n,t[r],r,t)},doseq(t,e,n){c(t)?t.forEach(e,n):u(t)?t.forEach((r,i)=>e.call(n,r,i,t)):o(t)&&Object.keys(t).forEach(r=>e.call(n,t[r],r,t))},doseqEx(t,e,n){this.doseq(t,(r,i)=>null!=r&&e.call(n,r,i,t))},dissoc(t,e){if(arguments.length>2){let e,n=1;for(;n<arguments.length;++n)e=this.dissoc(t,arguments[n]);return e}{let n;return u(t)?(n=t.get(e),t.delete(e)):o(t)&&(n=t[e],delete t[e]),n}},get(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc(t,e,n){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,n=1;for(;n<arguments.length;)e=this.assoc(t,arguments[n],arguments[n+1]),n+=2;return e}{let r;return u(t)?(r=t.get(e),t.set(e,n)):t&&(r=t[e],t[e]=n),r}},disj(t,e){const n=t?t.indexOf(e):-1;return n>-1&&t.splice(n,1),n>-1},conj:(t,...e)=>(t&&e.forEach(e=>t.push(e)),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),c(t)||(t=[t]),t),has(t,e){return 1!==arguments.length&&(u(t)?t.has(e):c(t)?-1!==t.indexOf(e):!!o(t)&&j.own(t,e))},patch(t,e){return v(o,t=t||{},"object"),e&&Object.keys(e).forEach(n=>{this.has(t,n)||(t[n]=e[n])}),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach(e=>e&&Object.assign(t,e)),t),deepCopyArray(t){v(c,t,"array");const e=[];for(let n=0,r=t.length;n<r;++n)e[n]=c(t[n])?this.deepCopyArray(t[n]):t[n];return e},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let n;return Object.keys(e).forEach(r=>{n=e[r],"object"==typeof n&&null!==n&&t[r]?("object"!=typeof t[r]&&(t[r]=n instanceof Array?[]:{}),this.merge(t[r],n)):t[r]=n}),t},throttle(t,e,n){let r=!0,i=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return o(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),this.debounce(t,e,{leading:r,trailing:i,maxWait:e})},debounce(t,e,n){let r,i,s,o,l,c,u=0,a=!1,h=!1,f=!0;const m=!e&&0!==e&&"function"==typeof root.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function d(e){const n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n),o}function p(t,e){return m?(root.cancelAnimationFrame(l),root.requestAnimationFrame(t)):setTimeout(t,e)}function g(t){const n=t-c;return void 0===c||n>=e||n<0||h&&t-u>=s}function v(){const t=Date.now();if(g(t))return y(t);l=p(v,function(t){const n=t-u,r=e-(t-c);return h?Math.min(r,s-n):r}(t))}function y(t){return l=void 0,f&&r?d(t):(r=i=void 0,o)}function x(...t){const n=Date.now(),s=g(n);if(r=t,i=this,c=n,s){if(void 0===l)return function(t){return u=t,l=p(v,e),a?d(t):o}(c);if(h)return l=p(v,e),d(c)}return void 0===l&&(l=p(v,e)),o}return e=+e||0,isObject(n)&&(a=!!n.leading,h="maxWait"in n,s=h?Math.max(+n.maxWait||0,e):s,f="trailing"in n?!!n.trailing:f),x.cancel=function(){void 0!==l&&function(t){if(m)return root.cancelAnimationFrame(t);clearTimeout(t)}(l),u=0,r=c=i=l=void 0},x.flush=function(){return void 0===l?o:y(Date.now())},x.pending=function(){return void 0!==l},x},negate:t=>(v(l,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,n)=>(e-=t.length)>0?t+new Array(Math.ceil(e/n.length)+1).join(n).substr(0,e):t,strPadLeft:(t,e,n)=>(e-=t.length)>0?new Array(Math.ceil(e/n.length)+1).join(n).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter(t=>t.length>0),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2){return this.strPadLeft(Number(t).toString(),e,"0")},dropArgs:(t,e)=>t.length>e?r.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let n=t;if(2===arguments.length&&911===arguments[1].hack&&(n=arguments[1]),n&&n.location&&e){const t=e.indexOf("://");if(t>0){let r=e.indexOf("/",t+3);return(r<0?e:e.substring(0,r))!=n.location.origin}}}};e&&(S.addEvent=function(t,e,n,r){c(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,n,r)},S.delEvent=function(t,e,n,r){c(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,n,r)});const A={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,n)=>a(n)?e.getElementsByTagNameNS(n,t):e.getElementsByTagName(id),attrs(t,e){return!o(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&S.doseq(e,(e,n)=>t.setAttribute(n,e)),t)},css(t,e){return!o(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&S.doseq(e,(e,n)=>t.style[n]=e),t)},wrap(t,e){const n=t.parentNode;return e.appendChild(t),n.appendChild(e),e},newElm(t,n,r){const i=e.createElement(t);return this.attrs(i,n),this.css(i,r),i},newTxt(t,n,r){const i=e.createTextNode(t);return this.attrs(i,n),this.css(i,r),i}};return{is:j,u:S,dom:e?A:{},EventBus:function(){let t=S.jsMap(),e={},n=[];return{sub(n,r,i,s){let o=n[0],l=n[1];S.seq(o).forEach(n=>{if(r||(r=n),a(r)&&(r=(i=i||l)[r]),!r)throw"Error: no callback for sub()";t.has(n)||t.set(n,S.jsMap());let o=t.get(n);l=l||e,!o.has(l)&&o.set(l,[]),o.get(l).push([r,i,s])})},pub(r,...i){let s,o,l=r[0],c=r[1]||e;S.seq(l).forEach(e=>{o=t.get(e),s=o&&o.get(c),s&&s.forEach(t=>{t[0].apply(t[1],i.concat(t[2]||n))})})},unsub(n,r,i){let s,o,l=n[0],c=n[1]||e;S.seq(l).forEach(e=>{if(s=t.get(e),o=s&&s.get(c),o)if(a(r)&&(r=(i=i||c)[r]),r)for(let t=o.length-1;t>=0;--t)o[t][0]===r&&o[t][1]===i&&o.splice(t,1);else;})}}}}}"object"==typeof module&&module.exports?n=require("../tpcl/seedrandom.min"):e=t.document,"object"==typeof module&&module.exports?module.exports=r():t["io/czlab/mcfud/core"]=r}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const n=360,r=2*Math.PI,{is:i,u:s}=(Math.PI,e),o={EPSILON:1e-10};function l(t){return t<0?- -t%n:t%n}return o.lerp=function(t,e,n){return(1-n)*t+n*e},o.xmod=function(t,e){return t<0?t- -(e+e*Math.floor(-t/e)):t%e},o.clamp=function(t,e,n){return n<t?t:n>e?e:n},o.sqr=function(t){return t*t},o.fuzzyEq=function(t,e){return Math.abs(t-e)<1e-10},o.fuzzyZero=function(t){return this.fuzzyEq(t,0)},o.radToDeg=function(t){return l(n*t/r)},o.degToRad=function(t){return r*l(t)/n},o.pythag2=function(t,e){return t*t+e*e},o.pythag=function(t,e){return Math.sqrt(t*t+e*e)},o.wrap=function(t,e){return(t+1)%e},o.biasGreater=function(t,e){return t>=.95*e+.01*t},o}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/math"]=e}(this),function(t){"use strict";function e(e=!1,n=null){class r{constructor(){this.x=this.y=0}}n||(n=t["io/czlab/mcfud/core"]());const{u:i,is:s}=n;const o=e?function(){return new r}:function(){return[0,0]},l=[];function c(...t){for(let n,i=0;i<t.length&&(n=t[i],l.length<96);++i)(e&&n instanceof r||!e&&n&&2===n.length)&&l.push(n)}function u(t=0,n=0){const r=l.length>0?l.pop():o();return e?(r.x=t,r.y=n):(r[0]=t,r[1]=n),r}const a=(t,e)=>t+e,h=(t,e)=>t-e,f=(t,e)=>t*e,m=(t,e)=>t/e;function d(t,n){return s.num(n)&&(n=t),e?i.assert(t instanceof r&&n instanceof r):i.assert(2===t.length&&t.length===n.length),!0}function p(t,n,r,i){let l=d(n,r)?i?n:o():null,c=s.num(r);return e?(l.x=t(n.x,c?r:r.x),l.y=t(n.y,c?r:r.y)):(l[0]=t(n[0],c?r:r[0]),l[1]=t(n[1],c?r:r[1])),l}function g(t,e,n,r,i){const s=r?r[0]:0,o=r?r[1]:0,l=t[0]-s,c=t[1]-o,a=s+(l*e-c*n),h=o+(l*n+c*e);return i?(t[0]=a,t[1]=h):t=u(a,h),t}function v(t,e,n,r,i){const s=r?r.x:0,o=r?r.y:0,l=t.x-s,c=t.y-o,a=s+(l*e-c*n),h=o+(l*n+c*e);return i?(t.x=a,t.y=h):t=u(a,h),t}return{take:u,reclaim:c,vec2:(t,e)=>u(t,e),add:(t,e)=>p(a,t,e),add$:(t,e)=>p(a,t,e,1),sub:(t,e)=>p(h,t,e),sub$:(t,e)=>p(h,t,e,1),mul:(t,e)=>p(f,t,e),mul$:(t,e)=>p(f,t,e,1),div:(t,e)=>p(m,t,e),div$:(t,e)=>p(m,t,e,1),dot(t,n){if(d(t,n))return e?t.x*n.x+t.y*n.y:t[0]*n[0]+t[1]*n[1]},makeVecAB:(t,n)=>e?u(n.x-t.x,n.y-t.y):u(n[0]-t[0],n[1]-t[1]),len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){let n=this.sub(e,t),r=this.len2(n);return c(n),r},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let n=this.len(t),r=o();return i.feq0(n)||(e?(r.x=t.x/n,r.y=t.y/n):(r[0]=t[0]/n,r[1]=t[1]/n)),r},unit$(t){let n=this.len(t);return i.feq0(n)||(e?(t.x/=n,t.y/=n):(t[0]/=n,t[1]/=n)),t},set:(t,n)=>(d(t,n),e?(t.x=n.x,t.y=n.y):(t[0]=n[0],t[1]=n[1]),t),clone(t){return this.set(o(),t)},copy:(t,...n)=>(i.assert(2===n.length)&&d(t,t),e?(t.x=n[0],t.y=n[1]):(t[0]=n[0],t[1]=n[1]),t),rot(t,n,r){d(t,r||t);const i=Math.cos(n),s=Math.sin(n);return e?v(t,i,s,r):g(t,i,s,r)},rot$(t,n,r){d(t,r||t);const i=Math.cos(n),s=Math.sin(n);return e?v(t,i,s,r,1):g(t,i,s,r,1)},cross:(t,n)=>e?function(t,e){return t instanceof r&&e instanceof r?t.x*e.y-t.y*e.x:t instanceof r&&s.num(e)?u(e*t.y,-e*t.x):s.num(t)&&e instanceof r?u(-t*e.y,t*e.x):void 0}(t,n):function(t,e){return s.vec(t)&&s.vec(e)?(d(t,e),t[0]*e[1]-t[1]*e[0]):s.vec(t)&&s.num(e)?(d(t,t),u(e*t[1],-e*t[0])):s.num(t)&&s.vec(e)?(d(e,e),u(-t*e[1],t*e[0])):void 0}(t,n),angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal:(t,n=!1)=>(d(t,t),e?n?u(-t.y,t.x):u(t.y,-t.x):n?u(-t[1],t[0]):u(t[1],-t[0])),normal$(t,n=!1){d(t,t);const r=e?t.x:t[0];return e?n?(t.x=-t.y,t.y=r):(t.x=t.y,t.y=-r):n?(t[0]=-t[1],t[1]=r):(t[0]=t[1],t[1]=-r),t},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const n=this.unit(e);return this.mul$(n,this.dot(t,n))},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){return this.sub(t,this.mul(e,2*this.dot(t,e)))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...n){let r,i=!1;return 1===n.length&&s.vec(n[0])&&(n=n[0],i=!0),r=1===n.length&&!i,e?r?this.vec2(t.x+n[0].x,t.y+n[0].y):n.map(e=>this.vec2(t.x+e.x,t.y+e.y)):r?this.vec2(t[0]+n[0][0],t[1]+n[0][1]):n.map(e=>this.vec2(t[0]+e[0],t[1]+e[1]))}}}"object"==typeof module&&module.exports?module.exports=e(!1,require("./core")):t["io/czlab/mcfud/vec2"]=e}(this),function(t){"use strict";function e(e,n){e||(e=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]());const r=Math.atan2,i=Math.cos,s=Math.sin,o=Math.tan,{u:l,is:c}=e,u={V3:function(t,e,n){return[t||0,e||0,n||0]},vecDot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]+e[2]},vecCross:function(t,e){return this.V3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},vecLen2:function(t){return this.vecDot(t,t)},vecLen:function(t){return Math.sqrt(this.vecLen2(t))},vecUnit:function(t){let e=this.vecLen(t),n=this.V3();return e>EPSILON&&(n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e),n},vecSub:function(t,e){return c.num(e)?this.V3(t[0]-e,t[1]-e,t[2]-e):this.V3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},vecAdd:function(t,e){return c.num(e)?this.V3(t[0]+e,t[1]+e,t[2]+e):this.V3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},vecMul:function(t,e){return c.num(e)?this.V3(t[0]*e,t[1]*e,t[2]*e):this.V3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},vecDiv:function(t,e){return c.num(e)?this.V3(t[0]/e,t[1]/e,t[2]/e):this.V3(t[0]/e[0],t[1]/e[1],t[2]/e[2])}};function a(t){return t%2!=0}function h(t,e,n,r){return r-1+(n-1)*e}function f(t,e,n){return{dim:[t,e],cells:n}}return u.matrix=function([t,e],...n){let r=t*e;return 0===n.length?function(t,e){return f(t,e,l.fill(new Array(t*e),0))}(t,e):l.assert(r===n.length)&&f(t,e,n)},u.matIdentity=function(t){let e=l.fill(new Array(t*t),0);for(let n=0;n<t;++n)e[h(0,t,n+1,n+1)]=1;return f(t,t,e)},u.matZero=function(t){return l.assert(t>0)&&f(t,t,l.fill(new Array(t*t),0))},u.mat2=function(t,e,n,r){return this.matrix([2,2],t,e,n,r)},u.mat3=function(t,e,n,r,i,s,o,l,c){return this.matrix([3,3],t,e,n,r,i,s,o,l,c)},u.mat4=function(t,e,n,r,i,s,o,l,c,u,a,h,f,m,d,p){return this.matrix([4,4],t,e,n,r,i,s,o,l,c,u,a,h,f,m,d,p)},u.matEq=function(t,e){return t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&function(t,e){for(let r=0;r<t.length;++r)if(!n.fuzzyEq(t[r],e[r]))return!1;return!0}(t.cells,e.cells)},u.matNeq=function(t,e){return!this.matEq(t,e)},u.matXpose=function(t){let[e,n]=t.dim,r=e*n,i=[];for(let s=0;s<r;++s)i.push(t.cells[s/e+n*(s%e)]);return f(n,e,i)},u.mat3FastInverse=function(t){return l.assert(3===t.dim[0]&&3===t.dim[1])&&this.matXpose(t)},u.mat4FastInverse=function(t){_assert(4===t.dim[0]&&4===t.dim[1]);let e=this.matXpose(t),[n,r]=t.dim,i=l.partition(r,t.cells),s=i[0],o=i[1],c=i[2],u=i[3],a=s.slice(0,3),f=o.slice(0,3),m=c.slice(0,3),d=u.slice(0,3);return t.cells[h(0,4,1,4)]=0,t.cells[h(0,4,2,4)]=0,t.cells[h(0,4,3,4)]=0,t.cells[h(0,4,4,1)]=-this.vecDot(a,d),t.cells[h(0,4,4,2)]=-this.vecDot(f,d),t.cells[h(0,4,4,3)]=-this.vecDot(m,d),e},u.matScale=function(t,e){return f(t.dim[0],t.dim[1],t.cells.map(t=>t*e))},u.matMult=function(t,e){let[n,r]=t.dim,[i,s]=e.dim,o=t.cells,c=e.cells;l.assert(r===i,"mismatch matrices");let u=new Array(n*s);for(let t=0;t<n;++t)for(let e=0;e<s;++e)u[e+t*s]=l.range(i).reduce((n,i)=>n+o[i+t*r]*c[e+i*s],0);return f(n,s,u)},u.matDet=function(t){let[e,n]=t.dim,r=[];for(let e=0;e<n;++e)l.conj(r,this.matDet(this.matCut(t,1,e+1)));return l.range(n).reduce((e,n)=>{let i=r[n];return e+t.cells[n]*(a(n)?-i:i)},0)},u.matDet2x2=function(t){return l.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]},u.matCut=function(t,e,n){let[r,i]=t.dim,s=e-1,o=n-1,c=[];for(let e=0;e<r;++e)for(let n=0;n<i;++n)e!==s&&n!==o&&l.conj(c,t.cells[n+e*i]);return f(r-1,i-1,c)},u.matMinor=function(t){let[e,n]=t.dim,r=[];for(let i=0;i<e;++i)for(let e=0;e<n;++e)l.conj(r,this.matDet(this.matCut(t,i+1,e+1)));return f(e,n,r)},u.matMinor2x2=function(t){return l.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},u.matCofactor=function(t){let e=this.matMinor(t),[n,r]=e.dim,i=t.cells.slice();for(let t=n*r,e=0;e<t;++e)a(e)&&(i[e]=-i[e]);return f(n,r,i)},u.matAdjugate=function(t){return this.matXpose(this.matCofactor(t))},u.matInverse2x2=function(t){let[e,r]=t.dim;l.assert(4===t.cells.length&&2===e&&2===r);let i,s=t.cells,o=s[0]*s[3]-s[1]*s[2];if(n.fuzzyZero(o))i=this.matIdentity(e);else{let t=1/o;i=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return i},u.matInverse=function(t){let[e,r]=t.dim,i=this.matDet(t);return n.fuzzyZero(i)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/i)},u.matFromColMajor=function(t){return this.matXpose(t)},u.matToColMajor=function(t){return this.matXpose(t)},u.mat4Txlate=function(t){let e=l.assert(3===t.length)&&this.matIdentity(4);return e.cells[h(0,4,4,1)]=t[0],e.cells[h(0,4,4,2)]=t[1],e.cells[h(0,4,4,3)]=t[2],e},u.matFromMX_3x3=function(t){l.assert(9===t.cells.length);let[e,n]=t.dim,r=l.partition(n,t.cells),i=r[0],s=r[1],o=r[2];return f(e+1,n+1,i.concat(0,s,0,o,0,[0,0,0,1]))},u.getTranslation4x4=function(t){l.assert(16===t.cells.length);let e=t.cells;return this.V3(e[h(0,4,4,1)],e[h(0,4,4,2)],e[h(0,4,4,3)])},u.matFromVX_V3=function(t){l.assert(3===t.length);let e=this.matIdentity(4),n=e.cells;return n[h(0,4,1,1)]=t[0],n[h(0,4,2,2)]=t[1],n[h(0,4,3,3)]=t[2],e},u.getScaleFromMX_4x4=function(t){l.assert(16===t.cells.length);let[e,n]=t.dim,r=l.partition(n,t.cells),i=r[0],s=r[1],o=r[2];return this.V3(i[0],s[1],o[2])},u.matVMult=function(t,e){let n=t.dim[1],r=e.length;l.assert(n===r);let i=this.matMult(t,f(r,1,e)),s=i.cells;return i.cells=null,s},u.rotation2x2=function(t){return this.mat2(i(t),-s(t),s(t),i(t))},u.yawPitchRoll=function(t,e,n){return this.mat4(i(n)*i(t)+s(n)*s(e)*s(t),s(n)*i(e),i(n)*-s(t)+s(n)*s(e)*i(t),0,-s(n)*i(t)+i(n)*s(e)*s(t),i(n)*i(e),s(n)*s(t)+i(n)*s(e)*i(t),0,i(e)*s(t),-s(e),i(e)*i(t),0,0,0,0,1)},u.xRotation=function(t){return this.mat4(1,0,0,0,0,i(t),s(t),0,0,-s(t),i(t),0,0,0,0,1)},u.xRotation3x3=function(t){return this.mat3(1,0,0,0,i(t),s(t),0,-s(t),i(t))},u.yRotation=function(t){return this.mat4(i(t),0,-s(t),0,0,1,0,0,s(t),0,i(t),0,0,0,0,1)},u.yRotation3x3=function(t){return this.mat3(i(t),0,-s(t),0,1,0,s(t),0,i(t))},u.zRotation=function(t){return this.mat4(i(t),s(t),0,0,-s(t),i(t),0,0,0,0,1,0,0,0,0,1)},u.zRotation3x3=function(t){return this.mat3(i(t),s(t),0,-s(t),i(t),0,0,0,1)},u.mat4Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation(n),this.xRotation(t)),this.yRotation(e))},u.mat3Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation3x3(n),this.xRotation3x3(t)),this.yRotation3x3(e))},u.matOrthogonal4x4=function(t){l.assert(16===t.cells.length);let[e,n]=t.dim,r=l.partition(n,t.cells),i=r[0],s=r[1],o=r[2],c=r[3],u=i.slice(0,3),a=s.slice(0,3),h=this.vecCross(u,a),f=this.vecCross(a,h),m=this.vecCross(h,u),d=this.vecCross(u,a);return this.mat4(f[0],f[1],f[2],i[3],m[0],m[1],m[2],s[3],d[0],d[1],d[2],o[3],c[0],c[1],c[2],c[3])},u.matOrthogonal3x3=function(t){l.assert(9===t.cells.length);let[e,n]=t.dim,r=l.partition(n,t.cells),i=r[0],s=r[1],o=(r[2],i),c=s,u=this.vecCross(o,c),a=this.vecCross(c,u),h=this.vecCross(u,o),f=this.vecCross(o,c);return this.mat3(a[0],a[1],a[2],h[0],h[1],h[2],f[0],f[1],f[2])},u.mat4AxisAngle=function(t,e){l.assert(3===t.length);let r=t[0],o=t[1],c=t[2],u=this.vecLen(t),a=i(e),h=s(e),f=1-a;if(!n.fuzzyEq(u,1)){let t=1/u;r*=t,o*=t,c*=t}return this.mat4(a+f*r*r,f*r*o+h*c,f*r*c-h*o,0,f*r*o-h*c,a+f*o*o,f*o*c+h*r,0,f*r*c+h*o,f*o*c-h*r,a+f*c*c,0,0,0,0,1)},u.axisAngle3x3=function(t,e){l.assert(3===t.length);let r=t[0],o=t[1],c=t[2],u=i(e),a=s(e),h=1-u,f=this.vecLen(t);if(!n.fuzzyEq(f,1)){let t=1/f;r*=t,o*=t,c*=t}return this.mat3(u+h*r*r,h*r*o+a*c,h*r*c-a*o,h*r*o-a*c,u+h*o*o,h*o*c+a*r,h*r*c+a*o,h*o*c-a*r,u+h*c*c)},u.matMultV3M4=function(t,e){l.assert(3===t.length&&16===e.cells.length);let n=t[0],r=t[1],i=t[2],s=l.partition(4,e.cells),o=s[0],c=s[1],u=s[2],a=s[3];return this.V3(n*o[0]+r*c[0]+i*u[0]+1*a[0],n*o[1]+r*c[1]+i*u[1]+1*a[1],n*o[2]+r*c[2]+i*u[2]+1*a[2])},u.mat3MultVX_4x4=function(t,e){l.assert(3===t.length&&16===e.cells.length);let n=t[0],r=t[1],i=t[2],s=l.partition(4,e.cells),o=s[0],c=s[1],u=s[2],a=s[3];return[n*o[0]+r*c[0]+i*u[0]+0*a[0],n*o[1]+r*c[1]+i*u[1]+0*a[1],n*o[2]+r*c[2]+i*u[2]+0*a[2]]},u.mat3MultVX_3x3=function(t,e){l.assert(3===t.length&&9===e.cells.length);t[0],t[1],t[2];let n=l.partition(3,e.cells),r=n[0],i=n[1],s=n[2];return[this.vecDot(t,this.V3(r[0],i[0],s[0])),this.vecDot(t,this.V3(r[1],i[1],s[1])),this.vecDot(t,this.V3(r[2],i[2],s[2]))]},u.mat4TxformViaRotation=function(t,e,n){l.assert(3===e.length);let r=e[0],i=e[1],s=e[2];return this.matMult(this.matMult(this.matFromVX(t),this.mat4Rotation(r,i,s)),this.mat4Txlate(n))},u.mat4TxformViaAxisAngle=function(t,e,n,r){return this.matMult(this.matMult(this.matFromVX(t),this.mat4AxisAngle(e,n)),this.mat4Txlate(r))},u.mat4LookAt=function(t,e,n){let r=this.vecUnit(this.vecSub(e,t)),i=this.vecUnit(this.vecCross(n,r)),s=this.vecCross(r,i);return this.mat4(i[0],s[0],r[0],0,i[1],s[1],r[1],0,i[2],s[2],r[2],0,-this.vecDot(i,t),-this.vecDot(s,t),-this.vecDot(r,t),1)},u.mat4Proj=function(t,e,n,r){let i=1/o(.5*t),s=i/e,l=r/(r-n),c=this.matIdentity(4);return c.cells[h(0,4,1,1)]=s,c.cells[h(0,4,2,2)]=i,c.cells[h(0,4,3,3)]=l,c.cells[h(0,4,3,4)]=1,c.cells[h(0,4,4,3)]=-n*l,c.cells[h(0,4,4,4)]=0,c},u.mat4Ortho=function(t,e,n,r,i,s){let o=(e-t)/2,l=(r-n)/2,c=(s-i)/1,u=(t+e)/(t-e),a=(r+n)/(n-r),h=i/(i-s);return this.mat4(o,0,0,0,0,l,0,0,0,0,c,0,u,a,h,1)},u.matDecompose3x3=function(t){let e=this.matXpose(t),n=l.partition(3,e),i=n[0],s=n[1],o=n[2],c=Math.sqrt(i[0]*i[0]+s[0]*s[0]);return c<1e-6?this.V3(r(-s[2],s[1]),r(-o[0],c),0):this.V3(r(o[1],o[2]),r(-o[0],c),r(s[0],i[0]))},u}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math")):t["io/czlab/mcfud/matrix"]=e}(this),function(t){"use strict";const e=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",n=e.length;function r(r){r||(r=t["io/czlab/mcfud/core"]());const{u:i}=r,s={};function o(t){return Math.abs(t)%n}function l(t,n){return(n||e).charAt(t)}function c(t){for(let e=0;e<n;++e)if(charat(e)===t)return e;return-1}function u(t,e){let r=e+t;return l(r>=n?r-n:r)}function a(t,e){let r=e-t;return l(r<0?n+r:r)}return s.encrypt=function(t,e){if(0===e)return t;let n=[],r=o(e);return t.split().forEach(t=>{let i=c(t);n.push(i<0?t:function(t,e,n){return t<0?u(e,n):a(e,n)}(e,r,i))}),n.join("")},s.decrypt=function(t,e){if(0===e)return t;let n,r=[],i=o(e);return t.split("").forEach(t=>{n=c(t),r.push(n<0?t:function(t,e,n){return t<0?a(e,n):u(e,n)}(e,i,n))}),r.join("")},s}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/crypt"]=r}(this),function(t){"use strict";function e(){return{fsm(t){let e=t.initState();return{state:()=>e,process(){let n=t[e];n&&n.run&&n.run()},trigger(n){let r=t[e];n=n||"change";let i=r&&r.transitions[n];if(i){let n=i.target,s=t[n];if(s)return r.egress&&r.egress(),s.ingress&&s.ingress(),i.action&&i.action(),e=n}}}}}}"object"==typeof module&&module.exports?module.exports=e():t["io/czlab/mcfud/fsm"]=e}(this),function(t){"use strict";function e(e,n){e||(e=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]());const r=2*Math.PI,{u:i}=e,s={textStyle:function(t,e,n,r){return{font:t,fill:e,align:n,base:r}},drawShape:function(t,e,...n){e.draw&&e.draw(t,...n)},cfgStyle:function(t,e){if(e){let n=e.line,r=e.stroke;n&&(n.cap&&(t.lineCap=n.cap),n.width&&(t.lineWidth=n.width)),r&&r.style&&(t.strokeStyle=r.style)}},drawPoints:function(t,e,n){void 0===n&&(n=e.length),t.beginPath();for(let r=0;r<n;++r){let i=(r+1)%n,s=e[r],o=e[i];t.moveTo(s[0],s[1]),t.lineTo(o[0],o[1])}t.stroke()},drawShapePoly:function(t,e){return this.drawPoints(t,e.points)},drawCircle:function(t,e,n,i){t.beginPath(),t.arc(e,n,i,0,r,!0),t.closePath(),t.stroke()},drawShapeCircle:function(t,e){this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},drawRect:function(t,e,n,r,i,s){let o=e,l=n-i;t.save(),t.translate(o,l),t.rotate(s),t.strokeRect(0,0,r,i),t.restore()},drawShapeRect:function(t,e){return this.drawRet(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},drawLine:function(t,e,n,r,i){t.beginPath(),t.moveTo(e,n),t.lineTo(r,i),t.stroke()},drawShapeLine:function(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])}};return i.inject(s,{TXMatrix2d:class{constructor(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]}identity(){let t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this}clone(t){let e=this.m,n=t.m;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],this}multiply(t){let e=this.m,n=t.m,r=e[0]*n[0]+e[1]*n[3],i=e[0]*n[1]+e[1]*n[4],s=e[0]*n[2]+e[1]*n[5]+e[2],o=e[3]*n[0]+e[4]*n[3],l=e[3]*n[1]+e[4]*n[4],c=e[3]*n[2]+e[4]*n[5]+e[5];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=l,e[5]=c,this}rotate(t){if(0===t)return this;let e=Math.cos(t),n=Math.sin(t),r=this.m,i=r[0]*e+r[1]*n,s=r[0]*-n+r[1]*e,o=r[3]*e+r[4]*n,l=r[3]*-n+r[4]*e;return r[0]=i,r[1]=s,r[3]=o,r[4]=l,this}rotateDeg(t){return 0===t?this:this.rotate(Math.PI*t/180)}scale(t,e){let n=this.m;return void 0===e&&(e=t),n[0]*=t,n[1]*=e,n[3]*=t,n[4]*=e,this}translate(t,e){let n=this.m;return n[2]+=n[0]*t+n[1]*e,n[5]+=n[3]*t+n[4]*e,this}transform(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]}transformPoint(t){let e=t.x,n=t.y;return t.x=e*this.m[0]+n*this.m[1]+this.m[2],t.y=e*this.m[3]+n*this.m[4]+this.m[5],t}transformArray(t,e){let n=t[0],r=t[1];return e[0]=n*this.m[0]+r*this.m[1]+this.m[2],e[1]=n*this.m[3]+r*this.m[4]+this.m[5],e}transformX(t,e){return t*this.m[0]+e*this.m[1]+this.m[2]}transformY(t,e){return t*this.m[3]+e*this.m[4]+this.m[5]}setContextTransform(t){let e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}}})}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math")):t["io/czlab/mcfud/gfx"]=e}(this),function(t){"use strict";function e(e,n,r){const[i,s,o]=[1,0,-1];e||(e=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]()),r||(r=t["io/czlab/mcfud/vec2"]());const{u:l}=e,c={};class u{constructor(t,e,n,i){switch(arguments.length){case 2:this.pos=r.vec2(),this.width=t,this.height=e;break;case 4:this.pos=r.vec2(t,e),this.width=n,this.height=i;break;default:throw"Error: bad input to Rect()"}}}class a{constructor(t,e){this.width=t,this.height=e}half(){return new a(this.width/2|0,this.height/2|0)}}c.polyArea=function(t){let e=0;for(let n,r,i,s=t.length,o=0;o<s;++o)i=(o+1)%s,n=t[o],r=t[i],e+=n[0]*r[1]-r[0]*n[1];return Math.abs(e)/2|0},c.calcPolyCenter=function(t){let e=6*c.polyArea(t),n=0,i=0;for(let e,r,s,o=0,l=t.length;o<l;++o)s=(o+1)%l,e=t[o],r=t[s],n+=(e[0]+r[0])*(e[0]*r[1]-r[0]*e[1]),i+=(e[1]+r[1])*(e[0]*r[1]-r[0]*e[1]);return r.vec2(n/e|0,i/e|0)};class h{constructor(t,e,n,i){this.p=r.vec2(t,e),this.q=r.vec2(n,i)}}class f{constructor(t,e){this.calcPoints=null,this.normals=null,this.edges=null,this.points=null,this.orient=0,this.pos=r.vec2(),this.setPos(t,e)}setPos(t=0,e=0){return r.vecCopy(this.pos,t,e),this}set(t){return this.calcPoints=this.calcPoints||[],this.normals=this.normals||[],this.edges=this.edges||[],this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=function(t){let e=t.length;l.assert(e>2&&e<=36);let n=0,i=t[0][0];for(let r,s=1;s<e;++s)r=t[s][0],r>i?(i=r,n=s):l.feq(r,i)&&t[s][1]<t[n][1]&&(n=s);let s=new Array(36),o=n,c=0;for(;;){s[c]=o;let i=0;for(let n=1;n<e;++n){if(i===o){i=n;continue}let e=r.vecSub(t[i],t[s[c]]),u=r.vecSub(t[n],t[s[c]]),a=r.vec2Cross(e,u);a<0&&(i=n),l.feq0(a)&&r.vecLen2(u)>r.vecLen2(e)&&(i=n)}if(++c,o=i,i===n)break}const u=[];for(let e=0;e<c;++e)u.push(r.vecClone(t[s[e]]));return u}(t),l.doseq(this.points,t=>{this.calcPoints.push(r.vec2()),this.edges.push(r.vec2()),this.normals.push(r.vec2())}),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}translate(t,e){return l.doseq(this.points,n=>{n[0]+=t,n[1]+=e}),this._recalc()}_recalc(){if(this.points){let t,e,n;l.doseq(this.points,(t,e)=>{r.vecSet(this.calcPoints[e],t),l.feq0(this.orient)||r.vec2RotSelf(this.calcPoints[e],this.orient)}),l.doseq(this.points,(i,s)=>{t=(s+1)%this.calcPoints.length,e=this.calcPoints[s],n=this.calcPoints[t],this.edges[s]=r.vecSub(n,e),this.normals[s]=r.vecUnit(r.perp(this.edges[s]))})}return this}}class m{constructor(t,e){this.overlapN=r.vec2(),this.overlapV=r.vec2(),this.A=t,this.B=e,this.clear()}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function d(t,e){let n=1/0,i=-1/0;for(let s,o=0;o<t.length;++o)s=r.vecDot(t[o],e),s<n&&(n=s),s>i&&(i=s);return r.take(n,i)}function p(t,e){let n=r.vecDot(e,t),l=r.vecLen2(t);return n<0?i:n>l?o:s}function g(t,e,n,i,s,o){let[l,c]=d(e,s),[u,a]=d(i,s),h=r.vecSub(n,t),f=r.vecDot(h,s);if(u+=f,a+=f,r.reclaim(h),l>a||u>c)return!0;if(o){let t=0;if(l<u)if(o.AInB=!1,c<a)t=c-u,o.BInA=!1;else{let[e,n]=[c-u,a-l];t=e<n?e:-n}else if(o.BInA=!1,c>a)t=l-a,o.AInB=!1;else{let[e,n]=[c-u,a-l];t=e<n?e:-n}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,r.vecSet(o.overlapN,s),t<0&&r.vecFlipSelf(o.overlapN))}}c.getAABB=function(t){if(l.has(t,"radius"))return new c.Rect(t.pos[0]-t.radius,t.pos[1]-t.radius,2*t.radius,2*t.radius);{let e=r.translate(t.pos,t.calcPoints),n=e[0][0],i=e[0][1],s=n,o=i;for(let t,r=1;r<e.length;++r)t=e[r],t[0]<n&&(n=t[0]),t[0]>s&&(s=t[0]),t[1]<i&&(i=t[1]),t[1]>o&&(o=t[1]);return new c.Rect(n,i,s-n,o-i)}},c.shiftPoints=function(t,e){return t.map(t=>r.vecAdd(t,e))},c.rotPoints=function(t,e,n){return t.map(t=>r.vec2Rot(t,e,n))},c.calcRectPoints=function(t,e){let n=t/2|0,i=e/2|0;return[r.vec2(n,-i),r.vec2(n,i),r.vec2(-n,i),r.vec2(-n,-i)]},c.line=function(t,e,n,r){return new h(t,e,n,r)},c.rectEqRect=function(t,e){return t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1]},c.rectContainsRect=function(t,e){return!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height)},c.rectGetMaxX=function(t){return t.pos[0]+t.width},c.rectGetMidX=function(t){return t.pos[0]+t.width/2|0},c.rectGetMinX=function(t){return t.pos[0]},c.rectGetMaxY=function(t){return t.pos[1]+t.height},c.rectGetMidY=function(t){return t.pos[1]+t.height/2|0},c.rectGetMinY=function(t){return t.pos[1]},c.rectContainsPoint=function(t,e,n){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&n>=this.rectGetMinY(t)&&n<=this.rectGetMaxY(t)},c.rectIntersectsRect=function(t,e){return!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1])},c.rectUnionsRect=function(t,e){const n=Math.min(t.pos[0],e.pos[0]),r=Math.min(t.pos[1],e.pos[1]);return new u(n,r,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-r)},c.rectIntersectsRect=function(t,e){const n=Math.max(t.pos[0],e.pos[0]),r=Math.max(t.pos[1],e.pos[1]);return new u(n,r,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-r)},c.hitTestPointCircle=function(t,e){return r.vecLen2(r.vecSub(t,e.pos))<=e.radius*e.radius};const v=new m,y=(x=new u(0,0,1,1),new f(x.pos[0],x.pos[1]).set([r.vec2(x.width,0),r.vec2(x.width,x.height),r.vec2(0,x.height),r.vec2()]));var x;function b(t,e,n){let i=t.radius+e.radius,s=r.vecSub(e.pos,t.pos),o=i*i,l=r.vecLen2(s),c=!(l>o);if(c&&n){let o=Math.sqrt(l);n.A=t,n.B=e,n.overlap=i-o,r.vecSet(n.overlapN,r.vecUnitSelf(s)),r.vecSet(n.overlapV,r.vecMul(s,n.overlap)),n.AInB=t.radius<=e.radius&&o<=e.radius-t.radius,n.BInA=e.radius<=t.radius&&o<=t.radius-e.radius}return r.reclaim(s),c}function M(t,e,n){let s,l=r.vecSub(e.pos,t.pos),c=e.radius*e.radius,u=t.calcPoints,a=r.take();for(let h=u.length,f=0;f<h;++f){let m=f===h-1?0:f+1,d=0===f?h-1:f-1,g=0,v=null;r.vecSet(a,t.edges[f]),s=r.vecSub(l,u[f]),n&&r.vecLen2(s)>c&&(n.AInB=!1);let y=p(a,s);if(y===i){r.vecSet(a,t.edges[d]);let i=r.vecSub(l,u[d]);if(y=p(a,i),y===o){let t=r.vecLen(s);if(t>e.radius)return r.reclaim(l,a,s,i),!1;n&&(n.BInA=!1,v=r.vecUnit(s),g=e.radius-t)}r.reclaim(i)}else if(y===o){if(r.vecSet(a,t.edges[m]),r.vecSubSelf(r.vecSet(s,l),u[m]),y=p(a,s),y===i){let t=r.vecLen(s);if(t>e.radius)return r.reclaim(l,a,s),!1;n&&(n.BInA=!1,v=r.vecUnit(s),g=e.radius-t)}}else{let t=r.vecUnitSelf(r.perp(a)),i=r.vecDot(s,t),o=Math.abs(i);if(i>0&&o>e.radius)return r.reclaim(l,t,s),!1;n&&(v=t,g=e.radius-i,(i>=0||g<2*e.radius)&&(n.BInA=!1))}v&&n&&Math.abs(g)<Math.abs(n.overlap)&&(n.overlap=g,r.vecSet(n.overlapN,v))}return n&&(n.A=t,n.B=e,r.vecMulSelf(r.vecSet(n.overlapV,n.overlapN),n.overlap)),r.reclaim(l,a,s),!0}function w(t,e,n){let i=M(e,t,n);if(i&&n){let t=n.A,e=n.AInB;r.vecFlipSelf(n.overlapN),r.vecFlipSelf(n.overlapV),n.A=n.B,n.B=t,n.AInB=n.BInA,n.BInA=e}return i}function j(t,e,i){let s=t.calcPoints,o=e.calcPoints;for(let n=0;n<s.length;++n)if(g(t.pos,s,e.pos,o,t.normals[n],i))return!1;for(let n=0;n<o.length;++n)if(g(t.pos,s,e.pos,o,e.normals[n],i))return!1;if(i){if(0===i.overlap||n.fuzzyZero(i.overlap))return!1;i.A=t,i.B=e,r.vecSet(i.overlapV,i.overlapN),r.vecMulSelf(i.overlapV,i.overlap)}return!0}return c.hitTestPointPolygon=function(t,e){return r.vecSet(y.pos,t),!!c.hitTestPolygonPolygon(y,e,v.clear())&&v.AInB},c.hitCircleCircle=function(t,e){let n=new m;return b(t,e,n)?n:null},c.hitTestCircleCircle=function(t,e){return b(t,e,new m)},c.hitPolygonCircle=function(t,e){let n=new m;return M(t,e,n)?n:null},c.hitTestPolygonCircle=function(t,e){return M(t,e,new m)},c.hitCirclePolygon=function(t,e){let n=new m;return w(t,e,n)?n:null},c.hitTestCirclePolygon=function(t,e){return w(t,e,new m)},c.hitPolygonPolygon=function(t,e){let n=new m;return j(t,e,n)?n:null},c.hitTestPolygonPolygon=function(t,e){return j(t,e,new m)},l.inject(c,{Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=r.vec2()}setOrient(t){return this.orient=t,this}setPos(t,e){return r.vecCopy(this.pos,t,e),this}},Line:h,Box:Box,Manifold:m,Polygon:f,Rect:u,Area:a})}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math"),require("./vec2")):t["io/czlab/mcfud/geo2d"]=e}(this),function(t){"use strict";function e(){class t{constructor(t,e,n,r,i,s){this.maxCount=i||12,this.maxDepth=s||5,this.objects=[],this.boxes=null,this.level=0,this.x1=t,this.x2=n,this.y1=e,this.y2=r,this.midX=(t+n)/2,this.midY=(e+r)/2}_ctree(e,n,r,i){let s=new t(e,n,r,i,this.maxCount,this.maxDepth);return s.level=this.level+1,s}_split(){_.assert(null===this.boxes),this.boxes=[this._ctree(this.midX,this.y1,this.x2,this.midY),this._ctree(this.midX,this.midY,this.x2,this.y2),this._ctree(this.x1,this.midY,this.midX,this.y2),this._ctree(this.x1,this.y1,this.midX,this.midY)]}_locate(t){let e=t.y<this.midY,n=t.x<this.midX,r=t.x+t.width>this.midX,i=t.y+t.height>this.midY;return e&&(n&&out.push(3),r&&out.push(0)),i&&(n&&out.push(2),r&&out.push(1)),out}insert(t){this.boxes?this._locate(t).forEach(e=>{this.boxes[e].insert(t)}):(this.objects.push(t),this.objects.length>this.maxCount&&this.level<this.maxDepth&&(this._split(),this.objects.forEach(t=>{this._locate(t).forEach(e=>{this.boxes[e].insert(t)})}),this.objects.length=0))}search(t){let e=new Map,n=[];return this.boxes&&this._locate(t).forEach(r=>{this.boxes[r].search(t).forEach(t=>{e.has(t)||(e.set(t,null),n.push(t))})}),this.objects.forEach(t=>{e.has(t)||(e.set(t,null),n.push(t))}),n}reset(){this.objects.length=0,this.boxes&&this.boxes.forEach(t=>{t.reset()}),this.boxes=null}}return{quadtree:(e,n,r)=>new t(e.x1,e.y1,e.x2,e.y2,n,r)}}"object"==typeof module&&module.exports?module.exports=e():t["io/czlab/mcfud/qtree"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:n}=e,r={};class i{constructor(){this.lastBestMove=null,this.state=null,this.other=0,this.cur=0}clone(){let t=new i;return t.state=n.deepCopyArray(this.state),t.lastBestMove=this.lastBestMove,t.other=this.other,t.cur=this.cur,t}}function s(t,e,n,r,i,o){if(0===r||t.isOver(e)){let n=t.evalScore(e);return 0!==n&&(n-=.01*r*Math.abs(n)/n),n}let l=t.getNextMoves(e),c=e,u=-1/0,a=l[0];r===n&&(e.lastBestMove=l[0]);for(let h,f,m=0;m<l.length&&(t.undoMove||(e=c.clone()),f=l[m],t.makeMove(e,f),t.switchPlayer(e),h=-s(t,e,n,r-1,-o,-i),t.undoMove&&(t.switchPlayer(e),t.undoMove(e,f)),u<h&&(u=h,a=f),!(i<h&&(i=h,r===n&&(e.lastBestMove=f),i>=o)));++m);return u}return r.evalNegaMax=function(t){let e=t.takeFFrame();return s(t,e,t.depth,t.depth,-1/0,1/0),e.lastBestMove},n.inject(r,{FFrame:i,GameBoard:class{constructor(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}makeMove(t,e){}switchPlayer(t){}takeFFrame(){}}})}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/negamax"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{is:n,u:r}=e;function i(t){return t.startsWith("P")}function s(t,e){let n="";for(;t>0;)n+=e,--t;return n}function o(t,e){let r=u;return e&&(n.str(t)?r="any"===t||t===e?a:u:t instanceof e&&(r=a)),r}function l(t,e){let n;try{n=e.call(t)?a:u}catch(t){n=u}return n}function c(t,e,n){let r;try{e.call(t),r=o(n,null)}catch(t){r=o(n,t)}return r}const[u,a]=["Failed","Passed"];return{deftest(t){let e=null,n=null,r=null,i=null,s={ensure:(t,e)=>(r.push([1,t,e]),s),eerror:(t,e)=>(r.push([911,t,e]),s),begin:t=>(i={},r=[],e=t,s),end(s){n=s;let o=function(){e&&e(i);let t=[];for(let e,n,s=0;s<r.length;++s){switch(n=r[s],e="",n[0]){case 1:e=l(i,n[2]);break;case 911:e=c(i,n[2],"any")}e&&t.push(`${e}: ${n[1]}`)}return r.length=0,n&&n(i),t};return(o.title=t)&&o}};return s},runtest(t,e){const n=Date.now(),r=t(),o=Date.now(),l=r.length,c=r.filter(i).length,u=c/l*100,a=o-n;return[s(78,"+"),e||t.title,(new Date).toString(),s(78,"+"),r.join("\n"),s(78,"="),["Passed: ",c,"/",l," [",0|u,"%]"].join(""),"Failed: "+(l-c),["cpu-time: ",a,"ms"].join("")].join("\n")}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/test"]=e}(this);