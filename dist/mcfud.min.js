!function(t,e,r){var n,s=256,o="random",i=r.pow(s,6),a=r.pow(2,52),l=2*a,c=255;function u(c,u,m){function g(){for(var t=x.g(6),e=i,r=0;t<a;)t=(t+r)*s,e*=s,r=x.g(1);for(;l<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var y=[],v=d(function t(e,r){var n,s=[],o=typeof e;if(r&&"object"==o)for(n in e)try{s.push(t(e[n],r-1))}catch(t){}return s.length?s:"string"==o?e:e+"\0"}((u=1==u?{entropy:!0}:u||{}).entropy?[c,p(e)]:null==c?function(){try{var r;return n&&(r=n.randomBytes)?r=r(s):(r=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(r)),p(r)}catch(r){var o=t.navigator,i=o&&o.plugins;return[+new Date,t,i,t.screen,p(e)]}}():c,3),y),x=new h(y);return g.int32=function(){return 0|x.g(4)},g.quick=function(){return x.g(4)/4294967296},g.double=g,d(p(x.S),e),(u.pass||m||function(t,e,n,s){return s&&(s.S&&f(s,x),t.state=function(){return f(x,{})}),n?(r[o]=t,e):t})(g,v,"global"in u?u.global:this==r,u.state)}function h(t){var e,r=t.length,n=this,o=0,i=n.i=n.j=0,a=n.S=[];for(r||(t=[r++]);o<s;)a[o]=o++;for(o=0;o<s;o++)a[o]=a[i=c&i+t[o%r]+(e=a[o])],a[i]=e;(n.g=function(t){for(var e,r=0,o=n.i,i=n.j,a=n.S;t--;)e=a[o=c&o+1],r=r*s+a[c&(a[o]=a[i=c&i+e])+(a[i]=e)];return n.i=o,n.j=i,r})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var r,n=t+"",s=0;s<n.length;)e[c&s]=c&(r^=19*e[c&s])+n.charCodeAt(s++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(d(r.random(),e),"object"==typeof module&&module.exports){module.exports=u;try{n=require("crypto")}catch(u){}}else"function"==typeof define&&define.amd?define((function(){return u})):r["seed"+o]=u}("undefined"!=typeof self?self:this,[],Math),"function"!=typeof JSON.decycle&&(JSON.decycle=function(t,e){"use strict";var r=new WeakMap;return function t(n,s){var o,i;return void 0!==e&&(n=e(n)),"object"!=typeof n||null===n||n instanceof Boolean||n instanceof Date||n instanceof Number||n instanceof RegExp||n instanceof String?n:void 0!==(o=r.get(n))?{$ref:o}:(r.set(n,s),Array.isArray(n)?(i=[],n.forEach((function(e,r){i[r]=t(e,s+"["+r+"]")}))):(i={},Object.keys(n).forEach((function(e){i[e]=t(n[e],s+"["+JSON.stringify(e)+"]")}))),i)}(t,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach((function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$}),function(t,e,r,n){"use strict";function s(){const s=t,o=Math.floor,i=Array.prototype.slice,a=Object.prototype.toString;function l(t){return"[object Object]"==a.call(t)}function c(t){return l(t)}function u(t){return"[object Function]"==a.call(t)}function h(t){return"[object Array]"==a.call(t)}function f(t){return"[object Map]"==a.call(t)}function d(t){return"[object Set]"==a.call(t)}function p(t){return"[object String]"==a.call(t)}function m(t){return"[object Number]"==a.call(t)}function g(t){return"[object Boolean]"==a.call(t)}function y(t){return(t<0?-t:t)%2==0}function v(t){return void 0===t}function x(t){return h(t)||f(t)||l(t)}const b=1.6180339887,M=r?r():Math.seedrandom?new Math.seedrandom:function(){return Math.random()};function w(t,e){return t.forEach((t=>{if(!t[0](t[1]))throw new TypeError(`wanted ${e}`)})),!0}function q(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError(`wanted ${e}`)}function k(t,e,r){if(!t(e))throw new TypeError(`wanted ${r}`);return!0}const E=/(\/|\\\\)([^(\/|\\\\)]+)$/g,j=/(\.[^\.\/\?\\]*)(\?.*)?$/;function P(t,e){let r=j.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}function A(t,e,r){const n=t(e);switch(r.length){case 0:return n;case 1:return n&&t(r[0]);case 2:return n&&t(r[0])&&t(r[1]);case 3:return n&&t(r[0])&&t(r[1])&&t(r[2]);default:return n&&r.every((e=>t(e)))}}const S=1e-10;let C=0;const $={},B={fun:(t,...e)=>A(u,t,e),str:(t,...e)=>A(p,t,e),undef:(t,...e)=>A(v,t,e),map:(t,...e)=>A(f,t,e),set:(t,...e)=>A(d,t,e),num:(t,...e)=>A(m,t,e),bool:(t,...e)=>A(g,t,e),pos:t=>m(t)&&t>0,neg:t=>m(t)&&t<0,vec:(t,...e)=>A(h,t,e),obj:(t,...e)=>A(l,t,e),notEmpty:t=>O.size(t)>0,isEmpty:t=>0==O.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},O={error(...t){console.error(...t)},log(...t){console.log(...t)},feq0:t=>t>=-1e-10&&t<=S,feq:(t,e,r=1e-10)=>t>=e-r&&t<=e+r,hexToBin(t){const e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};let r="";for(let s,o=0;o<t.length;++o)(s=e[t[o]])?r+=s:(o=1/0,r=n);return r},pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec:(t,...e)=>(e.forEach(((e,r)=>t[r]=e)),t),evenN:(t,e)=>y(t=o(t))?t:e?t+1:t-1,nichts:t=>null==t,echt:t=>null!=t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const r=parseFloat(t);return isNaN(r)&&m(e)?e:r},percentRemain:(t,e,r)=>(t>e&&(t=r?t%e:e),Math.max(0,e-t)/e),splitVerStr(t){const e=(""+(t||"")).split(".").filter((t=>t.length>0));return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),n=this.splitVerStr(""+e);return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]>n[1]?1:r[1]<n[1]?-1:r[2]>n[2]?1:r[2]<n[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter((t=>e.indexOf(P(t,1))>-1)),zipMap(t,e,r){let n,s=Math.min(t.length,e.length),o=r||new Map;for(n=0;n<s;++n)o.set(t[n],e[n]);return o},zip(t,e,r){return this.zipMap(t,e,r)},zipObj(t,e,r){let n,s=Math.min(t.length,e.length),o=r||{};for(n=0;n<s;++n)o[t[n]]=e[n];return o},partition(t,e){const r=[];for(let n,s,o=0;;){for(n=[],s=0;s<t;++s){if(!(o<e.length)){s=-1;break}n.push(e[o++])}if(n.length>0&&r.push(n),s<0)break}return r},keys:t=>f(t)?Array.from(t.keys()):l(t)?Object.keys(t):[],selectNotKeys(t,e){q([[f,t],[l,t]],"map/object");const r=f(t)?new Map:{};return e=this.seq(e),this.doseq(t,((t,n)=>!e.includes(n)&&this.assoc(r,n,t))),r},selectKeys(t,e){q([[f,t],[l,t]],"map/object");const r=f(t)?new Map:{};return this.seq(e).forEach((e=>{f(t)?t.has(e)&&r.set(e,t.get(e)):B.own(t,e)&&(r[e]=t[e])})),r},copyKeys(t,e,r){return q([[f,t],[l,t]],"map/object"),e instanceof Map&&O.assert(t instanceof Map,"expected Map"),this.seq(r).forEach((r=>{f(e)?e.has(r)&&t.set(r,e.get(r)):(B.own(e,r)||void 0!==e[r])&&(t[r]=e[r])})),t},setManyKeys(t,e,r){return q([[f,t],[l,t]],"map/object"),this.seq(e).forEach((e=>{f(t)?t.set(e,r):t[e]=r})),t},clearKeys(t,e){return q([[f,t],[l,t]],"map/object"),this.seq(e).forEach((e=>{f(t)?t.delete(e):delete t[e]})),t},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0==e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),(t=>this.has(e,t)?t:null))},randInt2:(t,e)=>t+o(M()*(e-t+1)),randFloat2:(t,e)=>t+M()*(e-t),randMinus1To1:()=>2*(M()-.5),randInt:t=>o(M()*t),rand:(t=!1)=>t?Math.random():M(),randGaussian(t=6){let e,r=0;for(e=0;e<t;++e)r+=this.rand();return r/t},randSign:()=>M()>.5?-1:1,toGoldenRatio(t){let e=t/b,r=e/b;return[this.rounded(e),this.rounded(r)]},inst:(t,e)=>e instanceof t,hashCode(t){let e,r=0;for(e=0;e<t.length;++e)r=Math.imul(31,r)+t.charCodeAt(e);return r},cls(t){try{t.length=0}catch(t){}return t},randSample(t,e=1){let r,n;return 1==e?n=[this.randItem(t)]:0==e?n=[]:e>0&&(r=this.shuffle(t,!1),n=e>=r.length?r:r.slice(0,e)),n},randItem(t,e=!1){let r,n=-1;if(t)switch(t.length){case 0:case 1:r=t[n=0];break;case 2:r=t[n=this.randSign()>0?1:0];break;default:r=t[n=o(M()*t.length)]}return e?[r,n]:r},isPerc:t=>p(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>y(t),jsMap(...t){k(y,t.length,"even n# of args");let e,r=new Map;for(e=0;e<t.length;)r.set(t[e],t[e+1]),e+=2;return r},jsObj(...t){k(y,t.length,"even n# of args");let e,r={};for(e=0;e<t.length;)r[t[e]]=t[e+1],e+=2;return r},jsVec:(...t)=>0==t.length?[]:t.slice(),lastIndex:t=>h(t)&&t.length>0?t.length-1:-1,first(t){if(h(t)&&t.length>0)return t[0]},last(t){if(h(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>i.call(t,e),every(t,e){k(h,t,"array");for(let r=0;r<t.length;++r)if(u(e)){if(!e(t[r]))return!1}else if(t[r]!=e)return!1;return t.length>0},notAny(t,e){k(h,t,"array");for(let r=0;r<t.length;++r)if(u(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){w([[h,t],[h,e]],"arrays");let r,n=Math.min(t.length,e.length);for(r=0;r<n;++r)t[r]=e[r];return t},append(t,e=[],r=!1){w([[h,t],[h,e]],"arrays"),r&&(t.length=0);for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e,...r){if(m(t)&&(t=new Array(t)),h(t))for(let n=0;n<t.length;++n)t[n]=u(e)?e(n,...r):e;return t},size(t){return h(t)||p(t)?t.length:d(t)||f(t)?t.size:t?this.keys(t).length:0},nextId:()=>++C,now:()=>Date.now(),fileExt:t=>P(t),fileBase(t){let e,r,n=t.indexOf("?");return n>0&&(t=t.substring(0,n)),t=t.replace(/(\/|\\\\)$/,""),r=E.exec(t),e="",r&&(e=r[2],n=e.lastIndexOf("."),n>0&&(e=e.substring(0,n))),e},range(t,e,r=1){1==arguments.length&&(e=t,t=0,r=1);let n=(e-t)/r;const s=[];n=Math.ceil(n),n=Math.max(0,n),s.length=n;for(let e=0;e<n;++e)s[e]=t,t+=r;return s},shuffle(t,e=!0){k(h,t,"array");const r=i.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,n=r.length-1;n>0;--n)e=o(M()*(n+1)),t=r[n],r[n]=r[e],r[e]=t}return e?this.copy(t,r):r},shuffle2(t,e=!0){k(h,t,"array");const r=i.call(t,0);switch(r.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=r[0];r[0]=r[1],r[1]=t}break;default:for(let t,e,n=0,s=r.length;n<s;++n)e=n+o(M()*(s-n)),t=r[e],r[e]=r[n],r[n]=t}return e?this.copy(t,r):r},shuffle3(t,e=!0){return(e?t:i.call(t,0)).sort(((t,e)=>this.rand()>.5?-1:this.rand()>.5?1:0))},uniq:t=>(k(h,t,"array"),Array.from(new Set(t))),map(t,e,r){if(k(x,t,"array/map/object"),h(t))return t.map(e,r);{const n=f(t)?new Map:{};return this.doseq(t,((s,o)=>{this.assoc(n,o,e.call(r,s,o,t))})),n}},find(t,e,r){let n,s=!0,o=i.call(arguments,3);return this.doseq(t,((t,i)=>{s&&e.apply(r,[t,i].concat(o))&&(n=[i,t],s=!1)})),n},some(t,e,r){let n,s=!0,o=i.call(arguments,3);return this.doseq(t,((t,i)=>{s&&(n=e.apply(r,[t,i].concat(o)),n?s=!1:n=void 0)})),n},equals(t,e){if(c(t)&&c(e)){let r,n,s=Object.keys(t),o=Object.keys(e);if(s.length==o.length){for(let i=0;i<s.length;++i)if(r=s[i],n=o[i],!this.equals(r,n)||!this.equals(t[r],e[n]))return!1;return!0}return!1}if(h(t)&&h(e)){if(t.length==e.length){for(let r=0;r<t.length;++r)if(!this.equals(t[r],e[r]))return!1;return!0}return!1}if(m(t)&&m(e))return t==e;if(p(t)&&p(e))return t==e;if(g(t)&&g(e))return t==e;if(null===t&&null===e)return!0;if(void 0===t&&void 0===e)return!0;throw Error("cant call equals for these types")},invoke(t,e){let r=i.call(arguments,2);h(t)&&t.forEach((t=>t[e].apply(t,r)))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):B.pos(t)&&clearTimeout(t)},dotimes(t,e,r,...n){for(let s=0;s<t;++s)e.call(r,s,...n)},rseq(t,e,r){if(k(h,t,"array"),t.length>0)for(let n=t.length-1;n>=0;--n)e.call(r,t[n],n,t)},doseq(t,e,r){h(t)?t.forEach(e,r):f(t)?t.forEach(((n,s)=>e.call(r,n,s,t))):l(t)&&Object.keys(t).forEach((n=>e.call(r,t[n],n,t)))},doseqEx(t,e,r){this.doseq(t,((n,s)=>null!=n&&e.call(r,n,s,t)))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return f(t)?(r=t.get(e),t.delete(e)):l(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(f(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let n;return f(t)?(n=t.get(e),t.set(e,r)):t&&(n=t[e],t[e]=r),n}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach((e=>t.push(e))),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map((t=>t.trim())).filter((t=>t.length>0))),h(t)||(t=[t]),t),has(t,e){return 1!=arguments.length&&(f(t)?t.has(e):h(t)?-1!=t.indexOf(e):!!l(t)&&B.own(t,e))},patch(t,e){return k(l,t=t||{},"object"),e&&Object.keys(e).forEach((r=>{this.has(t,r)||(t[r]=e[r])})),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach((e=>e&&function(t,e){let r=Object.keys(e).reduce(((t,r)=>(t[r]=Object.getOwnPropertyDescriptor(e,r),t)),{});return Object.getOwnPropertySymbols(e).forEach((t=>{let n=Object.getOwnPropertyDescriptor(e,t);n.enumerable&&(r[t]=n)})),Object.defineProperties(t,r)}(t,e))),t),deepCopyArray(t){k(h,t,"array");let e,r,n=[];for(e=0,r=t.length;e<r;++e)n[e]=h(t[e])?this.deepCopyArray(t[e]):t[e];return n},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach((n=>{r=e[n],"object"==typeof r&&null!==r&&t[n]?("object"!=typeof t[n]&&(t[n]=r instanceof Array?[]:{}),this.merge(t[n],r)):t[n]=r})),t},throttle(t,e,r){let n=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return l(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),this.debounce(t,e,{leading:n,trailing:s,maxWait:e})},debounce(t,e,r){let n,o,i,a,l,u,h=0,f=!1,d=!1,p=!0;const m=!e&&0!==e&&"function"==typeof s.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function g(e){const r=n,s=o;return n=o=void 0,h=e,a=t.apply(s,r),a}function y(t,e){return m?(s.cancelAnimationFrame(l),s.requestAnimationFrame(t)):setTimeout(t,e)}function v(t){const r=t-u;return void 0===u||r>=e||r<0||d&&t-h>=i}function x(){const t=Date.now();if(v(t))return b(t);l=y(x,function(t){const r=t-h,n=e-(t-u);return d?Math.min(n,i-r):n}(t))}function b(t){return l=void 0,p&&n?g(t):(n=o=void 0,a)}function M(...t){const r=Date.now(),s=v(r);if(n=t,o=this,u=r,s){if(void 0===l)return function(t){return h=t,l=y(x,e),f?g(t):a}(u);if(d)return l=y(x,e),g(u)}return void 0===l&&(l=y(x,e)),a}return e=+e||0,c(r)&&(f=!!r.leading,d="maxWait"in r,i=d?Math.max(+r.maxWait||0,e):i,p="trailing"in r?!!r.trailing:p),M.cancel=function(){void 0!==l&&function(t){if(m)return s.cancelAnimationFrame(t);clearTimeout(t)}(l),h=0,n=u=o=l=void 0},M.flush=function(){return void 0===l?a:b(Date.now())},M.pending=function(){return void 0!==l},M},negate:t=>(k(u,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter((t=>t.length>0)),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2,r="0"){return this.strPadLeft(Number(t).toString(),e,r)},prettyMillis(t){let e,r,n=o(t/1e3);r=o(n/60),t-=1e3*n,n-=60*r,e=o(r/60),r-=60*e;let s=[];return s.push(`${n}.${t} secs`),(r>0||e>0)&&s.push(`${r} mins, `),e>0&&s.push(`${e} hrs, `),s.reverse().join("")},swap(t,e,r){let n=t[e];return t[e]=t[r],t[r]=n,t},listIndexesOf(t,e){let r=O.fill(t.length,(t=>t));return e?this.shuffle(r):r},dropArgs:(t,e)=>t.length>e?i.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2==arguments.length&&911==arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let n=e.indexOf("/",t+3);return(n<0?e:e.substring(0,n))!=r.location.origin}}},addEvent(t,e,r,n){h(t)&&1==arguments.length?t.forEach((t=>this.addEvent.apply(this,t))):e.addEventListener(t,r,n)},delEvent(t,e,r,n){h(t)&&1==arguments.length?t.forEach((t=>this.delEvent.apply(this,t))):e.removeEventListener(t,r,n)},rounded(t){return this.roundUnderOffset(t,.5)},roundUnderOffset(t,e){const r=o(t);return t-r<e?r:r+1}},I={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>p(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!l(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&O.doseq(e,((e,r)=>t.setAttribute(r,e))),t)},css(t,e){return!l(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&O.doseq(e,((e,r)=>t.style[r]=e)),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,n){const s=e.createElement(t);return this.attrs(s,r),this.css(s,n),s},newTxt(t,r,n){const s=e.createTextNode(t);return this.attrs(s,r),this.css(s,n),s}},T={},N=[];class z{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,r,n){let s=t[0],o=t[1];return o&&!this._targets.has(o)&&this._targets.set(o,1),O.seq(s).forEach((t=>{if(e||(e=t),p(e)&&(e=(r=r||o)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,O.jsMap());let s=this._tree.get(t);o=o||T,!s.has(o)&&s.set(o,[]),s.get(o).push([e,r,n])})),this}pub(t,...e){let r,n,s=t[0],o=t[1]||T;return(o===T||this._targets.has(o))&&O.seq(s).forEach((t=>{n=this._tree.get(t),r=n&&n.get(o),r&&r.forEach((t=>{t[0].apply(t[1],e.concat(t[2]||N))}))})),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let r=e.next();!r.done;)r.value.delete(t),r=e.next()}return this}unsub(t,e,r){if(1!=arguments.length||B.vec(t)){let n=t[0],s=t[1]||T;if(s===T||this._targets.has(s)){let t,o;O.seq(n).forEach((n=>{if(t=this._tree.get(n),o=t&&t.get(s),o&&(p(e)&&(e=(r=r||s)[e]),e))for(let t=o.length-1;t>=0;--t)o[t][0]===e&&o[t][1]===r&&o.splice(t,1)}))}}else this.drop(t);return this}}return e?$.dom=I:(delete O.addEvent,delete O.delEvent),$.EventBus=function(){return new z},$.is=B,$.u=O,$}"object"==typeof module&&module.exports?r=require("../tpcl/seedrandom.min"):e=t.document,"object"==typeof module&&module.exports?module.exports=s():t["io/czlab/mcfud/core"]=s}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,n=2*Math.PI,s=(Math.PI,Math.floor),{is:o,u:i}=e;const a=t=>t<0?- -t%r:t%r;return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*s(-t/e)):t%e,ndiv:(t,e)=>s(t/e),pow:(t,e)=>0==e?1:1==e?t:2==e?t*t:3==e?t*t*t:Math.pow(t,e),pow2(t){let e=2;for(;t>e;)e*=2;return e},clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>i.feq(t,e),fuzzyZero:t=>i.feq0(t),radToDeg:t=>a(r*t/n),degToRad:t=>n*a(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t,remap(t,e,r,n,s,o){const i=(t-e)/(r-e)*(s-n)+n;return o?n<s?this.clamp(n,s,i):this.clamp(s,n,i):i},perlin1D(t,e,r,n,o){let i,a,l,c,u,h,f,d;for(let p=0;p<t;++p){i=0,a=0,l=1;for(let o=0;o<r;++o)c=t>>o,u=s(p/c)*c,h=(u+c)%t,f=(p-u)/c,d=(1-f)*e[s(u)]+f*e[s(h)],a+=l,i+=d*l,l/=n;o[p]=i/a}},perlin2D(t,e,r,n,o,i){let a,l,c,u,h,f,d,p,m,g,y,v;for(let x=0;x<t;++x)for(let b=0;b<e;++b){a=0,l=0,c=1;for(let i=0;i<n;++i)p=t>>i,m=s(x/p)*p,g=s(b/p)*p,y=(m+p)%t,v=(g+p)%e,u=(x-m)/p,h=(b-g)/p,f=(1-u)*r[s(g*t+m)]+u*r[s(g*t+y)],d=(1-u)*r[s(v*t+m)]+u*r[s(v*t+y)],l+=c,a+=(h*(d-f)+f)*c,c/=o;i[b*t+x]=a/l}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/math"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r,is:n}=e,s=(t,e)=>r.assert(!n.num(t)&&!n.num(e)&&t&&e,"wanted 2 vecs"),o=(t,e=0,r=0)=>t?[e,r]:{x:e,y:r},i={};class a{constructor(){this.x=0,this.y=0}unit(t){return n.bool(t)&&(t=o(t)),n.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return n.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,r){let s=i.take();switch(s.x=this.x,s.y=this.y,t){case"+":n.num(e)&&(s.x+=e),n.num(r)&&(s.y+=r);break;case"-":n.num(e)&&(s.x-=e),n.num(r)&&(s.y-=r);break;case"*":n.num(e)&&(s.x*=e),n.num(r)&&(s.y*=r);break;case"/":n.num(e)&&(s.x/=e),n.num(r)&&(s.y/=r)}return s}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function l(t,e,r,s,o,i,a){const l=t-o,c=e-i,u=o+(l*r-c*s),h=i+(l*s+c*r);return n.vec(a)?(a[0]=u,a[1]=h):(a.x=u,a.y=h),a}function c(t,e,r,s){let o,a,l=i.take().bind(t);if(n.num(e))a=l.op(r,e,e);else{let t=i.take().bind(e);a=l[r](t),i.drop(t)}return o=a.unit(s?t:n.vec(t)),i.drop(l,a),o}r.inject(i,{take(){return this._pool.pop()},drop(...t){t.forEach((t=>{t.x=0,t.y=0,this._pool.push(t)}))},_pool:r.fill(16,(()=>new a))});return{gx:t=>n.vec(t)?t[0]:t.x,sx(t,e){n.vec[t]?t[0]=e:t.x=e},gy:t=>n.vec(t)?t[1]:t.y,sy(t,e){n.vec[t]?t[1]=e:t.y=e},vec:(t=0,e=0)=>o(!0,t,e),vecXY:(t=0,e=0)=>o(!1,t,e),add(t,e){return r.assert(2==arguments.length)&&c(t,e,"+")},add$(t,e){return r.assert(2==arguments.length)&&c(t,e,"+",!0)},sub(t,e){return r.assert(2==arguments.length)&&c(t,e,"-")},sub$(t,e){return r.assert(2==arguments.length)&&c(t,e,"-",!0)},mul(t,e){return r.assert(2==arguments.length)&&c(t,e,"*")},mul$(t,e){return r.assert(2==arguments.length)&&c(t,e,"*",!0)},div(t,e){return r.assert(2==arguments.length)&&c(t,e,"/")},div$(t,e){return r.assert(2==arguments.length)&&c(t,e,"/",!0)},dot(t,e){s(t,e);let r=i.take().bind(t),n=i.take().bind(e),o=r.x*n.x+r.y*n.y;return i.drop(r,n),o},equals(t,e){let r=i.take().bind(t),n=i.take().bind(e),s=r.x==n.x&&r.y==n.y;return i.drop(r,n),s},vecAB(t,e){s(t,e);let r,o=i.take().bind(t),a=i.take().bind(e),l=i.take();return l.x=a.x-o.x,l.y=a.y-o.y,r=l.unit(n.vec(t)),i.drop(o,a,l),r},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e,s=this.len(t),o=i.take().bind(t);return r.feq0(s)?(o.x=0,o.y=0):(o.x/=s,o.y/=s),e=o.unit(n.vec(t)),i.drop(o),e},unit$(t){let e,n=this.len(t),s=i.take().bind(t);return r.feq0(n)?(s.x=0,s.y=0):(s.x/=n,s.y/=n),e=s.unit(t),i.drop(s),e},copy(t,e){s(t,e);let r,n=i.take().bind(t),o=i.take().bind(e);return n.x=o.x,n.y=o.y,r=n.unit(t),i.drop(n,o),r},clone(t){let e=i.take().bind(t),r=e.unit(n.vec(t));return i.drop(e),r},set(t,e,r){let s,o=i.take().bind(t);return n.num(e)&&(o.x=e),n.num(r)&&(o.y=r),s=o.unit(t),i.drop(o),s},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,r=null){let s,a,c=0,u=0,h=i.take().bind(t);return r&&(a=i.take().bind(r),c=a.x,u=a.y,i.drop(a)),s=l(h.x,h.y,Math.cos(e),Math.sin(e),c,u,o(n.vec(t))),i.drop(h),s},rot$(t,e,r){let n,s,o=0,a=0,c=i.take().bind(t);return r&&(s=i.take().bind(r),o=s.x,a=s.y,i.drop(s)),n=l(c.x,c.y,Math.cos(e),Math.sin(e),o,a,t),i.drop(c),n},cross(t,e){let r;if(n.num(t)){let s=i.take(),o=i.take().bind(e);s.x=-t*o.y,s.y=t*o.x,r=s.unit(n.vec(e)),i.drop(o,s)}else if(n.num(e)){let s=i.take(),o=i.take().bind(t);s.x=e*o.y,s.y=-e*o.x,r=s.unit(n.vec(t)),i.drop(o,s)}else{s(t,e);let n=i.take().bind(t),o=i.take().bind(e);r=n.x*o.y-n.y*o.x,i.drop(n,o)}return r},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let r,s=i.take(),o=i.take().bind(t);return e?(s.x=-o.y,s.y=o.x):(s.x=o.y,s.y=-o.x),r=s.unit(n.vec(t)),i.drop(o,s),r},normal$(t,e=!1){let r,n=i.take(),s=i.take().bind(t);return e?(n.x=-s.y,n.y=s.x):(n.x=s.y,n.y=-s.x),r=n.unit(t),i.drop(s,n),r},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);this.mul$(r,this.dot(t,r));let s=i.take().bind(r),o=s.unit(n.vec(t));return i.drop(s),o},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){const r=2*this.dot(t,e);return this.sub(t,this.mul(e,r))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let r,s,o,a,l=i.take().bind(t);return 1==e.length&&n.vec(e[0])&&!n.num(e[0][0])&&(e=e[0]),o=e.map((t=>(s=i.take().bind(t),r=s["+"](l),a=r.unit(n.vec(t)),i.drop(s,r),a))),i.drop(l),o},clamp$(t,e,r){const n=this.len(t),s=Math.max(e,Math.min(r,n));return n==s?t:this.mul$(this.div$(t,n||1),s)},clamp(t,e,r){const n=this.len(t),s=Math.max(e,Math.min(r,n));return n==s?t:this.mul(this.div(t,n||1),s)}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/vec2"]=r}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const r=Math.cos,n=Math.sin,s=(Math.tan,Math.floor),{u:o,is:i}=e;const a=t=>t%2!=0,l=(t,e,r,n)=>n-1+(r-1)*e,c=(t,e,r)=>({cells:r,dim:[t,e]}),u=(t,e)=>c(t,e,o.fill(t*e,0));return{v4:(t=0,e=0,r=0,n=0)=>[t,e,r,n],v3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!o.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return i.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return i.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return i.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return i.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const n=t*e;return 0==r.length?u(t,e):o.assert(n==r.length)&&c(t,e,r)},matCell(t,e,r,n){const s=l(t.dim[0],t.dim[1],e,r);if(s>=0&&s<t.cells.length)return i.num(n)?(t.cells[s]=n,t):t.cells[s]},matIdentity(t){const e=o.assert(t>0)&&o.fill(t*t,0);for(let r=0;r<t;++r)e[l(0,t,r+1,r+1)]=1;return c(t,t,e)},matZero:t=>o.assert(t>0)&&c(t,t,o.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return o.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,n=[];for(let s,o=0;o<r;++o){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+o]);n.push(s)}return n},mat2(t,e,r,n){return this.matrix([2,2],t,e,r,n)},mat3(t,e,r,n,s,o,i,a,l){return this.matrix([3,3],t,e,r,n,s,o,i,a,l)},mat4(t,e,r,n,s,o,i,a,l,c,u,h,f,d,p,m){return this.matrix([4,4],t,e,r,n,s,o,i,a,l,c,u,h,f,d,p,m)},matEq(t,e){return t.dim[0]==e.dim[0]&&t.dim[1]==e.dim[1]&&(r=t.cells,n=e.cells,r.length==n.length&&r.every(((t,e)=>t==n[e]||o.feq(t,n[e]))));var r,n},matXpose(t){const[e,r]=t.dim,n=e*r,o=[];for(let i=0;i<n;++i)o.push(t.cells[s(i/e)+r*(i%e)]);return c(r,e,o)},matScale:(t,e)=>c(t.dim[0],t.dim[1],t.cells.map((t=>t*e))),matMult(t,e){let[r,n]=t.dim,[s,i]=e.dim,a=t.cells,l=e.cells;o.assert(n==s,"mismatch matrices");let u=new Array(r*i);for(let t=0;t<r;++t)for(let e=0;e<i;++e)u[e+t*i]=o.range(s).reduce(((r,s)=>r+a[s+t*n]*l[e+s*i]),0);return c(r,i,u)},matDet(t){let[e,r]=t.dim,n=[];if(2==r)return this._matDet2x2(t);for(let e=0;e<r;++e)o.conj(n,this.matDet(this.matCut(t,1,e+1)));return o.range(r).reduce(((e,r)=>{let s=n[r];return e+t.cells[r]*(a(r)?-s:s)}),0)},_matDet2x2:t=>(o.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){const[n,s]=t.dim;let i=e-1,a=r-1,l=[];for(let e=0;e<n;++e)for(let r=0;r<s;++r)e!=i&&r!=a&&o.conj(l,t.cells[r+e*s]);return c(n-1,s-1,l)},matMinor(t){const[e,r]=t.dim;let n=[];if(o.assert(e==r),2==r)return this._matMinor2x2(t);for(let s=0;s<e;++s)for(let e=0;e<r;++e)o.conj(n,this.matDet(this.matCut(t,s+1,e+1)));return c(e,r,n)},_matMinor2x2(t){return o.assert(4==t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[r,n]=e.dim;let s=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<n;++r)e=t*n+r,a(t+r)&&(s[e]=-s[e]);return c(r,n,s)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,r]=t.dim;o.assert(4==t.cells.length&&2==e&&2==r);let n,s=t.cells,i=s[0]*s[3]-s[1]*s[2];if(o.feq0(i))n=this.matIdentity(e);else{let t=1/i;n=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return n},matInv(t){const[e,r]=t.dim;if(2==r)return this._minv2x2(t);let n=this.matDet(t);return o.feq0(n)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/n)},matFromColMajor(t){let e=t.length,r=t[0].length,n=u(r,e);for(let r,s=0;s<t.length;++s){r=t[s];for(let t=0;t<r.length;++t)n.cells[t*e+s]=r[t]}return n},matToColMajor(t){const[e,r]=t.dim,n=[];t.cells.slice();for(let s,o=0;o<r;++o){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+o]);n.push(s)}return n},scale3D(t){const e=this.matIdentity(4);return e.cells[l(0,4,1,1)]=t[0],e.cells[l(0,4,2,2)]=t[1],e.cells[l(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[l(0,4,4,1)]=t[0],e.cells[l(0,4,4,2)]=t[1],e.cells[l(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],n=e.length;o.assert(r==n);let s=this.matMult(t,c(n,1,e)),i=s.cells;return s.cells=null,i},rot2D(t){return this.mat2(r(t),-n(t),n(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,n(t),0,0,1,0,0,-n(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e==r){for(let n,s=0;s<e;++s)for(let e=0;e<r;++e)if(n=t.cells[s*r+e],s+1==e+1){if(1!=n)return!1}else if(0!=n)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1==Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/matrix"]=r}(this),function(t,e){"use strict";const r=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-".split(""),n=r.length;function s(e){e||(e=t["io/czlab/mcfud/core"]());const{u:s}=e,o=t=>Math.abs(t)%n,i=t=>r[t],a=t=>r.findIndex((e=>e==t));function l(t,e){let r=e+t;return i(r>=n?r-n:r)}function c(t,e){let r=e-t;return i(r<0?n+r:r)}return{encrypt(t,e){if(0!=e){let r,n=o(e);r=t.split("").map((t=>(r=a(t),r<0?t:((t,e,r)=>t<0?l(e,r):c(e,r))(e,n,r)))),t=r.join("")}return t},decrypt(t,e){if(0!=e){let r,n=o(e);r=t.split("").map((t=>(r=a(t),r<0?t:((t,e,r)=>t<0?c(e,r):l(e,r))(e,n,r)))),t=r.join("")}return t}}}"object"==typeof module&&module.exports?module.exports=s(require("./core")):t["io/czlab/mcfud/crypt"]=s}(this),function(t,e){"use strict";function r(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change",n){const s=t[e],o=s&&s.transitions[r];if(o){const r=o.target,i=t[r];if(i)return s.exit&&s.exit(),i.enter&&i.enter(),n&&n.action?n.action():o.action&&o.action(n),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/fsm"]=r}(this),function(t,e){"use strict";function r(e,r,n,s){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/vec2"]()),n||(n=t["io/czlab/mcfud/math"]()),s||(s=t["io/czlab/mcfud/matrix"]());const o=2*Math.PI,{u:i}=e;return{setContextTransform:(t,e,r=!1)=>(t[r?"setTransform":"transform"](e.cells[0],e.cells[3],e.cells[1],e.cells[4],e.cells[2],e.cells[5]),t),textStyle:(t,e,r,n,s,o)=>(e&&(t.font=e),n&&(t.fillStyle=n),s&&(t.textAlign=s),o&&(t.textBaseline=o),r&&(t.strokeStyle=r),t),drawShape:(t,e,...r)=>(e&&e.draw&&e.draw(t,...r),t),cfgStyle:(t,e,r,n,s)=>(r&&(t.fillStyle=r),e&&(t.strokeStyle=e),s&&(t.lineCap=s),n&&(t.lineWidth=n),t),drawPoints(t,e){t.beginPath();for(let n,s,o,i=e.length,a=0;a<i;++a)o=(a+1)%i,n=e[a],s=e[o],t.moveTo(r.gx(n),r.gy(n)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.stroke(),t},fillPoints(t,e){t.beginPath();for(let n,s,o,i=e.length,a=0;a<i;++a)o=(a+1)%i,n=e[a],s=e[o],0==a?t.moveTo(r.gx(n),r.gy(n)):t.lineTo(r.gx(n),r.gy(n)),t.lineTo(r.gx(s),r.gy(s));return t.closePath(),t.fill(),t},drawCircle:(t,e,r,n)=>(t.beginPath(),t.arc(e,r,n,0,o,!0),t.closePath(),t.stroke(),t),fillCircle:(t,e,r,n)=>(t.beginPath(),t.arc(e,r,n,0,o,!0),t.closePath(),t.fill(),t),drawRect:(t,e,r,n,s,o=0,i=0,a=0)=>(t.save(),t.translate(i,a),t.rotate(o),t.translate(-i,-a),t.strokeRect(e,r,n,s),t.restore(),t),fillRect:(t,e,r,n,s,o=0,i=0,a=0)=>(t.save(),t.translate(i,a),t.rotate(o),t.translate(-i,-a),t.fillRect(e,r,n,s),t.restore(),t),drawLine:(t,e,r,n,s)=>(t.beginPath(),t.moveTo(e,r),t.lineTo(n,s),t.stroke(),t),drawText:(t,e,r,n)=>(t.strokeText(e,r,n),t),fillText:(t,e,r,n)=>(t.fillText(e,r,n),t),clearCanvas(t){return this.clearRect(t,0,0,t.canvas.width,t.canvas.height)},fillCanvas(t){return this.fillRect(t,0,0,t.canvas.width,t.canvas.height)},clearRect:(t,e,r,n,s)=>(t.clearRect(e,r,n,s),t)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./vec2"),require("./math"),require("./matrix")):t["io/czlab/mcfud/gfx"]=r}(this),function(t,e){"use strict";const[r,n,s]=[1,0,-1];function o(e,o,i,a,l){e||(e=t["io/czlab/mcfud/core"]()),o||(o=t["io/czlab/mcfud/math"]()),i||(i=t["io/czlab/mcfud/vec2"]()),a||(a=t["io/czlab/mcfud/matrix"]()),l||(l=t["io/czlab/mcfud/algo/basic"]());const{Stack:c,StdCompare:u}=l,{is:h,u:f}=(Math.floor,e);const d=f.fill(36,undefined);function p(t){f.assert(t.length>2&&t.length<=36,"too little/many vertices");let e=0,r=t[0][0];for(let n,s=1;s<t.length;++s)n=t[s][0],n>r?(r=n,e=s):f.feq(n,r)&&t[s][1]<t[e][1]&&(e=s);let n=0,s=e;for(;;){d[n]=s;let r=0,o=d[n];for(let e,n,a,l=1;l<t.length;++l)r!=s?(e=i.sub(t[r],t[o]),n=i.sub(t[l],t[o]),a=i.cross(e,n),a<0&&(r=l),f.feq0(a)&&i.len2(n)>i.len2(e)&&(r=l)):r=l;if(s=r,++n,r==e)break}const o=[];for(let e=0;e<n;++e)o.push(i.clone(t[d[e]]));return o}class m{constructor(t,e,r,n){switch(arguments.length){case 2:this.pos=i.vec(),this.width=t,this.height=e;break;case 4:this.pos=i.vec(t,e),this.width=r,this.height=n;break;default:throw"Error: bad input to Rect()"}}}class g{constructor(t,e){this.width=t,this.height=e}half(){return new g(o.ndiv(this.width,2),o.ndiv(this.height,2))}}class v{constructor(t,e,r,n){this.p=i.vec(t,e),this.q=i.vec(r,n)}}class b{constructor(t,e=0,r=0){this.pos=i.vec(e,r),this.shape=t}}class M{constructor(){this.orient=0}setOrient(t){throw Error("no implementation")}}class w extends M{constructor(t){super(),this.calcPoints=[],this.normals=[],this.edges=[],this.set(t||[])}set(t){return this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=p(t),this.points.forEach((t=>{this.calcPoints.push(i.vec()),this.edges.push(i.vec()),this.normals.push(i.vec())})),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}moveBy(t,e){return this.points.forEach((r=>{r[0]+=t,r[1]+=e})),this._recalc()}_recalc(){let t=this.points.length;return this.points.forEach(((t,e)=>{i.copy(this.calcPoints[e],t),f.feq0(this.orient)||i.rot$(this.calcPoints[e],this.orient)})),this.points.forEach(((e,r)=>{this.edges[r]=i.sub(this.calcPoints[(r+1)%t],this.calcPoints[r]),this.normals[r]=i.unit(i.normal(this.edges[r]))})),this}}class q{constructor(t,e){this.overlapN=i.vec(),this.overlapV=i.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new q,e=this.AInB,r=this.BInA,n=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=n,t.AInB=r,t.BInA=e,t.overlapN=i.flip(this.overlapN),t.overlapV=i.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function k(t,e){let r=1/0,n=-1/0;for(let s,o=0;o<t.length;++o)s=i.dot(t[o],e),s<r&&(r=s),s>n&&(n=s);return[r,n]}function E(t,e){let o=i.len2(t),a=i.dot(e,t);return a<0?r:a>o?s:n}function j(t,e,r,n,s,o){let[a,l]=k(e,s),[c,u]=k(n,s),h=i.vecAB(t,r),f=i.dot(h,s);if(c+=f,u+=f,a>u||c>l)return!0;if(o){let t=0;if(a<c)if(o.AInB=!1,l<u)t=l-c,o.BInA=!1;else{let[e,r]=[l-c,u-a];t=e<r?e:-r}else if(o.BInA=!1,l>u)t=a-u,o.AInB=!1;else{let[e,r]=[l-c,u-a];t=e<r?e:-r}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,i.copy(o.overlapN,s),t<0&&i.flip$(o.overlapN))}}function P(t,e,r){let n,s=t.shape.radius+e.shape.radius,o=i.vecAB(t.pos,e.pos),a=i.len2(o),l=!(a>s*s);return l&&r&&(n=Math.sqrt(a),r.A=t,r.B=e,r.overlap=s-n,i.copy(r.overlapN,i.unit$(o)),i.copy(r.overlapV,i.mul(o,r.overlap)),r.AInB=t.shape.radius<=e.shape.radius&&n<=e.shape.radius-t.shape.radius,r.BInA=e.shape.radius<=t.shape.radius&&n<=t.shape.radius-e.shape.radius),l}function A(t,e,n){let o,a=e.shape.radius*e.shape.radius,l=i.vecAB(t.pos,e.pos),c=t.shape.calcPoints,u=i.vec();for(let h,f,d,p,m=c.length,g=0;g<m;++g){h=g==m-1?0:g+1,f=0==g?m-1:g-1,d=0,p=null,i.copy(u,t.shape.edges[g]),o=i.vecAB(c[g],l),n&&i.len2(o)>a&&(n.AInB=!1);let y=E(u,o);if(y===r){if(i.copy(u,t.shape.edges[f]),y=E(u,i.vecAB(c[f],l)),y===s){let t=i.len(o);if(t>e.shape.radius)return!1;n&&(n.BInA=!1,p=i.unit(o),d=e.shape.radius-t)}}else if(y===s){if(i.copy(u,t.shape.edges[h]),i.sub$(i.copy(o,l),c[h]),y=E(u,o),y===r){let t=i.len(o);if(t>e.shape.radius)return!1;n&&(n.BInA=!1,p=i.unit(o),d=e.shape.radius-t)}}else{let t=i.unit$(i.normal(u)),r=i.dot(o,t),s=Math.abs(r);if(r>0&&s>e.shape.radius)return!1;n&&(p=t,d=e.shape.radius-r,(r>=0||d<2*e.shape.radius)&&(n.BInA=!1))}p&&n&&Math.abs(d)<Math.abs(n.overlap)&&(n.overlap=d,i.copy(n.overlapN,p))}return n&&(n.A=t,n.B=e,i.mul$(i.copy(n.overlapV,n.overlapN),n.overlap)),!0}function S(t,e,r){let n=A(e,t,r);if(n&&r){let t=r.A,e=r.AInB;i.flip$(r.overlapN),i.flip$(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return n}function C(t,e,r){let n=t.shape.calcPoints,s=e.shape.calcPoints;for(let o=0;o<n.length;++o)if(j(t.pos,n,e.pos,s,t.shape.normals[o],r))return!1;for(let o=0;o<s.length;++o)if(j(t.pos,n,e.pos,s,e.shape.normals[o],r))return!1;if(r){if(0==r.overlap||f.feq0(r.overlap))return!1;r.A=t,r.B=e,i.copy(r.overlapV,r.overlapN),i.mul$(r.overlapV,r.overlap)}return!0}class ${static create(){return new $}constructor(){this.identity()}identity(){return this.m=a.matIdentity(3),this}translate(t,e){return this.m=a.matMult(this.m,a.mat3(1,0,t,0,1,e,0,0,1)),this}scale(t,e){return this.m=a.matMult(this.m,a.mat3(t,0,0,0,e,0,0,0,1)),this}shear(t,e){return this.m=a.matMult(this.m,a.mat3(1,t,0,e,1,0,0,0,1)),this}rotateCCW(t,e,r){let n=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCCW(t),this.translate(e,r)):this.m=a.matMult(this.m,a.mat3(s,-n,0,n,s,0,0,0,1)),this}rotateCW(t,e,r){let n=Math.sin(t),s=Math.cos(t);return void 0!==e&&void 0!==r?(this.translate(-e,-r),this.rotateCW(t),this.translate(e,r)):this.m=a.matMult(this.m,a.mat3(s,n,0,-n,s,0,0,0,1)),this}transformXY(t,e){let r=[t,e,1];return a.matVMult(this.m,r).length=2,2}transformPoints(t){let e,r=[0,0,1];t.forEach((t=>{h.vec(t)?(r[0]=t[0],r[1]=t[1]):(r[0]=t.x,r[1]=t.y),e=a.matVMult(this.m,r),h.vec(t)?(t[0]=e[0],t[1]=e[1]):(t.x=e[0],t.y=e[1])}))}}class B{constructor(t,e){if(e<t){let r=t;t=e,e=r}f.feq0(t)&&(t=0),f.feq0(e)&&(e=0),this.min=t,this.max=e}min(){return this.min}max(){return this.max}intersects(t){return!(this.max<t.min||t.max<this.min)}contains(t){return this.min<=t&&t<=this.max}length(){return this.max-this.min}static MinEndPtCmp(t,e){return t.min<e.min?-1:t.min>e.min?1:t.max<e.max?-1:t.max>e.max?1:0}static MaxEndPtCmp(t,e){return t.max<e.max?-1:t.max>e.max?1:t.min<e.min?-1:t.min>e.min?1:0}static LenCmp(t,e){let r=t.length(),n=e.length();return r<n?-1:r>n?1:0}static test(){let t=[new B(15,33),new B(45,60),new B(20,70),new B(46,55)];console.log("Unsorted"),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by min endpoint"),t.sort(B.MinEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by max endpoint"),t.sort(B.MaxEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by length"),t.sort(B.LenCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`)))}}class O{static theta(t){return Math.atan2(t[1],t[0])}static angleBetween(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}static ccw(t,e,r){let n=(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0]);return n<0?-1:n>0?1:0}static area2(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0])}static distTo(t,e){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}static distSqTo(t,e){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}static compareTo(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0}static XOrderCmp(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}static YOrderCmp(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}static ROrderCmp(t,e){let r=t[0]*t[0]+t[1]*t[1]-(e[0]*e[0]+e[1]*e[1]);return r<0?-1:r>0?1:0}static PolarOrderCmp(t){return(e,r)=>{let n=e[0]-t[0],s=e[1]-t[1],o=r[0]-t[0],i=r[1]-t[1];return s>=0&&i<0?-1:i>=0&&s<0?1:f.feq0(s)&&f.feq0(i)?n>=0&&o<0?-1:o>=0&&n<0?1:0:-O.ccw(t,e,r)}}static DistToOrderCmp(t,e){let r=O.distSqTo(t),n=O.distSqTo(e);return r<n?-1:r>n?1:0}static equals(t,e){return e===t||!!e&&(t[0]==e[0]&&t[1]==e[1])}static farthestPair(t){let e,r=[0,0],n=[0,0],s=0,o=-1/0,a=O.calcConvexHull(t);if(!1===a||t.length<=1)return!1;if(e=a.length,a.unshift(null),2==e)r=a[1],n=a[2],s=O.distTo(r,n);else{let t,s=2;for(;O.area2(a[e],a[1],a[s+1])>O.area2(a[e],a[1],a[s]);)++s;t=s;for(let l,c=1;c<=s&&t<=e;++c)for(O.distSqTo(a[c],a[t])>o&&(o=O.distSqTo(a[c],a[t]),i.copy(r,a[c]),i.copy(n,a[t]));t<e&&O.area2(a[c],a[c+1],a[t+1])>O.area2(a[c],a[c+1],a[t]);)++t,l=O.distSqTo(a[c],a[t]),l>o&&(o=O.distSqTo(a[c],a[t]),i.copy(r,a[c]),i.copy(n,a[t]))}return{best1:r,best2:n,bestDistance:Math.sqrt(o)}}static closestPair(t){let e=[0,0],r=[0,0],n=1/0,s=t.slice();const a=t.length;s.sort(O.YOrderCmp),s.sort(O.XOrderCmp);for(let t=0;t<a-1;++t)if(O.equals(s[t],s[t+1]))return i.copy(e,s[t]),i.copy(r,s[t+1]),{bestDistance:0,best1:e,best2:r};let l=s.slice();return function t(s,a,l,c,u){if(u<=c)return 1/0;let h=c+o.ndiv(u-c,2),f=s[h],d=t(s,a,l,c,h),p=t(s,a,l,h+1,u),m=Math.min(d,p);!function(t,e,r,n,s){for(let n=r;n<=s;++n)i.copy(e[n],t[n]);let o=r,a=n+1;for(let l=r;l<=s;++l)o>n?i.copy(t[l],e[a++]):a>s?i.copy(t[l],e[o++]):O.compareTo(e[a],e[o])<0?i.copy(t[l],e[a++]):i.copy(t[l],e[o++])}(a,l,c,h,u);let g=0;for(let t=c;t<=u;++t)Math.abs(a[t][0]-f[0])<m&&i.copy(l[g++],a[t]);for(let t=0;t<g;++t)for(let s,o=t+1;o<g&&l[o][1]-l[t][1]<m;++o)s=O.distTo(l[t],l[o]),s<m&&(m=s,s<n&&(n=m,i.copy(e,l[t]),i.copy(r,l[o])));return m}(s,l,f.fill(a,(()=>[0,0])),0,a-1),{bestDistance:n,best1:e,best2:r}}static calcConvexHull(t){f.assert(t&&t.length>0,"invalid points");let e,r,n,s=t.length,o=f.deepCopyArray(t),a=new c;for(o.sort(O.compareTo),e=o[0],o.shift(),o.sort(O.PolarOrderCmp(e)),o.unshift(e),a.push(o[0]),r=1;r<s&&O.equals(o[0],o[r]);++r);if(r==s)return!1;for(n=r+1;n<s&&0==O.ccw(o[0],o[r],o[n]);++n);a.push(o[n-1]);for(let t,e=n;e<s;++e){for(t=a.pop();O.ccw(a.peek(),t,o[e])<=0;)t=a.pop();a.push(t),a.push(o[e])}let l=new c;for(let t=a.iterator();t.hasNext();)l.push(t.next());s=l.size(),t=[];for(let e=l.iterator();e.hasNext();)t.push(i.clone(e.next()));if(s>2)for(let e=0;e<s;++e)if(O.ccw(t[e],t[(e+1)%s],t[(e+2)%s])<=0)return!1;return t}static test_convexHull(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599\n               4096 20992 21538  2430 21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797\n               8192 28160 16128 20224 14080 20224 26112  7296 20367 20436 7486   422 17835  2689 22016  3200 22016  5248\n               24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224 15104 12032 6144 20992 26112  3200\n               6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161 5120 20992\n               10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596\n               17152 18176 8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224\n               30950  2616 4096 22016 4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371\n               4160 29184 13056 13056 8192 29184 23040  7296 5120 25088 22016  7296 7168 29184 25216  7296 23040  3200\n               4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017 26112  6272 20658  1204 23553 13965\n               13056 14080 14080 12032 24064  7296 21377 26361 17088\n               12032 16128 16128 30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);e=[[5,15],[5,-20],[-60,10],[70,-10],[-60,-10],[70,10]];let r=O.calcConvexHull(e);!1===r||r.length!=e.length?console.log("not convex!"):r.forEach((t=>{console.log(`${t[0]}, ${t[1]}`)}))}static test_closestPair(){let t="954 11163 1125 11331 1296 11499 1467 11667 1657 11796 1847 11925 2037 12054 2238 12207 2439 12360\n               2640 12513 2878 12523 3116 12533 3354 12543 3518 12493 3682 12443 3846 12393\n               8463 7794 8022 7527 7581 7260 7140 6993 6731 6624 6322 6255 5913 5886\n               5521 5494 5129 5102 4737 4710 4599 5158".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:n,best2:s}=O.closestPair(e);console.log(`bestDist=${r}, p1=${n}, p2=${s}`)}static test_farthestPair(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599 4096 20992 21538  2430\n               21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797 8192 28160 16128 20224 14080 20224 26112  7296\n               20367 20436 7486   422 17835  2689 22016  3200 22016  5248 24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224\n               15104 12032 6144 20992 26112  3200 6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161\n               5120 20992 10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596 17152 18176\n               8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224 30950  2616 4096 22016\n               4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371 4160 29184 13056 13056 8192 29184 23040  7296\n               5120 25088 22016  7296 7168 29184 25216  7296 23040  3200 4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017\n               26112  6272 20658  1204 23553 13965 13056 14080 14080 12032 24064  7296 21377 26361 17088 12032 16128 16128\n               30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);let{bestDistance:r,best1:n,best2:s}=O.farthestPair(e);console.log(`bestDist=${r}, p1=${n}, p2=${s}`)}}return{Rect:m,Area:g,Line:v,Body:b,Circle:class extends M{constructor(t){super(),this.radius=t}setOrient(t){return this.orient=t,this}},Polygon:w,Manifold:q,C2DMatrix:$,Point2D:O,Interval1D:B,Interval2D:class{constructor(t,e){this.x=t,this.y=e}intersects(t){return!!this.x.intersects(t.x)&&!!this.y.intersects(t.y)}contains(t){return x.contains(t[0])&&y.contains(t[1])}area(){return x.length()*y.length()}},bodyWrap:(t,e,r)=>new b(t,e,r),orderVertices:t=>p(t),polyArea(t,e=!1){let r=e?this.orderVertices(t):t,n=0;for(let t,e,s,o=r.length,i=0;i<o;++i)s=(i+1)%o,t=r[i],e=r[s],n+=t[0]*e[1]-e[0]*t[1];return o.ndiv(Math.abs(n),2)},calcPolygonCenter(t,e=!1){const r=e?this.orderVertices(t):t,n=6*this.polyArea(r);let s=0,a=0;for(let t,e,n,o=0,i=r.length;o<i;++o)n=(o+1)%i,t=r[o],e=r[n],s+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),a+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return i.vec(o.ndiv(s,n),o.ndiv(a,n))},getAABB(t){if(f.assert(t instanceof b,"wanted a body"),f.has(t.shape,"radius"))return new m(t.pos[0]-t.shape.radius,t.pos[1]-t.shape.radius,2*t.shape.radius,2*t.shape.radius);{let e=i.translate(t.pos,t.shape.calcPoints),r=e[0][0],n=e[0][1],s=r,o=n;for(let t,i=1;i<e.length;++i)t=e[i],t[0]<r&&(r=t[0]),t[0]>s&&(s=t[0]),t[1]<n&&(n=t[1]),t[1]>o&&(o=t[1]);return new m(r,n,s-r,o-n)}},shiftPoints:(t,e)=>t.map((t=>i.add(t,e))),rotPoints:(t,e,r)=>t.map((t=>i.rot(t,e,r))),calcRectPoints(t,e){const r=t/2,n=e/2;return[i.vec(r,-n),i.vec(r,n),i.vec(-r,n),i.vec(-r,-n)]},line:(t,e,r,n)=>new v(t,e,r,n),rectEqRect:(t,e)=>t.width==e.width&&t.height==e.height&&t.pos[0]==e.pos[0]&&t.pos[1]==e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+t.width/2,rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+t.height/2,rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const r=Math.min(t.pos[0],e.pos[0]),n=Math.min(t.pos[1],e.pos[1]);return new m(r,n,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-n)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const r=Math.max(t.pos[0],e.pos[0]),n=Math.max(t.pos[1],e.pos[1]);return new m(r,n,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-n)}},hitTestPointCircle(t,e,r){f.assert(r instanceof b,"wanted a body");let n=t-r.pos[0],s=e-r.pos[1];return n*n+s*s<=r.shape.radius*r.shape.radius},hitCircleCircle(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new q;if(P(t,e,r))return r},hitTestCircleCircle:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),P(t,e,new q)),hitPolygonCircle(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new q;if(A(t,e,r))return r},hitTestPolygonCircle:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),A(t,e,new q)),hitCirclePolygon(t,e){f.assert(e instanceof b&&t instanceof b,"need bodies");let r=new q;if(S(t,e,r))return r},hitTestCirclePolygon:(t,e)=>(f.assert(e instanceof b&&t instanceof b,"need bodies"),S(t,e,new q)),hitPolygonPolygon(t,e){f.assert(t instanceof b&&e instanceof b,"need bodies");let r=new q;if(C(t,e,r))return r},hitTestPolygonPolygon:(t,e)=>(f.assert(t instanceof b&&e instanceof b,"need bodies"),C(t,e,new q)),hitTestPointInPolygon(t,e,r){let n;for(let s,o,i=r.length,a=0,l=i-1;a<i;)s=r[a],o=r[l],s[1]>e!=o[1]>e&&t<(o[0]-s[0])*(e-s[1])/(o[1]-s[1])+s[0]&&(n=!n),l=a,++a;return n},hitTestPointPolygon(t,e,r){return f.assert(r instanceof b,"wanted a body"),this.hitTestPointInPolygon(t,e,i.translate(r.pos,r.shape.calcPoints))},hitTestLineCircle(t,e,r,n,s){let o,a=i.sub(e,t),l=[r,n],c=i.sub(l,t),u=i.sub(l,e),h=i.len2(c),f=i.dot(c,a)/i.dot(a,a);return o=f>=0&&f<=1?h-f*f*i.len2(a):f<0?h:i.len2(u),[o<s*s]},hitTestLinePolygon(t,e,r){f.assert(r instanceof b,"wanted a body");let n=i.translate(r.pos,r.shape.calcPoints);for(let r=0,s=0;r<n.length;++r){s=r+1,s==n.length&&(s=0);let[o,i]=this.lineIntersect2D(t,e,n[r],n[s]);if(o)return[o,i]}return[!1]},lineIntersect2D(t,e,r,n){let s,o,i=t[0],a=t[1],l=e[0],c=e[1],u=r[0],h=r[1],d=n[0],p=n[1],m=(i-l)*(h-p)-(a-c)*(u-d);return f.feq0(m)?[!1]:(s=(i-u)*(h-p)-(a-h)*(u-d),s/=m,o=(i-u)*(a-c)-(a-h)*(i-l),o/=m,0<=s&&s<=1&&0<=o&&o<=1?[!0,s,[i+s*(l-i),a+s*(c-a)]]:[!1])},lineIntersection2D(t,e,r,n){if(t[1]>n[1]&&e[1]>n[1]&&t[1]>r[1]&&e[1]>r[1]||e[1]<r[1]&&t[1]<r[1]&&e[1]<n[1]&&t[1]<n[1]||t[0]>n[0]&&e[0]>n[0]&&t[0]>r[0]&&e[0]>r[0]||e[0]<r[0]&&t[0]<r[0]&&e[0]<n[0]&&t[0]<n[0])return[!1,0];let s=(t[1]-r[1])*(n[0]-r[0])-(t[0]-r[0])*(n[1]-r[1]),o=(e[0]-t[0])*(n[1]-r[1])-(e[1]-t[1])*(n[0]-r[0]),i=(t[1]-r[1])*(e[0]-t[0])-(t[0]-r[0])*(e[1]-t[1]),a=(e[0]-t[0])*(n[1]-r[1])-(e[1]-t[1])*(n[0]-r[0]),l=s*o,c=i*a;return l>0&&l<o*o&&c>0&&c<a*a?[!0,s/o]:[!1,0]}}}"object"==typeof module&&module.exports?module.exports=o(require("./core"),require("./math"),require("./vec2"),require("./matrix"),require("../algo/basic")):t["io/czlab/mcfud/geo2d"]=o}(this),function(t,e){"use strict";function r(r,n){r||(r=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]());Math.floor;const{u:s,is:o}=r;return{spatialGrid:(t=320,r=320)=>function(t,r){const i=new Map;return{searchAndExec(t,e){let r,n=t.getSpatial();for(let s,o,a=n.y1;a<=n.y2;++a)if(o=i.get(a))for(let i,l,c=n.x1;c<=n.x2;++c)if(s=o.get(c))for(i=s.values(),l=i.next();!l.done;){if(t!==l.value&&(r=e(t,l.value))){c=a=1/0;break}r=null,l=i.next()}return r},search(t,e=!1){let r,n,s=[],o=t.getSpatial();for(let a=o.y1;a<=o.y2;++a)if(n=i.get(a))for(let i=o.x1;i<=o.x2;++i)(r=n.get(i))&&r.forEach((r=>{(r!==t||e)&&s.push(r)}));return s},engrid(e,s){if(!e)return;let o=e.getBBox(),i=e.getSpatial(),a=n.ndiv(o.x1,t),l=n.ndiv(o.y1,r),c=n.ndiv(o.x2,t),u=n.ndiv(o.y2,r);return i.x1==a&&i.x2==c&&i.y1==l&&i.y2==u||(this.degrid(e),i.x1=a,i.x2=c,i.y1=l,i.y2=u,s||this._register(e)),e},reset(){i.clear()},_register(t){let e=t.getSpatial();if(o.num(e.x1))for(let r,n,o=e.y1;o<=e.y2;++o){i.has(o)||i.set(o,new Map),n=i.get(o);for(let o=e.x1;o<=e.x2;++o)n.has(o)||n.set(o,new Map),r=n.get(o),s.assoc(r,t.getGuid(),t)}},degrid(t){if(t){let r=t.getSpatial();if(o.num(r.x1))for(let e,n,o=r.y1;o<=r.y2;++o)if(n=i.get(o))for(let o=r.x1;o<=r.x2;++o)(e=n.get(o))&&s.dissoc(e,t.getGuid());r.x1=e,r.x2=e,r.y1=e,r.y2=e}}}}(t,r)}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/spatial"]=r}(this),function(t,e){"use strict";function r(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());Math.floor;const{u:s}=e;function o(t,e,i,a,l,c,u){let h=null,f=[],d=r.ndiv(t+e,2),p=r.ndiv(i+a,2);function m(t){function e({x1:t,x2:e,y1:r,y2:n}){let s=[],o=t<d,i=e>d;return r<p&&(o&&s.push(3),i&&s.push(0)),n>p&&(o&&s.push(2),i&&s.push(1)),s}return t.getBBox?e(t.getBBox()):(s.assert(void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2,"wanted bbox for quadtree"),e(t))}const g={x1:t,x2:e,y1:i,y2:a};return{boundingBox:()=>g,subTrees:()=>h,dbg:t=>t(f,h,l,c,u),insert(...r){r.forEach((r=>{h?m(r).forEach((t=>h[t].insert(r))):(f.push(r),f.length>l&&u<c&&(s.assert(null===h),h=[o(d,e,i,p,l,c,u+1),o(d,e,p,a,l,c,u+1),o(t,d,p,a,l,c,u+1),o(t,d,i,p,l,c,u+1)],f.forEach((t=>m(t).forEach((e=>h[e].insert(t))))),f.length=0))}))},remove(t){h?h.forEach((e=>e.remove(t))):s.disj(f,t)},isLeaf:()=>null===h?-1:f.length,prune(){if(h){let t=0,e=0;for(let r,s=0;s<h.length;++s)r=h[s],r.prune(),n=r.isLeaf(),n>=0&&(++t,e+=n);t==h.length&&e<l&&(s.assert(0==f.length,"quadtree wanted zero items"),h.forEach((t=>t._swap(f))),h=null)}},_swap(t){f.forEach((e=>t.push(e))),f.length=0},reset(){f.length=0,h&&h.forEach((t=>t.reset())),h=null},searchAndExec(t,e,r){let n;if(h){let s=m(t);for(let o=0;o<s.length&&(n=h[s[o]].searchAndExec(t,e,r),!n);++o);}else for(let s,o=0;o<f.length&&(s=f[o],r&&s===t||!(n=e(s,t)));++o);return n},search(t,e){const r=new Map,n=[];return e&&r.set(t,null),h&&m(t).forEach((e=>{h[e].search(t).forEach((t=>{r.has(t)||(r.set(t,null),n.push(t))}))})),f.forEach((t=>{r.has(t)||(r.set(t,null),n.push(t))})),r.clear(),n}}}return{quadtree(t,e=12,r=5){const{x1:n,x2:s,y1:i,y2:a}=t;return o(n,s,i,a,e,r,0)}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("./math")):t["io/czlab/mcfud/qtree"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const{u:n}=r;class s{constructor(t,r){this.lastBestMove=e,this.state=e,this.other=r,this.cur=t}clone(t){const e=new s;return e.state=t(this.state),e.lastBestMove=this.lastBestMove,e.other=this.other,e.cur=this.cur,e}}function o(t,e,r,n){return t.evalScore(e,r,n)*(1+.001*r)}function i(t,e,r,s,a,l){if(0==r||t.isOver(e))return{depth:r,value:o(t,e,r,s)};let c=e,u=t.getStateCopier(),h=n.shuffle(t.getNextMoves(e));for(let o,f,d=0;d<h.length;++d)if(f=h[d],t.undoMove||(n.assert(u,"Missing state copier!"),e=c.clone(u)),t.makeMove(e,f),o=i(t,e,r-1,s,{value:-l.value,move:l.move},{value:-a.value,move:a.move}),t.undoMove&&t.unmakeMove(e,f),o.value=-o.value,o.move=f,o.value>a.value&&(a={value:o.value,move:f,depth:o.depth}),a.value>=l.value)return l;return JSON.parse(JSON.stringify(a))}function a(t,e,r,s,i,l){if(0==r||t.isOver(e))return[o(t,e,r,s),null];let c=n.shuffle(t.getNextMoves(e)),u=t.getStateCopier(),h=e,f=-1/0,d=c[0];r==s&&(h.lastBestMove=d);for(let o,p,m=0;m<c.length&&(t.undoMove||(n.assert(u,"Missing state copier!"),e=h.clone(u)),p=c[m],t.makeMove(e,p),o=-a(t,e,r-1,s,-l,-i)[0],t.undoMove&&t.unmakeMove(e,p),f<o&&(f=o,d=p),!(i<o&&(i=o,r==s&&(h.lastBestMove=p),i>=l)));++m);return[f,h.lastBestMove]}const l={algo:"negamax",GFrame:s,GameBoard:class{constructor(){}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}takeGFrame(){}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let r=this.getFirstMove();return n.nichts(r)&&(r=l.evalNegaMax(this)),r}},XXevalNegaMax(t){const e=t.takeGFrame(),r=t.depth;let[s,o]=a(t,e,r,r,-1/0,1/0);return n.nichts(o)&&console.log(`evalNegaMax: score=${s}, pos= ${o}, lastBestMove=${o}`),o},evalNegaMax(t){const e=t.takeGFrame(),r=t.depth;let{value:s,move:o}=i(t,e,r,r,{value:-1/0},{value:1/0});return n.nichts(o)&&console.log(`evalNegaMax: score= ${s}, pos= ${o}`),o}};return l}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/negamax"]=r}(this),function(t,e){"use strict";function r(r){r||(r=t["io/czlab/mcfud/core"]());const{u:n}=r;class s{constructor(t,r){this.state=e,this.other=r,this.cur=t}clone(t){const e=new s;return e.state=t(this.state),e.other=this.other,e.cur=this.cur,e}}const o=(t,e,r,n)=>t.evalScore(e,r,n);function i(t,r,s,a,l,c,u){if(0==s||t.isOver(r))return[o(t,r,s,a),e];let h=r,f=t.getStateCopier(),d=n.shuffle(t.getNextMoves(r));if(u){let e,o,p=d[0],m=-1/0;for(let g=0;g<d.length&&(t.undoMove||(n.assert(f,"Missing state copier!"),r=h.clone(f)),o=d[g],t.makeMove(r,o),e=i(t,r,s-1,a,l,c,!u)[0],t.undoMove&&t.unmakeMove(r,o),l=Math.max(e,l),e>m&&(m=e,p=o),!(c<=l));++g);return[m,p]}{let e,o,p=d[0],m=1/0;for(let g=0;g<d.length&&(t.undoMove||(n.assert(f,"Missing state copier!"),r=h.clone(f)),o=d[g],t.makeMove(r,o),e=i(t,r,s-1,a,l,c,!u)[0],t.undoMove&&t.unmakeMove(r,o),c=Math.min(e,c),e<m&&(m=e,p=o),!(c<=l));++g);return[m,p]}}const a={algo:"minimax",GFrame:s,GameBoard:class{constructor(){this.aiActor=e}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t,e,r){}isStalemate(t){}isOver(t,e){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}takeGFrame(){}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let r=this.getFirstMove();return n.nichts(r)&&(r=a.evalMiniMax(this)),r}},evalMiniMax(t){const e=t.takeGFrame(),r=t.depth;let[s,o]=i(t,e,r,r,-1/0,1/0,!0);return n.nichts(o)&&console.log(`evalMiniMax: score=${s}, pos= ${o}`),o}};return a}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/minimax"]=r}(this),function(t,e){"use strict";function r(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:n,u:s}=e;function o(t,e){let r="";for(;t>0;)r+=e,--t;return r}function i(t,e){let r=u;return e&&(n.str(t)?r="any"==t||t==e?h:u:t instanceof e&&(r=h)),r}function a(t,e,r){return new Promise(((n,s)=>{let o;try{o=r.call(t),o instanceof Promise?o.then((function(t){n(`${t?h:u}: ${e}`)})):(o=o?709394==o?c:h:u,n(`${o}: ${e}`))}catch(t){o=u,n(`${o}: ${e}`)}}))}function l(t,e,r,n){return new Promise(((s,o)=>{let a;try{a=r.call(t),a=709394==a?h:i(n,null)}catch(t){a=i(n,t)}s(`${a}: ${e}`)}))}const[c,u,h]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,n=t.total,i=e/n*100;console.log(r.white(o(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(o(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(o(78,"="))),console.log(r.yellow(["Passed: ",e,"/",n," [",0|i,"%]"].join(""))),console.log(r.magenta("Failed: "+(n-e))),console.log(r.white(["cpu-time: ",s.prettyMillis(t.duration)].join(""))),console.log(r.white(o(78,"=")))},deftest(t){let[e,r,n,s]=[null,null,null,null];const o={ensure:(t,e)=>(n.push([1,t,e]),o),eerror:(t,e)=>(n.push([911,t,e]),o),begin:t=>(s={},n=[],e=t,o),end(o){r=o;let i=function(){return new Promise(((t,o)=>{e&&e(s);let i,c=[];for(let t,e,r=0;r<n.length;++r){switch(e=n[r],e[0]){case 1:t=a(s,e[1],e[2]);break;case 911:t=l(s,e[1],e[2],"any")}i=i?i.then((function(e){return c.push(e),t})):t}i&&i.then((function(e){c.push(e),n.length=0,r&&r(s),t(c)}))}))};return(i.title=t)&&i}};return o},_run:t=>new Promise(((e,r)=>{t().then((function(t){e(t)}))})),runtest(t,e){const r=Date.now();return this._run(t).then((function(n){const s=Date.now(),o={title:e||t.title,date:(new Date).toString(),total:n.length,duration:s-r,passed:n.filter((t=>"P"==t[0])),skippd:n.filter((t=>"S"==t[0])),failed:n.filter((t=>"F"==t[0]))};return new Promise((t=>{t(o)}))}))}}}"object"==typeof module&&module.exports?module.exports=r(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=r}(this);