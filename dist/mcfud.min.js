!function(t,e,i){var s,r=256,n="random",o=i.pow(r,6),h=i.pow(2,52),a=2*h,l=255;function c(l,c,g){function m(){for(var t=x.g(6),e=o,i=0;t<h;)t=(t+i)*r,e*=r,i=x.g(1);for(;a<=t;)t/=2,e/=2,i>>>=1;return(t+i)/e}var y=[],v=f(function t(e,i){var s,r=[],n=typeof e;if(i&&"object"==n)for(s in e)try{r.push(t(e[s],i-1))}catch(t){}return r.length?r:"string"==n?e:e+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[l,p(e)]:null==l?function(){try{var i;return s&&(i=s.randomBytes)?i=i(r):(i=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(i)),p(i)}catch(i){var n=t.navigator,o=n&&n.plugins;return[+new Date,t,o,t.screen,p(e)]}}():l,3),y),x=new u(y);return m.int32=function(){return 0|x.g(4)},m.quick=function(){return x.g(4)/4294967296},m.double=m,f(p(x.S),e),(c.pass||g||function(t,e,s,r){return r&&(r.S&&d(r,x),t.state=function(){return d(x,{})}),s?(i[n]=t,e):t})(m,v,"global"in c?c.global:this==i,c.state)}function u(t){var e,i=t.length,s=this,n=0,o=s.i=s.j=0,h=s.S=[];for(i||(t=[i++]);n<r;)h[n]=n++;for(n=0;n<r;n++)h[n]=h[o=l&o+t[n%i]+(e=h[n])],h[o]=e;(s.g=function(t){for(var e,i=0,n=s.i,o=s.j,h=s.S;t--;)e=h[n=l&n+1],i=i*r+h[l&(h[n]=h[o=l&o+e])+(h[o]=e)];return s.i=n,s.j=o,i})(r)}function d(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){for(var i,s=t+"",r=0;r<s.length;)e[l&r]=l&(i^=19*e[l&r])+s.charCodeAt(r++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(f(i.random(),e),"object"==typeof module&&module.exports){module.exports=c;try{s=require("crypto")}catch(c){}}else"function"==typeof define&&define.amd?define((function(){return c})):i["seed"+n]=c}("undefined"!=typeof self?self:this,[],Math),"function"!=typeof JSON.decycle&&(JSON.decycle=function(t,e){"use strict";var i=new WeakMap;return function t(s,r){var n,o;return void 0!==e&&(s=e(s)),"object"!=typeof s||null===s||s instanceof Boolean||s instanceof Date||s instanceof Number||s instanceof RegExp||s instanceof String?s:void 0!==(n=i.get(s))?{$ref:n}:(i.set(s,r),Array.isArray(s)?(o=[],s.forEach((function(e,i){o[i]=t(e,r+"["+i+"]")}))):(o={},Object.keys(s).forEach((function(e){o[e]=t(s[e],r+"["+JSON.stringify(e)+"]")}))),o)}(t,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach((function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$}),function(t,e,i,s){"use strict";function r(){const i=t,r=Math.floor,n=Array.prototype.slice,o=Object.prototype.toString;function h(t){return"[object Object]"==o.call(t)}function a(t){return h(t)}function l(t){return"[object Function]"==o.call(t)}function c(t){return"[object Array]"==o.call(t)}function u(t){return"[object Map]"==o.call(t)}function d(t){return"[object Set]"==o.call(t)}function f(t){return"[object String]"==o.call(t)}function p(t){return"[object Number]"==o.call(t)}function g(t){return"[object Boolean]"==o.call(t)}function m(t){return(t<0?-t:t)%2==0}function y(t){return void 0===t}function v(t){return c(t)||u(t)||h(t)}const x=1.6180339887,_=Math.seedrandom?new Math.seedrandom:function(){return Math.random()};function w(t,e){return t.forEach((t=>{if(!t[0](t[1]))throw new TypeError(`wanted ${e}`)})),!0}function b(t,e){for(let e,i=0;i<t.length;++i)if(e=t[i],e[0](e[1]))return!0;throw new TypeError(`wanted ${e}`)}function k(t,e,i){if(!t(e))throw new TypeError(`wanted ${i}`);return!0}const E=/(\/|\\\\)([^(\/|\\\\)]+)$/g,N=/(\.[^\.\/\?\\]*)(\?.*)?$/;function S(t,e){let i=N.exec(t);return i&&i[1]?(i=i[1].toLowerCase(),e||(i=i.substring(1))):i="",i}function M(t,e,i){const s=t(e);switch(i.length){case 0:return s;case 1:return s&&t(i[0]);case 2:return s&&t(i[0])&&t(i[1]);case 3:return s&&t(i[0])&&t(i[1])&&t(i[2]);default:return s&&i.every((e=>t(e)))}}const O=1e-10;let I=0;const T={},A={fun:(t,...e)=>M(l,t,e),str:(t,...e)=>M(f,t,e),undef:(t,...e)=>M(y,t,e),map:(t,...e)=>M(u,t,e),set:(t,...e)=>M(d,t,e),num:(t,...e)=>M(p,t,e),bool:(t,...e)=>M(g,t,e),pos:t=>p(t)&&t>0,neg:t=>p(t)&&t<0,vec:(t,...e)=>M(c,t,e),vecN:(t,e,i=!1)=>c(t)&&(i?t.length==e:t.length>=e),obj:(t,...e)=>M(h,t,e),notEmpty:t=>z.size(t)>0,isEmpty:t=>0==z.size(t),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},z={SORT_DESC:1,SORT_ASC:-1,error(...t){console.error(...t)},warn(...t){console.warn(...t)},log(...t){console.log(...t)},ndiv:(t,e)=>Math.floor(t/e),feq0:t=>t>=-1e-10&&t<=O,feq:(t,e,i=1e-10)=>t>=e-i&&t<=e+i,hexToBin(t){const e={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"};let i="";for(let r,n=0;n<t.length;++n){if(!(r=e[t[n]])){i=s;break}i+=r}return i},pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,setVec:(t,...e)=>(e.forEach(((e,i)=>t[i]=e)),t),evenN:(t,e=!1)=>m(t=r(t))?t:e?t+1:t-1,nichts:t=>null==t,echt:t=>null!=t,nor:(t,e)=>null==t?e:t,or:(t,e)=>void 0===t?e:t,toNum(t,e){const i=parseFloat(t);return isNaN(i)&&p(e)?e:i},percentRemain:(t,e,i=!1)=>(t>e&&(t=i?t%e:e),Math.max(0,e-t)/e),splitVerStr(t){const e=(""+(t||"")).split(".").filter((t=>t.length>0));return[this.toNum(e[0],0),this.toNum(e[1],0),this.toNum(e[2],0)]},cmpVerStrs(t,e){let i=this.splitVerStr(""+t),s=this.splitVerStr(""+e);return i[0]>s[0]?1:i[0]<s[0]?-1:i[1]>s[1]?1:i[1]<s[1]?-1:i[2]>s[2]?1:i[2]<s[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter((t=>e.indexOf(S(t,1))>-1)),zipMap(t,e,i=s){let r,n=Math.min(t.length,e.length),o=i||new Map;for(r=0;r<n;++r)o.set(t[r],e[r]);return o},zip(t,e,i=s){return this.zipMap(t,e,i)},zipObj(t,e,i=s){let r,n=Math.min(t.length,e.length),o=i||{};for(r=0;r<n;++r)o[t[r]]=e[r];return o},partition(t,e){const i=[];for(let s,r,n=0;;){for(s=[],r=0;r<t;++r){if(!(n<e.length)){r=-1;break}s.push(e[n++])}if(s.length>0&&i.push(s),r<0)break}return i},keys:t=>u(t)?Array.from(t.keys()):h(t)?Object.keys(t):[],selectNotKeys(t,e){b([[u,t],[h,t]],"map/object");const i=u(t)?new Map:{};return e=this.seq(e),this.doseq(t,((t,s)=>!e.includes(s)&&this.assoc(i,s,t))),i},selectKeys(t,e){b([[u,t],[h,t]],"map/object");const i=u(t)?new Map:{};return this.seq(e).forEach((e=>{u(t)?t.has(e)&&i.set(e,t.get(e)):A.own(t,e)&&(i[e]=t[e])})),i},copyKeys(t,e,i){return b([[u,t],[h,t]],"map/object"),e instanceof Map&&z.assert(t instanceof Map,"expected Map"),this.seq(i).forEach((i=>{u(e)?e.has(i)&&t.set(i,e.get(i)):(A.own(e,i)||void 0!==e[i])&&(t[i]=e[i])})),t},setManyKeys(t,e,i){return b([[u,t],[h,t]],"map/object"),this.seq(e).forEach((e=>{u(t)?t.set(e,i):t[e]=i})),t},clearKeys(t,e){return b([[u,t],[h,t]],"map/object"),this.seq(e).forEach((e=>{u(t)?t.delete(e):delete t[e]})),t},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0==e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),(t=>this.has(e,t)?t:null))},randInt2:(t,e)=>t+r(_()*(e-t+1)),randFloat2:(t,e)=>t+_()*(e-t),randMinus1To1:()=>2*(_()-.5),randInt:t=>r(_()*t),rand:(t=!1)=>t?Math.random():_(),randGaussian(t=6){let e,i=0;for(e=0;e<t;++e)i+=this.rand();return i/t},randSign:()=>_()>.5?-1:1,toGoldenRatio(t){let e=t/x,i=e/x;return[this.rounded(e),this.rounded(i)]},inst:(t,e)=>e instanceof t,hashCode(t){let e,i=0;for(e=0;e<t.length;++e)i=Math.imul(31,i)+t.charCodeAt(e);return i},cls(t){return this.trunc(t)},trunc(t){try{t.length=0}catch(t){}return t},randSample(t,e=1){let i,s;return 1==e?s=[this.randItem(t)]:0==e?s=[]:e>0&&(i=this.shuffle(t,!1),s=e>=i.length?i:i.slice(0,e)),s},randItem(t,e=!1){let i,s=-1;if(t)switch(t.length){case 0:case 1:i=t[s=0];break;case 2:i=t[s=this.randSign()>0?1:0];break;default:i=t[s=r(_()*t.length)]}return e?[i,s]:i},randAorB:(t,e)=>_()>.5?t:e,isPerc:t=>f(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>m(t),jsMap(...t){k(m,t.length,"even n# of args");let e,i=new Map;for(e=0;e<t.length;)i.set(t[e],t[e+1]),e+=2;return i},jsObj(...t){k(m,t.length,"even n# of args");let e,i={};for(e=0;e<t.length;)i[t[e]]=t[e+1],e+=2;return i},jsVec:(...t)=>0==t.length?[]:t.slice(),lastIndex:t=>c(t)&&t.length>0?t.length-1:-1,first(t){if(c(t)&&t.length>0)return t[0]},last(t){if(c(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>n.call(t,e),every(t,e){k(c,t,"array");for(let i=0;i<t.length;++i)if(l(e)){if(!e(t[i]))return!1}else if(t[i]!=e)return!1;return t.length>0},notAny(t,e){k(c,t,"array");for(let i=0;i<t.length;++i)if(l(e)){if(e(t[i]))return!1}else if(t[i]===e)return!1;return t.length>0},copy(t,e=[]){w([[c,t],[c,e]],"arrays");let i,s=Math.min(t.length,e.length);for(i=0;i<s;++i)t[i]=e[i];return t},append(t,e=[],i=!1){w([[c,t],[c,e]],"arrays"),i&&(t.length=0);for(let i=0;i<e.length;++i)t.push(e[i]);return t},fill(t,e,...i){if(p(t)&&(t=new Array(t)),c(t))for(let s=0;s<t.length;++s)t[s]=l(e)?e(s,...i):e;return t},size(t){return c(t)||f(t)?t.length:d(t)||u(t)?t.size:t?this.keys(t).length:0},nextId:()=>++I,now:()=>Date.now(),fileExt:t=>S(t),fileBase(t){let e,i,s=t.indexOf("?");return s>0&&(t=t.substring(0,s)),t=t.replace(/(\/|\\\\)$/,""),i=E.exec(t),e="",i&&(e=i[2],s=e.lastIndexOf("."),s>0&&(e=e.substring(0,s))),e},range(t,e,i=1){1==arguments.length&&(e=t,t=0,i=1);let s=(e-t)/i;const r=[];s=Math.ceil(s),s=Math.max(0,s),r.length=s;for(let e=0;e<s;++e)r[e]=t,t+=i;return r},shuffle(t,e=!0){k(c,t,"array");const i=n.call(t,0);switch(i.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=i[0];i[0]=i[1],i[1]=t}break;default:for(let t,e,s=i.length-1;s>0;--s)e=r(_()*(s+1)),t=i[s],i[s]=i[e],i[e]=t}return e?this.copy(t,i):i},shuffle2(t,e=!0){k(c,t,"array");const i=n.call(t,0);switch(i.length){case 0:case 1:break;case 2:if(this.randSign()>0){let t=i[0];i[0]=i[1],i[1]=t}break;default:for(let t,e,s=0,n=i.length;s<n;++s)e=s+r(_()*(n-s)),t=i[e],i[e]=i[s],i[s]=t}return e?this.copy(t,i):i},shuffle3(t,e=!0){return(e?t:n.call(t,0)).sort(((t,e)=>this.rand()>.5?-1:this.rand()>.5?1:0))},uniq:t=>(k(c,t,"array"),Array.from(new Set(t))),map(t,e,i){if(k(v,t,"array/map/object"),c(t))return t.map(e,i);{const s=u(t)?new Map:{};return this.doseq(t,((r,n)=>{this.assoc(s,n,e.call(i,r,n,t))})),s}},find(t,e,i){let s,r=!0,o=n.call(arguments,3);return this.doseq(t,((t,n)=>{r&&e.apply(i,[t,n].concat(o))&&(s=[n,t],r=!1)})),s},some(t,e,i){let s,r=!0,o=n.call(arguments,3);return this.doseq(t,((t,n)=>{r&&(s=e.apply(i,[t,n].concat(o)),s?r=!1:s=void 0)})),s},equals(t,e){if(a(t)&&a(e)){let i,s,r=Object.keys(t),n=Object.keys(e);if(r.length==n.length){for(let o=0;o<r.length;++o)if(i=r[o],s=n[o],!this.equals(i,s)||!this.equals(t[i],e[s]))return!1;return!0}return!1}if(c(t)&&c(e)){if(t.length==e.length){for(let i=0;i<t.length;++i)if(!this.equals(t[i],e[i]))return!1;return!0}return!1}if(p(t)&&p(e))return t==e;if(f(t)&&f(e))return t==e;if(g(t)&&g(e))return t==e;if(null===t&&null===e)return!0;if(void 0===t&&void 0===e)return!0;throw Error("cant call equals for these types")},invoke(t,e){let i=n.call(arguments,2);c(t)&&t.forEach((t=>t[e].apply(t,i)))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,i=!1)=>({repeat:!!i,id:i?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&t.id?(t.repeat?clearInterval(t.id):clearTimeout(t.id),t.id=0):A.pos(t)&&clearTimeout(t)},rmap:(t,e,i,s,r)=>(t-e)/(i-e)*(r-s)+s,dotimes(t,e,i,...s){for(let r=0;r<t;++r)e.call(i,r,...s)},rseq(t,e,i){if(k(c,t,"array"),t.length>0)for(let s=t.length-1;s>=0;--s)e.call(i,t[s],s,t)},doseq(t,e,i){c(t)?t.forEach(e,i):u(t)?t.forEach(((s,r)=>e.call(i,s,r,t))):h(t)&&Object.keys(t).forEach((s=>e.call(i,t[s],s,t)))},doseqEx(t,e,i){this.doseq(t,((s,r)=>null!=s&&e.call(i,s,r,t)))},dissoc(t,e){if(arguments.length>2){let e,i=1;for(;i<arguments.length;++i)e=this.dissoc(t,arguments[i]);return e}{let i;return u(t)?(i=t.get(e),t.delete(e)):h(t)&&(i=t[e],delete t[e]),i}},get(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc(t,e,i){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,i=1;for(;i<arguments.length;)e=this.assoc(t,arguments[i],arguments[i+1]),i+=2;return e}{let s;return u(t)?(s=t.get(e),t.set(e,i)):t&&(s=t[e],t[e]=i),s}},disj(t,e){const i=t?t.indexOf(e):-1;return i>-1&&t.splice(i,1),i>-1},conj:(t,...e)=>(t&&e.forEach((e=>t.push(e))),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map((t=>t.trim())).filter((t=>t.length>0))),c(t)||(t=[t]),t),has(t,e){return 1!=arguments.length&&(u(t)?t.has(e):c(t)?-1!=t.indexOf(e):!!h(t)&&A.own(t,e))},patch(t,e){return k(h,t=t||{},"object"),e&&Object.keys(e).forEach((i=>{this.has(t,i)||(t[i]=e[i])})),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach((e=>e&&function(t,e){let i=Object.keys(e).reduce(((t,i)=>(t[i]=Object.getOwnPropertyDescriptor(e,i),t)),{});return Object.getOwnPropertySymbols(e).forEach((t=>{let s=Object.getOwnPropertyDescriptor(e,t);s.enumerable&&(i[t]=s)})),Object.defineProperties(t,i)}(t,e))),t),deepCopyArray(t){k(c,t,"array");let e,i,s=[];for(e=0,i=t.length;e<i;++e)s[e]=c(t[e])?this.deepCopyArray(t[e]):t[e];return s},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let i;return Object.keys(e).forEach((s=>{i=e[s],"object"==typeof i&&null!==i&&t[s]?("object"!=typeof t[s]&&(t[s]=i instanceof Array?[]:{}),this.merge(t[s],i)):t[s]=i})),t},throttle(t,e,i){let s=!0,r=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return h(i)&&(s="leading"in i?!!i.leading:s,r="trailing"in i?!!i.trailing:r),this.debounce(t,e,{leading:s,trailing:r,maxWait:e})},debounce(t,e,s){let r,n,o,h,l,c,u=0,d=!1,f=!1,p=!0;const g=!e&&0!==e&&"function"==typeof i.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){const i=r,s=n;return r=n=void 0,u=e,h=t.apply(s,i),h}function y(t,e){return g?(i.cancelAnimationFrame(l),i.requestAnimationFrame(t)):setTimeout(t,e)}function v(t){const i=t-c;return void 0===c||i>=e||i<0||f&&t-u>=o}function x(){const t=Date.now();if(v(t))return _(t);l=y(x,function(t){const i=t-u,s=e-(t-c);return f?Math.min(s,o-i):s}(t))}function _(t){return l=void 0,p&&r?m(t):(r=n=void 0,h)}function w(...t){const i=Date.now(),s=v(i);if(r=t,n=this,c=i,s){if(void 0===l)return function(t){return u=t,l=y(x,e),d?m(t):h}(c);if(f)return l=y(x,e),m(c)}return void 0===l&&(l=y(x,e)),h}return e=+e||0,a(s)&&(d=!!s.leading,f="maxWait"in s,o=f?Math.max(+s.maxWait||0,e):o,p="trailing"in s?!!s.trailing:p),w.cancel=function(){void 0!==l&&function(t){if(g)return i.cancelAnimationFrame(t);clearTimeout(t)}(l),u=0,r=c=n=l=void 0},w.flush=function(){return void 0===l?h:_(Date.now())},w.pending=function(){return void 0!==l},w},negate:t=>(k(l,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,i)=>(e-=t.length)>0?t+new Array(Math.ceil(e/i.length)+1).join(i).substr(0,e):t,strPadLeft:(t,e,i)=>(e-=t.length)>0?new Array(Math.ceil(e/i.length)+1).join(i).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter((t=>t.length>0)),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2,i="0"){return this.strPadLeft(Number(t).toString(),e,i)},prettyMillis(t){let e,i,s=r(t/1e3);i=r(s/60),t-=1e3*s,s-=60*i,e=r(i/60),i-=60*e;let n=[];return n.push(`${s}.${t} secs`),(i>0||e>0)&&n.push(`${i} mins, `),e>0&&n.push(`${e} hrs, `),n.reverse().join("")},swap(t,e,i){let s=t[e];return t[e]=t[i],t[i]=s,t},listIndexesOf(t,e){let i=z.fill(t.length,(t=>t));return e?this.shuffle(i):i},dropArgs:(t,e)=>t.length>e?n.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let i=t;if(2==arguments.length&&911==arguments[1].hack&&(i=arguments[1]),i&&i.location&&e){const t=e.indexOf("://");if(t>0){let s=e.indexOf("/",t+3);return(s<0?e:e.substring(0,s))!=i.location.origin}}},addEvent(t,e,i,s){c(t)&&1==arguments.length?t.forEach((t=>this.addEvent.apply(this,t))):e.addEventListener(t,i,s)},delEvent(t,e,i,s){c(t)&&1==arguments.length?t.forEach((t=>this.delEvent.apply(this,t))):e.removeEventListener(t,i,s)},rounded(t){return this.roundUnderOffset(t,.5)},roundUnderOffset(t,e){const i=r(t);return t-i<e?i:i+1},comparator(t,e,i){return 1==arguments.length?t<0?function(t,e){return t<e?-1:t>e?1:0}:function(t,e){return t>e?-1:t<e?1:0}:t<0?function(t,s){let r=e(t),n=i(s);return r<n?-1:r>n?1:0}:function(t,s){let r=e(t),n=i(s);return r>n?-1:r<n?1:0}}},C={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,i)=>f(i)?e.getElementsByTagNameNS(i,t):e.getElementsByTagName(id),attrs(t,e){return!h(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&z.doseq(e,((e,i)=>t.setAttribute(i,e))),t)},css(t,e){return!h(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&z.doseq(e,((e,i)=>t.style[i]=e)),t)},wrap(t,e){const i=t.parentNode;return e.appendChild(t),i.appendChild(e),e},newElm(t,i,s){const r=e.createElement(t);return this.attrs(r,i),this.css(r,s),r},newTxt(t,i,s){const r=e.createTextNode(t);return this.attrs(r,i),this.css(r,s),r}},B={},q=[];class P{constructor(){this._tree=new Map,this._targets=new Map}sub(t,e,i,s){let r=t[0],n=t[1];return n&&!this._targets.has(n)&&this._targets.set(n,1),z.seq(r).forEach((t=>{if(e||(e=t),f(e)&&(e=(i=i||n)[e]),!e)throw"Error: no callback for sub()";this._tree.has(t)||this._tree.set(t,z.jsMap());let r=this._tree.get(t);n=n||B,!r.has(n)&&r.set(n,[]),r.get(n).push([e,i,s])})),this}pub(t,...e){let i,s,r=t[0],n=t[1]||B;return(n===B||this._targets.has(n))&&z.seq(r).forEach((t=>{s=this._tree.get(t),i=s&&s.get(n),i&&i.forEach((t=>{t[0].apply(t[1],e.concat(t[2]||q))}))})),this}reset(){return this._targets.clear(),this._tree.clear(),this}drop(t){if(this._targets.has(t)){this._targets.delete(t);let e=this._tree.values();for(let i=e.next();!i.done;)i.value.delete(t),i=e.next()}return this}unsub(t,e,i){if(1!=arguments.length||A.vec(t)){let s=t[0],r=t[1]||B;if(r===B||this._targets.has(r)){let t,n;z.seq(s).forEach((s=>{if(t=this._tree.get(s),n=t&&t.get(r),n&&(f(e)&&(e=(i=i||r)[e]),e))for(let t=n.length-1;t>=0;--t)n[t][0]===e&&n[t][1]===i&&n.splice(t,1)}))}}else this.drop(t);return this}}return e?T.dom=C:(delete z.addEvent,delete z.delEvent),T.EventBus=function(){return new P},T.is=A,T.u=z,T}"object"==typeof module&&module.exports||(e=t.document),"object"==typeof module&&module.exports?module.exports=r():t["io/czlab/mcfud/core"]=r}(this),function(t,e){"use strict";function i(e){e||(e=t["io/czlab/mcfud/core"]());const i=360,s=2*Math.PI,r=(Math.PI,Math.floor),{is:n,u:o}=e;const h=t=>t<0?- -t%i:t%i;return{lerp:(t,e,i)=>(1-i)*t+i*e,xmod:(t,e)=>t<0?t- -(e+e*r(-t/e)):t%e,ndiv:(t,e)=>r(t/e),pow:(t,e)=>0==e?1:1==e?t:2==e?t*t:3==e?t*t*t:Math.pow(t,e),pow2(t){let e=2;for(;t>e;)e*=2;return e},clamp:(t,e,i)=>i<t?t:i>e?e:i,sqr:t=>t*t,fuzzyEq:(t,e)=>o.feq(t,e),fuzzyZero:t=>o.feq0(t),radToDeg:t=>h(i*t/s),degToRad:t=>s*h(t)/i,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t,remap(t,e,i,s,r,n){const o=(t-e)/(i-e)*(r-s)+s;return n?s<r?this.clamp(s,r,o):this.clamp(r,s,o):o},perlin1D(t,e,i,s,n){let o,h,a,l,c,u,d,f;for(let p=0;p<t;++p){o=0,h=0,a=1;for(let n=0;n<i;++n)l=t>>n,c=r(p/l)*l,u=(c+l)%t,d=(p-c)/l,f=(1-d)*e[r(c)]+d*e[r(u)],h+=a,o+=f*a,a/=s;n[p]=o/h}},perlin2D(t,e,i,s,n,o){let h,a,l,c,u,d,f,p,g,m,y,v;for(let x=0;x<t;++x)for(let _=0;_<e;++_){h=0,a=0,l=1;for(let o=0;o<s;++o)p=t>>o,g=r(x/p)*p,m=r(_/p)*p,y=(g+p)%t,v=(m+p)%e,c=(x-g)/p,u=(_-m)/p,d=(1-c)*i[r(m*t+g)]+c*i[r(m*t+y)],f=(1-c)*i[r(v*t+g)]+c*i[r(v*t+y)],a+=l,h+=(u*(f-d)+d)*l,l/=n;o[_*t+x]=h/a}}}}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/math"]=i}(this),function(t,e){"use strict";function i(e){e||(e=t["io/czlab/mcfud/core"]());const{u:i,is:s}=e,r=(t,e)=>i.assert(!s.num(t)&&!s.num(e)&&t&&e,"wanted 2 vecs"),n=(t,e=0,i=0)=>t?[e,i]:{x:e,y:i},o={};class h{constructor(){this.x=0,this.y=0}unit(t){return s.bool(t)&&(t=n(t)),s.vec(t)?(t[0]=this.x,t[1]=this.y):(t.x=this.x,t.y=this.y),t}bind(t){return s.vec(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y),this}op(t,e,i){let r=o.take();switch(r.x=this.x,r.y=this.y,t){case"+":s.num(e)&&(r.x+=e),s.num(i)&&(r.y+=i);break;case"-":s.num(e)&&(r.x-=e),s.num(i)&&(r.y-=i);break;case"*":s.num(e)&&(r.x*=e),s.num(i)&&(r.y*=i);break;case"/":s.num(e)&&(r.x/=e),s.num(i)&&(r.y/=i)}return r}"+"(t){return this.op("+",t.x,t.y)}"-"(t){return this.op("-",t.x,t.y)}"*"(t){return this.op("*",t.x,t.y)}"/"(t){return this.op("/",t.x,t.y)}}function a(t,e,i,r,n,o,h){const a=t-n,l=e-o,c=n+(a*i-l*r),u=o+(a*r+l*i);return s.vec(h)?(h[0]=c,h[1]=u):(h.x=c,h.y=u),h}function l(t,e,i,r){let n,h,a=o.take().bind(t);if(s.num(e))h=a.op(i,e,e);else{let t=o.take().bind(e);h=a[i](t),o.drop(t)}return n=h.unit(r?t:s.vec(t)),o.drop(a,h),n}i.inject(o,{take(){return this._pool.pop()},drop(...t){t.forEach((t=>{t.x=0,t.y=0,this._pool.push(t)}))},_pool:i.fill(16,(()=>new h))});const c={gx:t=>s.vec(t)?t[0]:t.x,sx(t,e){s.vec[t]?t[0]=e:t.x=e},gy:t=>s.vec(t)?t[1]:t.y,sy(t,e){s.vec[t]?t[1]=e:t.y=e},vec:(t=0,e=0)=>n(!0,t,e),vecXY:(t=0,e=0)=>n(!1,t,e),add(t,e){return i.assert(2==arguments.length)&&l(t,e,"+")},add$(t,e){return i.assert(2==arguments.length)&&l(t,e,"+",!0)},sub(t,e){return i.assert(2==arguments.length)&&l(t,e,"-")},sub$(t,e){return i.assert(2==arguments.length)&&l(t,e,"-",!0)},mul(t,e){return i.assert(2==arguments.length)&&l(t,e,"*")},mul$(t,e){return i.assert(2==arguments.length)&&l(t,e,"*",!0)},div(t,e){return i.assert(2==arguments.length)&&l(t,e,"/")},div$(t,e){return i.assert(2==arguments.length)&&l(t,e,"/",!0)},dot(t,e){r(t,e);let i=o.take().bind(t),s=o.take().bind(e),n=i.x*s.x+i.y*s.y;return o.drop(i,s),n},equals(t,e){let i=o.take().bind(t),s=o.take().bind(e),r=i.x==s.x&&i.y==s.y;return o.drop(i,s),r},vecAB(t,e){r(t,e);let i,n=o.take().bind(t),h=o.take().bind(e),a=o.take();return a.x=h.x-n.x,a.y=h.y-n.y,i=a.unit(s.vec(t)),o.drop(n,h,a),i},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){return this.len2(this.sub(e,t))},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let e,r=this.len(t),n=o.take().bind(t);return i.feq0(r)?(n.x=0,n.y=0):(n.x/=r,n.y/=r),e=n.unit(s.vec(t)),o.drop(n),e},unit$(t){let e,s=this.len(t),r=o.take().bind(t);return i.feq0(s)?(r.x=0,r.y=0):(r.x/=s,r.y/=s),e=r.unit(t),o.drop(r),e},copy(t,e){r(t,e);let i,s=o.take().bind(t),n=o.take().bind(e);return s.x=n.x,s.y=n.y,i=s.unit(t),o.drop(s,n),i},clone(t){let e=o.take().bind(t),i=e.unit(s.vec(t));return o.drop(e),i},set(t,e,i){let r,n=o.take().bind(t);return s.num(e)&&(n.x=e),s.num(i)&&(n.y=i),r=n.unit(t),o.drop(n),r},setX(t,e){return this.set(t,e)},setY(t,e){return this.set(t,null,e)},rot(t,e,i=null){let r,h,l=0,c=0,u=o.take().bind(t);return i&&(h=o.take().bind(i),l=h.x,c=h.y,o.drop(h)),r=a(u.x,u.y,Math.cos(e),Math.sin(e),l,c,n(s.vec(t))),o.drop(u),r},rot$(t,e,i){let s,r,n=0,h=0,l=o.take().bind(t);return i&&(r=o.take().bind(i),n=r.x,h=r.y,o.drop(r)),s=a(l.x,l.y,Math.cos(e),Math.sin(e),n,h,t),o.drop(l),s},cross(t,e){let i;if(s.num(t)){let r=o.take(),n=o.take().bind(e);r.x=-t*n.y,r.y=t*n.x,i=r.unit(s.vec(e)),o.drop(n,r)}else if(s.num(e)){let r=o.take(),n=o.take().bind(t);r.x=e*n.y,r.y=-e*n.x,i=r.unit(s.vec(t)),o.drop(n,r)}else{r(t,e);let s=o.take().bind(t),n=o.take().bind(e);i=s.x*n.y-s.y*n.x,o.drop(s,n)}return i},angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal(t,e=!1){let i,r=o.take(),n=o.take().bind(t);return e?(r.x=-n.y,r.y=n.x):(r.x=n.y,r.y=-n.x),i=r.unit(s.vec(t)),o.drop(n,r),i},normal$(t,e=!1){let i,s=o.take(),r=o.take().bind(t);return e?(s.x=-r.y,s.y=r.x):(s.x=r.y,s.y=-r.x),i=s.unit(t),o.drop(r,s),i},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const i=this.unit(e);this.mul$(i,this.dot(t,i));let r=o.take().bind(i),n=r.unit(s.vec(t));return o.drop(r),n},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){const i=2*this.dot(t,e);return this.sub(t,this.mul(e,i))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...e){let i,r,n,h,a=o.take().bind(t);return 1==e.length&&s.vec(e[0])&&!s.num(e[0][0])&&(e=e[0]),n=e.map((t=>(r=o.take().bind(t),i=r["+"](a),h=i.unit(s.vec(t)),o.drop(r,i),h))),o.drop(a),n},clamp$(t,e,i){const s=this.len(t),r=Math.max(e,Math.min(i,s));return s==r?t:this.mul$(this.div$(t,s||1),r)},clamp(t,e,i){const s=this.len(t),r=Math.max(e,Math.min(i,s));return s==r?t:this.mul(this.div(t,s||1),r)}};return c}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/vec2"]=i}(this),function(t,e){"use strict";function i(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const i=Math.cos,s=Math.sin,r=(Math.tan,Math.floor),{u:n,is:o}=e;const h=t=>t%2!=0,a=(t,e,i,s)=>s-1+(i-1)*e,l=(t,e,i)=>({cells:i,dim:[t,e]}),c=(t,e)=>l(t,e,n.fill(t*e,0));return{v4:(t=0,e=0,i=0,s=0)=>[t,e,i,s],v3:(t=0,e=0,i=0)=>[t,e,i],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.v3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t);if(!n.feq0(e))return[t[0]/e,t[1]/e,t[2]/e]},sub(t,e){return o.num(e)?this.v3(t[0]-e,t[1]-e,t[2]-e):this.v3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return o.num(e)?this.v3(t[0]+e,t[1]+e,t[2]+e):this.v3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return o.num(e)?this.v3(t[0]*e,t[1]*e,t[2]*e):this.v3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return o.num(e)?this.v3(t[0]/e,t[1]/e,t[2]/e):this.v3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...i){const s=t*e;return 0==i.length?c(t,e):n.assert(s==i.length)&&l(t,e,i)},matCell(t,e,i,s){const r=a(t.dim[0],t.dim[1],e,i);if(r>=0&&r<t.cells.length)return o.num(s)?(t.cells[r]=s,t):t.cells[r]},matIdentity(t){const e=n.assert(t>0)&&n.fill(t*t,0);for(let i=0;i<t;++i)e[a(0,t,i+1,i+1)]=1;return l(t,t,e)},matZero:t=>n.assert(t>0)&&l(t,t,n.fill(t*t,0)),matRowMajors(t){const[e,i]=t.dim;return n.partition(i,t.cells)},matColMajors(t){const[e,i]=t.dim,s=[];for(let r,n=0;n<i;++n){r=[];for(let s=0;s<e;++s)r.push(t.cells[s*i+n]);s.push(r)}return s},mat2(t,e,i,s){return this.matrix([2,2],t,e,i,s)},mat3(t,e,i,s,r,n,o,h,a){return this.matrix([3,3],t,e,i,s,r,n,o,h,a)},mat4(t,e,i,s,r,n,o,h,a,l,c,u,d,f,p,g){return this.matrix([4,4],t,e,i,s,r,n,o,h,a,l,c,u,d,f,p,g)},matEq(t,e){return t.dim[0]==e.dim[0]&&t.dim[1]==e.dim[1]&&(i=t.cells,s=e.cells,i.length==s.length&&i.every(((t,e)=>t==s[e]||n.feq(t,s[e]))));var i,s},matXpose(t){const[e,i]=t.dim,s=e*i,n=[];for(let o=0;o<s;++o)n.push(t.cells[r(o/e)+i*(o%e)]);return l(i,e,n)},matScale:(t,e)=>l(t.dim[0],t.dim[1],t.cells.map((t=>t*e))),matMult(t,e){let[i,s]=t.dim,[r,o]=e.dim,h=t.cells,a=e.cells;n.assert(s==r,"mismatch matrices");let c=new Array(i*o);for(let t=0;t<i;++t)for(let e=0;e<o;++e)c[e+t*o]=n.range(r).reduce(((i,r)=>i+h[r+t*s]*a[e+r*o]),0);return l(i,o,c)},matDet(t){let[e,i]=t.dim,s=[];if(2==i)return this._matDet2x2(t);for(let e=0;e<i;++e)n.conj(s,this.matDet(this.matCut(t,1,e+1)));return n.range(i).reduce(((e,i)=>{let r=s[i];return e+t.cells[i]*(h(i)?-r:r)}),0)},_matDet2x2:t=>(n.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,i){const[s,r]=t.dim;let o=e-1,h=i-1,a=[];for(let e=0;e<s;++e)for(let i=0;i<r;++i)e!=o&&i!=h&&n.conj(a,t.cells[i+e*r]);return l(s-1,r-1,a)},matMinor(t){const[e,i]=t.dim;let s=[];if(n.assert(e==i),2==i)return this._matMinor2x2(t);for(let r=0;r<e;++r)for(let e=0;e<i;++e)n.conj(s,this.matDet(this.matCut(t,r+1,e+1)));return l(e,i,s)},_matMinor2x2(t){return n.assert(4==t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){const e=this.matMinor(t),[i,s]=e.dim;let r=e.cells.slice();for(let t=0;t<i;++t)for(let e,i=0;i<s;++i)e=t*s+i,h(t+i)&&(r[e]=-r[e]);return l(i,s,r)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){const[e,i]=t.dim;n.assert(4==t.cells.length&&2==e&&2==i);let s,r=t.cells,o=r[0]*r[3]-r[1]*r[2];if(n.feq0(o))s=this.matIdentity(e);else{let t=1/o;s=this.mat2(r[3]*t,-r[1]*t,-r[2]*t,r[0]*t)}return s},matInv(t){const[e,i]=t.dim;if(2==i)return this._minv2x2(t);let s=this.matDet(t);return n.feq0(s)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/s)},matFromColMajor(t){let e=t.length,i=t[0].length,s=c(i,e);for(let i,r=0;r<t.length;++r){i=t[r];for(let t=0;t<i.length;++t)s.cells[t*e+r]=i[t]}return s},matToColMajor(t){const[e,i]=t.dim,s=[];t.cells.slice();for(let r,n=0;n<i;++n){r=[];for(let s=0;s<e;++s)r.push(t.cells[s*i+n]);s.push(r)}return s},scale3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,1,1)]=t[0],e.cells[a(0,4,2,2)]=t[1],e.cells[a(0,4,3,3)]=t[2],e},translate3D(t){const e=this.matIdentity(4);return e.cells[a(0,4,4,1)]=t[0],e.cells[a(0,4,4,2)]=t[1],e.cells[a(0,4,4,3)]=t[2],e},rot3D(t,e,i){return this.matMult(this.zRot3D(i),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let i=t.dim[1],s=e.length;n.assert(i==s);let r=this.matMult(t,l(s,1,e)),o=r.cells;return r.cells=null,o},rot2D(t){return this.mat2(i(t),-s(t),s(t),i(t))},xRot3D(t){return this.mat4(1,0,0,0,0,i(t),-s(t),0,0,s(t),i(t),0,0,0,0,1)},yRot3D(t){return this.mat4(i(t),0,s(t),0,0,1,0,0,-s(t),0,i(t),0,0,0,0,1)},zRot3D(t){return this.mat4(i(t),-s(t),0,0,s(t),i(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,i]=t.dim;if(e==i){for(let s,r=0;r<e;++r)for(let e=0;e<i;++e)if(s=t.cells[r*i+e],r+1==e+1){if(1!=s)return!1}else if(0!=s)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1==Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInv(t)))}}}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/matrix"]=i}(this),function(t,e){"use strict";const i=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-".split(""),s=i.length;function r(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e,n=t=>Math.abs(t)%s,o=t=>i[t],h=t=>i.findIndex((e=>e==t));function a(t,e){let i=e+t;return o(i>=s?i-s:i)}function l(t,e){let i=e-t;return o(i<0?s+i:i)}return{encrypt(t,e){if(0!=e){let i,s=n(e);i=t.split("").map((t=>(i=h(t),i<0?t:((t,e,i)=>t<0?a(e,i):l(e,i))(e,s,i)))),t=i.join("")}return t},decrypt(t,e){if(0!=e){let i,s=n(e);i=t.split("").map((t=>(i=h(t),i<0?t:((t,e,i)=>t<0?l(e,i):a(e,i))(e,s,i)))),t=i.join("")}return t}}}"object"==typeof module&&module.exports?module.exports=r(require("./core")):t["io/czlab/mcfud/crypt"]=r}(this),function(t,e){"use strict";function i(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const i=t[e];i&&i.run&&i.run()},trigger(i="change",s){const r=t[e],n=r&&r.transitions[i];if(n){const i=n.target,o=t[i];if(o)return r.exit&&r.exit(),o.enter&&o.enter(),s&&s.action?s.action():n.action&&n.action(s),e=i}}}}}}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/fsm"]=i}(this),function(t,e){"use strict";function i(e,i,s,r){e||(e=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/vec2"]()),s||(s=t["io/czlab/mcfud/math"]()),r||(r=t["io/czlab/mcfud/matrix"]());const n=2*Math.PI,{u:o}=e;return{setContextTransform:(t,e,i=!1)=>(t[i?"setTransform":"transform"](e.cells[0],e.cells[3],e.cells[1],e.cells[4],e.cells[2],e.cells[5]),t),textStyle:(t,e,i,s,r,n)=>(e&&(t.font=e),s&&(t.fillStyle=s),r&&(t.textAlign=r),n&&(t.textBaseline=n),i&&(t.strokeStyle=i),t),drawShape:(t,e,...i)=>(e&&e.draw&&e.draw(t,...i),t),cfgStyle:(t,e,i,s,r)=>(i&&(t.fillStyle=i),e&&(t.strokeStyle=e),r&&(t.lineCap=r),s&&(t.lineWidth=s),t),drawPoints(t,e){t.beginPath();for(let s,r,n,o=e.length,h=0;h<o;++h)n=(h+1)%o,s=e[h],r=e[n],t.moveTo(i.gx(s),i.gy(s)),t.lineTo(i.gx(r),i.gy(r));return t.closePath(),t.stroke(),t},fillPoints(t,e){t.beginPath();for(let s,r,n,o=e.length,h=0;h<o;++h)n=(h+1)%o,s=e[h],r=e[n],0==h?t.moveTo(i.gx(s),i.gy(s)):t.lineTo(i.gx(s),i.gy(s)),t.lineTo(i.gx(r),i.gy(r));return t.closePath(),t.fill(),t},drawCircle:(t,e,i,s)=>(t.beginPath(),t.arc(e,i,s,0,n,!0),t.closePath(),t.stroke(),t),fillCircle:(t,e,i,s)=>(t.beginPath(),t.arc(e,i,s,0,n,!0),t.closePath(),t.fill(),t),drawRect:(t,e,i,s,r,n=0,o=0,h=0)=>(t.save(),t.translate(o,h),t.rotate(n),t.translate(-o,-h),t.strokeRect(e,i,s,r),t.restore(),t),fillRect:(t,e,i,s,r,n=0,o=0,h=0)=>(t.save(),t.translate(o,h),t.rotate(n),t.translate(-o,-h),t.fillRect(e,i,s,r),t.restore(),t),drawLine:(t,e,i,s,r)=>(t.beginPath(),t.moveTo(e,i),t.lineTo(s,r),t.stroke(),t),drawText:(t,e,i,s)=>(t.strokeText(e,i,s),t),fillText:(t,e,i,s)=>(t.fillText(e,i,s),t),clearCanvas(t){return this.clearRect(t,0,0,t.canvas.width,t.canvas.height)},fillCanvas(t){return this.fillRect(t,0,0,t.canvas.width,t.canvas.height)},clearRect:(t,e,i,s,r)=>(t.clearRect(e,i,s,r),t)}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("./vec2"),require("./math"),require("./matrix")):t["io/czlab/mcfud/gfx"]=i}(this),function(t,e){"use strict";const[i,s,r]=[1,0,-1];function n(e,n,o,h,a){e||(e=t["io/czlab/mcfud/core"]()),n||(n=t["io/czlab/mcfud/math"]()),o||(o=t["io/czlab/mcfud/vec2"]()),h||(h=t["io/czlab/mcfud/matrix"]()),a||(a=t["io/czlab/mcfud/algo/basic"]());const{Stack:l,StdCompare:c}=a,{is:u,u:d}=(Math.floor,e);const f=d.fill(36,undefined);function p(t){d.assert(t.length>2&&t.length<=36,"too little/many vertices");let e=0,i=t[0][0];for(let s,r=1;r<t.length;++r)s=t[r][0],s>i?(i=s,e=r):d.feq(s,i)&&t[r][1]<t[e][1]&&(e=r);let s=0,r=e;for(;;){f[s]=r;let i=0,n=f[s];for(let e,s,h,a=1;a<t.length;++a)i!=r?(e=o.sub(t[i],t[n]),s=o.sub(t[a],t[n]),h=o.cross(e,s),h<0&&(i=a),d.feq0(h)&&o.len2(s)>o.len2(e)&&(i=a)):i=a;if(r=i,++s,i==e)break}const n=[];for(let e=0;e<s;++e)n.push(o.clone(t[f[e]]));return n}class g{constructor(t,e,i,s){switch(arguments.length){case 2:this.pos=o.vec(),this.width=t,this.height=e;break;case 4:this.pos=o.vec(t,e),this.width=i,this.height=s;break;default:throw"Error: bad input to Rect()"}}}class m{constructor(t,e){this.width=t,this.height=e}half(){return new m(n.ndiv(this.width,2),n.ndiv(this.height,2))}}class v{constructor(t,e,i,s){this.p=o.vec(t,e),this.q=o.vec(i,s)}}class _{constructor(t,e=0,i=0){this.pos=o.vec(e,i),this.shape=t}}class w{constructor(){this.orient=0}setOrient(t){throw Error("no implementation")}}class b extends w{constructor(t){super(),this.calcPoints=[],this.normals=[],this.edges=[],this.set(t||[])}set(t){return this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=p(t),this.points.forEach((t=>{this.calcPoints.push(o.vec()),this.edges.push(o.vec()),this.normals.push(o.vec())})),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}moveBy(t,e){return this.points.forEach((i=>{i[0]+=t,i[1]+=e})),this._recalc()}_recalc(){let t=this.points.length;return this.points.forEach(((t,e)=>{o.copy(this.calcPoints[e],t),d.feq0(this.orient)||o.rot$(this.calcPoints[e],this.orient)})),this.points.forEach(((e,i)=>{this.edges[i]=o.sub(this.calcPoints[(i+1)%t],this.calcPoints[i]),this.normals[i]=o.unit(o.normal(this.edges[i]))})),this}}class k{constructor(t,e){this.overlapN=o.vec(),this.overlapV=o.vec(),this.A=t,this.B=e,this.clear()}swap(){let t=new k,e=this.AInB,i=this.BInA,s=this.A;return t.overlap=this.overlap,t.A=this.B,t.B=s,t.AInB=i,t.BInA=e,t.overlapN=o.flip(this.overlapN),t.overlapV=o.flip(this.overlapV),t}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function E(t,e){let i=1/0,s=-1/0;for(let r,n=0;n<t.length;++n)r=o.dot(t[n],e),r<i&&(i=r),r>s&&(s=r);return[i,s]}function N(t,e){let n=o.len2(t),h=o.dot(e,t);return h<0?i:h>n?r:s}function S(t,e,i,s,r,n){let[h,a]=E(e,r),[l,c]=E(s,r),u=o.vecAB(t,i),d=o.dot(u,r);if(l+=d,c+=d,h>c||l>a)return!0;if(n){let t=0;if(h<l)if(n.AInB=!1,a<c)t=a-l,n.BInA=!1;else{let[e,i]=[a-l,c-h];t=e<i?e:-i}else if(n.BInA=!1,a>c)t=h-c,n.AInB=!1;else{let[e,i]=[a-l,c-h];t=e<i?e:-i}let e=Math.abs(t);e<n.overlap&&(n.overlap=e,o.copy(n.overlapN,r),t<0&&o.flip$(n.overlapN))}}function M(t,e,i){let s,r=t.shape.radius+e.shape.radius,n=o.vecAB(t.pos,e.pos),h=o.len2(n),a=!(h>r*r);return a&&i&&(s=Math.sqrt(h),i.A=t,i.B=e,i.overlap=r-s,o.copy(i.overlapN,o.unit$(n)),o.copy(i.overlapV,o.mul(n,i.overlap)),i.AInB=t.shape.radius<=e.shape.radius&&s<=e.shape.radius-t.shape.radius,i.BInA=e.shape.radius<=t.shape.radius&&s<=t.shape.radius-e.shape.radius),a}function O(t,e,s){let n,h=e.shape.radius*e.shape.radius,a=o.vecAB(t.pos,e.pos),l=t.shape.calcPoints,c=o.vec();for(let u,d,f,p,g=l.length,m=0;m<g;++m){u=m==g-1?0:m+1,d=0==m?g-1:m-1,f=0,p=null,o.copy(c,t.shape.edges[m]),n=o.vecAB(l[m],a),s&&o.len2(n)>h&&(s.AInB=!1);let y=N(c,n);if(y===i){if(o.copy(c,t.shape.edges[d]),y=N(c,o.vecAB(l[d],a)),y===r){let t=o.len(n);if(t>e.shape.radius)return!1;s&&(s.BInA=!1,p=o.unit(n),f=e.shape.radius-t)}}else if(y===r){if(o.copy(c,t.shape.edges[u]),o.sub$(o.copy(n,a),l[u]),y=N(c,n),y===i){let t=o.len(n);if(t>e.shape.radius)return!1;s&&(s.BInA=!1,p=o.unit(n),f=e.shape.radius-t)}}else{let t=o.unit$(o.normal(c)),i=o.dot(n,t),r=Math.abs(i);if(i>0&&r>e.shape.radius)return!1;s&&(p=t,f=e.shape.radius-i,(i>=0||f<2*e.shape.radius)&&(s.BInA=!1))}p&&s&&Math.abs(f)<Math.abs(s.overlap)&&(s.overlap=f,o.copy(s.overlapN,p))}return s&&(s.A=t,s.B=e,o.mul$(o.copy(s.overlapV,s.overlapN),s.overlap)),!0}function I(t,e,i){let s=O(e,t,i);if(s&&i){let t=i.A,e=i.AInB;o.flip$(i.overlapN),o.flip$(i.overlapV),i.A=i.B,i.B=t,i.AInB=i.BInA,i.BInA=e}return s}function T(t,e,i){let s=t.shape.calcPoints,r=e.shape.calcPoints;for(let n=0;n<s.length;++n)if(S(t.pos,s,e.pos,r,t.shape.normals[n],i))return!1;for(let n=0;n<r.length;++n)if(S(t.pos,s,e.pos,r,e.shape.normals[n],i))return!1;if(i){if(0==i.overlap||d.feq0(i.overlap))return!1;i.A=t,i.B=e,o.copy(i.overlapV,i.overlapN),o.mul$(i.overlapV,i.overlap)}return!0}class A{static create(){return new A}constructor(){this.identity()}identity(){return this.m=h.matIdentity(3),this}translate(t,e){return this.m=h.matMult(this.m,h.mat3(1,0,t,0,1,e,0,0,1)),this}scale(t,e){return this.m=h.matMult(this.m,h.mat3(t,0,0,0,e,0,0,0,1)),this}shear(t,e){return this.m=h.matMult(this.m,h.mat3(1,t,0,e,1,0,0,0,1)),this}rotateCCW(t,e,i){let s=Math.sin(t),r=Math.cos(t);return void 0!==e&&void 0!==i?(this.translate(-e,-i),this.rotateCCW(t),this.translate(e,i)):this.m=h.matMult(this.m,h.mat3(r,-s,0,s,r,0,0,0,1)),this}rotateCW(t,e,i){let s=Math.sin(t),r=Math.cos(t);return void 0!==e&&void 0!==i?(this.translate(-e,-i),this.rotateCW(t),this.translate(e,i)):this.m=h.matMult(this.m,h.mat3(r,s,0,-s,r,0,0,0,1)),this}transformXY(t,e){let i=[t,e,1];return h.matVMult(this.m,i).length=2,2}transformPoints(t){let e,i=[0,0,1];t.forEach((t=>{u.vec(t)?(i[0]=t[0],i[1]=t[1]):(i[0]=t.x,i[1]=t.y),e=h.matVMult(this.m,i),u.vec(t)?(t[0]=e[0],t[1]=e[1]):(t.x=e[0],t.y=e[1])}))}}class z{constructor(t,e){if(e<t){let i=t;t=e,e=i}d.feq0(t)&&(t=0),d.feq0(e)&&(e=0),this.min=t,this.max=e}min(){return this.min}max(){return this.max}intersects(t){return!(this.max<t.min||t.max<this.min)}contains(t){return this.min<=t&&t<=this.max}length(){return this.max-this.min}static MinEndPtCmp(t,e){return t.min<e.min?-1:t.min>e.min?1:t.max<e.max?-1:t.max>e.max?1:0}static MaxEndPtCmp(t,e){return t.max<e.max?-1:t.max>e.max?1:t.min<e.min?-1:t.min>e.min?1:0}static LenCmp(t,e){let i=t.length(),s=e.length();return i<s?-1:i>s?1:0}static test(){let t=[new z(15,33),new z(45,60),new z(20,70),new z(46,55)];console.log("Unsorted"),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by min endpoint"),t.sort(z.MinEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by max endpoint"),t.sort(z.MaxEndPtCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`))),console.log("Sort by length"),t.sort(z.LenCmp),t.forEach((t=>console.log(`min=${t.min}, max=${t.max}`)))}}class C{static theta(t){return Math.atan2(t[1],t[0])}static angleBetween(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}static ccw(t,e,i){let s=(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0]);return s<0?-1:s>0?1:0}static area2(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(e[1]-t[1])*(i[0]-t[0])}static distTo(t,e){let i=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(i*i+s*s)}static distSqTo(t,e){let i=t[0]-e[0],s=t[1]-e[1];return i*i+s*s}static compareTo(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0}static XOrderCmp(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}static YOrderCmp(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}static ROrderCmp(t,e){let i=t[0]*t[0]+t[1]*t[1]-(e[0]*e[0]+e[1]*e[1]);return i<0?-1:i>0?1:0}static PolarOrderCmp(t){return(e,i)=>{let s=e[0]-t[0],r=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return r>=0&&o<0?-1:o>=0&&r<0?1:d.feq0(r)&&d.feq0(o)?s>=0&&n<0?-1:n>=0&&s<0?1:0:-C.ccw(t,e,i)}}static DistToOrderCmp(t,e){let i=C.distSqTo(t),s=C.distSqTo(e);return i<s?-1:i>s?1:0}static equals(t,e){return e===t||!!e&&(t[0]==e[0]&&t[1]==e[1])}static farthestPair(t){let e,i=[0,0],s=[0,0],r=0,n=-1/0,h=C.calcConvexHull(t);if(!1===h||t.length<=1)return!1;if(e=h.length,h.unshift(null),2==e)i=h[1],s=h[2],r=C.distTo(i,s);else{let t,r=2;for(;C.area2(h[e],h[1],h[r+1])>C.area2(h[e],h[1],h[r]);)++r;t=r;for(let a,l=1;l<=r&&t<=e;++l)for(C.distSqTo(h[l],h[t])>n&&(n=C.distSqTo(h[l],h[t]),o.copy(i,h[l]),o.copy(s,h[t]));t<e&&C.area2(h[l],h[l+1],h[t+1])>C.area2(h[l],h[l+1],h[t]);)++t,a=C.distSqTo(h[l],h[t]),a>n&&(n=C.distSqTo(h[l],h[t]),o.copy(i,h[l]),o.copy(s,h[t]))}return{best1:i,best2:s,bestDistance:Math.sqrt(n)}}static closestPair(t){let e=[0,0],i=[0,0],s=1/0,r=t.slice();const h=t.length;r.sort(C.YOrderCmp),r.sort(C.XOrderCmp);for(let t=0;t<h-1;++t)if(C.equals(r[t],r[t+1]))return o.copy(e,r[t]),o.copy(i,r[t+1]),{bestDistance:0,best1:e,best2:i};let a=r.slice();return function t(r,h,a,l,c){if(c<=l)return 1/0;let u=l+n.ndiv(c-l,2),d=r[u],f=t(r,h,a,l,u),p=t(r,h,a,u+1,c),g=Math.min(f,p);!function(t,e,i,s,r){for(let s=i;s<=r;++s)o.copy(e[s],t[s]);let n=i,h=s+1;for(let a=i;a<=r;++a)n>s?o.copy(t[a],e[h++]):h>r?o.copy(t[a],e[n++]):C.compareTo(e[h],e[n])<0?o.copy(t[a],e[h++]):o.copy(t[a],e[n++])}(h,a,l,u,c);let m=0;for(let t=l;t<=c;++t)Math.abs(h[t][0]-d[0])<g&&o.copy(a[m++],h[t]);for(let t=0;t<m;++t)for(let r,n=t+1;n<m&&a[n][1]-a[t][1]<g;++n)r=C.distTo(a[t],a[n]),r<g&&(g=r,r<s&&(s=g,o.copy(e,a[t]),o.copy(i,a[n])));return g}(r,a,d.fill(h,(()=>[0,0])),0,h-1),{bestDistance:s,best1:e,best2:i}}static calcConvexHull(t){d.assert(t&&t.length>0,"invalid points");let e,i,s,r=t.length,n=d.deepCopyArray(t),h=new l;for(n.sort(C.compareTo),e=n[0],n.shift(),n.sort(C.PolarOrderCmp(e)),n.unshift(e),h.push(n[0]),i=1;i<r&&C.equals(n[0],n[i]);++i);if(i==r)return!1;for(s=i+1;s<r&&0==C.ccw(n[0],n[i],n[s]);++s);h.push(n[s-1]);for(let t,e=s;e<r;++e){for(t=h.pop();C.ccw(h.peek(),t,n[e])<=0;)t=h.pop();h.push(t),h.push(n[e])}let a=new l;for(let t=h.iterator();t.hasNext();)a.push(t.next());r=a.size(),t=[];for(let e=a.iterator();e.hasNext();)t.push(o.clone(e.next()));if(r>2)for(let e=0;e<r;++e)if(C.ccw(t[e],t[(e+1)%r],t[(e+2)%r])<=0)return!1;return t}static test_convexHull(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599\n               4096 20992 21538  2430 21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797\n               8192 28160 16128 20224 14080 20224 26112  7296 20367 20436 7486   422 17835  2689 22016  3200 22016  5248\n               24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224 15104 12032 6144 20992 26112  3200\n               6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161 5120 20992\n               10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596\n               17152 18176 8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224\n               30950  2616 4096 22016 4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371\n               4160 29184 13056 13056 8192 29184 23040  7296 5120 25088 22016  7296 7168 29184 25216  7296 23040  3200\n               4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017 26112  6272 20658  1204 23553 13965\n               13056 14080 14080 12032 24064  7296 21377 26361 17088\n               12032 16128 16128 30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let i=0;i<t.length;i+=2)e.push([t[i],t[i+1]]);e=[[5,15],[5,-20],[-60,10],[70,-10],[-60,-10],[70,10]];let i=C.calcConvexHull(e);!1===i||i.length!=e.length?console.log("not convex!"):i.forEach((t=>{console.log(`${t[0]}, ${t[1]}`)}))}static test_closestPair(){let t="954 11163 1125 11331 1296 11499 1467 11667 1657 11796 1847 11925 2037 12054 2238 12207 2439 12360\n               2640 12513 2878 12523 3116 12533 3354 12543 3518 12493 3682 12443 3846 12393\n               8463 7794 8022 7527 7581 7260 7140 6993 6731 6624 6322 6255 5913 5886\n               5521 5494 5129 5102 4737 4710 4599 5158".split(/\s+/).map((t=>+t)),e=[];for(let i=0;i<t.length;i+=2)e.push([t[i],t[i+1]]);let{bestDistance:i,best1:s,best2:r}=C.closestPair(e);console.log(`bestDist=${i}, p1=${s}, p2=${r}`)}static test_farthestPair(){let t="9230 13137 4096 24064 8192 26112 22016  9344 4440  8028 6505 31422 28462 32343 17152 19200 9561 11599 4096 20992 21538  2430\n               21903 23677 17152 16128 7168 25088 10162 18638 822 32301 16128 12032 18989  3797 8192 28160 16128 20224 14080 20224 26112  7296\n               20367 20436 7486   422 17835  2689 22016  3200 22016  5248 24650 16886 15104 20224 25866  4204 13056 15104 13662 10301 17152 20224\n               15104 12032 6144 20992 26112  3200 6144 29184 13056 12032 8128 20992 5076 19172 17152 17152 823 15895 25216  3200 6071 29161\n               5120 20992 10324 22176 29900  9390 27424  7945 4096 23040 12831 27971 29860 12437 28668  2061 1429 12561 29413   596 17152 18176\n               8192 27136 5120 29184 22016 11392 1444 10362 32011  3140 15731 32661 26112  4224 13120 20224 30950  2616 4096 22016\n               4096 25088 24064  3200 26112  5248 4862 30650 5570  8885 21784 18853 23164 32371 4160 29184 13056 13056 8192 29184 23040  7296\n               5120 25088 22016  7296 7168 29184 25216  7296 23040  3200 4718  4451 14080 16128 7168 20992 19546 17728 13056 16128 17947 17017\n               26112  6272 20658  1204 23553 13965 13056 14080 14080 12032 24064  7296 21377 26361 17088 12032 16128 16128\n               30875 28560 2542 26201 8192 25088 11444 16973".split(/\s+/).map((t=>+t)),e=[];for(let i=0;i<t.length;i+=2)e.push([t[i],t[i+1]]);let{bestDistance:i,best1:s,best2:r}=C.farthestPair(e);console.log(`bestDist=${i}, p1=${s}, p2=${r}`)}}return{Rect:g,Area:m,Line:v,Body:_,Circle:class extends w{constructor(t){super(),this.radius=t}setOrient(t){return this.orient=t,this}},Polygon:b,Manifold:k,C2DMatrix:A,Point2D:C,Interval1D:z,Interval2D:class{constructor(t,e){this.x=t,this.y=e}intersects(t){return!!this.x.intersects(t.x)&&!!this.y.intersects(t.y)}contains(t){return x.contains(t[0])&&y.contains(t[1])}area(){return x.length()*y.length()}},bodyWrap:(t,e,i)=>new _(t,e,i),orderVertices:t=>p(t),polyArea(t,e=!1){let i=e?this.orderVertices(t):t,s=0;for(let t,e,r,n=i.length,o=0;o<n;++o)r=(o+1)%n,t=i[o],e=i[r],s+=t[0]*e[1]-e[0]*t[1];return n.ndiv(Math.abs(s),2)},calcPolygonCenter(t,e=!1){const i=e?this.orderVertices(t):t,s=6*this.polyArea(i);let r=0,h=0;for(let t,e,s,n=0,o=i.length;n<o;++n)s=(n+1)%o,t=i[n],e=i[s],r+=(t[0]+e[0])*(t[0]*e[1]-e[0]*t[1]),h+=(t[1]+e[1])*(t[0]*e[1]-e[0]*t[1]);return o.vec(n.ndiv(r,s),n.ndiv(h,s))},getAABB(t){if(d.assert(t instanceof _,"wanted a body"),d.has(t.shape,"radius"))return new g(t.pos[0]-t.shape.radius,t.pos[1]-t.shape.radius,2*t.shape.radius,2*t.shape.radius);{let e=o.translate(t.pos,t.shape.calcPoints),i=e[0][0],s=e[0][1],r=i,n=s;for(let t,o=1;o<e.length;++o)t=e[o],t[0]<i&&(i=t[0]),t[0]>r&&(r=t[0]),t[1]<s&&(s=t[1]),t[1]>n&&(n=t[1]);return new g(i,s,r-i,n-s)}},shiftPoints:(t,e)=>t.map((t=>o.add(t,e))),rotPoints:(t,e,i)=>t.map((t=>o.rot(t,e,i))),calcRectPoints(t,e){const i=t/2,s=e/2;return[o.vec(i,-s),o.vec(i,s),o.vec(-i,s),o.vec(-i,-s)]},line:(t,e,i,s)=>new v(t,e,i,s),rectEqRect:(t,e)=>t.width==e.width&&t.height==e.height&&t.pos[0]==e.pos[0]&&t.pos[1]==e.pos[1],rectContainsRect:(t,e)=>!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height),rectGetMaxX:t=>t.pos[0]+t.width,rectGetMidX:t=>t.pos[0]+t.width/2,rectGetMinX:t=>t.pos[0],rectGetMaxY:t=>t.pos[1]+t.height,rectGetMidY:t=>t.pos[1]+t.height/2,rectGetMinY:t=>t.pos[1],rectContainsPoint(t,e,i){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&i>=this.rectGetMinY(t)&&i<=this.rectGetMaxY(t)},rectOverlayRect:(t,e)=>!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1]),rectUnion(t,e){const i=Math.min(t.pos[0],e.pos[0]),s=Math.min(t.pos[1],e.pos[1]);return new g(i,s,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-i,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-s)},rectIntersection(t,e){if(this.rectOverlayRect(t,e)){const i=Math.max(t.pos[0],e.pos[0]),s=Math.max(t.pos[1],e.pos[1]);return new g(i,s,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-i,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-s)}},hitTestPointCircle(t,e,i){d.assert(i instanceof _,"wanted a body");let s=t-i.pos[0],r=e-i.pos[1];return s*s+r*r<=i.shape.radius*i.shape.radius},hitCircleCircle(t,e){d.assert(t instanceof _&&e instanceof _,"need bodies");let i=new k;if(M(t,e,i))return i},hitTestCircleCircle:(t,e)=>(d.assert(t instanceof _&&e instanceof _,"need bodies"),M(t,e,new k)),hitPolygonCircle(t,e){d.assert(t instanceof _&&e instanceof _,"need bodies");let i=new k;if(O(t,e,i))return i},hitTestPolygonCircle:(t,e)=>(d.assert(t instanceof _&&e instanceof _,"need bodies"),O(t,e,new k)),hitCirclePolygon(t,e){d.assert(e instanceof _&&t instanceof _,"need bodies");let i=new k;if(I(t,e,i))return i},hitTestCirclePolygon:(t,e)=>(d.assert(e instanceof _&&t instanceof _,"need bodies"),I(t,e,new k)),hitPolygonPolygon(t,e){d.assert(t instanceof _&&e instanceof _,"need bodies");let i=new k;if(T(t,e,i))return i},hitTestPolygonPolygon:(t,e)=>(d.assert(t instanceof _&&e instanceof _,"need bodies"),T(t,e,new k)),hitTestPointInPolygon(t,e,i){let s;for(let r,n,o=i.length,h=0,a=o-1;h<o;)r=i[h],n=i[a],r[1]>e!=n[1]>e&&t<(n[0]-r[0])*(e-r[1])/(n[1]-r[1])+r[0]&&(s=!s),a=h,++h;return s},hitTestPointPolygon(t,e,i){return d.assert(i instanceof _,"wanted a body"),this.hitTestPointInPolygon(t,e,o.translate(i.pos,i.shape.calcPoints))},hitTestLineCircle(t,e,i,s,r){let n,h=o.sub(e,t),a=[i,s],l=o.sub(a,t),c=o.sub(a,e),u=o.len2(l),d=o.dot(l,h)/o.dot(h,h);return n=d>=0&&d<=1?u-d*d*o.len2(h):d<0?u:o.len2(c),[n<r*r]},hitTestLinePolygon(t,e,i){d.assert(i instanceof _,"wanted a body");let s=o.translate(i.pos,i.shape.calcPoints);for(let i=0,r=0;i<s.length;++i){r=i+1,r==s.length&&(r=0);let[n,o]=this.lineIntersect2D(t,e,s[i],s[r]);if(n)return[n,o]}return[!1]},lineIntersect2D(t,e,i,s){let r,n,o=t[0],h=t[1],a=e[0],l=e[1],c=i[0],u=i[1],f=s[0],p=s[1],g=(o-a)*(u-p)-(h-l)*(c-f);return d.feq0(g)?[!1]:(r=(o-c)*(u-p)-(h-u)*(c-f),r/=g,n=(o-c)*(h-l)-(h-u)*(o-a),n/=g,0<=r&&r<=1&&0<=n&&n<=1?[!0,r,[o+r*(a-o),h+r*(l-h)]]:[!1])},lineIntersection2D(t,e,i,s){if(t[1]>s[1]&&e[1]>s[1]&&t[1]>i[1]&&e[1]>i[1]||e[1]<i[1]&&t[1]<i[1]&&e[1]<s[1]&&t[1]<s[1]||t[0]>s[0]&&e[0]>s[0]&&t[0]>i[0]&&e[0]>i[0]||e[0]<i[0]&&t[0]<i[0]&&e[0]<s[0]&&t[0]<s[0])return[!1,0];let r=(t[1]-i[1])*(s[0]-i[0])-(t[0]-i[0])*(s[1]-i[1]),n=(e[0]-t[0])*(s[1]-i[1])-(e[1]-t[1])*(s[0]-i[0]),o=(t[1]-i[1])*(e[0]-t[0])-(t[0]-i[0])*(e[1]-t[1]),h=(e[0]-t[0])*(s[1]-i[1])-(e[1]-t[1])*(s[0]-i[0]),a=r*n,l=o*h;return a>0&&a<n*n&&l>0&&l<h*h?[!0,r/n]:[!1,0]}}}"object"==typeof module&&module.exports?module.exports=n(require("./core"),require("./math"),require("./vec2"),require("./matrix"),require("../algo/basic")):t["io/czlab/mcfud/geo2d"]=n}(this),function(t,e){"use strict";function i(i,s){i||(i=t["io/czlab/mcfud/core"]()),s||(s=t["io/czlab/mcfud/math"]());Math.floor;const{u:r,is:n}=i;return{spatialGrid:(t=320,i=320)=>function(t,i){const o=new Map;return{searchAndExec(t,e){let i,s=t.getSpatial();for(let r,n,h=s.y1;h<=s.y2;++h)if(n=o.get(h))for(let o,a,l=s.x1;l<=s.x2;++l)if(r=n.get(l))for(o=r.values(),a=o.next();!a.done;){if(t!==a.value&&(i=e(t,a.value))){l=h=1/0;break}i=null,a=o.next()}return i},search(t,e=!1){let i,s,r=[],n=t.getSpatial();for(let h=n.y1;h<=n.y2;++h)if(s=o.get(h))for(let o=n.x1;o<=n.x2;++o)(i=s.get(o))&&i.forEach((i=>{(i!==t||e)&&r.push(i)}));return r},engrid(e,r){if(!e)return;let n=e.getBBox(),o=e.getSpatial(),h=s.ndiv(n.x1,t),a=s.ndiv(n.y1,i),l=s.ndiv(n.x2,t),c=s.ndiv(n.y2,i);return o.x1==h&&o.x2==l&&o.y1==a&&o.y2==c||(this.degrid(e),o.x1=h,o.x2=l,o.y1=a,o.y2=c,r||this._register(e)),e},reset(){o.clear()},_register(t){let e=t.getSpatial();if(n.num(e.x1))for(let i,s,n=e.y1;n<=e.y2;++n){o.has(n)||o.set(n,new Map),s=o.get(n);for(let n=e.x1;n<=e.x2;++n)s.has(n)||s.set(n,new Map),i=s.get(n),r.assoc(i,t.getGuid(),t)}},degrid(t){if(t){let i=t.getSpatial();if(n.num(i.x1))for(let e,s,n=i.y1;n<=i.y2;++n)if(s=o.get(n))for(let n=i.x1;n<=i.x2;++n)(e=s.get(n))&&r.dissoc(e,t.getGuid());i.x1=e,i.x2=e,i.y1=e,i.y2=e}}}}(t,i)}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("./math")):t["io/czlab/mcfud/spatial"]=i}(this),function(t,e){"use strict";function i(e,i){e||(e=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]());Math.floor;const{u:s}=e;function r(t,e,o,h,a,l,c){let u=null,d=[],f=i.ndiv(t+e,2),p=i.ndiv(o+h,2);function g(t){function e({x1:t,x2:e,y1:i,y2:s}){let r=[],n=t<f,o=e>f;return i<p&&(n&&r.push(3),o&&r.push(0)),s>p&&(n&&r.push(2),o&&r.push(1)),r}return t.getBBox?e(t.getBBox()):(s.assert(void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2,"wanted bbox for quadtree"),e(t))}const m={x1:t,x2:e,y1:o,y2:h};return{boundingBox:()=>m,subTrees:()=>u,dbg:t=>t(d,u,a,l,c),insert(...i){i.forEach((i=>{u?g(i).forEach((t=>u[t].insert(i))):(d.push(i),d.length>a&&c<l&&(s.assert(null===u),u=[r(f,e,o,p,a,l,c+1),r(f,e,p,h,a,l,c+1),r(t,f,p,h,a,l,c+1),r(t,f,o,p,a,l,c+1)],d.forEach((t=>g(t).forEach((e=>u[e].insert(t))))),d.length=0))}))},remove(t){u?u.forEach((e=>e.remove(t))):s.disj(d,t)},isLeaf:()=>null===u?-1:d.length,prune(){if(u){let t=0,e=0;for(let i,s=0;s<u.length;++s)i=u[s],i.prune(),n=i.isLeaf(),n>=0&&(++t,e+=n);t==u.length&&e<a&&(s.assert(0==d.length,"quadtree wanted zero items"),u.forEach((t=>t._swap(d))),u=null)}},_swap(t){d.forEach((e=>t.push(e))),d.length=0},reset(){d.length=0,u&&u.forEach((t=>t.reset())),u=null},searchAndExec(t,e,i){let s;if(u){let r=g(t);for(let n=0;n<r.length&&(s=u[r[n]].searchAndExec(t,e,i),!s);++n);}else for(let r,n=0;n<d.length&&(r=d[n],i&&r===t||!(s=e(r,t)));++n);return s},search(t,e){const i=new Map,s=[];return e&&i.set(t,null),u&&g(t).forEach((e=>{u[e].search(t).forEach((t=>{i.has(t)||(i.set(t,null),s.push(t))}))})),d.forEach((t=>{i.has(t)||(i.set(t,null),s.push(t))})),i.clear(),s}}}return{quadtree(t,e=12,i=5){const{x1:s,x2:n,y1:o,y2:h}=t;return r(s,n,o,h,e,i,0)}}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("./math")):t["io/czlab/mcfud/qtree"]=i}(this),function(t,e){"use strict";function i(i){i||(i=t["io/czlab/mcfud/core"]());const{u:s}=i;class r{constructor(t,i){this.lastBestMove=e,this.state=e,this.other=i,this.cur=t}clone(t){const e=new r;return e.state=t(this.state),e.lastBestMove=this.lastBestMove,e.other=this.other,e.cur=this.cur,e}}function n(t,e,i,s){return t.evalScore(e,i,s)*(1+.001*i)}function o(t,e,i,r,h,a){if(0==i||t.isOver(e))return{depth:i,value:n(t,e,i,r)};let l=e,c=t.getStateCopier(),u=s.shuffle(t.getNextMoves(e));for(let n,d,f=0;f<u.length;++f)if(d=u[f],t.undoMove||(s.assert(c,"Missing state copier!"),e=l.clone(c)),t.makeMove(e,d),n=o(t,e,i-1,r,{value:-a.value,move:a.move},{value:-h.value,move:h.move}),t.undoMove&&t.unmakeMove(e,d),n.value=-n.value,n.move=d,n.value>h.value&&(h={value:n.value,move:d,depth:n.depth}),h.value>=a.value)return a;return JSON.parse(JSON.stringify(h))}function h(t,e,i,r,o,a){if(0==i||t.isOver(e))return[n(t,e,i,r),null];let l=s.shuffle(t.getNextMoves(e)),c=t.getStateCopier(),u=e,d=-1/0,f=l[0];i==r&&(u.lastBestMove=f);for(let n,p,g=0;g<l.length&&(t.undoMove||(s.assert(c,"Missing state copier!"),e=u.clone(c)),p=l[g],t.makeMove(e,p),n=-h(t,e,i-1,r,-a,-o)[0],t.undoMove&&t.unmakeMove(e,p),d<n&&(d=n,f=p),!(o<n&&(o=n,i==r&&(u.lastBestMove=p),o>=a)));++g);return[d,u.lastBestMove]}const a={algo:"negamax",GFrame:r,GameBoard:class{constructor(){}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}takeGFrame(){}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let i=this.getFirstMove();return s.nichts(i)&&(i=a.evalNegaMax(this)),i}},XXevalNegaMax(t){const e=t.takeGFrame(),i=t.depth;let[r,n]=h(t,e,i,i,-1/0,1/0);return s.nichts(n)&&console.log(`evalNegaMax: score=${r}, pos= ${n}, lastBestMove=${n}`),n},evalNegaMax(t){const e=t.takeGFrame(),i=t.depth;let{value:r,move:n}=o(t,e,i,i,{value:-1/0},{value:1/0});return s.nichts(n)&&console.log(`evalNegaMax: score= ${r}, pos= ${n}`),n}};return a}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/negamax"]=i}(this),function(t,e){"use strict";function i(i){i||(i=t["io/czlab/mcfud/core"]());const{u:s}=i;class r{constructor(t,i){this.state=e,this.other=i,this.cur=t}clone(t){const e=new r;return e.state=t(this.state),e.other=this.other,e.cur=this.cur,e}}const n=(t,e,i,s)=>t.evalScore(e,i,s);function o(t,i,r,h,a,l,c){if(0==r||t.isOver(i))return[n(t,i,r,h),e];let u=i,d=t.getStateCopier(),f=s.shuffle(t.getNextMoves(i));if(c){let e,n,p=f[0],g=-1/0;for(let m=0;m<f.length&&(t.undoMove||(s.assert(d,"Missing state copier!"),i=u.clone(d)),n=f[m],t.makeMove(i,n),e=o(t,i,r-1,h,a,l,!c)[0],t.undoMove&&t.unmakeMove(i,n),e>g&&(g=e,p=n),!(l<=(a=Math.max(e,a))));++m);return[g,p]}{let e,n,p=f[0],g=1/0;for(let m=0;m<f.length&&(t.undoMove||(s.assert(d,"Missing state copier!"),i=u.clone(d)),n=f[m],t.makeMove(i,n),e=o(t,i,r-1,h,a,l,!c)[0],t.undoMove&&t.unmakeMove(i,n),e<g&&(g=e,p=n),!((l=Math.min(e,l))<=a));++m);return[g,p]}}const h={algo:"minimax",GFrame:r,GameBoard:class{constructor(){this.aiActor=e}getStateCopier(){}getFirstMove(t){}getNextMoves(t){}evalScore(t,e,i){}isStalemate(t){}isOver(t,e){}unmakeMove(t,e){if(!this.undoMove)throw Error("Need Implementation");this.switchPlayer(t),this.undoMove(t,e)}makeMove(t,e){if(!this.doMove)throw Error("Need Implementation!");this.doMove(t,e),this.switchPlayer(t)}takeGFrame(){}switchPlayer(t){let e=t.cur;t.cur=t.other,t.other=e}getOtherPlayer(t){return t===this.actors[1]?this.actors[2]:t===this.actors[2]?this.actors[1]:void 0}getPlayer(){return this.actors[0]}run(t,e){this.getAlgoActor=()=>e,this.syncState(t,e);let i=this.getFirstMove();return s.nichts(i)&&(i=h.evalMiniMax(this)),i}},evalMiniMax(t){const e=t.takeGFrame(),i=t.depth;let[r,n]=o(t,e,i,i,-1/0,1/0,!0);return s.nichts(n)&&console.log(`evalMiniMax: score=${r}, pos= ${n}`),n}};return h}"object"==typeof module&&module.exports?module.exports=i(require("./core")):t["io/czlab/mcfud/minimax"]=i}(this),function(t,e){"use strict";function i(i){i||(i=t["io/czlab/mcfud/core"]());const s=(t,e)=>t<e?-1:t>e?1:0,r=Math.floor,{is:n,u:o}=i,h=t=>o.assert(n.num(t)||n.str(t),"expected number or string");function a(t,e=" ",i=""){for(;t.hasNext();)i+=`${t.next()}${e}`;return i}class l{constructor(t){this.current=t}hasNext(){return o.echt(this.current)}remove(){throw Error("Unsupported")}next(){if(!this.hasNext())throw Error("NoSuchElementException");let t=this.current.item;return this.current=this.current.next,t}}function c(t,i=e){return{item:t,next:i}}class u{constructor(){this.first=e,this.n=0}clone(){let t,e=new u,i=this.first;for(;i;)t?(t.next=c(i.item),t=t.next):e.first=t=c(i.item),e.n+=1,i=i.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}add(t){this.first=c(t,this.first),this.n+=1}iter(){return new l(this.first)}static test(){let t=new u;"to be or not to - be - - that - - - is".split(" ").forEach((e=>t.add(e))),console.log("size of bag = "+t.size()),console.log(a(t.iter()));let e=t.clone();console.log("size of cloned = "+e.size()),console.log(a(e.iter()))}}class d{constructor(){this.first=e,this.n=0}clone(){let t,e=new d,i=this.first;for(;i;)t?(t.next=c(i.item),t=t.next):e.first=t=c(i.item),e.n+=1,i=i.next;return e}isEmpty(){return o.nichts(this.first)}size(){return this.n}push(t){this.first=c(t,this.first),this.n+=1}pop(){if(this.isEmpty())throw Error("Stack underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,t}peek(){if(this.isEmpty())throw Error("Stack underflow");return this.first.item}toString(){return a(this.iter())}iter(){return new l(this.first)}static test(){let t=new d;"to be or not to - be - - that - - - is".split(" ").forEach((e=>{"-"!=e?t.push(e):t.isEmpty()||console.log("(-)"+t.pop()+" ")})),console.log("("+t.size()+" left on stack)");let e=t.clone();console.log("cloned= "+a(e.iter())),console.log("("+e.size()+" left on stack)")}}class f{constructor(){this.first=e,this.last=e,this.n=0}clone(){let t=new f,e=this.first;for(;e;)t.enqueue(e.item),e=e.next;return t}isEmpty(){return o.nichts(this.first)}size(){return this.n}peek(){if(this.isEmpty())throw Error("Queue underflow");return this.first.item}enqueue(t){let e=this.last;this.last=c(t),this.isEmpty()?this.first=this.last:e.next=this.last,this.n+=1}dequeue(){if(this.isEmpty())throw Error("Queue underflow");let t=this.first.item;return this.first=this.first.next,this.n-=1,this.isEmpty()&&(this.last=e),t}toString(){return a(this.iter())}iter(){return new l(this.first)}static test(){let t=new f;"to be or not to - be - - that - - - is".split(/\s+/).forEach((e=>{"-"!=e?t.enqueue(e):t.isEmpty()||console.log(t.dequeue()+" ")})),console.log("("+t.size()+" left on queue)");let e=t.clone();console.log("cloned= "+a(e.iter())),console.log("("+e.size()+" left on queue)")}}class p{constructor(t){this.compare=t||s,this.root=e,this.n=0}size(){return this.n}contains(t){return void 0!==this.get(t)}get(t){const e=(t,i,s)=>{if(i){let r=this.compare(t,i.key);s=r<0?e(t,i.left):r>0?e(t,i.right):i.value}return s};if(h(t)&&this.n>0)return e(t,this.root)}set(t,e){const i=(t,e,s)=>{if(!s)return this.n+=1,{key:t,value:e};let r=this.compare(t,s.key);return r<0?s.left=i(t,e,s.left):r>0?s.right=i(t,e,s.right):s.value=e,s};h(t)&&void 0!==e&&(this.root=i(t,e,this.root))}_getMaxNode(t){for(;t&&t.right;)t=t.right;return t}_getMaxKey(){let t=this._getMaxNode(this.root);if(t)return t.key}_getMinNode(t){for(;t&&t.left;)t=t.left;return t}_getMinKey(){let t=this._getMinNode(this.root);if(t)return t.key}remove(t){const i=(t,s)=>{if(s){let r,n,o,h=this.compare(t,s.key);h<0?s.left=i(t,s.left):h>0?s.right=i(t,s.right):s.left&&s.right?(o=this._getMaxNode(s.left),r=o.key,n=o.value,o.value=s.value,o.key=s.key,s.key=r,s.value=n,s.left=i(t,s.left)):s.left?(s=s.left,this.n-=1):s.right?(s=s.right,this.n-=1):(s=e,this.n-=1)}return s};h(t)&&(this.root=i(t,this.root))}keys(){let t=new f;return this.forEach(((e,i)=>t.enqueue(i))),t.iter()}firstKey(){let t;try{this.forEach(((e,i)=>{throw t=i,Error("????")}))}catch(t){}return t}lastKey(){let t;return this.forEach(((e,i)=>{t=i})),t}forEach(t,e){function i(t,e){return e&&e.apply(t,Array.prototype.slice.call(arguments,2))}!function t(e,s,r,n){if(!e)return i(r,n);t(e.left,s,r,(function(){i(r,s,e.value,e.key),t(e.right,s,r,(function(){i(r,n)}))}))}(this.root,t,e)}static test(){let t=new p;t.set(3,"3"),t.set(2,"2"),t.set(7,"7"),t.set(1,"1"),console.log(`firstKey= ${t.firstKey()}`),console.log(`lastKey= ${t.lastKey()}`),console.log(a(t.keys())),console.log(`k= ${t.get(3)}`),console.log(`has 2 = ${t.contains(2)}`),console.log(`has size = ${t.size()}`),t.remove(1),console.log(`has size = ${t.size()}`),console.log(a(t.keys())),console.log(`k= ${t.get(2)}`)}}class g{constructor(){this.st=new p}get(t){if(o.nichts(t))throw Error("calls get() with null key");return this.st.get(t)}put(t,e){if(o.nichts(t))throw Error("calls put() with null key");void 0===e?this.st.remove(t):this.st.set(t,e)}remove(t){if(o.nichts(t))throw Error("calls remove() with null key");this.st.remove(t)}contains(t){if(o.nichts(t))throw Error("calls contains() with null key");return this.st.contains(t)}size(){return this.st.size()}isEmpty(){return 0==this.size()}keys(){return this.st.keys()}min(){if(this.isEmpty())throw Error("calls min() with empty symbol table");return this.st.firstKey()}max(){if(this.isEmpty())throw Error("calls max() with empty symbol table");return this.st.lastKey()}ceiling(t){if(o.nichts(t))throw Error("argument to ceiling() is null");let e,i,s=this.st.keys();for(;s.hasNext();)if(i=s.next(),i==t||i>t){e=i;break}if(void 0===e)throw Error("argument to ceiling() is too large");return e}floor(t){if(o.nichts(t))throw Error("argument to floor() is null");let e,i,s=this.st.keys();for(;s.hasNext();)i=s.next(),(i==t||i<t)&&(e=i);if(void 0===e)throw Error("argument to floor() is too small");return e}static test(){let t=new g;t.put("a",1),t.put("g",9),t.put("c",3),t.put("j",10),t.put("z",26),t.put("x",24),console.log(`isEmpty= ${t.isEmpty()}`),console.log(`size= ${t.size()}`),console.log(`get-c= ${t.get("c")}`),console.log(`contains z= ${t.contains("z")}`),console.log(`contains m= ${t.contains("m")}`),console.log(a(t.keys())),console.log(`ceil w= ${t.ceiling("w")}`),console.log(`floor k= ${t.floor("k")}`),console.log(`min = ${t.min()}`),console.log(`max = ${t.max()}`),t.remove("x"),console.log(a(t.keys()))}}class m{static M=4;Node(t){return{m:t,children:new Array(m.M)}}Entry(t,i,s=e){return{key:t,val:i,next:s}}constructor(t){this.root=this.Node(0),this.compare=t,this._height=0,this.n=0}isEmpty(){return 0==this.size()}size(){return this.n}height(){return this._height}get(t){if(o.nichts(t))throw Error("argument to get() is null");return this._search(this.root,t,this._height)}_search(t,e,i){let s=t.children;if(0==i){for(let i=0;i<t.m;++i)if(0==this.compare(e,s[i].key))return s[i].val}else for(let r=0;r<t.m;++r)if(r+1==t.m||this.compare(e,s[r+1].key)<0)return this._search(s[r].next,e,i-1)}put(t,e){if(o.nichts(t))throw Error("argument key to put() is null");let i,s=this._insert(this.root,t,e,this._height);this.n+=1,s&&(i=this.Node(2),i.children[0]=this.Entry(this.root.children[0].key,null,this.root),i.children[1]=this.Entry(s.children[0].key,null,s),this.root=i,this._height+=1)}_insert(t,e,i,s){let r,n=this.Entry(e,i);if(0==s)for(r=0;r<t.m&&!(this.compare(e,t.children[r].key)<0);++r);else for(r=0;r<t.m;++r)if(r+1==t.m||this.compare(e,t.children[r+1].key)<0){let o=this._insert(t.children[r++].next,e,i,s-1);if(!o)return null;n.key=o.children[0].key,n.val=null,n.next=o;break}for(let e=t.m;e>r;--e)t.children[e]=t.children[e-1];if(t.children[r]=n,t.m++,t.m>=m.M)return this._split(t)}_split(t){let e=r(m.M/2),i=this.Node(e);t.m=e;for(let s=0;s<e;++s)i.children[s]=t.children[e+s];return i}toString(){return function t(e,i,s){let r="",n=e.children;if(0==i)for(let t=0;t<e.m;++t)r+=`${s}${n[t].key} ${n[t].val}\n`;else for(let o=0;o<e.m;++o)o>0&&(r+=`${s}(${n[o].key})\n`),r+=t(n[o].next,i-1,s+"     ");return r}(this.root,this._height,"")+"\n"}static test(){let t=new m(s);t.put("www.cs.princeton.edu","128.112.136.12"),t.put("www.cs.princeton.edu","128.112.136.11"),t.put("www.princeton.edu","128.112.128.15"),t.put("www.yale.edu","130.132.143.21"),t.put("www.simpsons.com","209.052.165.60"),t.put("www.apple.com","17.112.152.32"),t.put("www.amazon.com","207.171.182.16"),t.put("www.ebay.com","66.135.192.87"),t.put("www.cnn.com","64.236.16.20"),t.put("www.google.com","216.239.41.99"),t.put("www.nytimes.com","199.239.136.200"),t.put("www.microsoft.com","207.126.99.140"),t.put("www.dell.com","143.166.224.230"),t.put("www.slashdot.org","66.35.250.151"),t.put("www.espn.com","199.181.135.201"),t.put("www.weather.com","63.111.66.11"),t.put("www.yahoo.com","216.109.118.65"),console.log("cs.princeton.edu:  "+t.get("www.cs.princeton.edu")),console.log("hardvardsucks.com: "+t.get("www.harvardsucks.com")),console.log("simpsons.com:      "+t.get("www.simpsons.com")),console.log("apple.com:         "+t.get("www.apple.com")),console.log("ebay.com:          "+t.get("www.ebay.com")),console.log("dell.com:          "+t.get("www.dell.com")),console.log(""),console.log("size:    "+t.size()),console.log("height:  "+t.height()),console.log(t.toString()),console.log("")}}class y{constructor(t){this.d=t,this.st=new g}put(t,e){if(t<0||t>=this.d)throw Error("Illegal index");o.feq0(e)?this.st.remove(t):this.st.put(t,e)}get(t){if(t<0||t>=this.d)throw Error("Illegal index");return this.st.contains(t)?this.st.get(t):0}nnz(){return this.st.size()}dimension(){return this.d}dot(t){if(o.assert(t instanceof y,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e,i=0,s=(this.st.size()<=t.st.size()?this:t).st.keys();for(;s.hasNext();)e=s.next(),t.st.contains(e)&&(i+=this.get(e)*t.get(e));return i}dotWith(t){let e=0;for(let i,s=this.st.keys();s.hasNext();)i=s.next(),e+=t[i]*this.get(i);return e}magnitude(){return Math.sqrt(this.dot(this))}scale(t){let e=new y(this.d);for(let i,s=this.st.keys();s.hasNext();)i=s.next(),e.put(i,t*this.get(i));return e}plus(t){if(o.assert(t instanceof y,"expected SparseVector data"),this.d!=t.d)throw Error("Vector lengths disagree");let e=new y(this.d);for(let t,i=this.st.keys();i.hasNext();)t=i.next(),e.put(t,this.get(t));for(let i,s=t.st.keys();s.hasNext();)i=s.next(),e.put(i,t.get(i)+e.get(i));return e}toString(){let t="";for(let e,i=this.st.keys();i.hasNext();)e=i.next(),t+=`(${e}, ${this.st.get(e)}) `;return t}static test(){let t=new y(10),e=new y(10);t.put(3,.5),t.put(9,.75),t.put(6,.11),t.put(6,0),e.put(3,.6),e.put(4,.9),console.log("a = "+t.toString()),console.log("b = "+e.toString()),console.log("a dot b = "+t.dot(e)),console.log("a + b   = "+t.plus(e).toString())}}return{prnIter:a,StdCompare:s,BTree:m,Bag:u,Stack:d,Queue:f,ST:g,TreeMap:p,SparseVector:y,Iterator:l}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core")):t["io/czlab/mcfud/algo/basic"]=i}(this),function(t,e){"use strict";function i(i,s){i||(i=t["io/czlab/mcfud/core"]()),s||(s=t["io/czlab/mcfud/algo/basic"]());const{prnIter:r,Bag:n,Stack:o,Iterator:h,StdCompare:a}=s,l=Math.floor,{is:c,u:u}=i;function d(t,e,i,s,r){u.assert(t>e,"bad resize capacity");let n,o=new Array(t);for(n=i;n<s;++n)o[n]=r[n];return o}const f=(t,e,i)=>i(t,e)<0;function p(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function g(t){let e,i="";for(e=0;e<t.length;++e)i+=`${t[e]} `;console.log(i)}class m{static sort(t,e){const i=t.length;for(let s=1;s<i;++s)for(let i=s;i>0&&f(t[i],t[i-1],e);--i)p(t,i,i-1);return t}static sortRange(t,e,i,s){for(let r=e+1;r<i;++r)for(let i=r;i>e&&f(t[i],t[i-1],s);--i)p(t,i,i-1);return t}static indexSort(t,e){const i=t.length,s=u.fill(i,(t=>t));for(let r=1;r<i;++r)for(let i=r;i>0&&f(t[s[i]],t[s[i-1]],e);--i)p(s,i,i-1);return s}static test(){let t="SORTEXAMPLE".split("");g(m.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(m.sortRange(t,0,t.length,a)),t="SORTEXAMPLE".split(""),g(m.indexSort(t,a))}}class y{static sort(t,e){let i,s,r,n=t.length;for(let o,h=1;h<n;++h){for(s=0,r=h,o=t[h];s<r;)i=s+u.ndiv(r-s,2),f(o,t[i],e)?r=i:s=i+1;for(let e=h;e>s;--e)t[e]=t[e-1];t[s]=o}return t}static test(){let t="SORTEXAMPLE".split("");g(y.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(y.sort(t,a))}}class v{static sort(t,e){let i,s=t.length;for(let r=0;r<s;++r){i=r;for(let n=r+1;n<s;++n)f(t[n],t[i],e)&&(i=n);p(t,r,i)}return t}static test(){let t="SORTEXAMPLE".split("");g(v.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(v.sort(t,a))}}class x{static sort(t,e){let i=t.length,s=1,r=u.ndiv(i,3);for(;s<r;)s=3*s+1;for(;s>=1;){for(let r=s;r<i;++r)for(let i=r;i>=s&&f(t[i],t[i-s],e);i-=s)p(t,i,i-s);s=u.ndiv(s,3)}return t}static test(){let t="SORTEXAMPLE".split("");g(x.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(x.sort(t,a))}}function _(t,e,i,s,r,n){if(r<=s);else{let o=s+u.ndiv(r-s,2);_(t,e,i,s,o,n),_(t,e,i,o+1,r,n),function(t,e,i,s,r,n,o){for(let t=s;t<=n;++t)i[t]=e[t];let h=s,a=r+1;for(let l=s;l<=n;++l)h>r?e[l]=i[a++]:a>n?e[l]=i[h++]:f(t[i[a]],t[i[h]],o)?e[l]=i[a++]:e[l]=i[h++]}(t,e,i,s,o,r,n)}return t}class w{static sort(t,e){return function t(e,i,s,r,n){if(r<=s);else{let o=s+u.ndiv(r-s,2);t(e,i,s,o,n),t(e,i,o+1,r,n),function(t,e,i,s,r,n){for(let s=i;s<=r;++s)e[s]=t[s];let o=i,h=s+1;for(let a=i;a<=r;++a)o>s?t[a]=e[h++]:h>r?t[a]=e[o++]:f(e[h],e[o],n)?t[a]=e[h++]:t[a]=e[o++]}(e,i,s,o,r,n)}return e}(t,new Array(t.length),0,t.length-1,e),t}static indexSort(t,e){let i=t.length,s=u.fill(i,(t=>t));return _(t,s,new Array(i),0,i-1,e),s}static test(){let t="SORTEXAMPLE".split("");g(w.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(w.sort(t,a)),t="SORTEXAMPLE".split(""),g(w.indexSort(t,a))}}class b{static sort(t,e){const i=t.length;for(let s,r=0;r<i;++r){s=0;for(let n=i-1;n>r;--n)f(t[n],t[n-1],e)&&(p(t,n,n-1),++s);if(0==s)break}return t}static test(){let t="bed bug dad yes zoo all bad yet".split(" ");b.sort(t,a),g(t)}}function k(t,e,i,s){let r=e,n=t[e],o=i+1;for(;;){for(;f(t[++r],n,s)&&r!=i;);for(;f(n,t[--o],s)&&o!=e;);if(r>=o)break;p(t,r,o)}return p(t,e,o),o}class E{static sort(t,e){return function t(e,i,s,r){if(s<=i);else{let n=k(e,i,s,r);t(e,i,n-1,r),t(e,n+1,s,r)}return e}(t,0,t.length-1,e),t}static select(t,e,i){if(e<0||e>=t.length)throw Error(`index is not between 0 and ${t.length}: ${e}`);let s=0,r=t.length-1;for(;r>s;){let n=k(t,s,r,i);if(n>e)r=n-1;else{if(!(n<e))return t[n];s=n+1}}return t[s]}static test(){let t="bed bug dad yes zoo all bad yet".split(" ");g(E.sort(t,a)),t="SORTEXAMPLE".split(""),g(E.sort(t,a)),u.shuffle(t),t.forEach(((e,i)=>console.log(E.select(t,i,a))))}}const N=(t,e,i,s)=>f(t[e],t[i],s);class S{Node(t){return{key:t,order:0}}constructor(t,i){this.compare=t,this.table=new Map,this.head=e,this._min=e,this.n=0,c.vec(i)&&i.forEach((t=>this.insert(t)))}isEmpty(){return 0==this.n}size(){return this.n}insert(t){let e=this.Node(t);this.n+=1,this.head=this._insertNode(e,this.head),this._min=this._min?this._greater(this._min.key,t)?this.head:this._min:this.head}min(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.key}delMin(){if(this.isEmpty())throw Error("Priority queue is empty");this.head=this._cut(this._min,this.head);let t=this._min.child,i=this._min.key;return this._min.key=e,t&&(this.head=this._meld(this.head,t),this._min.child=e),this.n-=1,this.isEmpty()?this._min=e:this._consolidate(),i}union(t){return this.head=this._meld(this.head,t.head),this._min=this._greater(this._min.key,t._min.key)?t._min:this._min,this.n=this.n+t.n,this}_greater(t,e){return!u.nichts(t)&&(!!u.nichts(e)||this.compare(t,e)>0)}_link(t,e){e.child=this._insertNode(t,e.child),e.order+=1}_consolidate(){this.table.clear();let t=this.head,i=e,s=e,r=0;this._min=this.head;do{for(i=t,t=t.next,s=this.table.get(i.order);s;)this.table.delete(i.order),this._greater(i.key,s.key)?(this._link(i,s),i=s):this._link(s,i),s=this.table.get(i.order);this.table.set(i.order,i),i.order>r&&(r=i.order)}while(t!==this.head);this.head=null,this.table.forEach((t=>{t&&(this._min=this._greater(this._min.key,t.key)?t:this._min,this.head=this._insertNode(t,this.head))}))}_insertNode(t,e){return e?(e.prev.next=t,t.next=e,t.prev=e.prev,e.prev=t):(t.prev=t,t.next=t),t}_cut(t,i){if(t.next===t)return t.next=e,t.prev=e,e;{t.next.prev=t.prev,t.prev.next=t.next;let s=t.next;return t.next=e,t.prev=e,i===t?s:i}}_meld(t,e){return t?e?(t.prev.next=e.next,e.next.prev=t.prev,t.prev=e,e.next=t,t):t:e}iter(){let t=new S(this.compare),e=i=>{if(!i)return;let s=i;do{t.insert(s.key),e(s.child),s=s.next}while(s!==i)};return e(this.head),{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t="",e=new S(a);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ",e.isEmpty(),console.log(t),console.log("min= "+e.min()),console.log(r(e.iter())),console.log("("+e.size()+" left on pq)");let i=new S(a);"ZTAK".split("").forEach((t=>i.insert(t))),i=i.union(e),console.log(r(i.iter()))}}class M{Node(t){return{key:t,order:0,index:0}}constructor(t,i){if(t<0)throw Error("Cannot create a priority queue of negative size");this.maxN=t,this.n=0,this.head=e,this._min=e,this.compare=i,this.table=new Map,this.nodes=new Array(t)}isEmpty(){return 0==this.n}contains(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");return u.echt(this.nodes[t])}size(){return this.n}insert(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(this.contains(t))throw Error("Specified index is already in the queue");let i=this.Node(e);i.index=t,this.nodes[t]=i,this.n+=1,this.head=this._insertNode(i,this.head),this._min=this._min?this._greater(this._min.key,e)?this.head:this._min:this.head}minIndex(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.index}min(){if(this.isEmpty())throw Error("Priority queue is empty");return this._min.key}delMin(){if(this.isEmpty())throw Error("Priority queue is empty");this.head=this._cutNode(this._min,this.head);let t=this._min.child,i=this._min.index;if(this._min.key=e,t){do{t.parent=e,t=t.next}while(t!==this._min.child);this.head=this._meld(this.head,t),this._min.child=e}return this.n-=1,this.isEmpty()?this._min=e:this._consolidate(),this.nodes[i]=e,i}keyOf(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");return this.nodes[t].key}changeKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");this._greater(e,this.nodes[t].key)?this.increaseKey(t,e):this.decreaseKey(t,e)}decreaseKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");if(this._greater(e,this.nodes[t].key))throw Error("Calling with this argument would not decrease the key");let i=this.nodes[t];i.key=e,this._greater(this._min.key,e)&&(this._min=i),i.parent&&this._greater(i.parent.key,e)&&this._cut(t)}increaseKey(t,e){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");if(this._greater(this.nodes[t].key,e))throw Error("Calling with this argument would not increase the key");this.delete(t),this.insert(t,e)}delete(t){if(t<0||t>=this.maxN)throw Error("IllegalArgumentException");if(!this.contains(t))throw Error("Specified index is not in the queue");let i=this.nodes[t];if(i.key=null,i.parent&&this._cut(t),this.head=this._cutNode(i,this.head),i.child){let t=i.child;i.child=e,i=t;do{t.parent=e,t=t.next}while(t!==i);this.head=this._meld(this.head,t)}this.isEmpty()?this._min=e:this._consolidate(),this.nodes[t]=e,this.n-=1}_greater(t,e){return!u.nichts(t)&&(!!u.nichts(e)||this.compare(t,e)>0)}_link(t,e){t.parent=e,e.child=this._insertNode(t,e.child),e.order+=1}_cut(t){let i=this.nodes[t],s=i.parent;s.child=this._cutNode(i,s.child),i.parent=e,s.order-=1,this.head=this._insertNode(i,this.head),s.mark=!s.mark,!s.mark&&s.parent&&this._cut(s.index)}_consolidate(){let t=e,i=e,s=0,r=this.head;this.table.clear(),this._min=this.head;do{for(t=r,r=r.next,i=this.table.get(t.order);i;)this.table.delete(t.order),this._greater(t.key,i.key)?(this._link(t,i),t=i):this._link(i,t),i=this.table.get(t.order);this.table.set(t.order,t),t.order>s&&(s=t.order)}while(r!==this.head);this.head=e,this.table.forEach((t=>{this._min=this._greater(this._min.key,t.key)?t:this._min,this.head=this._insertNode(t,this.head)}))}_insertNode(t,e){return e?(e.prev.next=t,t.next=e,t.prev=e.prev,e.prev=t):(t.prev=t,t.next=t),t}_cutNode(t,i){if(t.next===t)return t.next=e,t.prev=e,e;{t.next.prev=t.prev,t.prev.next=t.next;let s=t.next;return t.next=e,t.prev=e,i===t?s:i}}_meld(t,e){return t?e?(t.prev.next=e.next,e.next.prev=t.prev,t.prev=e,e.next=t,t):t:e}iter(){let t=new M(this.maxN,this.compare);return this.nodes.forEach((e=>{e&&t.insert(e.index,e.key)})),{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new M(t.length,a);for(let i=0;i<t.length;++i)e.insert(i,t[i]);for(console.log("min= "+e.min()),console.log("minindex= "+e.minIndex()),console.log("size= "+e.size()),console.log("contains(3)="+e.contains(3)),console.log("keyOf(3)="+e.keyOf(3)),e.changeKey(3,"bbbb");!e.isEmpty();){let t=e.minIndex();console.log(t+" "+e.keyOf(t)),e.delMin()}console.log("");for(let i=0;i<t.length;++i)e.insert(i,t[i]);for(let i,s=e.iter();s.hasNext();)i=s.next(),console.log(i+" "+t[i]);for(;!e.isEmpty();)e.delMin()}}class O{constructor(t,e){if(this.comparator=t,this.n=0,c.vec(e)){this.pq=new Array(e.length+1),this.n=e.length;for(let t=0;t<this.n;++t)this.pq[t+1]=e[t];for(let t=l(this.n/2);t>=1;--t)this._sink(t,this)}else this.pq=new Array(c.num(e)?e:2);u.assert(this._isMinHeap(),"not min heap")}isEmpty(){return 0==this.n}size(){return this.n}min(){if(this.isEmpty())throw Error("Priority queue underflow");return this.pq[1]}insert(t){this.n==this.pq.length-1&&(this.pq=d(2*this.pq.length,this.n,1,this.n+1,this.pq)),this.pq[++this.n]=t,this._swim(this.n),u.assert(this._isMinHeap(),"not min heap-insert")}delMin(){if(this.isEmpty())throw Error("Priority queue underflow");let t=this.pq[1];return p(this.pq,1,this.n--),this._sink(1),this.pq[this.n+1]=e,this.n>0&&this.n==u.ndiv(this.pq.length-1,4)&&(this.pq=d(u.ndiv(this.pq.length,2),this.n,1,this.n+1,this.pq)),t}_swim(t){for(;t>1&&this._greater(u.ndiv(t,2),t);)p(this.pq,t,u.ndiv(t,2)),t=u.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._greater(e,e+1)&&e++,!this._greater(t,e))break;p(this.pq,t,e),t=e}}_greater(t,e){return this.comparator(this.pq[t],this.pq[e])>0}_isMinHeap(){for(let t=1;t<=this.n;++t)if(u.nichts(this.pq[t]))return!1;for(let t=this.n+1;t<this.pq.length;++t)if(!u.nichts(this.pq[t]))return!1;return!u.echt(this.pq[0])&&this._isMinHeapOrdered(1)}_isMinHeapOrdered(t){if(t>this.n)return!0;let e=2*t,i=2*t+1;return!(e<=this.n&&this._greater(t,e))&&(!(i<=this.n&&this._greater(t,i))&&(this._isMinHeapOrdered(e)&&this._isMinHeapOrdered(i)))}iter(){let t=new O(this.comparator,this.size());for(let e=1;e<=this.n;++e)t.insert(this.pq[e]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t="",e=new O(a);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMin()+" ",console.log(t),console.log("("+e.size()+" left on pq)")}}class I{constructor(t,e){if(this.comparator=t,this.n=0,c.vec(e)){this.pq=new Array(e.length+1),this.n=e.length;for(let t=0;t<this.n;++t)this.pq[t+1]=e[t];for(let t=l(this.n/2);t>=1;--t)this._sink(t)}else this.pq=new Array(c.num(e)?e:2);u.assert(this._isMaxHeap(),"not max heap")}isEmpty(){return 0==this.n}size(){return this.n}max(){if(this.isEmpty())throw Error("Priority queue underflow");return this.pq[1]}insert(t){this.n==this.pq.length-1&&(this.pq=d(2*this.pq.length,this.n,1,this.n+1,this.pq)),this.n+=1,this.pq[this.n]=t,this._swim(this.n),u.assert(this._isMaxHeap(),"not max heap-insert")}delMax(){if(this.isEmpty())throw Error("Priority queue underflow");let t=this.pq[1];return p(this.pq,1,this.n),this.n-=1,this._sink(1),this.pq[this.n+1]=null,this.n>0&&this.n==u.ndiv(this.pq.length-1,4)&&(this.pq=d(u.ndiv(this.pq.length,2),this.n,1,this.n+1,this.pq)),t}_isMaxHeap(){for(let t=1;t<=this.n;++t)if(u.nichts(this.pq[t]))return!1;for(let t=this.n+1;t<this.pq.length;++t)if(u.echt(this.pq[t]))return!1;return!u.echt(this.pq[0])&&this._isMaxHeapOrdered(1)}_isMaxHeapOrdered(t){if(t>this.n)return!0;let e=2*t,i=2*t+1;return!(e<=this.n&&N(this.pq,t,e,this.comparator))&&(!(i<=this.n&&N(this.pq,t,i,this.comparator))&&(this._isMaxHeapOrdered(e)&&this._isMaxHeapOrdered(i)))}_swim(t){for(;t>1&&N(this.pq,u.ndiv(t,2),t,this.comparator);)p(this.pq,t,u.ndiv(t,2)),t=u.ndiv(t,2)}_sink(t){let e;for(;2*t<=this.n&&(e=2*t,e<this.n&&N(this.pq,e,e+1,this.comparator)&&++e,N(this.pq,t,e,this.comparator));)p(this.pq,t,e),t=e}iter(){const t=new I(this.comparator,this.size());for(let e=1;e<=this.n;++e)t.insert(this.pq[e]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMax()}}}static test(){let t="",e=new I(a);"PQE".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ","XAM".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ","PLE".split("").forEach((t=>e.insert(t))),t+=e.delMax()+" ",console.log(t),console.log("("+e.size()+" left on pq)")}}function T(t,e,i,s){return s(t[e-1],t[i-1])<0}function A(t,e,i){const s=t[e-1];t[e-1]=t[i-1],t[i-1]=s}class z{static sort(t,e){function i(t,e,i,s){for(;2*e<=i;){let r=2*e;if(r<i&&T(t,r,r+1,s)&&++r,!T(t,e,r,s))break;A(t,e,r),e=r}}let s,r=t.length;for(s=u.ndiv(r,2);s>=1;--s)i(t,s,r,e);for(s=r;s>1;)A(t,1,s--),i(t,1,s,e);return t}static test(){let t="SORTEXAMPLE".split("");g(z.sort(t,a)),t="bed bug dad yes zoo all bad yet".split(" "),g(z.sort(t,a))}}class C{constructor(t,e){if(t<0)throw Error("IllegalArgumentException");this.compare=e,this.maxN=t,this.n=0,this.mKeys=new Array(t+1),this.pq=new Array(t+1),this.qp=new Array(t+1);for(let e=0;e<=t;++e)this.qp[e]=-1}isEmpty(){return 0==this.n}contains(t){return this._validateIndex(t),-1!=this.qp[t]}size(){return this.n}insert(t,e){if(this._validateIndex(t),this.contains(t))throw Error("index is already in the priority queue");++this.n,this.qp[t]=this.n,this.pq[this.n]=t,this.mKeys[t]=e,this._swim(this.n)}minIndex(){if(0==this.n)throw Error("Priority queue underflow");return this.pq[1]}minKey(){if(0==this.n)throw Error("Priority queue underflow");return this.mKeys[this.pq[1]]}delMin(){if(0==this.n)throw Error("Priority queue underflow");let t=this.pq[1];return this._exch(1,this.n--),this._sink(1),u.assert(t==this.pq[this.n+1],"No good"),this.qp[t]=-1,this.mKeys[t]=null,this.pq[this.n+1]=-1,t}keyOf(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");return this.mKeys[t]}changeKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t]),this._sink(this.qp[t])}decreaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let i=this.compare(this.mKeys[t],e);if(0==i)throw Error("Calling decreaseKey() with a key equal to the key in the priority queue");if(i<0)throw Error("Calling decreaseKey() with a key strictly greater than the key in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t])}increaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let i=this.compare(this.mKeys[t],e);if(0==i)throw Error("Calling increaseKey() with a key equal to the key in the priority queue");if(i>0)throw Error("Calling increaseKey() with a key strictly less than the key in the priority queue");this.mKeys[t]=e,this._sink(this.qp[t])}delete(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let i=this.qp[t];this._exch(i,this.n--),this._swim(i),this._sink(i),this.mKeys[t]=e,this.qp[t]=-1}_validateIndex(t){if(t<0)throw Error("index is negative: "+t);if(t>=this.maxN)throw Error("index >= capacity: "+t)}_greater(t,e){return this.compare(this.mKeys[this.pq[t]],this.mKeys[this.pq[e]])>0}_exch(t,e){let i=this.pq[t];this.pq[t]=this.pq[e],this.pq[e]=i,this.qp[this.pq[t]]=t,this.qp[this.pq[e]]=e}_swim(t){for(;t>1&&this._greater(u.ndiv(t,2),t);)this._exch(t,u.ndiv(t,2)),t=u.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._greater(e,e+1)&&++e,!this._greater(t,e))break;this._exch(t,e),t=e}}iter(){let t=new C(this.pq.length-1,this.compare);for(let e=1;e<=this.n;++e)t.insert(this.pq[e],this.mKeys[this.pq[e]]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMin()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new C(t.length,a);for(let i=0;i<t.length;++i)e.insert(i,t[i]);for(;!e.isEmpty();){let i=e.delMin();console.log(i+" "+t[i])}console.log("");for(let i=0;i<t.length;++i)e.insert(i,t[i]);for(let i,s=e.iter();s.hasNext();)i=s.next(),console.log(i+" "+t[i]);for(;!e.isEmpty();)e.delMin()}}class B{constructor(t,e){if(t<0)throw Error("IllegalArgumentException");this.compare=e,this.maxN=t,this.n=0,this.mKeys=new Array(t+1),this.pq=new Array(t+1),this.qp=new Array(t+1);for(let e=0;e<=t;++e)this.qp[e]=-1}isEmpty(){return 0==this.n}contains(t){return this._validateIndex(t),-1!=this.qp[t]}size(){return this.n}insert(t,e){if(this._validateIndex(t),this.contains(t))throw Error("index is already in the priority queue");++this.n,this.qp[t]=this.n,this.pq[this.n]=t,this.mKeys[t]=e,this._swim(this.n)}maxIndex(){if(0==this.n)throw Error("Priority queue underflow");return this.pq[1]}maxKey(){if(0==this.n)throw Error("Priority queue underflow");return this.mKeys[this.pq[1]]}delMax(){if(0==this.n)throw Error("Priority queue underflow");let t=this.pq[1];return this._exch(1,this.n--),this._sink(1),u.assert(this.pq[this.n+1]==t,"bad delMax"),this.qp[t]=-1,this.mKeys[t]=e,this.pq[this.n+1]=-1,t}keyOf(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");return this.mKeys[t]}changeKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t]),this._sink(this.qp[t])}increaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");if(0==this.compare(this.mKeys[t],e))throw Error("Calling increaseKey() with a key equal to the key in the priority queue");if(this.compare(this.mKeys[t],e)>0)throw Error("Calling increaseKey() with a key that is strictly less than the key in the priority queue");this.mKeys[t]=e,this._swim(this.qp[t])}decreaseKey(t,e){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");if(0==this.compare(this.mKeys[t],e))throw Error("Calling decreaseKey() with a key equal to the key in the priority queue");if(this.compare(this.mKeys[t],e)<0)throw Error("Calling decreaseKey() with a key that is strictly greater than the key in the priority queue");this.mKeys[t]=e,this._sink(this.qp[t])}delete(t){if(this._validateIndex(t),!this.contains(t))throw Error("index is not in the priority queue");let i=this.qp[t];this._exch(i,this.n--),this._swim(i),this._sink(i),this.mKeys[t]=e,this.qp[t]=-1}_validateIndex(t){if(t<0)throw Error("index is negative: "+t);if(t>=this.maxN)throw Error("index >= capacity: "+t)}_less(t,e){return f(this.mKeys[this.pq[t]],this.mKeys[this.pq[e]],this.compare)}_exch(t,e){let i=this.pq[t];this.pq[t]=this.pq[e],this.pq[e]=i,this.qp[this.pq[t]]=t,this.qp[this.pq[e]]=e}_swim(t){for(;t>1&&this._less(u.ndiv(t,2),t);)this._exch(t,u.ndiv(t,2)),t=u.ndiv(t,2)}_sink(t){for(;2*t<=this.n;){let e=2*t;if(e<this.n&&this._less(e,e+1)&&++e,!this._less(t,e))break;this._exch(t,e),t=e}}iter(){let t=new B(this.pq.length-1,this.compare);for(let e=1;e<=this.n;++e)t.insert(this.pq[e],this.mKeys[this.pq[e]]);return{remove(){throw Error("UnsupportedOperationException")},hasNext:()=>!t.isEmpty(),next(){if(!this.hasNext())throw Error("NoSuchElementException");return t.delMax()}}}static test(){let t=["it","was","the","best","of","times","it","was","the","worst"],e=new B(t.length,a);for(let i=0;i<t.length;++i)e.insert(i,t[i]);for(let i,s=e.iter();s.hasNext();)i=s.next(),console.log(i+" "+t[i]);console.log("");for(let i=0;i<t.length;++i)u.rand()<.5?e.increaseKey(i,t[i]+t[i]):e.decreaseKey(i,t[i].substring(0,1));for(;!e.isEmpty();){let t=e.maxKey(),i=e.delMax();console.log(i+" "+t)}console.log("");for(let i=0;i<t.length;++i)e.insert(i,t[i]);let i=new Array(t.length);for(let e=0;e<t.length;++e)i[e]=e;u.shuffle(i);for(let t=0;t<i.length;++t){let s=e.keyOf(i[t]);e.delete(i[t]),console.log(i[t]+" "+s)}}}return{FibonacciMinPQ:S,IndexFibonacciMinPQ:M,Insertion:m,BinaryInsertion:y,Selection:v,Shell:x,Merge:w,Bubble:b,Quick:E,MinPQ:O,MaxPQ:I,Heap:z,IndexMinPQ:C,IndexMaxPQ:B}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("./basic")):t["io/czlab/mcfud/algo/sort"]=i}(this),function(t,e){"use strict";function i(i,s,r,n){i||(i=t["io/czlab/mcfud/core"]()),s||(s=t["io/czlab/mcfud/math"]()),r||(r=t["io/czlab/mcfud/algo/basic"]()),n||(n=t["io/czlab/mcfud/algo/sort"]());const{Bag:o,Stack:h,Queue:a,StdCompare:l,prnIter:c}=r,{MinPQ:u}=n,{is:d,u:f}=(Math.floor,i);class p{static count(t,e){let i=new Map,s=0,r="",n=0;for(let r,o=0;o<t.length;++o)r=t[o],r.length<e||(++s,i.has(r)?i.set(r,i.get(r)+1):(i.set(r,1),++n));return i.set(r,0),Array.from(i.keys()).forEach((t=>{i.get(t)>i.get(r)&&(r=t)})),[r,i.get(r),[n,s]]}static test(){let t="it was the best of times it was the worst of times\n        it was the age of wisdom it was the age of foolishness\n        it was the epoch of belief it was the epoch of incredulity\n        it was the season of light it was the season of darkness\n        it was the spring of hope it was the winter of despair".split(" "),[e,i,s]=p.count(t,1);console.log(e+" "+i),console.log("distinct = "+s[0]),console.log("words= "+s[1])}}class g{constructor(){this.first=e,this.n=0}size(){return this.n}isEmpty(){return 0==this.size()}contains(t){if(f.nichts(t))throw Error("argument to contains is null");return void 0!==this.get(t)}get(t){if(f.nichts(t))throw Error("argument to get is null");for(let e=this.first;e;e=e.next)if(t==e.key)return e.val}put(t,e){if(f.nichts(t))throw Error("first argument to put is null");if(void 0===e)this.delete(t);else{let i,s;for(s=this.first;s&&!i;s=s.next)t==s.key&&(s.val=e,i=!0);i||(this.first=((t,e,i)=>({key:t,val:e,next:i}))(t,e,this.first),this.n+=1)}}delete(t){const i=(t,s)=>t?s==t.key?(this.n-=1,t.next):(t.next=i(t.next,s),t):e;if(f.nichts(t))throw Error("argument to delete is null");this.first=i(this.first,t)}keys(){let t=new a;for(let e=this.first;e;e=e.next)t.enqueue(e.key);return t.iter()}static load(t){let e=new g;return t.forEach(((t,i)=>e.put(t,i))),e}static test(){let t=g.load("SEARCHEXAMPLE".split(""));console.log(((e="",i=0,s=0)=>{for(s=t.keys();s.hasNext();)e+=`${i=s.next()}=${t.get(i)} `;return e})()),console.log("size= "+t.size()),console.log("contains R= "+t.contains("R")),console.log("get R= "+t.get("R")),t.delete("R"),t.isEmpty(),console.log("contains R= "+t.contains("R")),console.log("get R= "+t.get("R")),console.log("size= "+t.size())}}class m{constructor(t,e=2){this.mKeys=new Array(e),this.vals=new Array(e),this.compare=t,this.n=0,this._resize=t=>{let e=new Array(t),i=new Array(t);for(let t=0;t<this.n;++t)e[t]=this.mKeys[t],i[t]=this.vals[t];this.vals=i,this.mKeys=e},this._argOk=t=>f.echt(t,"Invalid argument"),this._check=()=>(()=>{for(let t=1;t<this.size();++t)if(this.compare(this.mKeys[t],this.mKeys[t-1])<0)return!1;return!0})()&&(()=>{for(let t=0;t<this.size();++t)if(t!=this.rank(this.select(t)))return!1;for(let t=0;t<this.size();++t)if(0!=this.compare(this.mKeys[t],this.select(this.rank(this.mKeys[t]))))return!1;return!0})()}isEmpty(){return 0==this.size()}contains(t){return this._argOk(t)&&void 0!==this.get(t)}get(t){if(this._argOk(t)&&!this.isEmpty()){let e=this.rank(t);if(e<this.n&&0==this.compare(this.mKeys[e],t))return this.vals[e]}}rank(t){let e,i,r=0,n=this.n-1;for(this._argOk(t);r<=n;)if(e=r+s.ndiv(n-r,2),i=this.compare(t,this.mKeys[e]),i<0)n=e-1;else{if(!(i>0))return e;r=e+1}return r}put(t,e){if(this._argOk(t)&&void 0===e)this.delete(t);else{let i=this.rank(t);if(i<this.n&&0==this.compare(this.mKeys[i],t))this.vals[i]=e;else{this.n==this.mKeys.length&&this._resize(2*this.mKeys.length);for(let t=this.n;t>i;--t)this.mKeys[t]=this.mKeys[t-1],this.vals[t]=this.vals[t-1];this.n+=1,this.mKeys[i]=t,this.vals[i]=e}}}delete(t){if(this._argOk(t)&&this.isEmpty());else{let i=this.rank(t);if(i==this.n||0!=this.compare(this.mKeys[i],t));else{for(let t=i;t<this.n-1;++t)this.mKeys[t]=this.mKeys[t+1],this.vals[t]=this.vals[t+1];this.n-=1,this.mKeys[this.n]=e,this.vals[this.n]=e,this.n>0&&this.n==s.ndiv(this.mKeys.length,4)&&this._resize(s.ndiv(this.mKeys.length,2)),this._check()}}}deleteMin(){if(this.isEmpty())throw Error("Symbol table underflow error");this.delete(this.min())}deleteMax(){if(this.isEmpty())throw Error("Symbol table underflow error");this.delete(this.max())}min(){if(this.isEmpty())throw Error("called min with empty symbol table");return this.mKeys[0]}max(){if(this.isEmpty())throw Error("called max with empty symbol table");return this.mKeys[this.n-1]}select(t){if(t<0||t>=this.size())throw Error(`called select with invalid argument: ${t}`);return this.mKeys[t]}floor(t){let e=this._argOk(t)&&this.rank(t);if(e<this.n&&0==this.compare(t,this.mKeys[e]))return this.mKeys[e];if(0==e)throw Error("argument to floor is too small");return this.mKeys[e-1]}ceiling(t){let e=this._argOk(t)&&this.rank(t);if(e==this.n)throw Error("argument to ceiling is too large");return this.mKeys[e]}size(t,e){return 0==arguments.length?this.n:(this._argOk(t)&&this._argOk(e),this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t))}keys(t,e){0==arguments.length&&(t=this.min(),e=this.max()),this._argOk(t)&&this._argOk(e);let i=new a;if(this.compare(t,e)>0);else{for(let s=this.rank(t);s<this.rank(e);++s)i.enqueue(this.mKeys[s]);this.contains(e)&&i.enqueue(this.mKeys[this.rank(e)])}return i.iter()}static load(t,e){let i=new m(e);return t.forEach(((t,e)=>i.put(t,e))),i}static test(){let t=m.load("SEARCHEXAMPLE".split(""),l),e=e=>{e="";for(let i,s=t.keys();s.hasNext();)i=s.next(),e+=`${i}=${t.get(i)} `;return e};console.log(e()),t.deleteMin(),console.log(e()),t.deleteMax(),t.isEmpty(),console.log(e()),console.log("floor of Q= "+t.floor("Q")),console.log("ceil of Q= "+t.ceiling("Q")),console.log("size= "+t.size()),console.log("size= "+t.size("E","P")),console.log("keys E->P = "+c(t.keys("E","P")))}}class y{constructor(t){this.compare=t,this.root=e,this._argOk=t=>f.assert(t,"Invalid argument"),this._check=()=>(this.isBST(this.root,null,null)||console.log("Not in symmetric order"),this.isSizeConsistent(this.root)||console.log("Subtree counts not consistent"),this.isRankConsistent()||console.log("Ranks not consistent"),this.isBST(this.root,null,null)&&this.isSizeConsistent(this.root)&&this.isRankConsistent()),this.isBST=(t,e,i)=>!!f.nichts(t)||!(f.echt(e)&&this.compare(t.key,e)<=0)&&(!(f.echt(i)&&this.compare(t.key,i)>=0)&&(this.isBST(t.left,e,t.key)&&this.isBST(t.right,t.key,i))),this.isSizeConsistent=t=>!!f.nichts(t)||t.size==this._sizeNode(t.left)+this._sizeNode(t.right)+1&&(this.isSizeConsistent(t.left)&&this.isSizeConsistent(t.right)),this.isRankConsistent=()=>{for(let t=0;t<this.size();++t)if(t!=this.rank(this.select(t)))return!1;for(let t,e=this.keys();e.hasNext();)if(t=e.next(),0!=this.compare(t,this.select(this.rank(t))))return!1;return!0}}Node(t,e,i){return{key:t,val:e,size:i}}isEmpty(){return 0==this.size()}contains(t){return this._argOk(t)&&void 0!==this.get(t)}get(t){return this._getNode(this.root,t)}_getNode(t,e){if(!this._argOk(e)||!f.nichts(t)){let i=this.compare(e,t.key);return i<0?this._getNode(t.left,e):i>0?this._getNode(t.right,e):t.val}}put(t,e){this._argOk(t)&&f.nichts(e)?this.delete(t):(this.root=this._putNode(this.root,t,e),this._check())}_putNode(t,e,i){if(f.nichts(t))t=this.Node(e,i,1);else{let s=this.compare(e,t.key);s<0?t.left=this._putNode(t.left,e,i):s>0?t.right=this._putNode(t.right,e,i):t.val=i,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right)}return t}deleteMin(){if(this.isEmpty())throw Error("Symbol table underflow");this.root=this._deleteMinNode(this.root),this._check()}_deleteMinNode(t){return f.nichts(t.left)?t=t.right:(t.left=this._deleteMinNode(t.left),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1),t}deleteMax(){if(this.isEmpty())throw Error("Symbol table underflow");this.root=this._deleteMaxNode(this.root),this._check()}_deleteMaxNode(t){return f.nichts(t.right)?t=t.left:(t.right=this._deleteMaxNode(t.right),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1),t}delete(t){this.root=this._argOk(t)&&this._deleteNode(this.root,t),this._check()}_deleteNode(t,e){if(f.echt(t)){let i=this.compare(e,t.key);if(i<0)t.left=this._deleteNode(t.left,e);else if(i>0)t.right=this._deleteNode(t.right,e);else{if(f.nichts(t.right))return t.left;if(f.nichts(t.left))return t.right;let e=t;(t=this._minNode(e.right)).right=this._deleteMinNode(e.right),t.left=e.left}t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1}return t}min(){if(this.isEmpty())throw Error("calls min with empty symbol table");return this._minNode(this.root).key}_minNode(t){return f.nichts(t.left)?t:this._minNode(t.left)}max(){if(this.isEmpty())throw Error("calls max with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return f.nichts(t.right)?t:this._maxNode(t.right)}floor(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls floor with empty symbol table");let e=this._floorNode(this.root,t);if(f.nichts(e))throw Error("argument to floor is too small");return e.key}_floorNode(t,e){if(f.nichts(t))return null;let i=this.compare(e,t.key);if(0==i)return t;if(i<0)return this._floorNode(t.left,e);let s=this._floorNode(t.right,e);return f.nichts(s)?t:s}ceiling(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls ceiling with empty symbol table");let e=this._ceilingNode(this.root,t);if(f.nichts(e))throw Error("argument to floor is too large");return e.key}_ceilingNode(t,i){if(f.nichts(t))return e;let s=this.compare(i,t.key);if(0==s)return t;if(s<0){let e=this._ceilingNode(t.left,i);return e||t}return this._ceilingNode(t.right,i)}select(t){if(t<0||t>=this.size())throw Error(`argument to select is invalid: ${t}`);return this._selectNode(this.root,t)}_selectNode(t,i){if(f.nichts(t))return e;let s=this._sizeNode(t.left);return s>i?this._selectNode(t.left,i):s<i?this._selectNode(t.right,i-s-1):t.key}rank(t){return this._argOk(t)&&this._rankNode(t,this.root)}_rankNode(t,e){if(f.nichts(e))return 0;let i=this.compare(t,e.key);return i<0?this._rankNode(t,e.left):i>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keys(t,e){let i=new a;return 0==arguments.length&&(this.isEmpty()||(t=this.min(),e=this.max())),!this.isEmpty()&&this._argOk(t)&&this._argOk(e)&&this._keysNode(this.root,i,t,e),i.iter()}_keysNode(t,e,i,s){if(f.nichts(t));else{let r=this.compare(i,t.key),n=this.compare(s,t.key);r<0&&this._keysNode(t.left,e,i,s),r<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,i,s)}return e}_sizeNode(t){return f.nichts(t)?0:t.size}size(t,e){return 0==arguments.length?this._sizeNode(this.root):this._argOk(t)&&this._argOk(e)&&this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}height(){return this._heightNode(this.root)}_heightNode(t){return f.nichts(t)?-1:1+Math.max(this._heightNode(t.left),this._heightNode(t.right))}levelOrder(){let t,e=[],i=new a;for(e.push(this.root);e.length>0;)t=e.pop(),f.echt(t)&&(i.enqueue(t.key),e.push(t.left,t.right));return i.iter()}static load(t,e){let i=new y(e);return t.forEach(((t,e)=>i.put(t,e))),i}static test(){let t,e=y.load("SEARCHEXAMPLE".split(""),l);t="";for(let i,s=e.levelOrder();s.hasNext();)i=s.next(),t+=`${i}=${e.get(i)} `;console.log("level-order:\n"+t),t="";for(let i,s=e.keys();s.hasNext();)i=s.next(),t+=`${i}=${e.get(i)} `;e.isEmpty(),console.log("keys=\n"+t),console.log("size="+e.size()),console.log("size E->Q = ",e.size("E","Q")),t="";for(let i,s=e.keys("E","Q");s.hasNext();)i=s.next(),t+=`${i}=${e.get(i)} `;console.log("keys[E->Q]= "+t),console.log("min= "+e.min()),console.log("max= "+e.max()),console.log("rank P= "+e.rank("P")),console.log("contains X= "+e.contains("X")),console.log("contains Z= "+e.contains("Z")),e.delete("X"),console.log("get C="+e.get("C")),console.log("max= "+e.max()),e.deleteMin(),e.deleteMax(),console.log("height= "+e.height()),console.log("min= "+e.min()),console.log("max= "+e.max()),console.log("rank E= "+e.rank("E")),console.log("floor G= "+e.floor("G")),console.log("ceiling G= "+e.ceiling("G"))}}class v{static BLACK=!1;static RED=!0;constructor(t){this.compare=t,this.root=e,this._argOk=t=>f.assert(t,"Invalid argument"),this._check=()=>{let t=(e,i,s)=>!!f.nichts(e)||!(i&&this.compare(e.key,i)<=0)&&(!(s&&this.compare(e.key,s)>=0)&&(t(e.left,i,e.key)&&t(e.right,e.key,s))),e=t=>!!f.nichts(t)||t.size==this._sizeNode(t.left)+this._sizeNode(t.right)+1&&(e(t.left)&&e(t.right)),i=t=>!!f.nichts(t)||!this._isRed(t.right)&&((t===this.root||!this._isRed(t)||!this._isRed(t.left))&&(i(t.left)&&i(t.right))),s=(t,e)=>f.nichts(t)?0==e:(this._isRed(t)||--e,s(t.left,e)&&s(t.right,e));return t(this.root,null,null)&&e(this.root)&&(()=>{for(let t=0;t<this.size();++t)if(t!=this._rankNode(this.select(t)))return!1;for(let t,e=this.keys();e.hasNext();)if(t=e.next(),0!=this.compare(t,this.select(this._rankNode(t))))return!1;return!0})()&&i(this.root)&&(()=>{let t=0,e=this.root;for(;e;)this._isRed(e)||++t,e=e.left;return s(this.root,t)})()}}Node(t,e,i,s){return{key:t,val:e,color:i,size:s}}_isRed(t){return!f.nichts(t)&&t.color===v.RED}_sizeNode(t){return f.nichts(t)?0:t.size}isEmpty(){return f.nichts(this.root)}get(t){return this._argOk(t)&&this._getNode(this.root,t)}_getNode(t,e){for(;t;){let i=this.compare(e,t.key);if(i<0)t=t.left;else{if(!(i>0))return t.val;t=t.right}}}contains(t){return void 0!==this.get(t)}put(t,e){this._argOk(t)&&f.nichts(e)?this.delete(t):(this.root=this._putNode(this.root,t,e),this.root.color=v.BLACK)}_putNode(t,e,i){if(f.nichts(t))return this.Node(e,i,v.RED,1);let s=this.compare(e,t.key);return s<0?t.left=this._putNode(t.left,e,i):s>0?t.right=this._putNode(t.right,e,i):t.val=i,this._isRed(t.right)&&!this._isRed(t.left)&&(t=this._rotateLeft(t)),this._isRed(t.left)&&this._isRed(t.left.left)&&(t=this._rotateRight(t)),this._isRed(t.left)&&this._isRed(t.right)&&this._flipColors(t),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,t}deleteMin(){if(this.isEmpty())throw Error("BST underflow");this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=v.RED),this.root=this._deleteMinNode(this.root),this.isEmpty()||(this.root.color=v.BLACK)}_deleteMinNode(t){return f.nichts(t.left)?null:(this._isRed(t.left)||this._isRed(t.left.left)||(t=this._moveRedLeft(t)),t.left=this._deleteMinNode(t.left),this._balance(t))}deleteMax(){if(this.isEmpty())throw Error("BST underflow");this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=v.RED),this.root=this._deleteMaxNode(this.root),this.isEmpty()||(this.root.color=v.BLACK)}_deleteMaxNode(t){return this._isRed(t.left)&&(t=this._rotateRight(t)),f.nichts(t.right)?null:(this._isRed(t.right)||this._isRed(t.right.left)||(t=this._moveRedRight(t)),t.right=this._deleteMaxNode(t.right),this._balance(t))}delete(t){this._argOk(t)&&!this.contains(t)||(this._isRed(this.root.left)||this._isRed(this.root.right)||(this.root.color=v.RED),this.root=this._deleteNode(this.root,t),this.isEmpty()||(this.root.color=v.BLACK))}_deleteNode(t,e){if(this.compare(e,t.key)<0)this._isRed(t.left)||this._isRed(t.left.left)||(t=this._moveRedLeft(t)),t.left=this._deleteNode(t.left,e);else{if(this._isRed(t.left)&&(t=this._rotateRight(t)),0==this.compare(e,t.key)&&f.nichts(t.right))return null;if(this._isRed(t.right)||this._isRed(t.right.left)||(t=this._moveRedRight(t)),0==this.compare(e,t.key)){let e=this._minNode(t.right);t.key=e.key,t.val=e.val,t.right=this._deleteMinNode(t.right)}else t.right=this._deleteNode(t.right,e)}return this._balance(t)}_rotateRight(t){if(f.nichts(t)||!this._isRed(t.left))throw Error("bad input to rotateRight");let e=t.left;return t.left=e.right,e.right=t,e.color=e.right.color,e.right.color=v.RED,e.size=t.size,t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,e}_rotateLeft(t){if(f.nichts(t)||!this._isRed(t.right))throw Error("bad input to rotateLeft");let e=t.right;return t.right=e.left,e.left=t,e.color=e.left.color,e.left.color=v.RED,e.size=t.size,t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,e}_flipColors(t){t.color=!t.color,t.left.color=!t.left.color,t.right.color=!t.right.color}_moveRedLeft(t){return this._flipColors(t),this._isRed(t.right.left)&&(t.right=this._rotateRight(t.right),t=this._rotateLeft(t),this._flipColors(t)),t}_moveRedRight(t){return this._flipColors(t),this._isRed(t.left.left)&&(t=this._rotateRight(t),this._flipColors(t)),t}_balance(t){return this._isRed(t.right)&&!this._isRed(t.left)&&(t=this._rotateLeft(t)),this._isRed(t.left)&&this._isRed(t.left.left)&&(t=this._rotateRight(t)),this._isRed(t.left)&&this._isRed(t.right)&&this._flipColors(t),t.size=this._sizeNode(t.left)+this._sizeNode(t.right)+1,t}height(){return this._height(this.root)}_height(t){return f.nichts(t)?-1:1+Math.max(this._height(t.left),this._height(t.right))}min(){if(this.isEmpty())throw Error("calls min with empty symbol table");return this._minNode(this.root).key}_minNode(t){return f.nichts(t.left)?t:this._minNode(t.left)}max(){if(this.isEmpty())throw Error("calls max with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return f.nichts(t.right)?t:this._maxNode(t.right)}floor(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls floor with empty symbol table");let e=this._floorNode(this.root,t);if(f.nichts(e))throw Error("argument to floor is too small");return e.key}_floorNode(t,i){if(f.nichts(t))return e;let s=this.compare(i,t.key);if(0==s)return t;if(s<0)return this._floorNode(t.left,i);let r=this._floorNode(t.right,i);return r||t}ceiling(t){if(this._argOk(t)&&this.isEmpty())throw Error("calls ceiling with empty symbol table");let e=this._ceilingNode(this.root,t);if(f.nichts(e))throw Error("argument to ceiling is too small");return e.key}_ceilingNode(t,i){if(f.nichts(t))return e;let s=this.compare(i,t.key);if(0==s)return t;if(s>0)return this._ceilingNode(t.right,i);let r=this._ceilingNode(t.left,i);return r||t}select(t){if(t<0||t>=this.size())throw Error(`argument to select is invalid: ${t}`);return this._selectNode(this.root,t)}_selectNode(t,i){if(f.nichts(t))return e;let s=this._sizeNode(t.left);return s>i?this._selectNode(t.left,i):s<i?this._selectNode(t.right,i-s-1):t.key}rank(t){return this._argOk(t)&&this._rankNode(t,this.root)}_rankNode(t,e){if(f.nichts(e))return 0;let i=this.compare(t,e.key);return i<0?this._rankNode(t,e.left):i>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keys(t,e){let i=new a;return 0==arguments.length&&(this.isEmpty()||(t=this.min(),e=this.max())),!this.isEmpty()&&this._argOk(t)&&this._argOk(e)&&this._keysNode(this.root,i,t,e),i.iter()}_keysNode(t,e,i,s){if(t){let r=this.compare(i,t.key),n=this.compare(s,t.key);r<0&&this._keysNode(t.left,e,i,s),r<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,i,s)}return e}size(t,e){return 0==arguments.length?this._sizeNode(this.root):this._argOk(t)&&this._argOk(e)&&this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}static load(t,e){let i=new v(e);return t.forEach(((t,e)=>i.put(t,e))),i}static test(){let t,e=v.load("SEARCHEXAMPLE".split(""),l);t="";for(let i,s=e.keys();s.hasNext();)i=s.next(),t+=`${i}=${e.get(i)} `;console.log(t),e.isEmpty(),console.log("height= "+e.height()+", size= "+e.size()),console.log("get X= "+e.get("X")),console.log("contains X= "+e.contains("X")),console.log("min= "+e.min()+",max= "+e.max()),e.deleteMin(),e.deleteMax(),console.log("min= "+e.min()+",max= "+e.max()),e.delete("R"),console.log("contains R= "+e.contains("R")),console.log("floor J= "+e.floor("J")),console.log("ceiling J= "+e.ceiling("J")),console.log("rank M= "+e.rank("M")),t="";for(let i,s=e.keys("D","Q");s.hasNext();)i=s.next(),t+=`${i}=${e.get(i)} `;console.log("keys[D-Q]= "+t),console.log("size[E-P]= "+e.size("E","P"))}}class x{static indexOf(t,e){let i=0,r=t.length-1;for(;i<=r;){let n=i+s.ndiv(r-i,2);if(e<t[n])r=n-1;else{if(!(e>t[n]))return n;i=n+1}}return-1}static test(){let t="84 48 68 10 18 98 12 23 54 57 33 16 77 11 29".split(" ").map((t=>+t)).sort();"23 50 10 99 18 23 98 84 11 10 48 77 13 54 98 77 77 68".split(" ").map((t=>+t)).forEach((e=>{x.indexOf(t,e)<0&&console.log(e)}))}}class _{Node(t,e,i,s){return{key:t,val:e,height:i,size:s}}constructor(t){this.compare=t,this.root=e}isEmpty(){return f.nichts(this.root)}_sizeNode(t){return f.nichts(t)?0:t.size}height(){return this._heightNode(this.root)}_heightNode(t){return f.nichts(t)?-1:t.height}get(t){if(f.nichts(t))throw Error("argument to get() is null");let e=this._getNode(this.root,t);if(e)return e.val}_getNode(t,i){if(!t)return e;let s=this.compare(i,t.key);return s<0?this._getNode(t.left,i):s>0?this._getNode(t.right,i):t}contains(t){return void 0!==this.get(t)}put(t,e){if(f.nichts(t))throw Error("first argument to put() is null");void 0===e?this.delete(t):this.root=this._putNode(this.root,t,e)}_putNode(t,e,i){if(!t)return this.Node(e,i,0,1);let s=this.compare(e,t.key);if(s<0)t.left=this._putNode(t.left,e,i);else{if(!(s>0))return t.val=i,t;t.right=this._putNode(t.right,e,i)}return t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balanceNode(t)}_balanceNode(t){return this._balanceFactor(t)<-1?(this._balanceFactor(t.right)>0&&(t.right=this._rotateRight(t.right)),t=this._rotateLeft(t)):this._balanceFactor(t)>1&&(this._balanceFactor(t.left)<0&&(t.left=this._rotateLeft(t.left)),t=this._rotateRight(t)),t}_balanceFactor(t){return this._heightNode(t.left)-this._heightNode(t.right)}_rotateRight(t){let e=t.left;return t.left=e.right,e.right=t,e.size=t.size,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),e.height=1+Math.max(this._heightNode(e.left),this._heightNode(e.right)),e}_rotateLeft(t){let e=t.right;return t.right=e.left,e.left=t,e.size=t.size,t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),e.height=1+Math.max(this._heightNode(e.left),this._heightNode(e.right)),e}delete(t){if(f.nichts(t))throw Error("argument to delete() is null");this.contains(t)&&(this.root=this._deleteNode(this.root,t))}_deleteNode(t,e){let i=this.compare(e,t.key);if(i<0)t.left=this._deleteNode(t.left,e);else if(i>0)t.right=this._deleteNode(t.right,e);else{if(!t.left)return t.right;if(!t.right)return t.left;let e=t;(t=this.min(e.right)).right=this.deleteMin(e.right),t.left=e.left}return t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)}deleteMin(){if(this.isEmpty())throw Error("called deleteMin() with empty symbol table");this.root=this._deleteMinNode(this.root)}_deleteMinNode(t){return t.left?(t.left=this._deleteMinNode(t.left),t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)):t.right}deleteMax(){if(this.isEmpty())throw Error("called deleteMax() with empty symbol table");this.root=this._deleteMaxNode(this.root)}_deleteMaxNode(t){return t.right?(t.right=this._deleteMaxNode(t.right),t.size=1+this._sizeNode(t.left)+this._sizeNode(t.right),t.height=1+Math.max(this._heightNode(t.left),this._heightNode(t.right)),this._balance(t)):t.left}min(){if(this.isEmpty())throw Error("called min() with empty symbol table");return this._minNode(this.root).key}_minNode(t){return t.left?this._minNode(t.left):t}max(){if(this.isEmpty())throw Error("called max() with empty symbol table");return this._maxNode(this.root).key}_maxNode(t){return t.right?this._maxNode(t.right):t}floor(t){if(f.nichts(t))throw Error("argument to floor() is null");if(this.isEmpty())throw Error("called floor() with empty symbol table");let e=this._floorNode(this.root,t);if(e)return e.key}_floorNode(t,i){if(f.nichts(t))return e;let s=this.compare(i,t.key);if(0==s)return t;if(s<0)return this._floorNode(t.left,i);let r=this._floorNode(t.right,i);return r||t}ceiling(t){if(f.nichts(t))throw Error("argument to ceiling() is null");if(this.isEmpty())throw Error("called ceiling() with empty symbol table");let e=this._ceilingNode(this.root,t);if(e)return e.key}_ceilingNode(t,i){if(f.nichts(t))return e;let s=this.compare(i,t.key);if(0==s)return t;if(s>0)return this._ceilingNode(t.right,i);let r=this._ceilingNode(t.left,i);return r||t}select(t){if(t<0||t>=this.size())throw Error("k is not in range 0-"+(this.size()-1));let e=this._selectNode(this.root,t);if(e)return e.key}_selectNode(t,i){if(f.nichts(t))return e;let s=this._sizeNode(t.left);return s>i?this._selectNode(t.left,i):s<i?this._selectNode(t.right,i-s-1):t}rank(t){if(f.nichts(t))throw Error("argument to rank() is null");return this._rankNode(t,this.root)}_rankNode(t,e){if(f.nichts(e))return 0;let i=this.compare(t,e.key);return i<0?this._rankNode(t,e.left):i>0?1+this._sizeNode(e.left)+this._rankNode(t,e.right):this._sizeNode(e.left)}keysInOrder(){let t=new a;return this._keysInOrderNode(this.root,t),t.iter()}_keysInOrderNode(t,e){f.nichts(t)||(this._keysInOrderNode(t.left,e),e.enqueue(t.key),this._keysInOrderNode(t.right,e))}keysLevelOrder(){let t=new a;if(!this.isEmpty()){let e=new a;for(e.enqueue(this.root);!e.isEmpty();){let i=e.dequeue();t.enqueue(i.key),i.left||e.enqueue(i.left),i.right&&e.enqueue(i.right)}}return t}keys(t,e){if(0==arguments.length)return this.keysInOrder();if(f.nichts(t))throw Error("first argument to keys() is null");if(f.nichts(e))throw Error("second argument to keys() is null");let i=new a;return this._keysNode(this.root,i,t,e),i.iter()}_keysNode(t,e,i,s){if(t){let r=this.compare(i,t.key),n=this.compare(s,t.key);r<0&&this._keysNode(t.left,e,i,s),r<=0&&n>=0&&e.enqueue(t.key),n>0&&this._keysNode(t.right,e,i,s)}}size(t,e){if(0==arguments.length)return this._sizeNode(this.root);if(f.nichts(t))throw Error("first argument to size() is null");if(f.nichts(e))throw Error("second argument to size() is null");return this.compare(t,e)>0?0:this.contains(e)?this.rank(e)-this.rank(t)+1:this.rank(e)-this.rank(t)}_check(){let t=this;return function e(i,s,r){return!i||!(!s&&t.compare(i.key,s)<=0)&&(!(!r&&t.compare(i.key,r)>=0)&&(e(i.left,s,i.key)&&e(i.right,i.key,r)))}(this.root,null,null)&&function e(i){if(!i)return!0;let s=t._balanceFactor(i);return!(s>1||s<-1)&&(e(i.left)&&e(i.right))}(this.root)&&function e(i){return!i||i.size==t._sizeNode(i.left)+t._sizeNode(i.right)+1&&(e(i.left)&&e(i.right))}(this.root)&&function(){for(let e=0;e<t.size();e++)if(e!=t.rank(t.select(e)))return!1;for(let e,i=t.keys().iterator();i.hasNext();)if(e=i.next(),0!=this.compare(e,t.select(t.rank(key))))return!1;return!0}()}static test(){let t=new _(l);"SEARCHEXAMPLE".split("").forEach(((e,i)=>t.put(e,i)));for(let e,i=t.keys();i.hasNext();)e=i.next(),console.log(e+" "+t.get(e))}}const w=Math.sqrt(2);function b(t,e){return{parent:e,pos:t,f:0,g:0,h:0,pid:`${t[0]},${t[1]}`,equals(t){return this.pos[0]==t.pos[0]&&this.pos[1]==t.pos[1]}}}class k{static manhattan(t,e,i=1){return i*Math.abs(t[1]-e[1])+i*Math.abs(t[0]-e[0])}static euclidean(t,e,i=1){let s=e[0]-t[0],r=e[1]-t[1];return i*(s*s+r*r)}static diagonal(t,e,i=1,s=w){let r=Math.abs(e[0]-t[0]),n=Math.abs(e[1]-t[1]);return i*(r+n)+(s-2*i)*Math.min(r,n)}constructor(t){this.grid=t}pathTo(t,e,i){return this._search(this.grid,t,e,i)}_search(t,e,i,s){const r=s.compare,n=t.length,o=t[0].length,h=new Map,a=new Map,l=new u(r,10),c=b(i),d=b(e),f=[[1,0],[-1,0],[0,1],[0,-1]],p=(t,e)=>{for(;t;t=t.parent)e.unshift(t.pos);return e};s.wantDiagonal&&f.push([1,1],[1,-1],[-1,1],[-1,-1]),a.set(d.pid,d.g),l.insert(d);let g,m=[];for(;!l.isEmpty();){if(g=l.delMin(),a.delete(g.pid),h.set(g.pid,0),g.equals(c))return p(g,[]);m.length=0;for(let t,e=0;e<f.length;++e)t=[g.pos[0]+f[e][0],g.pos[1]+f[e][1]],t[0]>o-1||t[0]<0||t[1]>n-1||t[1]<0||s.blocked(t)||m.push(b(t,g));m.forEach((t=>{h.has(t.pid)||(t.g=g.g+s.cost(),t.h=s.calcHeuristic(t.pos,c.pos),t.f=t.g+t.h,a.has(t.pid)&&t.g>a.get(t.pid)||(l.insert(t),a.set(t.pid,t.g)))}))}}static test(){let t,e,i,s=[[0,1,0,0,0,0],[0,0,0,0,0,0],[0,1,0,1,0,0],[0,1,0,0,1,0],[0,0,0,0,1,0]],r=s.length,n=s[0].length,o={wantDiagonal:!1,compare:(t,e)=>t.f-e.f,cost:()=>1,blocked:t=>0!=s[t[1]][t[0]],calcHeuristic:(t,e)=>k.euclidean(t,e)},h=new k(s).pathTo([0,0],[5,4],o);h?(i="",h.forEach((t=>{i+=`[${t[0]},${t[1]}] `})),console.log(i),e=f.fill(r,(()=>f.fill(n,"#"))),t=0,h.forEach((i=>{e[i[1]][i[0]]=""+t,++t})),e.forEach((t=>{console.log(t.toString())}))):console.log("no path")}}return{AStarGrid:k,AVLTreeST:_,RedBlackBST:v,BST:y,BinarySearch:x,BinarySearchST:m,FrequencyCounter:p,SequentialSearchST:g}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("../main/math"),require("./basic"),require("./sort")):t["io/czlab/mcfud/algo/search"]=i}(this),function(t,e){"use strict";function i(i,s,r,n){r||(r=t["io/czlab/mcfud/algo/basic"]()),n||(n=t["io/czlab/mcfud/algo/sort"]()),i||(i=t["io/czlab/mcfud/core"]()),s||(s=t["io/czlab/mcfud/math"]());const{prnIter:o,TreeMap:h,Bag:a,Stack:l,Queue:c,ST:u,StdCompare:d}=r,{IndexMinPQ:f,MinPQ:p}=n,{is:g,u:m}=(Math.floor,i);function y(t,e){if(t<0||t>=e)throw Error(`vertex ${t} is not between 0 and ${e-1}`);return!0}class v{constructor(t){m.assert(t>=0,"Number of vertices must be non-negative"),this.verts=t,this.edges=0,this.adjls=m.fill(t,(()=>new a))}clone(){let t=new v(this.V());t.edges=this.E(),t.adjls=[];for(let e=0,i=this.V();e<i;++e)t.adjls.push(this.adjls[e].clone());return t}V(){return this.verts}E(){return this.edges}addEdge(t,e){y(t,this.verts),y(e,this.verts),this.edges+=1,this.adjls[t].add(e),this.adjls[e].add(t)}adj(t){return y(t,this.verts)&&this.adjls[t]}degree(t){return y(t,this.verts)&&this.adjls[t].size()}toString(){let t=`${this.verts} vertices, ${this.edges} edges\n`;for(let e=0;e<this.verts;++e)t+=`${e}: `+o(this.adjls[e].iter()),t+="\n";return t}static load(t,e){let i=new v(t);m.assert(e.length%2==0,"wanted even n# of data points");for(let t=0;t<e.length;t+=2)i.addEdge(e[t],e[t+1]);return i}static test(){let t=v.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);t.degree(1),console.log(t.toString());let e=t.clone();console.log("cloned=\n"+e.toString())}}class x{constructor(t,e){this.bMarked=new Array(t.V()),this.nCount=0,y(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.nCount+=1,this.bMarked[e]=!0;for(let i,s=t.adj(e).iter();s.hasNext();)i=s.next(),this.bMarked[i]||this._dfs(t,i)}marked(t){return y(t,this.bMarked.length)&&this.bMarked[t]}count(){return this.nCount}static test(){let t,e,i=v.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);[0,9].forEach((s=>{e=new x(i,s),t="";for(let s=0;s<i.V();++s)e.marked(s)&&(t+=`${s} `);console.log(t),console.log(e.count()!=i.V()?"NOT connected":"connected")}))}}class _{constructor(t,e){this.bMarked=new Array(t.V()),y(e,this.bMarked.length);let i,s,r=m.fill(t.V(),(e=>t.adj(e).iter())),n=new l;for(this.bMarked[e]=!0,n.push(e);!n.isEmpty();)i=n.peek(),r[i].hasNext()?(s=r[i].next(),this.bMarked[s]||(this.bMarked[s]=!0,n.push(s))):n.pop()}marked(t){return y(t,this.bMarked.length)&&this.bMarked[t]}static test(){let t,e,i=v.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]);[0,9].forEach((s=>{e=new _(i,s),t="";for(let s=0;s<i.V();++s)e.marked(s)&&(t+=`${s} `);console.log(t)}))}}class w{constructor(t,e){this.bMarked=new Array(t.V()),this.edgeTo=new Array(t.V()),this.s=e,y(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.bMarked[e]=!0;for(let i,s=t.adj(e).iter();s.hasNext();)i=s.next(),this.bMarked[i]||(this.edgeTo[i]=e,this._dfs(t,i))}hasPathTo(t){return y(t,this.bMarked.length)&&this.bMarked[t]}pathTo(t){if(y(t,this.bMarked.length)&&this.hasPathTo(t)){let e=new l;for(let i=t;i!=this.s;i=this.edgeTo[i])e.push(i);return e.push(this.s),e.iter()}}static test(){let t=v.load(6,[0,5,2,4,2,3,1,2,0,1,3,4,3,5,0,2]),e=new w(t,0);for(let i,s,r=0;r<t.V();++r)if(e.hasPathTo(r)){i=`0 to ${r}:  `;for(let t=e.pathTo(r);t.hasNext();)s=t.next(),i+=0==s?s:`-${s}`;console.log(i)}else console.log(`0 to ${r}:  not connected\n`)}}function b(t,e,i){let s,r=[];for(s=0;s<t.V();++s)i.mDistTo[s]=1/0;for(e.forEach((t=>{i.bMarked[t]=!0,i.mDistTo[t]=0,r.push(t)}));r.length>0;){s=r.shift();for(let e,n=t.adj(s).iter();n.hasNext();)e=n.next(),i.bMarked[e]||(i.edgeTo[e]=s,i.mDistTo[e]=i.mDistTo[s]+1,i.bMarked[e]=!0,r.push(e))}}function k(t,e){if(!t||0==t.length)throw Error("argument is null or empty");return t.forEach((t=>y(t,e))),!0}class E{constructor(t,e){this.bMarked=new Array(t.V()),this.mDistTo=new Array(t.V()),this.edgeTo=new Array(t.V()),g.vec(e)||(e=[e]),k(e,t.V()),b(t,e,this),function(t,e,i){if(0!=i.mDistTo[e])throw Error(`dist of source ${e} to itself = ${i.mDistTo[e]}`);for(let e=0;e<t.V();++e)for(let s,r=t.adj(e).iter();r.hasNext();){if(s=r.next(),i.hasPathTo(e)!==i.hasPathTo(s))throw Error(`edge ${e}-${s}hasPathTo(${e})=${i.hasPathTo(e)}hasPathTo(${s})=${i.hasPathTo(s)}`);if(i.hasPathTo(e)&&i.mDistTo[s]>i.mDistTo[e]+1)throw Error(`edge ${e}-${s}distTo[${e}]=${i.mDistTo[e]}distTo[${s}]=${i.mDistTo[s]}`)}for(let s,r=0;r<t.V();++r)if(i.hasPathTo(r)&&r!=e&&(s=i.edgeTo[r],i.mDistTo[r]!=i.mDistTo[s]+1))throw Error(`shortest path edge ${s}-${r} distTo[${s}]= ${i.mDistTo[s]}distTo[${r}]= ${i.mDistTo[r]}`)}(t,e,this)}hasPathTo(t){return y(t,this.bMarked.length)&&this.bMarked[t]}distTo(t){return y(t,this.bMarked.length)&&this.mDistTo[t]}pathTo(t){if(y(t,this.bMarked.length)&&this.hasPathTo(t)){let e,i=new l;for(e=t;0!=this.mDistTo[e];e=this.edgeTo[e])i.push(e);return i.push(e),i.iter()}}static test(){let t=v.load(6,[0,5,2,4,2,3,1,2,0,1,3,4,3,5,0,2]),e=new E(t,0);for(let i,s=0;s<t.V();++s)if(e.hasPathTo(s)){i=`0 to ${s}(${e.distTo(s)}): `;for(let t,r=e.pathTo(s);r.hasNext();)t=r.next(),i+=0==t?`${t}`:`-${t}`;console.log(i)}else console.log(`0 to ${s} (-):  not connected\n`)}}class N{constructor(t,e,i){if(t<0)throw Error("vertex index must be a non-negative integer");if(e<0)throw Error("vertex index must be a non-negative integer");this.v=t,this.w=e,this._weight=i}weight(){return this._weight}either(){return this.v}other(t){if(t==this.v)return this.w;if(t==this.w)return this.v;throw Error("Illegal endpoint")}static comparator(t,e){return t._weight<e._weight?-1:t._weight>e._weight?1:0}toString(){return`${this.v}-${this.w} ${this._weight}`}static test(){console.log(new N(12,34,5.67).toString())}}class S{constructor(t){if(t<0)throw Error("Number of vertices must be non-negative");this._V=t,this._E=0,this.adjls=m.fill(t,(()=>new a))}static randGraph(t,e){let i=new S(t);if(e<0)throw Error("Number of edges must be non-negative");for(let s,r,n,o=0;o<e;++o)r=m.randInt(t),n=m.randInt(t),s=Math.round(100*m.rand())/100,i.addEdge(new N(r,n,s));return i}clone(){let t=new S(this.V());t._E=this.E();for(let e=0;e<this.V();++e)t.adjls[e]=this.adjls[e].clone();return t}V(){return this._V}E(){return this._E}addEdge(t){let e=t.either(),i=t.other(e);y(e,this._V),y(i,this._V),this.adjls[e].add(t),this.adjls[i].add(t),this._E+=1}adj(t){return y(t,this._V)&&this.adjls[t]}degree(t){return y(t,this._V)&&this.adjls[t].size()}edges(){const t=new a;for(let e,i,s,r=0;r<this._V;++r)for(i=0,e=this.adjls[r].iter();e.hasNext();)s=e.next(),s.other(r)>r?t.add(s):s.other(r)==r&&(i%2==0&&t.add(s),++i);return t.iter()}toString(){let t=`${this._V} ${this._E}\n`;for(let e,i=0;i<this._V;++i){for(t+=`${i}: `,e=this.adjls[i].iter();e.hasNext();)t+=`${e.next()}, `;t+="\n"}return t}static load(t,e){let i=new S(t);m.assert(e.length%3==0,"Invalid data size");for(let s=0;s<e.length;s+=3)y(e[s],t)&&y(e[s+1],t)&&i.addEdge(new N(e[s],e[s+1],e[s+2]));return i}static test(){let t="4 5 0.35 4 7 0.37 5 7 0.28 0 7 0.16 1 5 0.32 0 4 0.38 2 3 0.17 1 7 0.19 0 2 0.26 1 2 0.36 1 3 0.29 2 7 0.34 6 2 0.40 3 6 0.52 6 0 0.58 6 4 0.93".split(" ").map((t=>+t)),e=S.load(8,t);console.log(e.toString())}}class M{constructor(t){this.bMarked=new Array(t.V()),this._id=new Array(t.V()),this._size=new Array(t.V()),this.nCount=0;for(let e=0;e<t.V();++e)this.bMarked[e]||(this._dfs(t,e),++this.nCount)}_dfs(t,e){this.bMarked[e]=!0,this._id[e]=this.nCount,this._size[this.nCount]+=1;for(let i,s,r=t.adj(e).iter();r.hasNext();)i=r.next(),t instanceof S?(s=i.other(e),this.bMarked[s]||this._dfs(t,s)):this.bMarked[i]||this._dfs(t,i)}id(t){return y(t,this.bMarked.length)&&this._id[t]}size(t){return y(t,this.bMarked.length)&&this._size[this._id[t]]}count(){return this.nCount}connected(t,e){return y(t,this.bMarked.length)&&y(e,this.bMarked.length)&&this.id(t)==this.id(e)}static test(){let t=v.load(13,[0,5,4,3,0,1,9,12,6,4,5,4,0,2,11,12,9,10,0,6,7,8,9,11,5,3]),e=new M(t),i=e.count();console.log(i+" components");let s=m.fill(i,(()=>[]));for(let i=0;i<t.V();++i)s[e.id(i)].push(i);for(let t,e=0;e<i;++e)t="",s[e].forEach((e=>t+=e.toString()+" ")),console.log(t)}}class O{static load(t,e){if(t<0)throw Error("verts in a Digraph must be non-negative");m.assert(e.length%2==0,"expected even n# of data-length");let i=new O(t);for(let t=0;t<e.length;t+=2)i.addEdge(e[t],e[t+1]);return i}constructor(t){if(t<0)throw Error("verts in a Digraph must be non-negative");this._V=t,this._E=0,this._indegree=m.fill(t,0),this.adjls=m.fill(t,(()=>new a))}clone(){let t=this,e=new O(this.V());e._E=this.E(),e._indegree=m.fill(e.V(),(e=>t._indegree[e]));for(let t=0;t<e.V();++t)e.adjls[t]=this.adjls[t].clone();return e}V(){return this._V}E(){return this._E}addEdge(t,e){y(t,this._V)&&y(e,this._V),this.adjls[t].add(e),this._indegree[e]+=1,++this._E}adj(t){return y(t,this._V)&&this.adjls[t]}outdegree(t){return y(t,this._V)&&this.adjls[t].size()}indegree(t){return y(t,this._V)&&this._indegree[t]}reverse(){let t=new O(this._V);for(let e,i=0;i<this._V;++i)for(e=this.adjls[i].iter();e.hasNext();)t.addEdge(e.next(),i);return t}toString(){let t=`${this._V} vertices, ${this._E} edges\n`;for(let e,i=0;i<this._V;++i){for(t+=`${i}: `,e=this.adjls[i].iter();e.hasNext();)t+=`${e.next()} `;t+="\n"}return t}static test(){let t=O.load(13,"4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t))),e="",i="";for(let s=0;s<t.V();++s)e+=`${s}=${t.indegree(s)}, `,i+=`${s}=${t.outdegree(s)},`;console.log("indegreee= "+e),console.log("outdegreee= "+i),console.log(t.toString());let s=t.clone();console.log("cloned=\n"+s.toString());let r=t.reverse();console.log("rev'ed=\n"+r.toString())}}class I{constructor(t,e){this.bMarked=new Array(t.V()),g.vec(e)||(e=[e]),k(e,t.V()),e.forEach((e=>{this.bMarked[e]||this._dfs(t,e)}))}_dfs(t,e){this.mCount+=1,this.bMarked[e]=!0;for(let i,s=t.adj(e).iter();s.hasNext();)i=s.next(),this.bMarked[i]||this._dfs(t,i)}marked(t){return y(t,this.bMarked.length)&&this.bMarked[t]}count(){return this.mCount}static test(){let t=O.load(13,"4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t))),e="",i=new I(t,[1,2,6]);for(let s=0;s<t.V();++s)i.marked(s)&&(e+=`${s} `);i.count(),console.log(e)}}class T{constructor(t){this.bMarked=new Array(t.V()),this.onStack=new Array(t.V()),this.edgeTo=new Array(t.V()),this.mCycle=e;for(let e=0;e<t.V();++e)this.bMarked[e]||this.mCycle||this._dfs(t,e)}_dfs(t,e){this.onStack[e]=!0,this.bMarked[e]=!0;for(let i,s=t.adj(e).iter();s.hasNext();){if(i=s.next(),this.mCycle)return;if(this.bMarked[i]){if(this.onStack[i]){this.mCycle=new l;for(let t=e;t!=i;t=this.edgeTo[t])this.mCycle.push(t);this.mCycle.push(i),this.mCycle.push(e),this._check()}}else this.edgeTo[i]=e,this._dfs(t,i)}this.onStack[e]=!1}hasCycle(){return!!this.mCycle}cycle(){return this.mCycle&&this.mCycle.iter()}_check(){if(this.hasCycle()){let t=-1,e=-1;for(let i,s=this.cycle();s.hasNext();)i=s.next(),-1==t&&(t=i),e=i;if(t!=e)throw Error(`cycle begins with ${t} and ends with ${e}\n`)}return!0}static test(){let t="2 3 0 6 0 1 2 0 11 12  9 12  9 10  9 11 3 5 8 7 5 4 0 5 6 4 6 9 7 6".split(/\s+/).map((t=>+t)),e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9\n               10 9 11 7  9 10 12 11  4 4  3 3  5 6  8 8\n               6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t));[new T(O.load(13,e)),new T(O.load(13,t))].forEach((t=>{t.hasCycle()?(console.log("Directed cycle: "),console.log(o(t.cycle()))):console.log("No directed cycle")}))}}class A{constructor(t,e,i){if(t<0)throw Error("Vertex names must be non-negative integers");if(e<0)throw Error("Vertex names must be non-negative integers");this.v=t,this.w=e,this._weight=i}from(){return this.v}to(){return this.w}weight(){return this._weight}toString(){return`${this.v}->${this.w} ${Number(this._weight).toFixed(2)}`}static test(){console.log(new A(12,34,5.67).toString())}}class z{constructor(t){if(t<0)throw Error("Number of vertices in a Digraph must be non-negative");this._V=t,this._E=0,this._indegree=new Array(t),this.adjls=m.fill(t,(()=>new a))}static randGraph(t,e){if(e<0)throw Error("n# edges in a Digraph must be non-negative");let i=new z(t);for(let s=0;s<e;++s)i.addEdge(new A(m.randInt(t),m.randInt(t),.01*_randInt(100)));return i}static load(t,e){if(t<0)throw Error("n# vertices in a Digraph must be non-negative");m.assert(e.length%3==0,"bad data length");let i=new z(t);for(let s=0;s<e.length;s+=3)y(e[s],t)&&y(e[s+1],t)&&i.addEdge(new A(e[s],e[s+1],e[s+2]));return i}clone(){let t=new z(this.V());t._E=this.E();for(let e=0;e<this.V();++e)t._indegree[e]=this._indegree(e);for(let e=0;e<this.V();++e)t.adjls[e]=this.adjls[e].clone();return t}V(){return this._V}E(){return this._E}addEdge(t){m.assert(t instanceof A,"Expected DirectedEdge");let e=t.to(),i=t.from();y(i,this._V),y(e,this._V),this.adjls[i].add(t),this._indegree[e]+=1,this._E++}adj(t){return y(t,this._V)&&this.adjls[t]}outdegree(t){return y(t,this._V)&&this.adjls[t].size()}indegree(t){return y(t,this._V)&&this._indegree[t]}edges(){const t=new a;for(let e=0;e<this._V;++e)for(let i=this.adj(e).iter();i.hasNext();)t.add(i.next());return t.iter()}toString(){let t=`${this._V} ${this._E}\n`;for(let e=0;e<this._V;++e)t+=`${e}: `+o(this.adjls[e].iter())+"\n";return t}static test(){let t="4 5 0.35\n        5 4 0.35\n        4 7 0.37\n        5 7 0.28\n        7 5 0.28\n        5 1 0.32\n        0 4 0.38\n        0 2 0.26\n        7 3 0.39\n        1 3 0.29\n        2 7 0.34\n        6 2 0.40\n        3 6 0.52\n        6 0 0.58\n        6 4 0.93".split(/\s+/).map((t=>+t)),e=z.load(8,t);console.log(e.toString())}}class C{constructor(t){this._pre=new Array(t.V()),this._post=new Array(t.V()),this.preCounter=0,this.postCounter=0,this.postorder=new c,this.preorder=new c,this.bMarked=new Array(t.V());for(let e=0;e<t.V();e++)this.bMarked[e]||this._dfs(t,e);this._check()}_dfs(t,e){this.bMarked[e]=!0,this._pre[e]=this.preCounter++,this.preorder.enqueue(e);for(let i,s=t.adj(e).iter();s.hasNext();)i=t instanceof z?s.next().to():s.next(),this.bMarked[i]||this._dfs(t,i);this.postorder.enqueue(e),this._post[e]=this.postCounter++}pre(t){return y(t,this.bMarked.length)&&this._pre[t]}post(t){return y(t,this.bMarked.length)&&this._post[t]}postOrder(){return this.postorder.iter()}preOrder(){return this.preorder.iter()}reversePost(){let t=new l;for(let e=this.postorder.iter();e.hasNext();)t.push(e.next());return t.iter()}_check(){let t,e=0;for(t=this.postOrder();t.hasNext();){if(this.post(t.next())!=e)throw Error("post(v) and post() inconsistent");++e}for(e=0,t=this.preOrder();t.hasNext();){if(this.pre(t.next())!=e)throw Error("pre(v) and pre() inconsistent");++e}return!0}static test(){let t=O.load(13,"2 3 0 6 0 1 2 0 11 12  9 12  9 10  9 11 3 5 8 7 5 4 0 5 6 4 6 9 7 6".split(/\s+/).map((t=>+t)));console.log(t.toString());let e=new C(t);console.log("   v  pre  post"),console.log("--------------");for(let i=0;i<t.V();++i)console.log(`    ${i}  ${e.pre(i)}  ${e.post(i)}\n`);console.log("Preorder:  "),console.log(o(e.preOrder())),console.log("Postorder:  "),console.log(o(e.postOrder())),console.log(""),console.log("Reverse postorder: "),console.log(o(e.reversePost()))}}class B{constructor(t){m.assert(t instanceof z,"Expected EdgeWeightedDigraph"),this.bMarked=new Array(t.V()),this.onStack=new Array(t.V()),this.edgeTo=new Array(t.V());for(let e=0;e<t.V();++e)this.bMarked[e]||this._dfs(t,e);this._check()}_dfs(t,e){this.onStack[e]=!0,this.bMarked[e]=!0;for(let i,s,r=t.adj(e).iter();r.hasNext();){if(s=r.next(),i=s.to(),this.mCycle)return;if(this.bMarked[i]){if(this.onStack[i]){this.mCycle=new l;let t=s;for(;t.from()!=i;)this.mCycle.push(t),t=this.edgeTo[t.from()];return void this.mCycle.push(t)}}else this.edgeTo[i]=s,this._dfs(t,i)}this.onStack[e]=!1}hasCycle(){return m.echt(this.mCycle)}cycle(){return this.mCycle&&this.mCycle.iter()}_check(){if(this.hasCycle()){let t=e,i=e;for(let e,s=this.cycle();s.hasNext();){if(e=s.next(),t||(t=e),i&&i.to()!=e.from())throw Error(`cycle edges ${i} and ${e} not incident\n`);i=e}if(i.to()!=t.from())throw Error(`cycle edges ${i} and ${t} not incident\n`)}return!0}static test(){let t=13,e=new z(t);m.shuffle(m.fill(t,(t=>t)));for(let i,s,r,n=0;n<8;++n){do{s=m.randInt(t),r=m.randInt(t)}while(s>=r);i=m.rand(),e.addEdge(new A(s,r,i))}for(let i=0;i<6;++i)e.addEdge(new A(m.randInt(t),m.randInt(t),m.rand()));console.log(e.toString());let i=new B(e);i.hasCycle()?console.log("Cycle: "+o(i.cycle())):console.log("No directed cycle")}}class q{constructor(t){this.st=new u,t.forEach((t=>t.forEach(((t,e)=>{this.st.contains(t)||this.st.put(t,this.st.size())})))),this.keys=new Array(this.st.size());for(let t,e=this.st.keys();e.hasNext();)t=e.next(),this.keys[this.st.get(t)]=t;this._graph=new v(this.st.size()),t.forEach((t=>{let e=this.st.get(t[0]);for(let i,s=1;s<t.length;++s)i=this.st.get(t[s]),this._graph.addEdge(e,i)}))}contains(t){return this.st.contains(t)}indexOf(t){return this.st.get(t)}nameOf(t){return y(t,this._graph.V())&&this.keys[t]}graph(){return this._graph}static test(){let t="JFK MCO\n                  ORD DEN\n                  ORD HOU\n                  DFW PHX\n                  JFK ATL\n                  ORD DFW\n                  ORD PHX\n                  ATL HOU\n                  DEN PHX\n                  PHX LAX\n                  JFK ORD\n                  DEN LAS\n                  DFW HOU\n                  ORD ATL\n                  LAS LAX\n                  ATL MCO\n                  HOU MCO\n                  LAS PHX".split(/\s+/),e=new q(m.partition(2,t)),i=e.graph();["JFK","LAX"].forEach((t=>{if(e.contains(t)){let s=e.indexOf(t);console.log(t);for(let t=i.adj(s).iter();t.hasNext();)console.log("   "+e.nameOf(t.next()))}else console.log("input not contain '"+t+"'")}))}}class P{constructor(t){this.st=new u,t.forEach((t=>t.forEach((t=>{this.st.contains(t)||this.st.put(t,this.st.size())})))),this.keys=new Array(this.st.size());for(let t,e=this.st.keys();e.hasNext();)t=e.next(),this.keys[this.st.get(t)]=t;this.graph=new O(this.st.size()),t.forEach((t=>{let e=this.st.get(t[0]);for(let i=1;i<t.length;++i)this.graph.addEdge(e,this.st.get(t[i]))}))}contains(t){return this.st.contains(t)}indexOf(t){return this.st.get(t)}nameOf(t){return y(t,this.graph.V())&&this.keys[t]}digraph(){return this.graph}static test(){let t="JFK MCO\n              ORD DEN\n              ORD HOU\n              DFW PHX\n              JFK ATL\n              ORD DFW\n              ORD PHX\n              ATL HOU\n              DEN PHX\n              PHX LAX\n              JFK ORD\n              DEN LAS\n              DFW HOU\n              ORD ATL\n              LAS LAX\n              ATL MCO\n              HOU MCO\n              LAS PHX".split(/\s+/),e=new P(m.partition(2,t)),i=e.digraph();["JFK","ATL","LAX"].forEach((t=>{console.log(`${t}`);let s=i.adj(e.indexOf(t)).iter();for(;s.hasNext();)console.log("   "+e.nameOf(s.next()))}))}}class D{constructor(t){let i;if(this._order=e,this.rank=e,t instanceof z?i=new B(t):t instanceof O?(i=new T(t),i.hasCycle()||(this.rank=new Array(t.V()))):m.assert(!1,"bad arg for Topological"),i&&!i.hasCycle()){this._order=new c;for(let e,i=0,s=new C(t).reversePost();s.hasNext();)e=s.next(),this.rank&&(this.rank[e]=i++),this._order.enqueue(e)}}order(){return this._order.iter()}hasOrder(){return m.echt(this._order)}rank(t){return this.rank&&y(t,this.rank.length)&&this.hasOrder()?this.rank[t]:-1}static test(){let t=new P([["Algorithms","Theoretical CS","Databases","Scientific Computing"],["Introduction to CS","Advanced Programming","Algorithms"],["Advanced Programming","Scientific Computing"],["Scientific Computing","Computational Biology"],["Theoretical CS","Computational Biology","Artificial Intelligence"],["Linear Algebra","Theoretical CS"],["Calculus","Linear Algebra"],["Artificial Intelligence","Neural Networks","Robotics","Machine Learning"],["Machine Learning","Neural Networks"]]);for(let e=new D(t.digraph()).order();e.hasNext();)console.log(t.nameOf(e.next()))}}class R{constructor(t,e){this.bMarked=new Array(t.V()),this.edgeTo=new Array(t.V()),this.s=e,y(e,this.bMarked.length)&&this._dfs(t,e)}_dfs(t,e){this.bMarked[e]=!0;for(let i,s=t.adj(e).iter();s.hasNext();)i=s.next(),this.bMarked[i]||(this.edgeTo[i]=e,this._dfs(t,i))}hasPathTo(t){return y(t,this.bMarked.length)&&this.bMarked[t]}pathTo(t){if(y(t,this.bMarked.length)&&this.hasPathTo(t)){let e=new l;for(let i=t;i!=this.s;i=this.edgeTo[i])e.push(i);return e.push(this.s),e.iter()}}static test(){let t,e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10\n              9 11 7  9 10 12 11  4 4  3 3  5 6\n              8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t)),i=O.load(13,e),s=new R(i,3);for(let e=0;e<i.V();++e)if(s.hasPathTo(e)){t=`3 to ${e}:  `;for(let i,r=s.pathTo(e);r.hasNext();)i=r.next(),t+=3==i?`${i}`:`-${i}`;console.log(t)}else console.log(`3 to ${e}:  not connected`)}}class ${constructor(t,e){g.vec(e)||(e=[e]),this.bMarked=new Array(t.V()),this.mDistTo=new Array(t.V()),this.edgeTo=new Array(t.V());for(let e=0;e<t.V();++e)this.mDistTo[e]=1/0;k(e,t.V())&&this._bfs(t,e)}_bfs(t,e){let i=new c;for(e.forEach((t=>{this.bMarked[t]=!0,this.mDistTo[t]=0,i.enqueue(t)}));!i.isEmpty();){let e=i.dequeue();for(let s,r=t.adj(e).iter();r.hasNext();)s=r.next(),this.bMarked[s]||(this.edgeTo[s]=e,this.mDistTo[s]=this.mDistTo[e]+1,this.bMarked[s]=!0,i.enqueue(s))}}hasPathTo(t){return y(t,this.bMarked.length)&&this.bMarked[t]}distTo(t){return y(t,this.bMarked.length)&&this.mDistTo[t]}pathTo(t){if(y(t,this.bMarked.length)&&this.hasPathTo(t)){let e,i=new l;for(e=t;0!=this.mDistTo[e];e=this.edgeTo[e])i.push(e);return i.push(e),i.iter()}}static test(){let t,e="4  2 2  3 3  2 6  0 0  1 2  0 11 12 12  9 9 10\n              9 11 7  9 10 12 11  4 4  3 3  5 6\n              8 8  6 5  4 0  5 6  4 6  9 7  6".split(/\s+/).map((t=>+t)),i=O.load(13,e),s=new $(i,3);for(let e=0;e<i.V();++e)if(t="",s.hasPathTo(e)){t=`3 to ${e} (${s.distTo(e)}):  `;for(let i,r=s.pathTo(e);r.hasNext();)i=r.next(),t+=3==i?`${i}`:`->${i}`;console.log(t)}else console.log(`3 to ${e} (-):  not connected`)}}class L{constructor(t,e,i){m.assert(t instanceof z,"Expected EdgeWeightedDigraph");for(let e,i=t.edges();i.hasNext();)if(e=i.next(),e.weight()<0)throw Error(`edge ${e} has negative weight`);this._distTo=new Array(t.V()),this.edgeTo=m.fill(t.V(),null),y(e,t.V());for(let e=0;e<t.V();++e)this._distTo[e]=1/0;for(this._distTo[e]=0,this.pq=new f(t.V(),i),this.pq.insert(e,this._distTo[e]);!this.pq.isEmpty();){let e=this.pq.delMin();for(let i=t.adj(e).iter();i.hasNext();)this._relax(i.next())}this._check(t,e)}_relax(t){let e=t.from(),i=t.to();this._distTo[i]>this._distTo[e]+t.weight()&&(this._distTo[i]=this._distTo[e]+t.weight(),this.edgeTo[i]=t,this.pq.contains(i)?this.pq.decreaseKey(i,this._distTo[i]):this.pq.insert(i,this._distTo[i]))}distTo(t){return y(t,this._distTo.length)&&this._distTo[t]}hasPathTo(t){return y(t,this._distTo.length)&&this._distTo[t]<1/0}pathTo(t){if(y(t,this._distTo.length)&&this.hasPathTo(t)){let e=new l;for(let i=this.edgeTo[t];i;i=this.edgeTo[i.from()])e.push(i);return e.iter()}}_check(t,e){for(let e=t.edges();e.hasNext();)if(e.next().weight()<0)throw Error("negative edge weight detected");if(0!=this._distTo[e]||this.edgeTo[e])throw Error("distTo[s] and edgeTo[s] inconsistent");for(let i=0;i<t.V();++i)if(i!=e&&!this.edgeTo[i]&&this._distTo[i]!=1/0)throw Error("distTo[] and edgeTo[] inconsistent");for(let e=0;e<t.V();++e)for(let i,s,r=t.adj(e).iter();r.hasNext();)if(s=r.next(),i=s.to(),this._distTo[e]+s.weight()<this._distTo[i])throw Error(`edge ${s} not relaxed`);for(let e,i,s=0;s<t.V();++s)if(this.edgeTo[s]){if(i=this.edgeTo[s],e=i.from(),s!=i.to())throw Error("bad edge");if(this._distTo[e]+i.weight()!=this._distTo[s])throw Error(`edge ${i} on shortest path not tight`)}else;return!0}static test(){let t="4 5 0.35\n                  5 4 0.35\n                  4 7 0.37\n                  5 7 0.28\n                  7 5 0.28\n                  5 1 0.32\n                  0 4 0.38\n                  0 2 0.26\n                  7 3 0.39\n                  1 3 0.29\n                  2 7 0.34\n                  6 2 0.40\n                  3 6 0.52\n                  6 0 0.58\n                  6 4 0.93".split(/\s+/).map((t=>+t)),e=z.load(8,t),i=new L(e,0,d);for(let t=0;t<e.V();++t)i.hasPathTo(t)?console.log(`0 to ${t} (${Number(i.distTo(t)).toFixed(2)})  ${o(i.pathTo(t))}`):console.log(`0 to ${t}         no path\n`)}}class j{constructor(t,e,i){m.assert(t instanceof S,"Expected EdgeWeightedGraph");for(let e,i=t.edges();i.hasNext();)if(e=i.next(),e.weight()<0)throw new Error(`edge ${e} has negative weight`);for(this._distTo=m.fill(t.V(),(()=>1/0)),this._distTo[e]=0,this.compare=i,this.edgeTo=m.fill(t.V(),(()=>null)),y(e,t.V()),this.pq=new f(t.V(),this.compare),this.pq.insert(e,this._distTo[e]);!this.pq.isEmpty();){let e=this.pq.delMin();for(let i=t.adj(e).iter();i.hasNext();)this._relax(i.next(),e)}this._check(t,e)}_relax(t,e){let i=t.other(e);this._distTo[i]>this._distTo[e]+t.weight()&&(this._distTo[i]=this._distTo[e]+t.weight(),this.edgeTo[i]=t,this.pq.contains(i)?this.pq.decreaseKey(i,this._distTo[i]):this.pq.insert(i,this._distTo[i]))}distTo(t){return y(t,this._distTo.length)&&this._distTo[t]}hasPathTo(t){return y(t,this._distTo.length)&&this._distTo[t]<1/0}pathTo(t){if(y(t,this._distTo.length)&&this.hasPathTo(t)){let e=t,i=new l;for(let s=this.edgeTo[t];s;s=this.edgeTo[e])i.push(s),e=s.other(e);return i.iter()}}_check(t,e){for(let e=t.edges();e.hasNext();)if(e.next().weight()<0)throw Error("negative edge weight detected");if(0!=this._distTo[e]||this.edgeTo[e])throw Error("distTo[s] and edgeTo[s] inconsistent");for(let i=0;i<t.V();++i)if(i!=e&&!this.edgeTo[i]&&this._distTo[i]!=1/0)throw Error("distTo[] and edgeTo[] inconsistent");for(let e=0;e<t.V();++e)for(let i,s,r=t.adj(e).iter();r.hasNext();)if(s=r.next(),i=s.other(e),this._distTo[e]+s.weight()<this._distTo[i])throw Error(`edge ${s} not relaxed`);for(let e,i,s=0;s<t.V();++s)if(this.edgeTo[s]){if(i=this.edgeTo[s],s!=i.either()&&s!=i.other(i.either()))return!1;if(e=i.other(s),this._distTo[e]+i.weight()!=this._distTo[s])throw Error(`edge ${i} on shortest path not tight`)}return!0}static test(){let t="4 5 0.35 4 7 0.37 5 7 0.28 0 7 0.16 1 5 0.32 0 4 0.38\n                  2 3 0.17 1 7 0.19 0 2 0.26 1 2 0.36 1 3 0.29 2 7 0.34\n                  6 2 0.40 3 6 0.52 6 0 0.58 6 4 0.93".split(/\s+/).map((t=>+t)),e=S.load(8,t),i=new j(e,6,d);for(let t,s=0;s<e.V();++s)if(i.hasPathTo(s)){t=`6 to ${s} (${Number(i.distTo(s)).toFixed(2)})  `;for(let e=i.pathTo(s);e.hasNext();)t+=`${e.next()}   `;console.log(t)}else console.log(`6 to ${s}         no path`)}}return{DepthFirstDirectedPaths:R,BreadthFirstDirectedPaths:$,SymbolGraph:q,DijkstraUndirectedSP:j,DijkstraSP:L,Topological:D,SymbolDigraph:P,EdgeWeightedDirectedCycle:B,DepthFirstOrder:C,EdgeWeightedDigraph:z,DirectedEdge:A,DirectedCycle:T,DirectedDFS:I,Digraph:O,CC:M,EdgeWeightedGraph:S,Edge:N,BreadthFirstPaths:E,DepthFirstPaths:w,NonrecursiveDFS:_,DepthFirstSearch:x,Graph:v}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("../main/math"),require("./basic"),require("./sort")):t["io/czlab/mcfud/algo/graph"]=i}(this),function(t,e){"use strict";function i(e){e||(e=t["io/czlab/mcfud/core"]());Math.floor;const{u:i,is:s}=e,r={mutationRate:.1,crossOverRate:.7,probTournament:.75,NUM_HIDDEN:1,BIAS:-1,NUM_ELITE:4,TOURNAMENT_SIZE:5,MAX_PERTURBATION:.3,ACTIVATION_RESPONSE:1,NEURONS_PER_HIDDEN:10};class n{constructor(){}gt(t){}lt(t){}eq(t){}clone(){}score(){}update(t){}}class o extends n{constructor(t,e){super(),this.value=t,this.flip=e}gt(t){return this.flip?this.value<t.value:this.value>t.value}eq(t){return this.value==t.value}lt(t){return this.flip?this.value>t.value:this.value<t.value}score(){return this.value}update(t){this.value=t}clone(){return new o(this.value,this.flip)}}class h{constructor(){this.averageScore=0,this.totalScore=0,this.bestScore=0,this.worstScore=0,this.best=undefined}}class a{constructor(t){const e=i.fill(t+1,(()=>i.randMinus1To1()));this.numInputs=e.length,this.activation=0,this.weights=e,this.error=0}}class l{constructor(t,e){this.numNeurons=t,this.neurons=i.fill(t,(()=>new a(e)))}}class c{constructor(t,e){this.fitness=e,this.genes=t,this.age=0}clone(){return new c(this.genes.slice(),this.fitness.clone())}}function u(t){let e=i.randInt(t.length),s=i.randInt(t.length);return e<s?[e,s]:[s,e]}function d(t,e){let s,r=0,n=i.rand(),o=t.map((t=>r+=t.fitness.score()/e));for(s=0;s<o.length-1;++s)if(n>=o[s]&&n<=o[s+1])return t[s];return t[0]}function f(t){let e=i.randInt(t.length),s=i.randInt(t.length);for(;e==s;)s=i.randInt2(0,t.length-1);return i.rand()<r.probTournament?t[e].fitness.gt(t[s].fitness)?t[e]:t[s]:t[e].fitness.lt(t[s].fitness)?t[e]:t[s]}function p(t,e){let i=0,s=1/0,r=new h;function n(t){i=t.fitness.score(),r.bestScore=i,r.best=t}function o(t){s=t.fitness.score(),r.worstScore=s}return e&&(s=0,i=1/0),t.forEach((t=>{e?t.fitness.score()<i?n(t):t.fitness.score()>s&&o(t):t.fitness.score()>i?n(t):t.fitness.score()<s&&o(t),r.totalScore+=t.fitness.score()})),r.averageScore=r.totalScore/t.length,r}function g(t,e="cycles"){let s=t.startTime=i.now();return t[e]=0,s}function m(t){return t.endTime=i.now()}function y(t,e,s,r,n){let o=i.randInt(e.length);for(;e.length>1&&o==t;)o=i.randInt(e.length);let h,a,l=e[t].genes,u=e[o].genes;s?[h,a]=s(l,u):(h=l.slice(),a=u.slice()),r&&(r(h),r(a));let d=n(h,e[t].fitness),f=n(a,e[o].fitness);return d.gt(f)?new c(h,d):new c(a,f)}function v(t,e){let i,s=0;for(;s<t.length&&(i=t[s],!i.fitness.eq(e.fitness)&&!e.fitness.lt(i.fitness));++s);return s}function x(t,{calcFit:e,crossOver:n,create:o,mutate:h}){if(s.num(t))return i.fill(t,(()=>o()));let a,l,u,g,m=[],y=p(t);t.sort(((t,e)=>t.fitness.lt(e.fitness)?-1:t.fitness.gt(e.fitness)?1:0));for(let e=r.NUM_ELITES,i=t.length-1;i>=0&&e>0;--i)m.push(t[i]),--e;for(;m.length<t.length;)void 0!==r.TOURNAMENT_SIZE?(u=f(t),g=f(t)):(u=d(t,y),g=d(t,y)),n?[a,l]=n(u.genes,g.genes):(a=u.genes.slice(),l=g.genes.slice()),h&&(h(a),h(l)),m.push(new c(a,e(a,u.fitness)),new c(l,e(l,g.fitness)));for(;m.length>t.length;)m.pop();return m}return{NeuronLayer:l,Neuron:a,NeuralNet:class{constructor(t,e,s,r){this.layers=function(n){if(s>0){n.push(new l(r,t));for(let t=0;t<s-1;++t)n.push(new l(r,r))}return i.conj(n,new l(e,s>0?r:t))}([]),this.numOfWeights=this.layers.reduce(((t,e)=>t+e.neurons.reduce(((t,e)=>t+e.weights.length),0)),0),this.numOutputs=e,this.numInputs=t,this.numHidden=s,this.neuronsPerHidden=r}putWeights(t){i.assert(t.length>=this.numOfWeights,"bad input to putWeights");let e=0;this.layers.forEach((i=>i.neurons.forEach((i=>i.weights.forEach(((s,r)=>i.weights[r]=t[e++]))))))}getWeights(){const t=[];for(let e=0;e<this.numHidden+1;++e)for(let i=0;i<this.layers[e].numNeurons;++i)for(let s=0;s<this.layers[e].neurons[i].numInputs;++s)t.push(this.layers[e].neurons[i].weights[s]);return t}getNumberOfWeights(){return this.numOfWeights}feedForward(t){return this.update(t)}update(t){i.assert(t.length>=this.numInputs,"invalid input size");let e,s,n,o=[];return this.layers.forEach(((i,h)=>{h>0&&(t=o),o=[],i.neurons.forEach((i=>{n=0,e=0,s=i.numInputs;for(let r=0;r<s-1;++r)e+=i.weights[r]*t[n++];e+=i.weights[s-1]*r.BIAS,o.push(i.activation=this.sigmoid(e,r.ACTIVATION_RESPONSE))}))})),i.assert(o.length==this.numOutputs,"out length incorrect")?o:[]}sigmoid(t,e){return 1/(1+Math.exp(-t/e))}calcSplitPoints(){let t=[],e=0;return this.layers.forEach((i=>i.neurons.forEach((i=>{e+=i.numInputs,t.push(e-1)})))),t}},runGASearch:function(t,e){let s,r,n=g(e),o=e.maxCycles||100,h=1e3*(e.maxSeconds||30),a=function*([t,e],{mutate:s,create:r,maxAge:n,calcFit:o,poolSize:h,crossOver:a}){let l,c=r();yield c;let u,d,f,p,g,m=[c],x=[c];h=h||1,n=n||50;for(let t=0;t<h-1;++t)l=r(),l.fitness.gt(c.fitness)&&(yield c=l,x.push(l)),m.push(l);for(g=h-1,p=1;;)if(i.now()-t>e&&(yield c),p=p>0?p-1:g,l=m[p],d=y(p,m,a,s,o),l.fitness.gt(d.fitness)){if(void 0===n)continue;if(l.age+=1,n>l.age)continue;if(f=v(x,d,x.length),u=f/x.length,i.rand()<Math.exp(-u)){m[p]=d;continue}c.age=0,m[p]=c}else d.fitness.gt(l.fitness)?(d.age=0,m[p]=d,d.fitness.gt(c.fitness)&&(yield c=d,x.push(c))):(d.age=l.age+1,m[p]=d)}([n,h],e);for(;;){if(s=a.next().value,r=m(e),r-n>h){r=null;break}if(!t.gt(s.fitness))break;if(e.cycles>=o)break;e.cycles+=1}return[null==r,s]},runGACycle:function(t,e){let s,r,{maxCycles:n,targetScore:o,maxSeconds:h}=e,a=g(e),l=1e3*(h||30);for(n=n||100;;){if(t=x(t,e),r=m(e),r-a>l){r=null;break}if(s=p(t),i.echt(o)&&s.bestScore>=o)break;if(e.cycles>=n)break;e.cycles+=1}return e.gen++,[null==r,t]},calcStats:p,NumFitness:o,Fitness:n,Chromosome:c,mutateSM:function(t){if(i.rand()<r.mutationRate){let e,[s,r]=u(t),n=r-s-1;if(2==n)e=t[s+1],t[s+1]=t[s+2],t[s+2]=e;else if(n>2){e=i.shuffle(t.slice(s+1,r));for(let i=0,n=s+1;n<r;++n)t[n]=e[i++]}}},mutateDM:function(t){if(i.rand()<r.mutationRate){let e,s,r,[n,o]=u(t),h=t.length;o-n-1>0&&(s=t.slice(n+1,o),r=t.slice(0,n+1).concat(t.slice(o)),e=i.randInt(r.length),s=r.slice(0,e).concat(s).concat(r.slice(e)),t.length=0,s.forEach((e=>t.push(e))),i.assert(t.length==h,"mutateDM error"))}},mutateIVM:function(t){if(i.rand()<r.mutationRate){let e,[s,r]=u(t),n=t.length;if(r-s-1>1){e=t.slice(s+1,r).reverse();for(let i=0,n=s+1;n<r;++n)t[n]=e[i++]}i.assert(n==t.length,"mutateIVM error")}},mutateDIVM:function(t){if(i.rand()<r.mutationRate){let e,s,r,[n,o]=u(t),h=t.length;o-n-1>0&&(s=t.slice(n+1,o).reverse(),r=t.slice(0,n+1).concat(t.slice(o)),e=i.randInt(r.length),s=r.slice(0,e).concat(s).concat(r.slice(e)),t.length=0,s.forEach((e=>t.push(e))),i.assert(t.length==h,"mutateDIVM error"))}},crossOverOBX:function(t,e){let s,n,o,h,a;if(i.randInt2(0,t.length-2),o=t.slice(),h=e.slice(),i.rand()>r.crossOverRate||t===e);else{n=i.listIndexesOf(t,!0).slice(0,i.toGoldenRatio(t.length)[1]).sort(),s=n.map((e=>t[e])),a=0;for(let t=0;t<h.length;++t)for(let e=0;e<s.length;++e)if(h[t]==s[e]){h[t]=s[a++];break}s.length=0,a=0;for(let t=0;t<n.length;++t)s.push(e[n[t]]);for(let t=0;t<o.length;++t)for(let e=0;e<s.length;++e)if(o[t]==s[e]){o[t]=s[a++];break}}return[o,h]},crossOverPBX:function(t,e){let s,n;if(i.rand()>r.crossOverRate||t===e)s=t.slice(),n=e.slice();else{s=i.fill(t.length,null),n=i.fill(t.length,null),i.listIndexesOf(t,!0).slice(0,i.toGoldenRatio(t.length)[1]).sort().forEach((i=>{s[i]=t[i],n[i]=e[i]}));let r=0,o=0;for(let i=0;i<t.length;++i){for(;null!==n[o]&&o<t.length;)++o;for(n.indexOf(t[i])<0&&(n[o]=t[i]);null!==s[r]&&r<t.length;)++r;s.indexOf(e[i])<0&&(s[r]=e[i])}i.assert(!s.some((t=>null===t)),"crossOverPBX null error"),i.assert(!n.some((t=>null===t)),"crossOverPBX null error")}return[s,n]},crossOverRND:function(t,e){let s,n;if(i.rand()>r.crossOverRate||t===e)s=t.slice(),n=e.slice();else{let r=i.randInt(t.length);s=[],n=[];for(let i=0;i<r;++i)s.push(t[i]),n.push(e[i]);for(let i=r;i<t.length;++i)s.push(e[i]),n.push(t[i])}return[s,n]},crossOverPMX:function(t,e){let s=t.slice(),n=e.slice();if(i.rand()>r.crossOverRate||t===e);else{let r=i.randInt2(0,t.length-2),o=r;for(;o<=r;)o=i.randInt2(0,t.length-1);for(let h,a,l,c,u=r;u<o+1;++u)l=t[u],c=e[u],l!=c&&(h=s.indexOf(l),a=s.indexOf(c),i.swap(s,h,a),h=n.indexOf(l),a=n.indexOf(c),i.swap(n,h,a))}return[s,n]},crossOverAtSplits:function(t,e,s){let n,o;if(i.rand()>r.crossOverRate||t===e)n=t.slice(),o=e.slice();else{let r=s[i.randInt2(0,s.length-2)],h=s[i.randInt2(r,s.length-1)];n=[],o=[];for(let i=0;i<t.length;++i)i<r||i>=h?(n.push(t[i]),o.push(e[i])):(n.push(e[i]),o.push(t[i]))}return[n,o]},hillClimb:function(t,e,s,r,n,o){o.startTime=i.now();let h,a=t(n);for(;!s(a);)h=t(r(a)),e(a,h)&&(a=h);return o.endTime=i.now(),a},showBest(t,e,s){console.log(i.fill(80,"-").join("")),console.log("total time: "+i.prettyMillis(e.endTime-e.startTime)),s&&console.log("time expired"),console.log("total generations= "+e.gen),console.log("total cycles= "+e.cycles),console.log("fitness= "+t.fitness.score()),console.log(i.fill(80,"-").join(""))},config:t=>i.inject(r,t)}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core")):t["io/czlab/mcfud/algo/NNetGA"]=i}(this),function(t,e){"use strict";function i(i,s){i||(i=t["io/czlab/mcfud/core"]()),s||(i=t["io/czlab/mcfud/math"]());const r=Math.floor,{u:n,is:o}=i,h={INPUT:1,BIAS:2,HIDDEN:3,OUTPUT:4,NONE:911},a={NEURON:0,LINK:1},l={SNAPSHOT:7770,ACTIVE:8881},c={numInputs:0,numOutputs:0,BIAS:1,sigmoidResponse:1,addLinkAttempts:5,findLoopedLink:5,findOldLink:5,chanceAddLink:.07,chanceAddNode:.03,chanceRecurrent:-1,mutationRate:.8,maxWeightJiggle:.5,chanceSetWeight:.1,activationMutation:.1,maxActivationJiggle:.1,compatThreshold:.26,youngFitnessBonus:1.3,youngBonusAge:10,survivalRate:0,oldAgeThreshold:50,oldAgePenalty:.7,crossOverRate:.7,noImprovements:15,maxNNetNeurons:100,numBestElites:4,fitFunc:function(t=0){return new p(t)},sigmoid:function(t,e){return 1/(1+Math.exp(-t/e))},sigmoid2:function(t){return 1/(1+Math.pow(Math.E,-4.9*t))}};function u(t){return t.neuronType==h.OUTPUT}function d(t){return t.neuronType==h.BIAS}function f(t,e=!1){return t.neuronType==h.INPUT||e&&t.neuronType==h.BIAS}class p{#t;constructor(t){this.#t=t}update(t){return this.#t=t,this}score(){return this.#t}clone(){return new p(this.#t)}}class g{#e;#i;get x(){return this.#e}get y(){return this.#i}constructor(t=0,e=0){this.#e=t,this.#i=e}clone(){return new g(this.#e,this.#i)}static dft(){return new g(0,0)}}function m(t){switch(t){case h.INPUT:return"input";case h.BIAS:return"bias";case h.HIDDEN:return"hidden";case h.OUTPUT:return"output"}n.assert(!1,`bad node type ${t}`)}class y{#s;#r;#n;#o;#h;get activation(){return this.#s}get neuronType(){return this.#n}get recur(){return this.#r}get id(){return this.#h}get posY(){return this.#o.y}get posX(){return this.#o.x}set activation(t){this.#s=t}constructor(t,e,i=null,s=!1){n.assert(t>0,`creating a neuron with a bad id ${t}`),this.#o=i?i.clone():g.dft(),this.#r=!0===s,this.#s=1,this.#h=t,this.#n=e}prn(){return`${m(this.#n)}#[${this.#h}]`}setRecur(t){return this.#r=t,this}clone(){const t=new y(this.#h,this.#n,this.#o,this.#r);return t.activation=this.#s,t}}class v{#a;#l;#r;#c;#u;get fromNeuron(){return this.#a}get toNeuron(){return this.#l}get enabled(){return this.#c}get weight(){return this.#u}get recur(){return this.#r}set weight(t){this.#u=t}constructor(t,e,i=!0,s=null,r=!1){this.#a=t,this.#l=e,this.#r=!0===r,this.#c=!1!==i,this.#u=null===s||isNaN(s)?n.randMinus1To1():s}clone(){return new v(this.#a,this.#l,this.#c,this.#u,this.#r)}setRecur(t){return this.#r=t,this}setEnabled(t){return this.#c=t,this}}class x{#d;#f;#p;#o;#g;#m;#y;get innovType(){return this.#d}get neuronID(){return this.#p}get IID(){return this.#f}get pos(){return this.#o}get neuronIn(){return this.#m}get neuronOut(){return this.#y}get neuronType(){return this.#g}constructor(t,e,i,s,r=null,n=null){this.#o=n?n.clone():g.dft(),this.#f=t.nextIID(),this.#d=s,this.#m=e,this.#y=i,o.vecN(r,2,!0)?(this.#p=r[0],this.#g=r[1]):(this.#p=-31,this.#g=h.NONE),t.add(this)}static from(t,e,i,s){return new x(t,-71,-99,a.NEURON,[e,i],s)}}class _{#v;#x;#_;#w;#b;#k;constructor(t,e){let i,[s,r]=function(t,e){return[1/(t+2),1/(e+1)]}(t,e),o=0;this.#v=0,this.#x=0,this.#w=e,this.#_=t,this.#k=[],this.#b=[];for(let e=0;e<t;++e)i={t:h.INPUT,id:++o,co:new g((e+2)*s,0)},this.#b.push(i),x.from(this,i.id,i.t,i.co);i={t:h.BIAS,id:++o,co:new g(s,0)},this.#b.push(i),x.from(this,i.id,i.t,i.co);for(let t=0;t<e;++t)i={t:h.OUTPUT,id:++o,co:new g((t+1)*r,1)},this.#b.push(i),x.from(this,i.id,i.t,i.co);n.assert(o==t+e+1,"bad history db ctor - mismatched neuron ids"),n.assert(o==this.#b.at(-1).id,"bad history db ctor - erroneous last neuron id"),this.#v=o,e=this.#b.filter((t=>t.t==h.OUTPUT)),(t=this.#b.filter((t=>t.t!=h.OUTPUT))).forEach((t=>e.forEach((e=>new x(this,t.id,e.id,a.LINK)))))}sample(t,e){let i=this.#b.filter((t=>t.t!=h.OUTPUT)),s=this.#b.filter((t=>t.t==h.OUTPUT));return this.#b.forEach((e=>t.push(new y(e.id,e.t,e.co)))),i.forEach((t=>s.forEach((i=>e.push(new v(t.id,i.id)))))),this}#E(){return++this.#v}nextIID(){return++this.#x}check(t,e,i){n.assert(t>0&&e>0,`checking innov with bad neuron ids: from: ${t}, to: ${e}`);const s=this.#k.find((s=>s.innovType==i&&s.neuronIn==t&&s.neuronOut==e));return s?s.IID:-51}add(t){this.#k.push(t)}create(t,e,i,s=h.NONE,r=null){let o;return i==a.NEURON?(n.assert(s!=h.NONE,"create-innov: unexpected bad neuron type"),n.assert(t>0&&e>0,`create-innov: bad neuron ids: from: ${t} to: ${e}`),o=new x(this,t,e,i,[this.#E(),s],r)):o=new x(this,t,e,i,null,r),o}createNeuronFromID(t){const e=this.#k.find((e=>e.neuronID==t));return e?new y(t,e.neuronType,e.pos):n.assert(!1,"unknown neuron id not found in history.")}getNeuronID(t){const e=this.#k.find((e=>e.IID==t));return e?e.neuronID:-41}getIID(t,e=a.LINK){return this.check(t.fromNeuron,t.toNeuron,e)}getInnov(t,e=a.LINK){return this.#k.find((i=>i.innovType==e&&i.neuronIn==t.fromNeuron&&i.neuronOut==t.toNeuron))}countInputs(){return this.#_}countOutputs(){return this.#w}}class w{#u;#N;#S;#r;get weight(){return this.#u}get from(){return this.#N}constructor(t,e,i,s=!1){this.#u=t,this.#N=e,this.#S=i,this.#r=!0===s}clone(){return new w(this.#u,this.#N,this.#S,this.#r)}static from(t,e,i){const s=new w(t.weight,e,i,t.recur);return e.addLinkOut(s),i.addLinkIn(s),s}}class b{#M;#s;#O;#g;#p;#I;#o;get activation(){return this.#s}get neuronType(){return this.#g}get id(){return this.#p}get output(){return this.#I}set output(t){this.#I=t}constructor(t,e,i,s){this.#o=i?i.clone():g.dft(),this.#s=s,this.#g=e,this.#p=t,this.#I=0,this.#O=[],this.#M=[]}_cpy(t,e,i){return this.#M=i.map((t=>t.clone())),this.#O=e.map((t=>t.clone())),this.#I=t,this}prn(){return`node(${m(this.#g)})#[${this.#p}]`}flush(){return this.#I=0,this}clone(){return new b(this.#p,this.#g,this.#o,this.#s)._cpy(this.#I,this.#O,this.#M)}funcOverInLinks(t){return t(this.#O)}addLinkIn(t){return this.#O.push(t),this}addLinkOut(t){return this.#M.push(t),this}static from(t){return new b(t.id,t.neuronType,t.pos,t.activation)}}class k{#T;#A;constructor(t,e){n.append(this.#T=[],t,!0),this.#A=e,t.length=0}clone(){return new k(this.#T.map((t=>t.clone())),this.#A)}compute(t,e=l.ACTIVE){return this.update(t,e)}update(t,e=l.ACTIVE){let i,s,r=[],o=e==l.SNAPSHOT?this.#A:1;function h(t){return t.reduce(((t,e)=>t+e.weight*e.from.output),0)}for(;o--;){r.length=0,s=0,i=0;for(let e,r=0;r<this.#T.length&&(e=this.#T[r],f(e)?(n.assert(i<t.length,`NeuralNet: update with mismatched input size ${t.length}`),e.output=t[i++],i==t.length&&++s):d(e)&&(e.output=c.BIAS,++s),2!=s);++r);this.#T.forEach((t=>{f(t,!0)||(t.output=c.sigmoid(t.funcOverInLinks(h),t.activation),u(t)&&r.push(t.output))}))}return e==l.SNAPSHOT&&this.#T.forEach((t=>t.flush())),r}}class E{#T;#z;#C;#B;#q;#P;#D;#R;#$;#_;#w;#L;get spawnCnt(){return this.#$}get adjScore(){return this.#R}get id(){return this.#P}set spawnCnt(t){this.#$=t}constructor(t,e){this.#D=c.fitFunc(0),this.#T=[],this.#z=[],this.#P=e,this.#L=0,this.#q=t,this.#R=0,this.#$=0,this.#_=t.countInputs(),this.#w=t.countOutputs(),e>0&&t.sample(this.#T,this.#z),this.#j()}#j(){this.#V(),this.#C=[],this.#B=[],this.#K(),this.#T.forEach((t=>f(t,!0)?this.#B.push(t):this.#C.push(t)))}#H(){return this.#T.reduce(((t,e,i)=>t+(0==i?"":", ")+e.prn()),"")}#V(){0}dbgState(){return`{nodes=${this.#H()},links=${this.#z.length}}`}adjustScore(t){return this.#R=t,this}numNeurons(){return this.#T.length}numGenes(){return this.#z.length}setScore(t){return this.#D.update(t),this}getScore(){return this.#D.score()}geneAt(t){return this.#z[t]}neuronAt(t){return this.#T[t]}mutateGID(t){return n.assert(t>0,"bad genome id, must be positive"),this.#P=t,this}_specialClone(t,e,i){return this.#C=[],this.#B=[],e.forEach((t=>f(t,!0)?this.#B.push(t):this.#C.push(t))),n.append(this.#T,e,!0),n.append(this.#z,i,!0),this.#P=t,e.length=0,i.length=0,this}createPhenotype(t){const e=this.#T.map((t=>b.from(t)));return this.#z.forEach((t=>t.enabled?w.from(t,e.find((e=>e.id==t.fromNeuron)),e.find((e=>e.id==t.toNeuron))):0)),new k(e,t)}history(){return this.#q}#F(){return n.randItem(this.#T)}#U(){return n.randItem(this.#C)}addLink(t,i,s,r){if(n.assert(s>=0,"bad param: triesToFindLoop"),n.assert(r>=0,"bad param: triesToAddLink"),n.rand()>t)return;let o,h,l,c=!1;if(n.rand()<i){for(;s--;)if(l=this.#U(),!l.recur){l.setRecur(c=!0),o=h=l;break}}else for(;r--&&(h=this.#U(),o=this.#F(),o.id==h.id||this.#W(o.id,h.id));)o=h=e;o&&h&&(o.posY>h.posY&&(c=!0),this.#q.check(o.id,h.id,a.LINK)<0&&this.#q.create(o.id,h.id,a.LINK),this.#z.push(new v(o.id,h.id,!0,n.randMinus1To1(),c)),this.#K())}addNeuron(t,e){if(n.assert(e>=0,"bad param: triesToFindOldLink"),n.rand()>t)return;let i,s,o,l=-1,c=this.numGenes(),u=c-1-r(Math.sqrt(c)),f=t=>!t.enabled||t.recur||d(this.#G(t.fromNeuron))?-1:t.fromNeuron;if(c<this.#_+this.#w+5)for(;l<0&&e--;)s=this.#z[n.randInt2(0,u)],l=f(s);else for(;l<0;)s=n.randItem(this.#z),l=f(s);if(l<0)return;n.assert(s,"addNeuron: unexpected null link gene!"),s.setEnabled(!1),i=s.toNeuron,n.assert(l>0&&i>0,`addNeuron: bad neuron ids: fromID: ${l}, toID: ${i}`);let p=s.weight,m=this.#G(i),x=this.#G(l),_=(b=x,k=m,n.assert(b&&k,`splitBetween: unexpected null params: from: ${b}, to: ${k}`),new g((b.posX+k.posX)/2,(b.posY+k.posY)/2)),w=this.#q.check(l,i,a.NEURON);var b,k;w>0&&this.#X(this.#q.getNeuronID(w))&&(w=-1),w<0?(o=this.#q.create(l,i,a.NEURON,h.HIDDEN,_).neuronID,n.assert(o>0,`addNeuron: (+) unexpected -ve neuron id ${o}`),this.#q.create(l,o,a.LINK),this.#q.create(o,i,a.LINK)):(o=this.#q.getNeuronID(w),n.assert(o>0,`addNeuron: (x) unexpected -ve neuron id ${o}`)),n.assert(this.#q.check(l,o,a.LINK)>0&&this.#q.check(o,i,a.LINK)>0,"addNeuron: expected innovations"),this.#T.push(new y(o,h.HIDDEN,_)),this.#C.push(this.#T.at(-1)),this.#z.push(new v(l,o,!0,1),new v(o,i,!0,p)),this.#K()}#G(t){let e=this.#T.find((e=>e.id==t));return e||n.assert(!1,"Error in Genome::findNeuron")}#W(t,e){return this.#z.some((i=>i.fromNeuron==t&&i.toNeuron==e))}#X(t){return t>0&&this.#T.some((e=>e.id==t))}mutateWeights(t,e,i){this.#z.forEach((s=>{n.rand()<t&&(s.weight=n.rand()<e?n.randMinus1To1():s.weight+n.randMinus1To1()*i)}))}mutateActivation(t,e){this.#T.forEach((i=>{n.rand()<t&&(i.activation+=n.randMinus1To1()*e)}))}calcCompat(t){let e,i,s,r,n=0,o=0,h=0,a=0,l=0,c=0,u=this.numGenes(),d=t.numGenes();for(;n<u||o<d;)n>=u?(++o,++a):o>=d?(++n,++a):(r=t.geneAt(o),s=this.geneAt(n),i=this.#q.getIID(r),e=this.#q.getIID(s),e==i?(++n,++o,++l,c+=Math.abs(s.weight-r.weight)):(++h,e<i?++n:e>i&&++o));let f=Math.max(this.numGenes(),t.numGenes()),p=1*a/f+1*h/f;return l>0?p+.4*c/l:p}#K(){return this.#z.sort(n.comparator(n.SORT_ASC,(t=>this.#q.getIID(t)),(t=>this.#q.getIID(t)))),this}_cpy(t,e,i,s,r,n,o){return this.#D=c.fitFunc(t.score()),this.#T=n.map((t=>t.clone())),this.#z=o.map((t=>t.clone())),this.#$=s,this.#R=i,this.#L=r,this.#P=e,this.#j(),this}clone(){return new E(this.#q,-1)._cpy(this.#D,this.#P,this.#R,this.#$,this.#L,this.#T,this.#z)}morph(t){return this.#P=t,this.numNeurons()<c.maxNNetNeurons&&this.addNeuron(c.chanceAddNode,c.findOldLink),this.addLink(c.chanceAddLink,c.chanceRecurrent,c.findLoopedLink,c.addLinkAttempts),this.mutateWeights(c.mutationRate,c.chanceSetWeight,c.maxWeightJiggle),this.mutateActivation(c.activationMutation,c.maxActivationJiggle),this}}class N{#J;#Q;#Y;#Z;#tt;#et;#it;get bestScore(){return this.#it}get id(){return this.#J}get leader(){return this.#et}get stale(){return this.#Q}get age(){return this.#Y}constructor(t,e){this.#it=e.getScore(),this.#et=e.clone(),this.#tt=[e],this.#J=t,this.#Z=0,this.#Y=0,this.#Q=0}adjustScores(){return this.#tt.forEach(((t,e,i)=>{e=t.getScore(),this.#Y<c.youngBonusAge&&(e*=c.youngFitnessBonus),this.#Y>c.oldAgeThreshold&&(e*=c.oldAgePenalty),t.adjustScore(e/i.length)})),this}addMember(t){return t.getScore()>this.#it&&(this.#it=t.getScore(),this.#et=t.clone(),this.#Q=0),t.species=this.#J,this.#tt.push(t),this}purge(){return this.#tt.length=0,this.#Z=0,++this.#Q,++this.#Y,this}calcSpawnAmount(){return this.#Z=this.#tt.reduce(((t,e)=>t+e.spawnCnt),0)}spawn(){let t,e,i=this.#tt.length;return 1==i?e=this.#tt[0]:(t=r(c.survivalRate*i)-1,t<0&&(t=1),t>=i&&(t=i-1),e=this.#tt[n.randInt2(0,t)]),e.clone()}randPair(t=5){n.assert(t>=0,"bad param: tries must be positive");let i,s,o,h=this.#tt.length;if(1==h)i=this.#tt[0];else for(o=r(c.survivalRate*h)-1,o<0&&(o=1),o>=h&&(o=h-1),i=this.#tt[n.randInt2(0,o)];t--&&(s=this.#tt[n.randInt2(0,o)],i.id==s.id);)s=e;return s?[i,s]:[i,null]}numToSpawn(){return this.#Z}size(){return this.#tt.length}}function S(t,e,i,s){const r=e-t;return s.push({val:t+r/2,depth:i+1}),i>6||(S(t,t+r/2,i+1,s),S(t+r/2,e,i+1,s)),s}return{NeatGA:class{#st;#rt;#nt;#ot;#ht;#at;#lt;#ct;#ut;#dt;#ft;#pt;constructor(t,e,i){this.#ot=S(0,1,0,[]),this.#ht=[],this.#nt=[],this.#st=0,this.#rt=0,this.#at=0,this.#ft=t,this.#ct=0,this.#ut=0,this.#dt=0,this.#pt=new _(e,i),this.#lt=n.fill(t,(()=>new E(this.#pt,this.#gt())))}curGen(){return this.#at}#mt(t,e){let i,s,r,o,h,a=t.numGenes(),l=e.numGenes(),c=t.getScore()>=e.getScore(),u=[],d=[],f=0,p=0;for(;f!=a||p!=l;)f==a?(c||(i=e.geneAt(p)),++p):p==l?(c&&(i=t.geneAt(f)),++f):(s=t.geneAt(f),r=e.geneAt(p),o=this.#pt.getIID(s),h=this.#pt.getIID(r),o<h?(c&&(i=s),++f):h<o?(c||(i=r),++p):(i=n.randAorB(s,r),++f,++p)),n.assert(i,"crossOver: unexpected null as chosen"),0!=u.length&&this.#pt.getIID(u.at(-1))==this.#pt.getIID(i)||u.push(i.clone()),[i.fromNeuron,i.toNeuron].forEach((t=>d.indexOf(t)<0?d.push(t):0));return i=new E(this.#pt,-1)._specialClone(this.#gt(),d.sort().map((t=>this.#pt.createNeuronFromID(t))),u),i}#yt(){return++this.#st}#gt(){return++this.#rt}tournamentSelection(t){let e,i,s=0;for(n.assert(t>=0,`tournamentSelection: bad arg value: ${t}`);t--;)i=n.randItem(this.#lt),i.getScore()>s&&(e=i,s=i.getScore());return e}calcNetDepth(t){let e=0;for(let i=0;i<t.numNeurons();++i)for(let s=0;s<this.#ot.length;++s)t.neuronAt(i).posY==this.#ot[s].val&&this.#ot[s].depth>e&&(e=this.#ot[s].depth);return e+2}#vt(){this.#lt.forEach(((t,e)=>{(e=this.#nt.find((e=>t.calcCompat(e.leader)<=c.compatThreshold)))?e.addMember(t):this.#nt.push(new N(this.#yt(),t))})),this.#nt.forEach((t=>t.adjustScores())),this.#lt.forEach((t=>this.#ct+=t.adjScore)),this.#ut=this.#ct/this.#lt.length,this.#lt.forEach((t=>t.spawnCnt=t.adjScore/this.#ut)),this.#nt.forEach((t=>t.calcSpawnAmount())),this.#nt.sort(n.comparator(n.SORT_DESC,(t=>t.bestScore),(t=>t.bestScore)))}#xt(t){this.#lt.forEach(((e,i)=>e.setScore(t[i]))),this.#lt.sort(n.comparator(n.SORT_DESC,(t=>t.getScore()),(t=>t.getScore()))),this.#dt=Math.max(this.#dt,this.#lt[0].getScore()),this.#ht.length=0;for(let t=0;t<c.numBestElites;++t)this.#ht.push(this.#lt[t]);return this}#_t(){this.#ct=0,this.#ut=0;let t=[];return this.#nt.forEach((e=>{e.stale>c.noImprovements&&e.bestScore<this.#dt||t.push(e.purge())})),n.append(this.#nt,t,!0),this}epoch(t){n.assert(t.length==this.#lt.length,"NeatGA::Epoch(scores/ genomes mismatch)!"),this.#_t()&&this.#xt(t)&&this.#vt();let e,i=[],s=0;if(this.#nt.forEach((t=>{if(s<this.#ft){let r=!1,o=n.rounded(t.numToSpawn());for(;o--;){if(r)if(1==t.size()||n.rand()>c.crossOverRate)e=t.spawn();else{let[i,s]=t.randPair(5);e=s?this.#mt(i,s):i.clone()}else r=!0,e=t.leader.clone();if(i.push(e.morph(this.#gt())),++s==this.#ft)break}}})),s<this.#ft){let t=this.#ft-s;for(;t--;)i.push(this.tournamentSelection(r(this.#ft/5)).clone())}return n.append(this.#lt,i,!0),++this.#at,this.createPhenotypes()}createPhenotypes(){return this.#lt.map((t=>t.createPhenotype(this.calcNetDepth(t))))}numSpecies(){return this.#nt.length}bestFromPrevGen(){return this.#ht.map((t=>t.createPhenotype(this.calcNetDepth(t))))}},NeuralNet:k,Genome:E,NeuronGene:y,LinkGene:v,NLink:w,NNeuron:b,Species:N,FitFunc:p,InnovHistory:_,NeuronType:h,InnovType:a,RunType:l,configParams:t=>n.inject(c,t)}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/NEAT_Buckland"]=i}(this),function(t,e){"use strict";function i(e,i){e||(e=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]());const s=Math.floor,{u:r,is:n}=e,o=0,h=1,a=2,l=3,c={nextInnov:42,BIAS:1,probMutateWeight:.1,probMutateLink:.8,probAddLink:.05,probAddNode:.01,probCancelLink:.75,maxPerturbation:50,crossOverRate:.25,staleLimit:15,excessCoeff:1,weightDiffCoeff:.5,compatibilityThreshold:3};class u{#wt;#bt;#kt;#u;#c;get from(){return this.#wt}get to(){return this.#bt}get weight(){return this.#u}get innovID(){return this.#kt}set weight(t){this.#u=t}get enabled(){return this.#c}turnOff(){return this.#c=!1,this}turnOn(){return this.#c=!0,this}toggle(t){return this.#c=t,this}constructor(t,e,i,s,r=!0){this.#wt=t,this.#bt=e,this.#u=i,this.#kt=s,this.#c=!1!==r}mutate(){return this.#u=r.rand()<c.probMutateWeight?r.randMinus1To1():i.clamp(-1,1,this.#u+r.randGaussian()/c.maxPerturbation),this}clone(t,e){return new u(t,e,this.#u,this.#kt,this.#c)}}class d{#Et;#Nt;#St;#kt;constructor(t,e,i,s){this.#Et=t,this.#Nt=e,this.#kt=i,r.append(this.#St=[],s,!0)}size(){return this.#St.length}matches(t,e,i){return t.size()==this.size()&&e.id==this.#Et&&i.id==this.#Nt&&t.match(this.#St)}}class f{#q;constructor(){this.#q=[]}getAt(t){return this.#q[t]}find(t){return this.#q.find(t)}append(t){return this.#q.push(t),this}}class p{#Mt;#Ot;#It;#Tt;#n;#h;get output(){return this.#Mt}set output(t){this.#Mt=t}get inputSum(){return this.#It}get id(){return this.#h}get type(){return this.#n}get layer(){return this.#Tt}static checkSibling(t,e){return t.layer<e.layer?-1:t.layer>e.layer?1:0}static isSibling(t,e){return t.layer==e.layer}constructor(t,e,i){this.#Ot=[],this.#It=0,this.#Mt=0,this.#Tt=i,this.#n=e,this.#h=t}moveTo(t){return this.#Tt=t,this}flush(){return r.trunc(this.#Ot),this.#Mt=0,this.#It=0,this}resetInput(t){return this.#It=t,this}addInput(t){return this.#It+=t,this}addOutLink(t){return this.#Ot.push(t),this}activate(){return this.#Tt!=o&&(this.#Mt=this.#At(this.#It)),this.#Ot.forEach((t=>t.enabled?t.to.addInput(t.weight*this.#Mt):0)),this}#At(t){return 1/(1+Math.pow(Math.E,-4.9*t))}_olinks(){return this.#Ot}isLinked(t){let e=p.checkSibling(t,this);return e<0?t._olinks().find((t=>t.to.id==this.id)):e>0&&this.#Ot.find((e=>e.to.id==t.id))}clone(){return new p(this.#h,this.#n,this.#Tt)}}class g{#w;#zt;#Ct;#Bt;#_;constructor(t){this.#Ct=t.copyNodes(),this.#Bt=[],this.#_=this.#Ct.reduce(((t,e)=>e.type==o?t+1:t),0),this.#w=this.#Ct.reduce(((t,e)=>e.type==h?t+1:t),0);for(let e=0;e<t.depth;++e)this.#Ct.forEach((t=>{t.type==a&&(this.#zt=t),t.layer==e&&this.#Bt.push(t)}));r.assert(this.#zt,`no bias? with depth= ${t.depth}`)}compute(t){return this.update(t)}update(t){r.assert(t.length==this.#_,`update: expecting ${this.#_} inputs but got ${t.length}`),this.#Ct.forEach(((e,i)=>e.type==o?e.output=t[i]:0)),this.#zt.output=c.BIAS,this.#Bt.forEach((t=>t.activate()));let e=this.#Ct.reduce(((t,e)=>e.type==h?t.push(e.output)&&t:t),[]);return this.#Ct.forEach((t=>t.resetInput(0))),e}}class m{#qt;#w;#_;#Pt;#Ct;#Dt;#Rt;#D;get depth(){return this.#Dt}constructor(t,e){this.#w=e,this.#_=t,this.#$t()}#$t(){this.#Pt=[],this.#Ct=[],this.#Dt=0,this.#qt=1,this.#D=0}build(){this.#$t();for(let t=0;t<this.#_;++t)this.#Ct.push(new p(this.#E(),o,0));this.#Dt+=1;for(let t=0;t<this.#w;++t)this.#Ct.push(new p(this.#E(),h,1));return this.#Dt+=1,this.#Ct.push(new p(this.#E(),a,0)),this}geneAt(t){return this.#Pt[t]}nodeAt(t){return this.#Ct[t]}biasNode(){return this.#Ct.find((t=>t.type==a))}copyNodes(){return this.#Ct.map((t=>t))}isEmpty(){return 0==this.#Pt.length}size(){return this.#Pt.length}getScore(){return this.#D}setScore(t){return this.#D=t,this}getNode(t){return this.#Ct.find((e=>e.id==t))}#Lt(){return this.#Ct.forEach((t=>t.flush())),this.#Pt.forEach((t=>t.from.addOutLink(t))),this}reify(){return this.#Lt(),new g(this)}addLink(t){if(!this.#jt()){let e,i=r.randItem(this.#Ct),s=r.randItem(this.#Ct),n=(t,e)=>t.layer==e.layer||t.isLinked(e);for(;n(i,s);)i=r.randItem(this.#Ct),s=r.randItem(this.#Ct);i.layer>s.layer&&(e=s,s=i,i=e),this.#Pt.push(new u(i,s,r.randMinus1To1(),this.getInnov(t,i,s))),this.#Lt()}return this}addNode(t){if(this.isEmpty())return this.addLink(t);let e,i=this.biasNode(),s=r.randItem(this.#Pt);for(;s.from.id==i.id&&this.size()>1;)s=r.randItem(this.#Pt);if(s.turnOff(),this.#Ct.push(e=new p(this.#E(),l,2)),this.#Pt.push(new u(s.from,e,1,this.getInnov(t,s.from,e))),this.#Pt.push(new u(e,s.to,s.weight,this.getInnov(t,e,s.to))),e.moveTo(s.from.layer+1),this.#Pt.push(new u(i,e,0,this.getInnov(t,i,e))),p.isSibling(e,s.to)){for(let t,i=0;i<this.#Ct.length-1;++i)t=this.#Ct[i],p.checkSibling(t,e)>=0&&t.moveTo(t.layer+1);++this.#Dt}return this.#Lt()}getInnov(t,e,i){let s=c.nextInnov,r=t.find((t=>t.matches(this,e,i)));return r||(t.append(new d(e.id,i.id,s,this.#Pt.map((t=>t.innovID)))),++c.nextInnov),r?r.innovID:s}#jt(){let t=0,e=[];for(let t=0;t<this.#Dt;++t)e[t]=0;this.#Ct.forEach((t=>e[t.layer]+=1));for(let i,s=0;s<this.#Dt-1;++s){i=0;for(let t=s+1;t<this.#Dt;++t)i+=e[t];t+=e[s]*i}return t<=this.size()}mutate(t){return this.isEmpty()&&this.addLink(t),r.rand<c.probMutateLink&&this.#Pt.forEach((t=>t.mutate())),r.rand()<c.probAddLink&&this.addLink(t),r.rand()<c.probAddNode&&this.addNode(t),this}_introspect(){let t=0,e=0;return this.#Ct.forEach((i=>{i.layer>t&&(t=i.layer),i.id>e&&(e=i.id)})),this.#qt=e+1,this.#Dt=t+1,this}cloneNode(t){return this.#Ct.push(t.clone()),this}cloneGene(t,e){return this.#Pt.push(t.clone(this.getNode(t.from.id),this.getNode(t.to.id)).toggle(e)),this}crossOver(t){let e=[],i=[],s=new m(this.#_,this.#w);return this.#Pt.forEach((s=>{let n=!0,o=t.findGene(s.innovID);o?(s.enabled&&o.enabled||r.rand()<c.probCancelLink&&(n=!1),i.push(r.randAorB(s,o))):(n=s.enabled,i.push(s)),e.push(n)})),this.#Ct.forEach((t=>s.cloneNode(t))),i.forEach(((t,i)=>s.cloneGene(t,e[i]))),s._introspect().#Lt()}findGene(t){return this.#Pt.find((e=>e.innovID==t))}clone(){let t=new m(this.#_,this.#w);return this.#Ct.forEach((e=>t.cloneNode(e))),this.#Pt.forEach((e=>t.cloneGene(e,e.enabled))),t._introspect().#Lt()}match(t){return this.#Pt.every((e=>t.includes(e.innovID)))}countMatching(t){let e=0;return this.#Pt.forEach((i=>t.findGene(i.innovID)?++e:0)),e}#E(){return this.#qt++}}class y{#it;#Vt;#Kt;#Ht;#Q;get avgScore(){return this.#Vt}get alpha(){return this.#Ht}get bestScore(){return this.#it}constructor(t){this.#it=t.getScore(),this.#Ht=t.clone(),this.#Kt=[],this.#Vt=0,this.#Q=0,this.#Kt.push(t)}compatible(t){let e=this.#Ft(t,this.#Ht),i=this.#Ut(t,this.#Ht),s=t.size()-20;return s<1&&(s=1),c.compatibilityThreshold>c.excessCoeff*e/s+c.weightDiffCoeff*i}add(t){this.#Kt.push(t)}#Ft(t,e){return t.size()+e.size()-2*t.countMatching(e)}#Ut(t,e){let i=0,s=0;for(let r=0;r<t.size();++r)for(let n=0;n<e.size();++n)if(t.geneAt(r).innovID==e.geneAt(n).innovID){++s,i+=Math.abs(t.geneAt(r).weight-e.geneAt(n).weight);break}return 0==s?t.isEmpty()||e.isEmpty()?0:100:i/s}sort(){return this.#Kt.sort(r.comparator(r.SORT_DESC,(t=>t.getScore()),(t=>t.getScore()))),0==this.#Kt.length?this.#Q=200:this.#Kt[0].getScore()>this.#it?(this.#it=this.#Kt[0].getScore(),this.#Ht=this.#Kt[0].clone(),this.#Q=0):++this.stale,this}isEmpty(){return 0==this.#Kt.length}size(){return this.#Kt.length}setAverage(){return this.#Vt=this.#Kt.reduce(((t,e)=>t+e.getScore()),0)/this.size(),this}spawn(t){let e;if(r.rand()<c.crossOverRate)e=this.#F().clone();else{let t=this.#F(),i=this.#F();e=t.getScore()<i.getScore()?i.crossOver(t):t.crossOver(i)}return e.mutate(t)}#F(){let t=this.#Kt.reduce(((t,e)=>t+e.getScore()),0)*r.rand(),e=0;return this.#Kt.find((i=>{if(e+=i.getScore(),e>t)return!0}))||this.#Kt[0]}cull(){if(this.#Kt.length>2)for(let t=this.#Kt.length/2;t<this.#Kt.length;++t)this.#Kt.splice(t,1),--t;return this}flush(){return r.trunc(this.#Kt),this}normalize(){return this.#Kt.forEach((t=>t.setScore(t.getScore()/this.size()))),this.#Vt=this.#Kt.reduce(((t,e)=>t+e.getScore()),0)/this.size(),this}}return{NeatGA:class{#Wt;#Gt;#q;#Xt;#L;#Jt;#Qt;get popSize(){return this.#Jt}constructor(t,e,i){this.#Wt=i,this.#Gt=e,this.#Jt=t,this.#q=new f,this.#Qt=1,this.#Xt=[],this.#L=[];for(let s=0;s<t;++s)this.#Xt=r.fill(t,(()=>new m(e,i).build().mutate(this.#q)))}curGen(){return this.#Qt}createPhenotypes(){return this.#Xt.map((t=>t.reify()))}epoch(t){1==this.#Qt||this.#Xt[0];this.#vt(),this.#Yt(t),this.#Zt(),this.#te(),this.#ee(),this.#ie();let e=[],i=this.#se();for(this.#L.forEach((t=>{e.push(t.alpha.clone());let r=s(t.avgScore/i*this.popSize)-1;for(let i=0;i<r;++i)e.push(t.spawn(this.#q))})),e.length<this.popSize&&e.push(this.#L[0].alpha.clone());e.length<this.popSize;)e.push(this.#L[0].spawn(this.#q));return r.append(this.#Xt,e,!0),this.#Qt+=1,this.createPhenotypes()}#vt(){this.#L.forEach((t=>t.flush())),this.#Xt.forEach(((t,e)=>{(e=this.#L.find((e=>e.compatible(t))))?e.add(t):this.#L.push(new y(t))}))}#Yt(t){return this.#Xt.forEach(((e,i)=>e.setScore(t[i]))),this}#Zt(){this.#L.forEach((t=>t.sort())),this.#L.sort(r.comparator(r.SORT_DESC,(t=>t.bestScore),(t=>t.bestScore)))}#ee(){for(let t=2;t<this.#L.length;++t)this.#L[t].stale>=c.staleLimit&&(this.#L.splice(t,1),--t)}#ie(){let t=this.popSize,e=this.#se();for(let i=1;i<this.#L.length;++i)this.#L[i].avgScore/e*t<1&&(this.#L.splice(i,1),--i)}#se(){return this.#L.reduce(((t,e)=>t+e.avgScore),0)}#te(){return this.#L.forEach((t=>t.cull().normalize())),this}},Genome:m,Link:u,Node:p,Species:y,Innovation:d,InnovHistory:f,configParams:t=>r.inject(c,t)}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/NEAT_CBullet"]=i}(this),function(t,e){"use strict";function i(e,i){e||(e=t["io/czlab/mcfud/core"]()),i||(i=t["io/czlab/mcfud/math"]());const{is:s,u:r}=e;function n(t,e,i){return e>t.length-1?t:`${t.substr(0,e)}${i}${t.substr(e+1)}`}function o(t,e){return+t.charAt(e)}class h{static DV={n:1,s:2,e:4,w:8};static DX={e:1,w:-1,n:0,s:0};static DY={e:0,w:0,n:-1,s:1};static OPPOSITE={e:"w",w:"e",n:"s",s:"n"};constructor(t,e){this.COLS=t,this.ROWS=e,this._getEntryNodes()}_getEntryNodes(){let t={},e=2*this.ROWS+1-2,i=2*this.COLS+1-2;t.start={x:1,y:1,gate:{x:0,y:1}},t.end={x:i,y:e,gate:{x:i+1,y:e}},this.entryNodes=t}getIO(){let t=this.entryNodes.end.gate,e=this.entryNodes.start.gate;return{start:[e.x,e.y],end:[t.x,t.y]}}generate(){this.grid=this._walk(0,0,r.fill(this.ROWS,(()=>r.fill(this.COLS,0))))}canSouth(t){return!!(t&h.DV.s)}canEast(t){return!!(t&h.DV.e)}toAscii(){let t=this.grid,e=t.length,i=[],s=t[0].length;for(let r,n=0;n<e;++n){r="|";for(let e=0;e<s;++e)r+=this.canSouth(t[n][e])?" ":"_",this.canEast(t[n][e])?r+=this.canSouth(t[n][e]|t[n][e+1])?" ":"_":r+="|";i.push(r)}return i.unshift("_".repeat(i[0].length)),i.join("\n")}_walk(t,e,i){let s,n;return r.shuffle(["n","s","e","w"]).forEach((r=>{s=t+h.DX[r],n=e+h.DY[r],n>=0&&n<i.length&&s>=0&&s<i[n].length&&0==i[n][s]&&(i[e][t]|=h.DV[r],i[n][s]|=h.DV[h.OPPOSITE[r]],this._walk(s,n,i))})),i}toGrid(){let t,e,i=this.grid,s=i.length,n=[],o=i[0].length;for(let r,h=0;h<s;++h){t=[],e=[],r=0,t[r]=1,e[r]=1;for(let s=0;s<o;++s)++r,this.canSouth(i[h][s])?(t[r]=0,e[r]=0):(t[r]=0,e[r]=1),++r,this.canEast(i[h][s])?(t[r]=0,e[r]=1):(t[r]=1,e[r]=1);n.push(t,e)}return n.unshift(r.fill(n[0].length,1)),n}}return{Maze1:class{constructor(t,e,i="D",s={}){let{bias:r,removeWalls:n,maxWallsRemove:o}=s;this.bias=r||"",this.removeWalls=n||0,this.maxWallsRemove=o||300,this.ROWS=t,this.COLS=e,this.matrix=[],this.entryNodes=this.getEntryNodes(i)}generate(){this.getMatrix(this.parseMaze(r.fill(this.COLS*this.ROWS,(()=>"01111")))),this.removeMazeWalls()}toAscii(){return""}getIO(){let t=this.entryNodes.end.gate,e=this.entryNodes.start.gate;return{start:[e.x,e.y],end:[t.x,t.y]}}toGrid(){let t,e=[];return this.matrix.forEach(((i,s)=>{t=[];for(let e=0;e<i.length;++e)t[e]="1"==i.charAt(e)?1:0;e.push(t)})),e}parseMaze(t){const e={n:1,s:2,w:3,e:4},s={n:2,s:1,w:4,e:3};let h,a,l,c=0,u=[],d=0,f=3,p=t.length-1,g=r.randInt(t.length);for(this.bias&&("H"==this.bias?f=this.COLS/100>=1?i.ndiv(this.COLS,100)+2:3:"V"==this.bias&&(f=this.ROWS/100>=1?i.ndiv(this.ROWS,100)+2:3)),t[g]=n(t[g],0,1);c<p;)if(++d,h=this.getNeighbours(g),l=Object.keys(h).filter((e=>-1!=h[e]&&!o(t[h[e]],0))),this.bias&&d!=f?l=this.biasDirections(l):d=0,l.length)++c,l.length>1&&u.push(g),a=l[r.randInt(l.length)],t[g]=n(t[g],e[a],0),g=h[a],t[g]=n(t[g],s[a],0),t[g]=n(t[g],0,1);else{if(0==u.length)break;g=u.pop()}return t}getMatrix(t){let e="",i="",s=this.COLS*this.ROWS;r.assert(t.length==s,"invalid nodes");for(let r=0;r<s;++r){if(e+=0==e.length?"1":"",i+=0==i.length?"1":"",o(t[r],1))e+="11",i+=o(t[r],4)?"01":"00";else{let s=t.hasOwnProperty(r-this.COLS)&&o(t[r-this.COLS],4),n=t.hasOwnProperty(r+1)&&o(t[r+1],1);o(t[r],4)?(e+="01",i+="01"):n||s?(e+="01",i+="00"):(e+="00",i+="00")}(r+1)%this.COLS==0&&(this.matrix.push(e,i),e="",i="")}this.matrix.push("1".repeat(2*this.COLS+1))}getEntryNodes(t){let e={},i=2*this.ROWS+1-2,s=2*this.COLS+1-2;if("D"==t&&(e.start={x:1,y:1,gate:{x:0,y:1}},e.end={x:s,y:i,gate:{x:s+1,y:i}}),"H"==t||"V"==t){let r="H"==t?i:s;r=(r-1)/2;let n=r%2==0;r=n?r+1:r;let o="H"==t?1:r,h="H"==t?r:1,a="H"==t?s:n?o:o+2,l="H"==t?n?h:h+2:i,c="H"==t?{x:0,y:h}:{x:o,y:0},u="H"==t?{x:s+1,y:l}:{x:a,y:i+1};e.start={x:o,y:h,gate:c},e.end={x:a,y:l,gate:u}}return e}biasDirections(t){let e=-1!=t.indexOf("w")||-1!=t.indexOf("e"),i=-1!=t.indexOf("n")||-1!=t.indexOf("s");return"H"==this.bias&&e?t.filter((t=>"w"==t||"e"==t)):"V"==this.bias&&i?t.filter((t=>"n"==t||"s"==t)):t}getNeighbours(t){return{w:t>0&&t%this.COLS!=0?t-1:-1,e:(t+1)%this.COLS!=0?t+1:-1,n:t-this.COLS>=0?t-this.COLS:-1,s:this.COLS*this.ROWS>t+this.COLS?t+this.COLS:-1}}removeWall(t,e){const i=t%2==0,s=e%2==0;if(!o(this.matrix[t],e))return!1;if(!i&&s){const i=t-2>0&&1==o(this.matrix[t-2],e),s=t+2<this.matrix.length&&1==o(this.matrix[t+2],e);if(i&&s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0;if(!i&&s){const i=1==o(this.matrix[t-1],e-1),s=1==o(this.matrix[t-1],e+1);if(i||s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}else if(!s&&i){const i=1==o(this.matrix[t+1],e-1),s=1==o(this.matrix[t+1],e+1);if(i||s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}}else if(i&&!s){const i=1==o(this.matrix[t],e-2),s=1==o(this.matrix[t],e+2);if(i&&s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0;if(!i&&s){const i=1==o(this.matrix[t-1],e-1),s=1==o(this.matrix[t+1],e-1);if(i||s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}else if(!s&&i){const i=1==o(this.matrix[t-1],e+1),s=1==o(this.matrix[t+1],e+1);if(i||s)return this.matrix[t]=n(this.matrix[t],e,"0"),!0}}}removeMazeWalls(){if(0==this.removeWalls||0==this.matrix.length)return;let t,e,i=0,s=this.matrix.length-1,n=this.maxWallsRemove;for(;i<n&&(++i,!(this.wallsRemoved>=this.removeWalls));){let i=r.randInt2(1,s);i=i==s?i-1:i,e=[],t=this.matrix[i];for(let i=0;i<t.length;i++)0!=i&&i!=t.length-1&&o(t,i)&&e.push(i);r.shuffle(e);for(let t=0;t<e.length;t++)if(this.removeWall(i,e[t])){++this.wallsRemoved;break}}}},Maze2:h}}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("../main/math")):t["io/czlab/mcfud/algo/maze"]=i}(this),function(t,e){"object"==typeof exports?module.exports=exports=e():"function"==typeof define&&define.amd?define([],e):t.CryptoJS=e()}(this,(function(){var t,e,i,s,r,n,o,h,a,l,c,u,d,f,p,g,m,y,v,x,_,w,b,k,E,N,S,M,O,I,T,A,z,C,B,q,P,D,R,$=$||function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),!(e=!(e=!(e="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:e)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:e)&&"undefined"!=typeof global&&global.crypto?global.crypto:e)&&"function"==typeof require)try{e=require("crypto")}catch(r){}var i=Object.create||function(t){return s.prototype=t,t=new s,s.prototype=null,t};function s(){}var r={},n=r.lib={},o=n.Base={extend:function(t){var e=i(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),(e.init.prototype=e).$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},h=n.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,i=t.words,s=this.sigBytes,r=t.sigBytes;if(this.clamp(),s%4)for(var n=0;n<r;n++){var o=i[n>>>2]>>>24-n%4*8&255;e[s+n>>>2]|=o<<24-(s+n)%4*8}else for(var h=0;h<r;h+=4)e[s+h>>>2]=i[h>>>2];return this.sigBytes+=r,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],s=0;s<t;s+=4)i.push(function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new h.init(i,t)}}),a=r.enc={},l=a.Hex={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],r=0;r<i;r++){var n=e[r>>>2]>>>24-r%4*8&255;s.push((n>>>4).toString(16)),s.push((15&n).toString(16))}return s.join("")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s+=2)i[s>>>3]|=parseInt(t.substr(s,2),16)<<24-s%8*4;return new h.init(i,e/2)}},c=a.Latin1={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],r=0;r<i;r++){var n=e[r>>>2]>>>24-r%4*8&255;s.push(String.fromCharCode(n))}return s.join("")},parse:function(t){for(var e=t.length,i=[],s=0;s<e;s++)i[s>>>2]|=(255&t.charCodeAt(s))<<24-s%4*8;return new h.init(i,e)}},u=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i,s=this._data,r=s.words,n=s.sigBytes,o=this.blockSize,a=n/(4*o),l=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*o;n=t.min(4*l,n);if(l){for(var c=0;c<l;c+=o)this._doProcessBlock(r,c);i=r.splice(0,l),s.sigBytes-=n}return new h.init(i,n)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),f=(n.Hasher=d.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new f.HMAC.init(t,i).finalize(e)}}}),r.algo={});return r}(Math);function L(t,e,i){return t&e|~t&i}function j(t,e,i){return t&i|e&~i}function V(t,e){return t<<e|t>>>32-e}function K(t,e,i,s){var r,n=this._iv;n?(r=n.slice(0),this._iv=void 0):r=this._prevBlock,s.encryptBlock(r,0);for(var o=0;o<i;o++)t[e+o]^=r[o]}function H(t){var e,i,s;return 255&~(t>>24)?t+=1<<24:(i=t>>8&255,s=255&t,255==(e=t>>16&255)?(e=0,255===i?(i=0,255===s?s=0:++s):++i):++e,t=0,t+=e<<16,t+=i<<8,t+=s),t}function F(){for(var t=this._X,e=this._C,i=0;i<8;i++)A[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<A[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<A[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<A[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<A[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<A[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<A[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<A[6]>>>0?1:0)|0,this._b=e[7]>>>0<A[7]>>>0?1:0,i=0;i<8;i++){var s=t[i]+e[i],r=65535&s,n=s>>>16;z[i]=((r*r>>>17)+r*n>>>15)+n*n^((4294901760&s)*s|0)+((65535&s)*s|0)}t[0]=z[0]+(z[7]<<16|z[7]>>>16)+(z[6]<<16|z[6]>>>16)|0,t[1]=z[1]+(z[0]<<8|z[0]>>>24)+z[7]|0,t[2]=z[2]+(z[1]<<16|z[1]>>>16)+(z[0]<<16|z[0]>>>16)|0,t[3]=z[3]+(z[2]<<8|z[2]>>>24)+z[1]|0,t[4]=z[4]+(z[3]<<16|z[3]>>>16)+(z[2]<<16|z[2]>>>16)|0,t[5]=z[5]+(z[4]<<8|z[4]>>>24)+z[3]|0,t[6]=z[6]+(z[5]<<16|z[5]>>>16)+(z[4]<<16|z[4]>>>16)|0,t[7]=z[7]+(z[6]<<8|z[6]>>>24)+z[5]|0}function U(){for(var t=this._X,e=this._C,i=0;i<8;i++)D[i]=e[i];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<D[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<D[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<D[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<D[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<D[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<D[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<D[6]>>>0?1:0)|0,this._b=e[7]>>>0<D[7]>>>0?1:0,i=0;i<8;i++){var s=t[i]+e[i],r=65535&s,n=s>>>16;R[i]=((r*r>>>17)+r*n>>>15)+n*n^((4294901760&s)*s|0)+((65535&s)*s|0)}t[0]=R[0]+(R[7]<<16|R[7]>>>16)+(R[6]<<16|R[6]>>>16)|0,t[1]=R[1]+(R[0]<<8|R[0]>>>24)+R[7]|0,t[2]=R[2]+(R[1]<<16|R[1]>>>16)+(R[0]<<16|R[0]>>>16)|0,t[3]=R[3]+(R[2]<<8|R[2]>>>24)+R[1]|0,t[4]=R[4]+(R[3]<<16|R[3]>>>16)+(R[2]<<16|R[2]>>>16)|0,t[5]=R[5]+(R[4]<<8|R[4]>>>24)+R[3]|0,t[6]=R[6]+(R[5]<<16|R[5]>>>16)+(R[4]<<16|R[4]>>>16)|0,t[7]=R[7]+(R[6]<<8|R[6]>>>24)+R[5]|0}return B=(C=$).lib,t=B.Base,e=B.WordArray,(C=C.x64={}).Word=t.extend({init:function(t,e){this.high=t,this.low=e}}),C.WordArray=t.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,i=t.length,s=[],r=0;r<i;r++){var n=t[r];s.push(n.high),s.push(n.low)}return e.create(s,this.sigBytes)},clone:function(){for(var e=t.clone.call(this),i=e.words=this.words.slice(0),s=i.length,r=0;r<s;r++)i[r]=i[r].clone();return e}}),"function"==typeof ArrayBuffer&&(q=$.lib.WordArray,i=q.init,(q.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var e=t.byteLength,s=[],r=0;r<e;r++)s[r>>>2]|=t[r]<<24-r%4*8;i.call(this,s,e)}else i.apply(this,arguments)}).prototype=q),function(){var t,e=(t=$).lib.WordArray;function i(t){return t<<8&4278255360|t>>>8&16711935}(t=t.enc).Utf16=t.Utf16BE={stringify:function(t){for(var e=t.words,i=t.sigBytes,s=[],r=0;r<i;r+=2){var n=e[r>>>2]>>>16-r%4*8&65535;s.push(String.fromCharCode(n))}return s.join("")},parse:function(t){for(var i=t.length,s=[],r=0;r<i;r++)s[r>>>1]|=t.charCodeAt(r)<<16-r%2*16;return e.create(s,2*i)}},t.Utf16LE={stringify:function(t){for(var e=t.words,s=t.sigBytes,r=[],n=0;n<s;n+=2){var o=i(e[n>>>2]>>>16-n%4*8&65535);r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var s=t.length,r=[],n=0;n<s;n++)r[n>>>1]|=i(t.charCodeAt(n)<<16-n%2*16);return e.create(r,2*s)}}}(),s=(S=$).lib.WordArray,S.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,s=this._map;t.clamp();for(var r=[],n=0;n<i;n+=3)for(var o=(e[n>>>2]>>>24-n%4*8&255)<<16|(e[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|e[n+2>>>2]>>>24-(n+2)%4*8&255,h=0;h<4&&n+.75*h<i;h++)r.push(s.charAt(o>>>6*(3-h)&63));var a=s.charAt(64);if(a)for(;r.length%4;)r.push(a);return r.join("")},parse:function(t){var e=t.length,i=this._map;if(!(r=this._reverseMap))for(var r=this._reverseMap=[],n=0;n<i.length;n++)r[i.charCodeAt(n)]=n;var o=i.charAt(64);return!o||-1!==(o=t.indexOf(o))&&(e=o),function(t,e,i){for(var r=[],n=0,o=0;o<e;o++){var h,a;o%4&&(h=i[t.charCodeAt(o-1)]<<o%4*2,a=i[t.charCodeAt(o)]>>>6-o%4*2,a|=h,r[n>>>2]|=a<<24-n%4*8,n++)}return s.create(r,n)}(t,e,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r=(B=$).lib.WordArray,B.enc.Base64url={stringify:function(t,e=!0){var i=t.words,s=t.sigBytes,r=e?this._safe_map:this._map;t.clamp();for(var n=[],o=0;o<s;o+=3)for(var h=(i[o>>>2]>>>24-o%4*8&255)<<16|(i[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|i[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<s;a++)n.push(r.charAt(h>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(t,e=!0){var i=t.length,s=e?this._safe_map:this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],o=0;o<s.length;o++)n[s.charCodeAt(o)]=o;return!(e=s.charAt(64))||-1!==(e=t.indexOf(e))&&(i=e),function(t,e,i){for(var s=[],n=0,o=0;o<e;o++){var h,a;o%4&&(h=i[t.charCodeAt(o-1)]<<o%4*2,a=i[t.charCodeAt(o)]>>>6-o%4*2,a|=h,s[n>>>2]|=a<<24-n%4*8,n++)}return r.create(s,n)}(t,i,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},function(t){var e=$,i=(r=e.lib).WordArray,s=r.Hasher,r=e.algo,n=[];function o(t,e,i,s,r,n,o){return((o=t+(e&i|~e&s)+r+o)<<n|o>>>32-n)+e}function h(t,e,i,s,r,n,o){return((o=t+(e&s|i&~s)+r+o)<<n|o>>>32-n)+e}function a(t,e,i,s,r,n,o){return((o=t+(e^i^s)+r+o)<<n|o>>>32-n)+e}function l(t,e,i,s,r,n,o){return((o=t+(i^(e|~s))+r+o)<<n|o>>>32-n)+e}!function(){for(var e=0;e<64;e++)n[e]=4294967296*t.abs(t.sin(e+1))|0}(),r=r.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var s=e+i,r=t[s];t[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var c=this._hash.words,u=t[e+0],d=t[e+1],f=t[e+2],p=t[e+3],g=t[e+4],m=t[e+5],y=t[e+6],v=t[e+7],x=t[e+8],_=t[e+9],w=t[e+10],b=t[e+11],k=t[e+12],E=t[e+13],N=t[e+14],S=t[e+15],M=o(M=c[0],T=c[1],I=c[2],O=c[3],u,7,n[0]),O=o(O,M,T,I,d,12,n[1]),I=o(I,O,M,T,f,17,n[2]),T=o(T,I,O,M,p,22,n[3]);M=o(M,T,I,O,g,7,n[4]),O=o(O,M,T,I,m,12,n[5]),I=o(I,O,M,T,y,17,n[6]),T=o(T,I,O,M,v,22,n[7]),M=o(M,T,I,O,x,7,n[8]),O=o(O,M,T,I,_,12,n[9]),I=o(I,O,M,T,w,17,n[10]),T=o(T,I,O,M,b,22,n[11]),M=o(M,T,I,O,k,7,n[12]),O=o(O,M,T,I,E,12,n[13]),I=o(I,O,M,T,N,17,n[14]),M=h(M,T=o(T,I,O,M,S,22,n[15]),I,O,d,5,n[16]),O=h(O,M,T,I,y,9,n[17]),I=h(I,O,M,T,b,14,n[18]),T=h(T,I,O,M,u,20,n[19]),M=h(M,T,I,O,m,5,n[20]),O=h(O,M,T,I,w,9,n[21]),I=h(I,O,M,T,S,14,n[22]),T=h(T,I,O,M,g,20,n[23]),M=h(M,T,I,O,_,5,n[24]),O=h(O,M,T,I,N,9,n[25]),I=h(I,O,M,T,p,14,n[26]),T=h(T,I,O,M,x,20,n[27]),M=h(M,T,I,O,E,5,n[28]),O=h(O,M,T,I,f,9,n[29]),I=h(I,O,M,T,v,14,n[30]),M=a(M,T=h(T,I,O,M,k,20,n[31]),I,O,m,4,n[32]),O=a(O,M,T,I,x,11,n[33]),I=a(I,O,M,T,b,16,n[34]),T=a(T,I,O,M,N,23,n[35]),M=a(M,T,I,O,d,4,n[36]),O=a(O,M,T,I,g,11,n[37]),I=a(I,O,M,T,v,16,n[38]),T=a(T,I,O,M,w,23,n[39]),M=a(M,T,I,O,E,4,n[40]),O=a(O,M,T,I,u,11,n[41]),I=a(I,O,M,T,p,16,n[42]),T=a(T,I,O,M,y,23,n[43]),M=a(M,T,I,O,_,4,n[44]),O=a(O,M,T,I,k,11,n[45]),I=a(I,O,M,T,S,16,n[46]),M=l(M,T=a(T,I,O,M,f,23,n[47]),I,O,u,6,n[48]),O=l(O,M,T,I,v,10,n[49]),I=l(I,O,M,T,N,15,n[50]),T=l(T,I,O,M,m,21,n[51]),M=l(M,T,I,O,k,6,n[52]),O=l(O,M,T,I,p,10,n[53]),I=l(I,O,M,T,w,15,n[54]),T=l(T,I,O,M,d,21,n[55]),M=l(M,T,I,O,x,6,n[56]),O=l(O,M,T,I,S,10,n[57]),I=l(I,O,M,T,y,15,n[58]),T=l(T,I,O,M,E,21,n[59]),M=l(M,T,I,O,g,6,n[60]),O=l(O,M,T,I,b,10,n[61]),I=l(I,O,M,T,f,15,n[62]),T=l(T,I,O,M,_,21,n[63]),c[0]=c[0]+M|0,c[1]=c[1]+T|0,c[2]=c[2]+I|0,c[3]=c[3]+O|0},_doFinalize:function(){var e=this._data,i=e.words,s=8*this._nDataBytes,r=8*e.sigBytes;i[r>>>5]|=128<<24-r%32;var n=t.floor(s/4294967296);i[15+(64+r>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i[14+(64+r>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(i.length+1),this._process();for(var o=(i=this._hash).words,h=0;h<4;h++){var a=o[h];o[h]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}}),e.MD5=s._createHelper(r),e.HmacMD5=s._createHmacHelper(r)}(Math),q=(C=$).lib,n=q.WordArray,o=q.Hasher,q=C.algo,h=[],q=q.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],r=i[1],n=i[2],o=i[3],a=i[4],l=0;l<80;l++){l<16?h[l]=0|t[e+l]:(c=h[l-3]^h[l-8]^h[l-14]^h[l-16],h[l]=c<<1|c>>>31);var c=(s<<5|s>>>27)+a+h[l];c+=l<20?1518500249+(r&n|~r&o):l<40?1859775393+(r^n^o):l<60?(r&n|r&o|n&o)-1894007588:(r^n^o)-899497514,a=o,o=n,n=r<<30|r>>>2,r=s,s=c}i[0]=i[0]+s|0,i[1]=i[1]+r|0,i[2]=i[2]+n|0,i[3]=i[3]+o|0,i[4]=i[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[14+(64+s>>>9<<4)]=Math.floor(i/4294967296),e[15+(64+s>>>9<<4)]=i,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}}),C.SHA1=o._createHelper(q),C.HmacSHA1=o._createHmacHelper(q),function(t){var e=$,i=(r=e.lib).WordArray,s=r.Hasher,r=e.algo,n=[],o=[];!function(){function e(t){return 4294967296*(t-(0|t))|0}for(var i=2,s=0;s<64;)!function(e){for(var i=t.sqrt(e),s=2;s<=i;s++)if(!(e%s))return;return 1}(i)||(s<8&&(n[s]=e(t.pow(i,.5))),o[s]=e(t.pow(i,1/3)),s++),i++}();var h=[];r=r.SHA256=s.extend({_doReset:function(){this._hash=new i.init(n.slice(0))},_doProcessBlock:function(t,e){for(var i=this._hash.words,s=i[0],r=i[1],n=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],f=0;f<64;f++){f<16?h[f]=0|t[e+f]:(p=h[f-15],g=h[f-2],h[f]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+h[f-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+h[f-16]);var p=s&r^s&n^r&n,g=d+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&u)+o[f]+h[f];d=u,u=c,c=l,l=a+g|0,a=n,n=r,r=s,s=g+(((s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22))+p)|0}i[0]=i[0]+s|0,i[1]=i[1]+r|0,i[2]=i[2]+n|0,i[3]=i[3]+a|0,i[4]=i[4]+l|0,i[5]=i[5]+c|0,i[6]=i[6]+u|0,i[7]=i[7]+d|0},_doFinalize:function(){var e=this._data,i=e.words,s=8*this._nDataBytes,r=8*e.sigBytes;return i[r>>>5]|=128<<24-r%32,i[14+(64+r>>>9<<4)]=t.floor(s/4294967296),i[15+(64+r>>>9<<4)]=s,e.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=s._createHelper(r),e.HmacSHA256=s._createHmacHelper(r)}(Math),a=(S=$).lib.WordArray,B=S.algo,l=B.SHA256,B=B.SHA224=l.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=l._doFinalize.call(this);return t.sigBytes-=4,t}}),S.SHA224=l._createHelper(B),S.HmacSHA224=l._createHmacHelper(B),function(){var t=$,e=t.lib.Hasher,i=(r=t.x64).Word,s=r.WordArray,r=t.algo;function n(){return i.create.apply(i,arguments)}var o=[n(1116352408,3609767458),n(1899447441,602891725),n(3049323471,3964484399),n(3921009573,2173295548),n(961987163,4081628472),n(1508970993,3053834265),n(2453635748,2937671579),n(2870763221,3664609560),n(3624381080,2734883394),n(310598401,1164996542),n(607225278,1323610764),n(1426881987,3590304994),n(1925078388,4068182383),n(2162078206,991336113),n(2614888103,633803317),n(3248222580,3479774868),n(3835390401,2666613458),n(4022224774,944711139),n(264347078,2341262773),n(604807628,2007800933),n(770255983,1495990901),n(1249150122,1856431235),n(1555081692,3175218132),n(1996064986,2198950837),n(2554220882,3999719339),n(2821834349,766784016),n(2952996808,2566594879),n(3210313671,3203337956),n(3336571891,1034457026),n(3584528711,2466948901),n(113926993,3758326383),n(338241895,168717936),n(666307205,1188179964),n(773529912,1546045734),n(1294757372,1522805485),n(1396182291,2643833823),n(1695183700,2343527390),n(1986661051,1014477480),n(2177026350,1206759142),n(2456956037,344077627),n(2730485921,1290863460),n(2820302411,3158454273),n(3259730800,3505952657),n(3345764771,106217008),n(3516065817,3606008344),n(3600352804,1432725776),n(4094571909,1467031594),n(275423344,851169720),n(430227734,3100823752),n(506948616,1363258195),n(659060556,3750685593),n(883997877,3785050280),n(958139571,3318307427),n(1322822218,3812723403),n(1537002063,2003034995),n(1747873779,3602036899),n(1955562222,1575990012),n(2024104815,1125592928),n(2227730452,2716904306),n(2361852424,442776044),n(2428436474,593698344),n(2756734187,3733110249),n(3204031479,2999351573),n(3329325298,3815920427),n(3391569614,3928383900),n(3515267271,566280711),n(3940187606,3454069534),n(4118630271,4000239992),n(116418474,1914138554),n(174292421,2731055270),n(289380356,3203993006),n(460393269,320620315),n(685471733,587496836),n(852142971,1086792851),n(1017036298,365543100),n(1126000580,2618297676),n(1288033470,3409855158),n(1501505948,4234509866),n(1607167915,987167468),n(1816402316,1246189591)],h=[];!function(){for(var t=0;t<80;t++)h[t]=n()}(),r=r.SHA512=e.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var i,s=(i=this._hash.words)[0],r=i[1],n=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],f=s.high,p=s.low,g=r.high,m=r.low,y=n.high,v=n.low,x=a.high,_=a.low,w=l.high,b=l.low,k=c.high,E=c.low,N=u.high,S=u.low,M=d.high,O=f,I=p,T=g,A=m,z=y,C=v,B=x,q=_,P=w,D=b,R=k,$=E,L=N,j=S,V=M,K=i=d.low,H=0;H<80;H++){var F,U,W=h[H];H<16?(U=W.high=0|t[e+2*H],F=W.low=0|t[e+2*H+1]):(tt=(G=h[H-15]).high,et=G.low,Q=(Y=h[H-2]).high,J=Y.low,X=(Z=h[H-7]).high,G=Z.low,Z=(Y=h[H-16]).high,U=(U=((tt>>>1|et<<31)^(tt>>>8|et<<24)^tt>>>7)+X+((F=(X=(et>>>1|tt<<31)^(et>>>8|tt<<24)^(et>>>7|tt<<25))+G)>>>0<X>>>0?1:0))+((Q>>>19|J<<13)^(Q<<3|J>>>29)^Q>>>6)+((F+=et=(J>>>19|Q<<13)^(J<<3|Q>>>29)^(J>>>6|Q<<26))>>>0<et>>>0?1:0),F+=tt=Y.low,W.high=U=U+Z+(F>>>0<tt>>>0?1:0),W.low=F);var G=P&R^~P&L,X=D&$^~D&j,J=O&T^O&z^T&z,Q=(I>>>28|O<<4)^(I<<30|O>>>2)^(I<<25|O>>>7),Y=(et=o[H]).high,Z=et.low,tt=K+((D>>>14|P<<18)^(D>>>18|P<<14)^(D<<23|P>>>9)),et=(W=V+((P>>>14|D<<18)^(P>>>18|D<<14)^(P<<23|D>>>9))+(tt>>>0<K>>>0?1:0),Q+(I&A^I&C^A&C));V=L,K=j,L=R,j=$,R=P,$=D,P=B+(W=(W=(W=W+G+((tt+=X)>>>0<X>>>0?1:0))+Y+((tt+=Z)>>>0<Z>>>0?1:0))+U+((tt+=F)>>>0<F>>>0?1:0))+((D=q+tt|0)>>>0<q>>>0?1:0)|0,B=z,q=C,z=T,C=A,T=O,A=I,O=W+(((O>>>28|I<<4)^(O<<30|I>>>2)^(O<<25|I>>>7))+J+(et>>>0<Q>>>0?1:0))+((I=tt+et|0)>>>0<tt>>>0?1:0)|0}p=s.low=p+I,s.high=f+O+(p>>>0<I>>>0?1:0),m=r.low=m+A,r.high=g+T+(m>>>0<A>>>0?1:0),v=n.low=v+C,n.high=y+z+(v>>>0<C>>>0?1:0),_=a.low=_+q,a.high=x+B+(_>>>0<q>>>0?1:0),b=l.low=b+D,l.high=w+P+(b>>>0<D>>>0?1:0),E=c.low=E+$,c.high=k+R+(E>>>0<$>>>0?1:0),S=u.low=S+j,u.high=N+L+(S>>>0<j>>>0?1:0),i=d.low=i+K,d.high=M+V+(i>>>0<K>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;return e[s>>>5]|=128<<24-s%32,e[30+(128+s>>>10<<5)]=Math.floor(i/4294967296),e[31+(128+s>>>10<<5)]=i,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32}),t.SHA512=e._createHelper(r),t.HmacSHA512=e._createHmacHelper(r)}(),q=(C=$).x64,c=q.Word,u=q.WordArray,q=C.algo,d=q.SHA512,q=q.SHA384=d.extend({_doReset:function(){this._hash=new u.init([new c.init(3418070365,3238371032),new c.init(1654270250,914150663),new c.init(2438529370,812702999),new c.init(355462360,4144912697),new c.init(1731405415,4290775857),new c.init(2394180231,1750603025),new c.init(3675008525,1694076839),new c.init(1203062813,3204075428)])},_doFinalize:function(){var t=d._doFinalize.call(this);return t.sigBytes-=16,t}}),C.SHA384=d._createHelper(q),C.HmacSHA384=d._createHmacHelper(q),function(t){var e=$,i=(n=e.lib).WordArray,s=n.Hasher,r=e.x64.Word,n=e.algo,o=[],h=[],a=[];!function(){for(var t=1,e=0,i=0;i<24;i++){o[t+5*e]=(i+1)*(i+2)/2%64;var s=(2*t+3*e)%5;t=e%5,e=s}for(t=0;t<5;t++)for(e=0;e<5;e++)h[t+5*e]=e+(2*t+3*e)%5*5;for(var n=1,l=0;l<24;l++){for(var c,u=0,d=0,f=0;f<7;f++)1&n&&((c=(1<<f)-1)<32?d^=1<<c:u^=1<<c-32),128&n?n=n<<1^113:n<<=1;a[l]=r.create(u,d)}}();var l=[];!function(){for(var t=0;t<25;t++)l[t]=r.create()}(),n=n.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new r.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var i=this._state,s=this.blockSize/2,r=0;r<s;r++){var n=t[e+2*r],c=t[e+2*r+1];n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8);(S=i[r]).high^=c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),S.low^=n}for(var u=0;u<24;u++){for(var d=0;d<5;d++){for(var f=0,p=0,g=0;g<5;g++)f^=(S=i[d+5*g]).high,p^=S.low;var m=l[d];m.high=f,m.low=p}for(d=0;d<5;d++){var y=l[(d+4)%5],v=(x=l[(d+1)%5]).high,x=x.low;for(f=y.high^(v<<1|x>>>31),p=y.low^(x<<1|v>>>31),g=0;g<5;g++)(S=i[d+5*g]).high^=f,S.low^=p}for(var _=1;_<25;_++){var w=(S=i[_]).high,b=S.low,k=o[_];p=k<32?(f=w<<k|b>>>32-k,b<<k|w>>>32-k):(f=b<<k-32|w>>>64-k,w<<k-32|b>>>64-k),(k=l[h[_]]).high=f,k.low=p}var E=l[0],N=i[0];for(E.high=N.high,E.low=N.low,d=0;d<5;d++)for(g=0;g<5;g++){var S=i[_=d+5*g],M=l[_],O=l[(d+1)%5+5*g],I=l[(d+2)%5+5*g];S.high=M.high^~O.high&I.high,S.low=M.low^~O.low&I.low}S=i[0],N=a[u],S.high^=N.high,S.low^=N.low}},_doFinalize:function(){var e=this._data,s=e.words,r=(this._nDataBytes,8*e.sigBytes),n=32*this.blockSize;s[r>>>5]|=1<<24-r%32,s[(t.ceil((1+r)/n)*n>>>5)-1]|=128,e.sigBytes=4*s.length,this._process();for(var o=this._state,h=(s=this.cfg.outputLength/8)/8,a=[],l=0;l<h;l++){var c=(u=o[l]).high,u=u.low;c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8);a.push(u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)),a.push(c)}return new i.init(a,s)},clone:function(){for(var t=s.clone.call(this),e=t._state=this._state.slice(0),i=0;i<25;i++)e[i]=e[i].clone();return t}}),e.SHA3=s._createHelper(n),e.HmacSHA3=s._createHmacHelper(n)}(Math),Math,B=(S=$).lib,f=B.WordArray,p=B.Hasher,B=S.algo,g=f.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),m=f.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),y=f.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),v=f.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),x=f.create([0,1518500249,1859775393,2400959708,2840853838]),_=f.create([1352829926,1548603684,1836072691,2053994217,0]),B=B.RIPEMD160=p.extend({_doReset:function(){this._hash=f.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var i=0;i<16;i++){var s=e+i,r=t[s];t[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var n,o,h,a,l,c,u=this._hash.words,d=x.words,f=_.words,p=g.words,w=m.words,b=y.words,k=v.words,E=n=u[0],N=o=u[1],S=h=u[2],M=a=u[3],O=l=u[4];for(i=0;i<80;i+=1)c=n+t[e+p[i]]|0,c+=i<16?(o^h^a)+d[0]:i<32?L(o,h,a)+d[1]:i<48?((o|~h)^a)+d[2]:i<64?j(o,h,a)+d[3]:(o^(h|~a))+d[4],c=(c=V(c|=0,b[i]))+l|0,n=l,l=a,a=V(h,10),h=o,o=c,c=E+t[e+w[i]]|0,c+=i<16?(N^(S|~M))+f[0]:i<32?j(N,S,M)+f[1]:i<48?((N|~S)^M)+f[2]:i<64?L(N,S,M)+f[3]:(N^S^M)+f[4],c=(c=V(c|=0,k[i]))+O|0,E=O,O=M,M=V(S,10),S=N,N=c;c=u[1]+h+M|0,u[1]=u[2]+a+O|0,u[2]=u[3]+l+E|0,u[3]=u[4]+n+N|0,u[4]=u[0]+o+S|0,u[0]=c},_doFinalize:function(){var t=this._data,e=t.words,i=8*this._nDataBytes,s=8*t.sigBytes;e[s>>>5]|=128<<24-s%32,e[14+(64+s>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t.sigBytes=4*(e.length+1),this._process();for(var r=(e=this._hash).words,n=0;n<5;n++){var o=r[n];r[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return e},clone:function(){var t=p.clone.call(this);return t._hash=this._hash.clone(),t}}),S.RIPEMD160=p._createHelper(B),S.HmacRIPEMD160=p._createHmacHelper(B),q=(C=$).lib.Base,w=C.enc.Utf8,C.algo.HMAC=q.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=w.parse(e));var i=t.blockSize,s=4*i;(e=e.sigBytes>s?t.finalize(e):e).clamp();t=this._oKey=e.clone(),e=this._iKey=e.clone();for(var r=t.words,n=e.words,o=0;o<i;o++)r[o]^=1549556828,n[o]^=909522486;t.sigBytes=e.sigBytes=s,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;t=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(t))}}),C=(B=(S=$).lib).Base,b=B.WordArray,B=(q=S.algo).SHA1,k=q.HMAC,E=q.PBKDF2=C.extend({cfg:C.extend({keySize:4,hasher:B,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,s=k.create(i.hasher,t),r=b.create(),n=b.create([1]),o=r.words,h=n.words,a=i.keySize,l=i.iterations;o.length<a;){var c=s.update(e).finalize(n);s.reset();for(var u=c.words,d=u.length,f=c,p=1;p<l;p++){f=s.finalize(f),s.reset();for(var g=f.words,m=0;m<d;m++)u[m]^=g[m]}r.concat(c),h[0]++}return r.sigBytes=4*a,r}}),S.PBKDF2=function(t,e,i){return E.create(i).compute(t,e)},B=(C=(q=$).lib).Base,N=C.WordArray,C=(S=q.algo).MD5,M=S.EvpKDF=B.extend({cfg:B.extend({keySize:4,hasher:C,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i,s=this.cfg,r=s.hasher.create(),n=N.create(),o=n.words,h=s.keySize,a=s.iterations;o.length<h;){i&&r.update(i),i=r.update(t).finalize(e),r.reset();for(var l=1;l<a;l++)i=r.finalize(i),r.reset();n.concat(i)}return n.sigBytes=4*h,n}}),q.EvpKDF=function(t,e,i){return M.create(i).compute(t,e)},$.lib.Cipher||function(){var t=(f=$).lib,e=t.Base,i=t.WordArray,s=t.BufferedBlockAlgorithm,r=((l=f.enc).Utf8,l.Base64),n=f.algo.EvpKDF,o=t.Cipher=s.extend({cfg:e.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,i,s){return h(i).encrypt(t,e,i,s)},decrypt:function(e,i,s){return h(i).decrypt(t,e,i,s)}}}});function h(t){return"string"==typeof t?p:d}t.StreamCipher=o.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var a=f.mode={},l=t.BlockCipherMode=e.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}});l=a.CBC=((a=l.extend()).Encryptor=a.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize;c.call(this,t,e,s),i.encryptBlock(t,e),this._prevBlock=t.slice(e,e+s)}}),a.Decryptor=a.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,r=t.slice(e,e+s);i.decryptBlock(t,e),c.call(this,t,e,s),this._prevBlock=r}}),a);function c(t,e,i){var s,r=this._iv;r?(s=r,this._iv=void 0):s=this._prevBlock;for(var n=0;n<i;n++)t[e+n]^=s[n]}a=(f.pad={}).Pkcs7={pad:function(t,e){for(var s=(e=4*e)-t.sigBytes%e,r=s<<24|s<<16|s<<8|s,n=[],o=0;o<s;o+=4)n.push(r);e=i.create(n,s),t.concat(e)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};var u=(t.BlockCipher=o.extend({cfg:o.cfg.extend({mode:l,padding:a}),reset:function(){var t;o.reset.call(this);var e=(i=this.cfg).iv,i=i.mode;this._xformMode==this._ENC_XFORM_MODE?t=i.createEncryptor:(t=i.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,e&&e.words):(this._mode=t.call(i,this,e&&e.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4}),t.CipherParams=e.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),d=(a=(f.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return(e=(t=t.salt)?i.create([1398893684,1701076831]).concat(t).concat(e):e).toString(r)},parse:function(t){var e,s=r.parse(t);return 1398893684==(t=s.words)[0]&&1701076831==t[1]&&(e=i.create(t.slice(2,4)),t.splice(0,4),s.sigBytes-=16),u.create({ciphertext:s,salt:e})}},t.SerializableCipher=e.extend({cfg:e.extend({format:a}),encrypt:function(t,e,i,s){s=this.cfg.extend(s);e=(r=t.createEncryptor(i,s)).finalize(e);var r=r.cfg;return u.create({ciphertext:e,key:i,iv:r.iv,algorithm:t,mode:r.mode,padding:r.padding,blockSize:t.blockSize,formatter:s.format})},decrypt:function(t,e,i,s){return s=this.cfg.extend(s),e=this._parse(e,s.format),t.createDecryptor(i,s).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}})),f=(f.kdf={}).OpenSSL={execute:function(t,e,s,r){return r=r||i.random(8),t=n.create({keySize:e+s}).compute(t,r),s=i.create(t.words.slice(e),4*s),t.sigBytes=4*e,u.create({key:t,iv:s,salt:r})}},p=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:f}),encrypt:function(t,e,i,s){return i=(s=this.cfg.extend(s)).kdf.execute(i,t.keySize,t.ivSize),s.iv=i.iv,(s=d.encrypt.call(this,t,e,i.key,s)).mixIn(i),s},decrypt:function(t,e,i,s){return s=this.cfg.extend(s),e=this._parse(e,s.format),i=s.kdf.execute(i,t.keySize,t.ivSize,e.salt),s.iv=i.iv,d.decrypt.call(this,t,e,i.key,s)}})}(),$.mode.CFB=((B=$.lib.BlockCipherMode.extend()).Encryptor=B.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize;K.call(this,t,e,s,i),this._prevBlock=t.slice(e,e+s)}}),B.Decryptor=B.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,r=t.slice(e,e+s);K.call(this,t,e,s,i),this._prevBlock=r}}),B),$.mode.CTR=(q=(C=$.lib.BlockCipherMode.extend()).Encryptor=C.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,r=this._iv,n=this._counter;r&&(n=this._counter=r.slice(0),this._iv=void 0);var o=n.slice(0);i.encryptBlock(o,0),n[s-1]=n[s-1]+1|0;for(var h=0;h<s;h++)t[e+h]^=o[h]}}),C.Decryptor=q,C),$.mode.CTRGladman=(q=(B=$.lib.BlockCipherMode.extend()).Encryptor=B.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,r=this._iv,n=this._counter;r&&(n=this._counter=r.slice(0),this._iv=void 0),0===((r=n)[0]=H(r[0]))&&(r[1]=H(r[1]));var o=n.slice(0);i.encryptBlock(o,0);for(var h=0;h<s;h++)t[e+h]^=o[h]}}),B.Decryptor=q,B),$.mode.OFB=(q=(C=$.lib.BlockCipherMode.extend()).Encryptor=C.extend({processBlock:function(t,e){var i=this._cipher,s=i.blockSize,r=this._iv,n=this._keystream;r&&(n=this._keystream=r.slice(0),this._iv=void 0),i.encryptBlock(n,0);for(var o=0;o<s;o++)t[e+o]^=n[o]}}),C.Decryptor=q,C),$.mode.ECB=((B=$.lib.BlockCipherMode.extend()).Encryptor=B.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),B.Decryptor=B.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),B),$.pad.AnsiX923={pad:function(t,e){var i=(i=t.sigBytes)+(e=(e=4*e)-i%e)-1;t.clamp(),t.words[i>>>2]|=e<<24-i%4*8,t.sigBytes+=e},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},$.pad.Iso10126={pad:function(t,e){e*=4,e-=t.sigBytes%e,t.concat($.lib.WordArray.random(e-1)).concat($.lib.WordArray.create([e<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},$.pad.Iso97971={pad:function(t,e){t.concat($.lib.WordArray.create([2147483648],1)),$.pad.ZeroPadding.pad(t,e)},unpad:function(t){$.pad.ZeroPadding.unpad(t),t.sigBytes--}},$.pad.ZeroPadding={pad:function(t,e){e*=4,t.clamp(),t.sigBytes+=e-(t.sigBytes%e||e)},unpad:function(t){var e=t.words,i=t.sigBytes-1;for(i=t.sigBytes-1;0<=i;i--)if(e[i>>>2]>>>24-i%4*8&255){t.sigBytes=i+1;break}}},$.pad.NoPadding={pad:function(){},unpad:function(){}},O=(q=$).lib.CipherParams,I=q.enc.Hex,q.format.Hex={stringify:function(t){return t.ciphertext.toString(I)},parse:function(t){return t=I.parse(t),O.create({ciphertext:t})}},function(){var t=$,e=t.lib.BlockCipher,i=t.algo,s=[],r=[],n=[],o=[],h=[],a=[],l=[],c=[],u=[],d=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var i=0,f=0;for(e=0;e<256;e++){var p=f^f<<1^f<<2^f<<3^f<<4;s[i]=p=p>>>8^255&p^99;var g=t[r[p]=i],m=t[g],y=t[m],v=257*t[p]^16843008*p;n[i]=v<<24|v>>>8,o[i]=v<<16|v>>>16,h[i]=v<<8|v>>>24,a[i]=v,l[p]=(v=16843009*y^65537*m^257*g^16843008*i)<<24|v>>>8,c[p]=v<<16|v>>>16,u[p]=v<<8|v>>>24,d[p]=v,i?(i=g^t[t[t[y^g]]],f^=t[t[f]]):i=f=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54];i=i.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,i=t.sigBytes/4,r=4*(1+(this._nRounds=6+i)),n=this._keySchedule=[],o=0;o<r;o++)o<i?n[o]=e[o]:(p=n[o-1],o%i?6<i&&o%i==4&&(p=s[p>>>24]<<24|s[p>>>16&255]<<16|s[p>>>8&255]<<8|s[255&p]):(p=s[(p=p<<8|p>>>24)>>>24]<<24|s[p>>>16&255]<<16|s[p>>>8&255]<<8|s[255&p],p^=f[o/i|0]<<24),n[o]=n[o-i]^p);for(var h=this._invKeySchedule=[],a=0;a<r;a++){var p;o=r-a;p=a%4?n[o]:n[o-4],h[a]=a<4||o<=4?p:l[s[p>>>24]]^c[s[p>>>16&255]]^u[s[p>>>8&255]]^d[s[255&p]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,n,o,h,a,s)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,l,c,u,d,r),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,s,r,n,o,h){for(var a=this._nRounds,l=t[e]^i[0],c=t[e+1]^i[1],u=t[e+2]^i[2],d=t[e+3]^i[3],f=4,p=1;p<a;p++){var g=s[l>>>24]^r[c>>>16&255]^n[u>>>8&255]^o[255&d]^i[f++],m=s[c>>>24]^r[u>>>16&255]^n[d>>>8&255]^o[255&l]^i[f++],y=s[u>>>24]^r[d>>>16&255]^n[l>>>8&255]^o[255&c]^i[f++],v=s[d>>>24]^r[l>>>16&255]^n[c>>>8&255]^o[255&u]^i[f++];l=g,c=m,u=y,d=v}g=(h[l>>>24]<<24|h[c>>>16&255]<<16|h[u>>>8&255]<<8|h[255&d])^i[f++],m=(h[c>>>24]<<24|h[u>>>16&255]<<16|h[d>>>8&255]<<8|h[255&l])^i[f++],y=(h[u>>>24]<<24|h[d>>>16&255]<<16|h[l>>>8&255]<<8|h[255&c])^i[f++],v=(h[d>>>24]<<24|h[l>>>16&255]<<16|h[c>>>8&255]<<8|h[255&u])^i[f++],t[e]=g,t[e+1]=m,t[e+2]=y,t[e+3]=v},keySize:8});t.AES=e._createHelper(i)}(),function(){var t=$,e=(s=t.lib).WordArray,i=s.BlockCipher,s=t.algo,r=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],n=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],o=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],a=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],l=s.DES=i.extend({_doReset:function(){for(var t=this._key.words,e=[],i=0;i<56;i++){var s=r[i]-1;e[i]=t[s>>>5]>>>31-s%32&1}for(var h=this._subKeys=[],a=0;a<16;a++){var l=h[a]=[],c=o[a];for(i=0;i<24;i++)l[i/6|0]|=e[(n[i]-1+c)%28]<<31-i%6,l[4+(i/6|0)]|=e[28+(n[i+24]-1+c)%28]<<31-i%6;for(l[0]=l[0]<<1|l[0]>>>31,i=1;i<7;i++)l[i]=l[i]>>>4*(i-1)+3;l[7]=l[7]<<5|l[7]>>>27}var u=this._invSubKeys=[];for(i=0;i<16;i++)u[i]=h[15-i]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,i){this._lBlock=t[e],this._rBlock=t[e+1],c.call(this,4,252645135),c.call(this,16,65535),u.call(this,2,858993459),u.call(this,8,16711935),c.call(this,1,1431655765);for(var s=0;s<16;s++){for(var r=i[s],n=this._lBlock,o=this._rBlock,l=0,d=0;d<8;d++)l|=h[d][((o^r[d])&a[d])>>>0];this._lBlock=o,this._rBlock=n^l}var f=this._lBlock;this._lBlock=this._rBlock,this._rBlock=f,c.call(this,1,1431655765),u.call(this,8,16711935),u.call(this,2,858993459),c.call(this,16,65535),c.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function c(t,e){e=(this._lBlock>>>t^this._rBlock)&e,this._rBlock^=e,this._lBlock^=e<<t}function u(t,e){e=(this._rBlock>>>t^this._lBlock)&e,this._lBlock^=e,this._rBlock^=e<<t}t.DES=i._createHelper(l),s=s.TripleDES=i.extend({_doReset:function(){if(2!==(s=this._key.words).length&&4!==s.length&&s.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=s.slice(0,2),i=s.length<4?s.slice(0,2):s.slice(2,4),s=s.length<6?s.slice(0,2):s.slice(4,6);this._des1=l.createEncryptor(e.create(t)),this._des2=l.createEncryptor(e.create(i)),this._des3=l.createEncryptor(e.create(s))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2}),t.TripleDES=i._createHelper(s)}(),function(){var t=$,e=t.lib.StreamCipher,i=t.algo,s=i.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes,s=this._S=[],r=0;r<256;r++)s[r]=r;r=0;for(var n=0;r<256;r++){var o=e[(o=r%i)>>>2]>>>24-o%4*8&255;n=(n+s[r]+o)%256,o=s[r];s[r]=s[n],s[n]=o}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=r.call(this)},keySize:8,ivSize:0});function r(){for(var t=this._S,e=this._i,i=this._j,s=0,r=0;r<4;r++){i=(i+t[e=(e+1)%256])%256;var n=t[e];t[e]=t[i],t[i]=n,s|=t[(t[e]+t[i])%256]<<24-8*r}return this._i=e,this._j=i,s}t.RC4=e._createHelper(s),i=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var t=this.cfg.drop;0<t;t--)r.call(this)}}),t.RC4Drop=e._createHelper(i)}(),B=(C=$).lib.StreamCipher,q=C.algo,T=[],A=[],z=[],q=q.Rabbit=B.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,i=0;i<4;i++)t[i]=16711935&(t[i]<<8|t[i]>>>24)|4278255360&(t[i]<<24|t[i]>>>8);var s=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],r=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(i=this._b=0;i<4;i++)F.call(this);for(i=0;i<8;i++)r[i]^=s[i+4&7];if(e){var n,o=(e=16711935&((o=(n=e.words)[0])<<8|o>>>24)|4278255360&(o<<24|o>>>8))>>>16|4294901760&(n=16711935&((h=n[1])<<8|h>>>24)|4278255360&(h<<24|h>>>8)),h=n<<16|65535&e;for(r[0]^=e,r[1]^=o,r[2]^=n,r[3]^=h,r[4]^=e,r[5]^=o,r[6]^=n,r[7]^=h,i=0;i<4;i++)F.call(this)}},_doProcessBlock:function(t,e){var i=this._X;F.call(this),T[0]=i[0]^i[5]>>>16^i[3]<<16,T[1]=i[2]^i[7]>>>16^i[5]<<16,T[2]=i[4]^i[1]>>>16^i[7]<<16,T[3]=i[6]^i[3]>>>16^i[1]<<16;for(var s=0;s<4;s++)T[s]=16711935&(T[s]<<8|T[s]>>>24)|4278255360&(T[s]<<24|T[s]>>>8),t[e+s]^=T[s]},blockSize:4,ivSize:2}),C.Rabbit=B._createHelper(q),B=(C=$).lib.StreamCipher,q=C.algo,P=[],D=[],R=[],q=q.RabbitLegacy=B.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,i=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],s=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]],r=this._b=0;r<4;r++)U.call(this);for(r=0;r<8;r++)s[r]^=i[r+4&7];if(e){var n,o=(e=16711935&((o=(n=e.words)[0])<<8|o>>>24)|4278255360&(o<<24|o>>>8))>>>16|4294901760&(n=16711935&((t=n[1])<<8|t>>>24)|4278255360&(t<<24|t>>>8));t=n<<16|65535&e;for(s[0]^=e,s[1]^=o,s[2]^=n,s[3]^=t,s[4]^=e,s[5]^=o,s[6]^=n,s[7]^=t,r=0;r<4;r++)U.call(this)}},_doProcessBlock:function(t,e){var i=this._X;U.call(this),P[0]=i[0]^i[5]>>>16^i[3]<<16,P[1]=i[2]^i[7]>>>16^i[5]<<16,P[2]=i[4]^i[1]>>>16^i[7]<<16,P[3]=i[6]^i[3]>>>16^i[1]<<16;for(var s=0;s<4;s++)P[s]=16711935&(P[s]<<8|P[s]>>>24)|4278255360&(P[s]<<24|P[s]>>>8),t[e+s]^=P[s]},blockSize:4,ivSize:2}),C.RabbitLegacy=B._createHelper(q),$})),function(t,e){"use strict";function i(t,i){function s(t){return h.num(t)?o.at(t):o}function r(t){return o.push(t)>0}const n=Date.parse("01 Jan 2001 00:00:00 GMT"),o=[],{is:h,u:a}=t;function l(){let t=s(-1);return 0!=t.index&&t.index%10==0?function(t){let e=s(-10),{difficulty:i}=e.POW,r=t.ts-e.ts;return r<5e4?i+1:r>2e5?i-1:i}(t):t.POW.difficulty}function c(t,e,i,s,r){for(let n,o=0;;++o)if(n=m(t,e,i,s,r,o),p(n,r))return y(i,t,s,n,e,{nonce:o,difficulty:r})}function u(t){v.isValidNewBlock(t,s(-1))&&r(t)}function d(t){return t||(t=s()),t.reduce(((t,e)=>t+Math.pow(2,e.POW.difficulty)),0)}function f(t){let{difficulty:e}=t.POW;return function(t){return function(t){let{nonce:e,difficulty:i}=t.POW;return m(t.index,t.prev,t.ts,t.data,i,e)}(t)==t.hash}(t)?(p(t.hash,e)||console.log(`block difficulty error, expected: ${e} got: ${t.hash}`),!0):(console.log(`invalid hash, got: ${t.hash}`),!1)}function p(t,e){return a.hexToBin(t).startsWith("0".repeat(e))}function g(t){let e=s(0);return e.ts==t.ts&&e.index==t.index&&e.hash==t.hash&&e.prev==t.prev&&e.POW.nonce==t.POW.nonce&&e.POW.difficulty==t.POW.difficulty&&e.data.toString()==t.data.toString()}function m(t,e,s,r,n,o){return i.SHA256(""+t+e+s+r.toString()+n+o).toString()}function y(t,e,i,s,r,n){return{ts:t,index:e,data:i,hash:s,prev:r,POW:a.inject({},n)}}const v={DIFFICULTY_ADJUSTMENT_BLOCKS:10,BLOCK_GEN_INTERVAL_SECS:10,blockChainDB:e,calcTotalDifficulty:d,CHAIN:s,CHAIN_ADD:r,nextIndex:()=>s(-1).index+1,serialize:()=>JSON.stringify(o),getDataOf(t){let i=s(t);return i?i.data:e},headChain:()=>o[0],tailChain:()=>a.last(o),ensureRoot:t=>g(t),genNextBlockAsync(t,i){let s=l(),r=a.last(o),n=function*(t,i,s,r,n){for(let o,h,a=0;!o;++a)h=m(t,i,s,r,n,a),o=p(h,n)?y(s,t,r,h,i,{nonce:a,difficulty:n}):e,yield o}(r.index+1,r.hash,a.now(),t,s);setTimeout((function t(){let e=n.next().value;e?(u(e),v.bcastChanges(),i&&i(e)):setTimeout(t,0)}),0)},genNextBlock(t){let e=l(),i=a.last(o),s=c(i.index+1,i.hash,a.now(),t,e);return u(s),this.bcastChanges(),s},isValidBlockShape:t=>h.num(t.index)&&h.str(t.hash)&&h.str(t.prev)&&h.num(t.ts)&&a.echt(t.data),addBlockToChain(t){if(this.isValidNewBlock(t,a.last(o)))return r(t)},isValidNewBlock(t,e){let i;return this.isValidBlockShape(t)?e.index+1!=t.index?i="invalid index":e.hash!=t.prev?i="invalid previous hash":function(t,e){return e.ts-6e4<t.ts&&t.ts-6e4<a.now()}(t,e)||(i="invalid timestamp"):i="invalid structure",i&&console.log(i),!i&&f(t)},isValidChain(t){for(let e=0;e<t.length;++e)if(0==e){if(!g(t[e]))return!1}else if(!this.isValidNewBlock(t[e],t[e-1]))return!1;return!0},replaceChain(t){this.isValidChain(t)&&d(t)>=d()?(console.log("Replacing blockchain with updated blockchain"),this.resetChain(t)):console.log("Received invalid blockchain")},resetChain(t){a.append(o,t,!0),this.bcastChanges()},bcastChanges(){this.evtMsg.pub(["bc.latest"],s(-1))},genRawNextBlock(t){let e=this.tailChain(),i=getDifficulty(),s=c(e.index+1,e.hash,a.now(),t,i);if(this.addBlockToChain(s))return this.bcastChanges(),s},init(t,e){t&&t.lift(this);let i=this.genRoot();return this.evtMgr=e,o[0]=y(n,0,i,m(0,"",n,i,0,0),"",function(t=0,e=0){return{nonce:t,difficulty:e}}()),this},genRoot:()=>"Beware: Money is the root of all evil!"};return v}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("crypto-js")):t["io/czlab/mcfud/crypto/blockchain"]=i}(this),function(t,e){"use strict";function i(t,i,s){const r=new s.ec("secp256k1"),{u:n,is:o}=t;function h(t,e,i,s){return{txOutId:t,txOutIndex:e,address:i,amount:s}}function a(t,e,i=""){return{txOutId:t,txOutIndex:e,signature:i,toString(){return""+this.txOutId+this.txOutIndex+this.signature}}}function l(t,e){return{address:t,amount:e,toString(){return""+this.address+this.amount}}}function c(t,e,i){return{id:t,txIns:e,txOuts:i,toString(){return""+this.id+this.txIns.toString()+this.txOuts.toString()}}}function u(t,e){function i(i){let s=e.find((t=>t.txOutId==i.txOutId&&t.txOutIndex==i.txOutIndex));return s&&r.keyFromPublic(s.address,"hex").verify(t.id,i.signature)}if(y.getTransactionId(t)!=t.id)return console.error(`invalid tx id: ${t.id}`);for(let e=0;e<t.txIns.length;++e)if(!i(t.txIns[e]))return console.error(`invalid txIns in tx: ${t.id}`);return t.txOuts.reduce(((t,e)=>t+e.amount),0)==t.txIns.reduce(((t,i)=>t+function(t){let i=f(t.txOutId,t.txOutIndex,e);return n.assert(i,"failed to find unspent-rec")&&i.amount}(i)),0)}function d(t,e,i){let s;if(function(t,e){let i;return t?y.getTransactionId(t)!=t.id?i=`invalid grant-tx id: ${t.id}`:1!=t.txIns.length?i="one txIn must be specified in the grant-tx":t.txIns[0].txOutIndex!=e?i="invalid txIn index in grant-tx":1!=t.txOuts.length?i="invalid number of txOuts in grant-tx":50!=t.txOuts[0].amount&&(i="invalid amount in grant-tx"):i="the first tx in the block must be a grant-tx",i&&console.error(i),!i}(t[0],e)){if(function(t){for(let e,i,s=new Map,r=0;r<t.length;++r){if(i=t[r],e=""+i.txOutId+i.txOutIndex,s.has(e))return!0;s.set(e,1)}}(t.map((t=>t.txIns)).flat()))s="duplicate txIns";else for(let e=1;e<t.length;++e)if(!u(t[e],i)){s="invalid tx";break}}else s="invalid tx[0]";return s&&console.error(s),!s}function f(t,e,i){return i.find((i=>i.txOutId==t&&i.txOutIndex==e))}function p(t){function e(t){let e;return t?o.str(t.address)?!function(t){let e;return 130!=t.length?e="invalid public key length":t.match("^[a-fA-F0-9]+$")?t.startsWith("04")||(e="public key must start with 04"):e="public key must contain only hex characters",e&&console.log(e),!e}(t.address)?e="invalid TxOut address":o.num(t.amount)||(e="invalid amount type in txOut"):e="invalid address type in txOut":e="txOut is null",e&&console.log(e),!e}let i;if(o.str(t.id)?t.txIns instanceof Array?t.txIns.map((function(t){let e;return t?o.str(t.signature)?o.str(t.txOutId)?o.num(t.txOutIndex)||(e="invalid txOutIndex type in txIn"):e="invalid txOutId type in txIn":e="invalid signature type in txIn":e="txIn is null",e&&console.log(e),!e})).reduce(((t,e)=>t&&e),!0)?t.txOuts instanceof Array||(i="invalid txIns type in transaction"):i="invalid txIn structure":i="invalid txIns type in transaction":i="transactionId missing",i)return console.error(i);for(let i=0;i<t.txOuts.length;++i)if(!e(t.txOuts[i]))return!1;return!0}const g=[],m=[],y={UnspentRec:h,TxIn:a,TxOut:l,Transaction:c,lift:t=>(t.replaceChain=function(t){let e=this.isValidChain(t);n.echt(e)&&this.calcTotalDifficulty(t)>this.calcTotalDifficulty()?(y.setUnspentRecs(e),y.updateTxPool(e),this.resetChain(t)):console.warn("received blockchain invalid")},t.addBlockToChain=function(t){if(this.isValidNewBlock(t,this.tailChain())){let e=y.processTxs(t.data,t.index,m);if(e)return y.setUnspentRecs(e),y.updateTxPool(e),this.CHAIN_ADD(t)}},t.isValidChain=function(t){if(!this.ensureRoot(t[0]))return e;let i=[];for(let s,r=0;r<t.length;++r){if(s=t[r],0!=r&&!this.isValidNewBlock(t[r],t[r-1]))return e;if(i=y.processTxs(s.data,s.index,i),!i)return console.warn("invalid transactions in blockchain")}return i},t.genRoot=function(){return[y.genRoot()]},t),genRoot:()=>c("5e7a184fe16430f399d37a3e0197614ea3188624aa25b021139bb61a73fd412b",[a("",0,"")],[l("0429a91b39ad936a5e0690ffdb3136a554da25ba577182f6f187ba329e564a93cc5a3ee6f3258fe5139fd75d92851c85a3fb3f3f2b71e98ac254b8b73cc12db613",50)]),setUnspentRecs(t){n.append(m,t,!0)},getUnspentRecs:()=>JSON.parse(JSON.stringify(m)),processTxs(t,e,i){if(t.every(p)&&d(t,e,i))return function(){let e=t.reduce(((t,e)=>t.concat(e.txOuts.map(((t,i)=>h(e.id,i,t.address,t.amount))))),[]),s=t.map((t=>t.txIns)).flat().map((t=>h(t.txOutId,t.txOutIndex,"",0)));return i.filter((t=>!f(t.txOutId,t.txOutIndex,s))).concat(e)}()},getPublicKey:t=>r.keyFromPrivate(t,"hex").getPublic().encode("hex"),genGrantTx(t,e){let i=c("",[a("",e,"")],[l(t,50)]);return i.id=this.getTransactionId(i),i},getTransactionId:t=>i.SHA256(""+t.txIns.reduce(((t,e)=>t+""+e.txOutId+e.txOutIndex),"")+t.txOuts.reduce(((t,e)=>t+""+e.address+e.amount),"")).toString(),signTxIn(t,e,i,s){let o=t.txIns[e],h=f(o.txOutId,o.txOutIndex,s);return n.assert(h,"could not find referenced txOut"),getPublicKey(i)!=h.address&&n.assert(!1,"trying to sign an input with private-key that does not match the address that is referenced in txIn"),a=r.keyFromPrivate(i,"hex").sign(t.id).toDER(),Array.from(a,(t=>("0"+(255&t).toString(16)).slice(-2))).join("");var a},handleReceivedTx(t){this.addToTxPool(t,m)},getTxPool:()=>JSON.parse(JSON.stringify(g)),addToTxPool(t,e){return n.assert(u(t,e),"trying to add invalid tx to pool"),n.assert(this.isValidTxForPool(t),"trying to add invalid tx to pool"),g.push(t)>0},hasTxIn:(t,e)=>e.find((e=>e.txOutId==t.txOutId&&e.txOutIndex==t.txOutIndex)),updateTxPool(t){let e=[];for(let i of g)for(let s of i.txIns)this.hasTxIn(s,t)||e.push(i);e.forEach((t=>n.disj(g,t)))},getTxPoolIns:()=>g.map((t=>t.txIns)).flat(),isValidTxForPool(t){let e=this.getTxPoolIns();return t.txIns.every((t=>!e.find((e=>t.txOutIndex==e.txOutIndex&&t.txOutId==e.txOutId))))},init(t,e){return n.append(m,this.processTxs(t.getDataOf(0),0,m),!0),this.evtMsg=e,this}};return y}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("crypto-js"),require("elliptic")):t["io/czlab/mcfud/crypto/transaction"]=i}(this),function(t,e){"use strict";"object"==typeof module&&module.exports&&(module.exports=function(t,e){const{Server:i}=e,{is:s,u:r}=t,n=[],o={QUERY_LATEST:0,QUERY_ALL:1,QUERY_TXPOOL:2,RESPONSE_TXPOOL:4,RESPONSE_BLOCKCHAIN:8},h={type:o.QUERY_LATEST},a={type:o.QUERY_ALL},l=t=>({type:o.BLOCKCHAIN,data:JSON.stringify([t])}),c=t=>({type:o.RESPONSE_TXPOOL,data:JSON.stringify(t)});function u(t){try{return JSON.parse(t)}catch(t){console.error(t)}}function d(t,e){t&&t.send(JSON.stringify(e))}function f(t,e,i){t.on("message",(s=>{const r=u(s);if(r)switch(console.log(`got json-message ${JSON.stringify(r)}`),r.type){case o.QUERY_LATEST:d(t,l(e.tailChain()));break;case o.QUERY_ALL:d(t,(n=e.CHAIN(),{type:o.BLOCKCHAIN,data:JSON.stringify(n)}));break;case o.RESPONSE_BLOCKCHAIN:{let t=u(r.data);t?function(t,e){if(0==t.length)return console.log("received block chain size of 0");let i=t.at(-1);if(!e.isValidBlockShape(i))return console.log("block structuture not valid");let s=e.tailChain();i.index>s.index?(console.log(`last-index: ${s.index}, peer-last-index: ${i.index}`),s.hash==i.prev?e.addBlockToChain(i)&&p(l(e.tailChain())):1==t.length?(console.log("have to query the chain from our peer"),p(a)):(console.log("blockchain is longer than current blockchain"),e.replaceChain(t))):console.log("received blockchain is shorter. Do nothing")}(t,e):console.log("invalid blocks received")}break;case o.QUERY_TXPOOL:d(t,c(i.getTxPool()));break;case o.RESPONSE_TXPOOL:{let t=u(r.data);t||console.log("invalid transaction received"),t&&t.forEach((t=>{try{i.handleReceivedTx(t),g.bcastTxPool()}catch(t){console.error(t.message)}}))}}else console.log(`could not parse JSON message: ${s}`);var n}))}function p(t){n.forEach((e=>d(e,t)))}const g={initServer(t){new e.Server({port:t}).on("connection",(t=>this.cfgConnection(t))),console.log(`listening websocket p2p port on: ${t}`)},getSockets:()=>n,connect(t){let i=new e(t);i.on("open",(()=>this.cfgConnection(i))),i.on("error",(()=>console.error("connection failed")))},cfgConnection(t){var e;e=t,n.push(e),f(t,this.bcObj,this.txObj),function(t){let e=t=>{console.log(`connection failed to peer: ${t.url}`),r.disj(n,t)};t.on("close",(()=>e(t))),t.on("error",(()=>e(t)))}(t),d(t,h)},onBCLatest(t){console.log("send changes to peers"),p(l(t))},onTxPool(t){console.log("send tx-pool to peers"),p(c(t))},init(t,e,i){this.evtMsg=i,this.bcObj=t,this.txObj=e,i.sub(["bc.latest"],"onBCLatest",this),i.sub(["tx.pool"],"onTxPool",this)}};return g}(require("../main/core"),require("ws")))}(),function(t,e){"use strict";function i(t,e,i){const s=new i.ec("secp256k1"),{u:r,is:n}=t;return{_KEY:undefined,createTx(t,e,i,n,o){let h=this.TX;let a=s.keyFromPrivate(i,"hex").getPublic().encode("hex"),{included:l,leftOver:c}=function(t,e){let i=0,s=[];for(let r of e)if(s.push(r),i+=r.amount,i>=t)return{included:s,leftOver:i-t};r.assert(!1,`Can't create tx from the unspent transaction outputs.\n                       Required amount: ${t},\n                       available unspentTxOuts: ${JSON.stringify(e)}`)}(e,function(t){let e=[],i=o.map((t=>t.txIns)).flat(),s=n.filter((e=>e.address==t));for(let t of s)r.find(i,(e=>e.txOutId==t.txOutId&&e.txOutIndex==t.txOutIndex))||e.push(t);return e}(a)),u=h.Transaction("",l.map((t=>h.TxIn(t.txOutId,t.txOutIndex))),function(i,s){let r=h.TxOut(t,e);return 0==s?[r]:[r,h.TxOut(i,s)]}(a,c));u.id=h.getTransactionId(u);for(let t=0;t<u.txIns.length;++t)u.txIns[t].signature=h.signTxIn(u,t,i,n);return u},genPrivateKey:()=>s.genKeyPair().getPrivate().toString(16),getPublicFromWallet(){return s.keyFromPrivate(this.getPrivateFromWallet(),"hex").getPublic().encode("hex")},getPrivateFromWallet(){return this._KEY},initWallet(){return this._KEY="20db2edd8bd2e09e8cb7def7a26a20547afc0442509b275209cdd609923f7a80",this._KEY||(this._KEY=this.genPrivateKey()),this},deleteWallet(){return this},getBalance(t,e){return this.findUnspentRecs(t,e).reduce(((t,e)=>t+e.amount),0)},findUnspentRecs:(t,e)=>e.filter((e=>e.address==t)),init(e,i,s){return this.evtMgr=t.EventBus(),this.BC=e.init(i,this.evtMgr),this.TX=i.init(e,this.evtMgr),s.init(e,i,this.evtMgr),this},genNextBlock(){let t=this.TX.genGrantTx(this.getPublicFromWallet(),this.BC.nextIndex());return this.BC.genRawNextBlock([t].concat(this.TX.getTxPool()))},genBlockWith(t,e){return r.assert(this.TX.isValidAddress(t),"invalid address"),r.assert(n.num(e),"invalid amount"),this.BC.genRawNextBlock([this.TX.genGrantTx(this.getPublicFromWallet(),this.BC.nextIndex()),this.createTx(t,e,this.getPrivateFromWallet(),this.TX.getUnspentRecs(),this.TX.getTxPool())])},getAccountBalance(){return this.getBalance(this.getPublicFromWallet(),this.TX.getUnspentRecs())},sendTx(t,e){let i=this.createTx(t,e,this.getPrivateFromWallet(),this.TX.getUnspentRecs(),this.TX.getTxPool());return this.TX.addToTxPool(i,this.TX.getUnspentRecs()),this.evtMgr.pub(["tx.pool"],this.TX.getTxPool()),i},listUnspent(){return this.findUnspentRecs(this.getPublicFromWallet(),this.TX.getUnspentRecs())}}.initWallet()}"object"==typeof module&&module.exports?module.exports=i(require("../main/core"),require("crypto-js"),require("elliptic")):t["io/czlab/mcfud/crypto/wallet"]=i}(this),function(t,e){"use strict";function i(e,i){if(e||(e=t["io/czlab/mcfud/core"]()),!i)throw"Fatal: No Colors!";const{is:s,u:r}=e;function n(t,e){let i="";for(;t>0;)i+=e,--t;return i}function o(t,e){let i=c;return e&&(s.str(t)?i="any"==t||t==e?u:c:t instanceof e&&(i=u)),i}function h(t,e,i){return new Promise(((s,r)=>{let n;try{n=i.call(t),n instanceof Promise?n.then((function(t){s(`${t?u:c}: ${e}`)})):(n=n?709394==n?l:u:c,s(`${n}: ${e}`))}catch(t){n=c,s(`${n}: ${e}`)}}))}function a(t,e,i,s){return new Promise(((r,n)=>{let h;try{h=i.call(t),h=709394==h?u:o(s,null)}catch(t){h=o(s,t)}r(`${h}: ${e}`)}))}const[l,c,u]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,s=t.total,o=e/s*100;console.log(i.white(n(78,"+"))),console.log(i.white.bold(t.title)),console.log(i.white(t.date)),console.log(i.white(n(78,"+"))),t.passed.length>0&&console.log(i.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(i.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(i.magenta(t.failed.join("\n"))),console.log(i.white(n(78,"="))),console.log(i.yellow(["Passed: ",e,"/",s," [",0|o,"%]"].join(""))),console.log(i.magenta("Failed: "+(s-e))),console.log(i.white(["cpu-time: ",r.prettyMillis(t.duration)].join(""))),console.log(i.white(n(78,"=")))},deftest(t){let[e,i,s,r]=[null,null,null,null];const n={ensure:(t,e)=>(s.push([1,t,e]),n),eerror:(t,e)=>(s.push([911,t,e]),n),begin:t=>(r={},s=[],e=t,n),end(n){i=n;let o=function(){return new Promise(((t,n)=>{e&&e(r);let o,l=[];for(let t,e,i=0;i<s.length;++i){switch(e=s[i],e[0]){case 1:t=h(r,e[1],e[2]);break;case 911:t=a(r,e[1],e[2],"any")}o=o?o.then((function(e){return l.push(e),t})):t}o&&o.then((function(e){l.push(e),s.length=0,i&&i(r),t(l)}))}))};return(o.title=t)&&o}};return n},_run:t=>new Promise(((e,i)=>{t().then((function(t){e(t)}))})),runtest(t,e){const i=Date.now();return this._run(t).then((function(s){const r=Date.now(),n={title:e||t.title,date:(new Date).toString(),total:s.length,duration:r-i,passed:s.filter((t=>"P"==t[0])),skippd:s.filter((t=>"S"==t[0])),failed:s.filter((t=>"F"==t[0]))};return new Promise((t=>{t(n)}))}))}}}"object"==typeof module&&module.exports?module.exports=i(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=i}(this),function(t,e){"use strict";console.log("mufud version: 1.2.0")}();