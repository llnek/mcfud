!function(t,e,n){var r,i=256,s=n.pow(i,6),o=n.pow(2,52),l=2*o,c=255;function u(c,u,d){var g=[],v=p(f((u=1==u?{entropy:!0}:u||{}).entropy?[c,m(e)]:null==c?function(){try{var n;return r&&(n=r.randomBytes)?n=n(i):(n=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(n)),m(n)}catch(n){var s=t.navigator,o=s&&s.plugins;return[+new Date,t,o,t.screen,m(e)]}}():c,3),g),y=new a(g),x=function(){for(var t=y.g(6),e=s,n=0;t<o;)t=(t+n)*i,e*=i,n=y.g(1);for(;t>=l;)t/=2,e/=2,n>>>=1;return(t+n)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,p(m(y.S),e),(u.pass||d||function(t,e,r,i){return i&&(i.S&&h(i,y),t.state=function(){return h(y,{})}),r?(n.random=t,e):t})(x,v,"global"in u?u.global:this==n,u.state)}function a(t){var e,n=t.length,r=this,s=0,o=r.i=r.j=0,l=r.S=[];for(n||(t=[n++]);s<i;)l[s]=s++;for(s=0;s<i;s++)l[s]=l[o=c&o+t[s%n]+(e=l[s])],l[o]=e;(r.g=function(t){for(var e,n=0,s=r.i,o=r.j,l=r.S;t--;)e=l[s=c&s+1],n=n*i+l[c&(l[s]=l[o=c&o+e])+(l[o]=e)];return r.i=s,r.j=o,n})(i)}function h(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(f(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function p(t,e){for(var n,r=t+"",i=0;i<r.length;)e[c&i]=c&(n^=19*e[c&i])+r.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(p(n.random(),e),"object"==typeof module&&module.exports){module.exports=u;try{r=require("crypto")}catch(t){}}else"function"==typeof define&&define.amd?define((function(){return u})):n.seedrandom=u}("undefined"!=typeof self?self:this,[],Math),function(t){"use strict";let e=null,n=null;"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports?t=exports:t.document&&(e=t),t["io/czlab/mcfud/core"]=function(){if(n)return n;let r=new Math.seedrandom;const i=t.document,s=Object.prototype,o=Array.prototype.slice,l=s.toString,c={};function u(t){return"[object Object]"===l.call(t)}function a(t){return"[object Function]"===l.call(t)}function h(t){return"[object Array]"===l.call(t)}function f(t){return"[object Map]"===l.call(t)}function p(t){return"string"==typeof t}function m(t){return"[object Number]"===l.call(t)}function d(t){let e=t.lastIndexOf(".");return e>0?t.substring(e+1).toLowerCase():""}Date.now(),Date.now(),Date.now(),Date.now();let g=0;function v(t,e,n){let r=t(e);switch(n.length){case 0:return r;case 1:return r&&t(n[0]);case 2:return r&&t(n[0])&&t(n[1]);case 3:return r&&t(n[0])&&t(n[1])&&t(n[2]);default:return r&&n.every(e=>t(e))}}const y={fun:(t,...e)=>v(a,t,e),str:(t,...e)=>v(p,t,e),void0:t=>void 0===t,undef:t=>void 0===t,obj:(t,...e)=>v(u,t,e),map:(t,...e)=>v(f,t,e),num:(t,...e)=>v(m,t,e),vec:(t,...e)=>v(h,t,e),some:t=>x.size(t)>0,none:t=>0===x.size(t)},x={srand(){r=new Math.seedrandom},feq0:t=>Math.abs(t)<1e-10,feq:(t,e)=>Math.abs(t-e)<=1e-10,fgteq(t,e){return t>e||this.feq(t,e)},flteq(t,e){return t<e||this.feq(t,e)},pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t,e)=>[t,e],p2:(t,e)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,or:(t,e)=>void 0===t?e:t,parseNumber(t,e){let n=parseFloat(t);return isNaN(n)&&m(e)?e:n},splitVerStr(t){let e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.parseNumber(e[0],0),this.parseNumber(e[1],0),this.parseNumber(e[2],0)]},cmpVerStrs(t,e){let n=this.splitVerStr(""+t),r=this.splitVerStr(""+e);return n[0]>r[0]?1:n[0]<r[0]?-1:n[1]>r[1]?1:n[1]<r[1]?-1:n[2]>r[2]?1:n[2]<r[2]?-1:0},findFiles:(t,e)=>t.filter(t=>e.indexOf(d(t))>-1),pdef:t=>(t.enumerable=!0,t.configurable=!0,t),partition(t,e){let n=[];for(let r,i=0;;){r=[];for(let s=0;s<t;++s){if(!(i<e.length))return r.length>0&&n.push(r),n;r.push(e[i]),++i}}},range(t,e){x.assert(void 0!==t);let n=[];1===arguments.length&&(e=t,t=0);for(let r=t;r<e;++r)n.push(r);return n},keys:t=>f(t)?Array.from(t.keys()):u(t)?Object.keys(t):[],selectNotKeys(t,e){let n;return(f(t)||u(t))&&(n=f(t)?new Map:{},e=x.seq(e),x.doseq(t,(t,r)=>{e.includes(r)||(f(n)?n.set(r,t):n[r]=t)})),n},selectKeys(t,e){let n;return(f(t)||u(t))&&(n=f(t)?new Map:{},this.seq(e).forEach(e=>{f(t)?t.has(e)&&n.set(e,t.get(e)):s.hasOwnProperty.call(t,e)&&(n[e]=t[e])})),n},assertNot(t){if(t)throw arguments.length<2?"Assert Failed!":o.call(arguments,1).join("");return!0},assert(t){if(!t)throw arguments.length<2?"Assert Failed!":o.call(arguments,1).join("");return!0},noSuchKeys(t,e){let n=this.some(this.seq(t),t=>this.has(e,t)?t:null);return n&&console.log("keyfound="+n),!n},randFloat:(t,e)=>t+r()*(e-t),randMinus1To1:()=>2*(r()-.5),randInt:t=>Math.floor(r()*t),randInt2:function(t,e){return Math.floor(r()*(e-t+1)+t)},rand:()=>r(),randSign:()=>x.rand()>.5?-1:1,inst:(t,e)=>e instanceof t,hashCode(t){let e=0;for(let n=0;n<t.length;++n)e=Math.imul(31,e)+t.charCodeAt(n)|0;return e},randArrayItem(t){if(t)return 0===t.length?null:1===t.length?t[0]:t[x.floor(x.rand()*t.length)]},isPerc:t=>p(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:t=>t>0?t%2==0:-t%2==0,jsMap:()=>new Map,jsObj:()=>({}),jsVec:(...t)=>0===t.length?[]:t.slice(),lastIndex:t=>t&&t.length?t.length-1:-1,head:t=>t&&t.length?t[0]:void 0,tail:t=>t&&t.length?t[t.length-1]:void 0,floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(t,e)=>Math.min(t,e),max:(t,e)=>Math.max(t,e),slice:(t,e)=>o.call(t,e),every(t,e){for(let n=0;n<t.length;++n)if(t[n]!==e)return!1;return t.length>0},notAny(t,e){for(let n=0;n<t.length;++n)if(t[n]===e)return!1;return t.length>0},copy(t,e){if(!e)return t;if(!t)return e.slice();let n=Math.min(t.length,e.length);for(let r=0;r<n;++r)t[r]=e[r];return t},append(t,e){if(!e)return t;if(!t)return e.slice();for(let n=0;n<e.length;++n)t.push(e[n]);return t},fill(t,e){if(t)for(let n=0;n<t.length;++n)t[n]=a(e)?e():e;return t},size(t){let e=0;return h(t)?e=t.length:f(t)?e=t.size:t&&(e=x.keys(t).length),e},nextId:()=>++g,now:()=>Date.now(),fileExt:d,fileNoExt(t){let e=t.lastIndexOf(".");return e>0?t.substring(0,e):t},range(t,e,n=1){void 0===e&&(e=t,t=0,n=1);let r=[],i=(e-t)/n;i=Math.ceil(i),i=Math.max(0,i),r.length=i;for(let e=0;e<i;++e)r[e]=t,t+=n;return r},shuffle(t){let e=o.call(t,0);for(let t,n,i=e.length-1;i>0;--i)n=Math.floor(r()*(i+1)),t=e[i],e[i]=e[n],e[n]=t;return e},uniq(t){let e=[],n=null;return(t=o.call(t).sort()).forEach(t=>{void 0!==t&&t!==n&&e.push(t),n=t}),e},map(t,e,n){let r=[];if(h(t))r=t.map(e,n);else if(f(t))t.forEach((i,s)=>{r.push(e.call(n,i,s,t))});else if(t)for(let i in t)s.hasOwnProperty.call(t,i)&&r.push(e.call(n,t[i],i,t));return r},find(t,e,n){let r=o.call(arguments,3);if(h(t)){for(let i=0,s=t.length;i<s;++i)if(e.apply(n,[t[i],i].concat(r)))return t[i]}else if(f(t)){let i=Array.from(t.keys());for(let s,o=0,l=i.length;o<l;++o)if(s=i[o],e.apply(n,[t.get(s),s].concat(r)))return[s,t.get(s)]}else if(t)for(let i in t)if(s.hasOwnProperty.call(t,i)&&e.apply(n,[t[i],i].concat(r)))return[i,t[i]]},some(t,e,n){let r,i=o.call(arguments,3);if(h(t)){for(let s=0,o=t.length;s<o;++s)if(r=e.apply(n,[t[s],s].concat(i)))return r}else if(f(t)){let s=Array.from(t.keys());for(let o,l=0,c=s.length;l<c;++l)if(o=s[l],r=e.apply(n,[t.get(o),o].concat(i)))return r}else if(t)for(let o in t)if(s.hasOwnProperty.call(t,o)&&(r=e.apply(n,[t[o],o].concat(i))))return r},invoke(t,e){let n=o.call(arguments,2);h(t)&&t.forEach(t=>t[e].apply(t,n))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,n=!1)=>({repeat:!!n,id:n?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&(t.repeat?clearInterval(t.id):clearTimeout(t.id))},rseq(t,e,n){if(h(t)&&t.length>0)for(let r=t.length-1;r>=0;--r)e.call(n,t[r],r)},doseq(t,e,n){if(h(t))t.forEach(e,n);else if(f(t))t.forEach((r,i)=>e.call(n,r,i,t));else if(t)for(let r in t)s.hasOwnProperty.call(t,r)&&e.call(n,t[r],r,t)},dissoc(t,e){if(arguments.length>2){let e,n=1;for(;n<arguments.length;++n)e=this.dissoc(t,arguments[n]);return e}{let n;return f(t)?(n=t.get(e),t.delete(e)):t&&(n=t[e],delete t[e]),n}},get(t,e){if(void 0!==e){if(f(t))return t.get(e);if(t)return t[e]}},assoc(t,e,n){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"ArityError: expecting even count of args.";let e,n=1;for(;n<arguments.length;)e=this.assoc(t,arguments[n],arguments[n+1]),n+=2;return e}{let r;return f(t)?(r=t.get(e),t.set(e,n)):t&&(r=t[e],t[e]=n),r}},disj(t,e){let n=t?t.indexOf(e):-1;return n>-1&&t.splice(n,1),n>-1},conj:(t,...e)=>(t&&e.forEach(e=>t.push(e)),t),seq:(t,e=",")=>("string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),h(t)||(t=[t]),t),has:(t,e)=>!!e&&(f(t)?t.has(e):h(t)?-1!==t.indexOf(e):t?s.hasOwnProperty.call(t,e):void 0),patch:(t,e)=>(t=t||{},e&&Object.keys(e).forEach(n=>{void 0===t[n]&&(t[n]=e[n])}),t),clone:t=>(t&&(t=JSON.parse(JSON.stringify(t))),t),inject(t){let e=o.call(arguments,1);return t=t||{},e.forEach(e=>{e&&Object.assign(t,e)}),t},deepCopyArray(t){x.assert(y.vec(t),"Expected array");let e=[];for(let n=0,r=t.length;n<r;++n)e[n]=y.vec(t[n])?x.deepCopyArray(t[n]):t[n];return e},mergeEx:(t,e)=>x.merge(x.merge({},t),e),merge(t,e){let n=void 0;return Object.keys(e).forEach(r=>{n=e[r],"object"==typeof n&&null!==n&&t[r]?("object"!=typeof t[r]&&(t[r]=n instanceof Array?[]:{}),x.merge(t[r],n)):t[r]=n}),t},throttle(t,e,n){let r=!0,i=!0;return x.assert(y.fun(t),"Expecting a function"),y.obj(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),x.debounce(t,e,{leading:r,trailing:i,maxWait:e})},debounce(t,e,n){let r,i,s,o,l,c,u=0,a=!1,h=!1,f=!0;function p(e){let n=r,s=i;return r=i=void 0,u=e,o=t.apply(s,n),o}function m(t){return u=t,l=setTimeout(g,e),a?p(t):o}function d(t){let n=t-c;return void 0===c||n>=e||n<0||h&&t-u>=s}function g(){let t=x.now();if(d(t))return v(t);l=setTimeout(g,function(t){let n=t-u,r=e-(t-c);return h?Math.min(r,s-n):r}(t))}function v(t){return l=void 0,f&&r?p(t):(r=i=void 0,o)}return x.assert(y.fun(t),"expecting function"),e=e||0,y.obj(n)&&(a=!!n.leading,h="maxWait"in n,s=h?Math.max(n.maxWait||0,e):s,f="trailing"in n?!!n.trailing:f),function(){let t=x.now(),n=d(t);if(r=arguments,i=this,c=t,n){if(void 0===l)return m(c);if(h)return clearTimeout(l),l=setTimeout(g,e),p(c)}return void 0===l&&(l=setTimeout(g,e)),o}},negate:t=>(x.assert(y.fun(t),"expected function"),function(...e){return!t.apply(this,e)}),reject:(t,e)=>x.doseq(t,x.negate(e)),strPadRight:(t,e,n)=>(e-=t.length)>0?t+new Array(Math.ceil(e/n.length)+1).join(n).substr(0,e):t,strPadLeft:(t,e,n)=>(e-=t.length)>0?new Array(Math.ceil(e/n.length)+1).join(n).substr(0,e)+t:t,safeSplit:(t,e)=>x.reject(t.trim().split(e),t=>0===t.length),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber:(t,e=2)=>x.strPadLeft(Number(t).toString(),e,"0"),dropArgs:(t,e)=>t.length>e?Array.prototype.slice(t,e):[],isSSL:()=>e&&e.location&&e.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor)};i&&(x.addEvent=function(t,e,n,r){h(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,n,r)},x.delEvent=function(t,e,n,r){h(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,n,r)});const b={qSelector:t=>i.querySelectorAll(t),qId:t=>i.getElementById(t),parent:t=>t?t.parentNode:void 0,conj:(t,e)=>t.appendChild(e),byTag:(t,e)=>y.str(e)?i.getElementsByTagNameNS(e,t):i.getElementsByTagName(id),attrs(t,e){return!y.obj(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&x.doseq(e,(e,n)=>t.setAttribute(n,e)),t)},css(t,e){return!y.obj(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&x.doseq(e,(e,n)=>{t.style[n]=e}),t)},wrap(t,e){let n=t.parentNode;return e.appendChild(t),n.appendChild(e),e},newElm(t,e,n){let r=i.createElement(t);return this.attrs(r,e),this.css(r,n),r},newTxt(t,e,n){let r=i.createTextNode(t);return this.attrs(r,e),this.css(r,n),r}};return i&&(c.dom=b),c.EventBus=function(){let t=x.jsMap(),e={},n=[];return{sub(n,r,i,s){let o=n[0],l=n[1];x.seq(o).forEach(n=>{if(r||(r=n),y.str(r)&&(r=(i=i||l)[r]),!r)throw"Error: no callback for sub()";t.has(n)||t.set(n,x.jsMap());let o=t.get(n);l=l||e,!o.has(l)&&o.set(l,[]),o.get(l).push([r,i,s])})},pub(r,...i){let s,o,l=r[0],c=r[1]||e;x.seq(l).forEach(e=>{o=t.get(e),s=o&&o.get(c),s&&s.forEach(t=>{t[0].apply(t[1],i.concat(t[2]||n))})})},unsub(n,r,i){let s,o,l=n[0],c=n[1]||e;x.seq(l).forEach(e=>{if(s=t.get(e),o=s&&s.get(c),o)if(y.str(r)&&(r=(i=i||c)[r]),r)for(let t=o.length-1;t>=0;--t)o[t][0]===r&&o[t][1]===i&&o.splice(t,1);else;})}}},c.u=x,c.is=y,n=c}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io/czlab/mcfud/math"]=function(){if(e)return e;const{is:n,u:r}=t["io/czlab/mcfud/core"](),i=1e-10,s=360,o=2*Math.PI,l=(Math.PI,{EPSILON:i});function c(t){return t<0?- -t%s:t%s}return l.lerp=function(t,e,n){return(1-n)*t+n*e},l.xmod=function(t,e){return t<0?t- -(e+e*Math.floor(-t/e)):t%e},l.clamp=function(t,e,n){return n<t?t:n>e?e:n},l.sqr=function(t){return t*t},l.fuzzyEq=function(t,e){return Math.abs(t-e)<i},l.fuzzyZero=function(t){return this.fuzzyEq(t,0)},l.radToDeg=function(t){return c(s*t/o)},l.degToRad=function(t){return o*c(t)/s},l.pythag2=function(t,e){return t*t+e*e},l.pythag=function(t,e){return Math.sqrt(t*t+e*e)},l.wrap=function(t,e){return(t+1)%e},l.biasGreater=function(t,e){return t>=.95*e+.01*t},e=l}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports),t["io/czlab/mcfud/vec2"]=function(e){class n{constructor(){this.x=0,this.y=0}}const{u:r,is:i}=t["io/czlab/mcfud/core"](),s=t["io/czlab/mcfud/math"]();if(s.Vec2)return s.Vec2;const o={};const l=e?function(){return new n}:function(){return[0,0]},c=r.fill(new Array(128),l);function u(...t){t.forEach(t=>{t&&(e?t instanceof n&&c.push(t):2===t.length&&c.push(t))})}function h(t,n){let r=c.length>0?c.pop():l();return e?(r.x=t||0,r.y=n||0):(r[0]=t||0,r[1]=n||0),r}o.V2=function(t,e){return h(t,e)},o.takeV2=h,o.dropV2=u;const f=(t,e)=>t+e,p=(t,e)=>t-e,m=(t,e)=>t*e,d=(t,e)=>t/e;function g(t,s){return i.num(s)&&(s=t),e?r.assert(t instanceof n&&s instanceof n):r.assert(2===t.length&&t.length===s.length),!0}function v(t,n,r,s){let o=g(n,r)?s?n:l():null,c=i.num(r);return e?(o.x=t(n.x,c?r:r.x),o.y=t(n.y,c?r:r.y)):(o[0]=t(n[0],c?r:r[0]),o[1]=t(n[1],c?r:r[1])),o}function y(t,e,n,r,i){let s=r?r[0]:0,o=r?r[1]:0,l=t[0]-s,c=t[1]-o,u=s+(l*e-c*n),a=o+(l*n+c*e);return i?(t[0]=u,t[1]=a):t=h(u,a),t}function x(t,e,n,r,i){let s=r?r.x:0,o=r?r.y:0,l=t.x-s,c=t.y-o,u=s+(l*e-c*n),a=o+(l*n+c*e);return i?(t.x=u,t.y=a):t=h(u,a),t}return o.vecAdd=function(t,e){return v(f,t,e)},o.vecAddSelf=function(t,e){return v(f,t,e,1)},o.vecSub=function(t,e){return v(p,t,e)},o.vecSubSelf=function(t,e){return v(p,t,e,1)},o.vecMul=function(t,e){return v(m,t,e)},o.vecMulSelf=function(t,e){return v(m,t,e,1)},o.vecDiv=function(t,e){return v(d,t,e)},o.vecDivSelf=function(t,e){return v(d,t,e,1)},o.vecDot=function(t,n){return g(t,n)?e?t.x*n.x+t.y*n.y:t[0]*n[0]+t[1]*n[1]:void 0},o.makeVecAB=function(t,e){return h(e[0]-t[0],e[1]-t[1])},o.vecLen2=function(t){return this.vecDot(t,t)},o.vecLen=function(t){return Math.sqrt(this.vecLen2(t))},o.vecDist2=function(t,e){let n=this.vecSub(e,t),r=this.vecLen2(n);return u(n),r},o.vecDist=function(t,e){return Math.sqrt(this.vecDist2(t,e))},o.vecUnit=function(t){let n=this.vecLen(t),r=l();return n>1e-10&&(e?(r.x=t.x/n,r.y=t.y/n):(r[0]=t[0]/n,r[1]=t[1]/n)),r},o.vecUnitSelf=function(t){let n=this.vecLen(t);return n>1e-10&&(e?(t.x/=n,t.y/=n):(t[0]/=n,t[1]/=n)),t},o.vecSet=function(t,n){return g(t,n),e?(t.x=n.x,t.y=n.y):(t[0]=n[0],t[1]=n[1]),t},o.vecClone=function(t){return this.vecSet(l(),t)},o.vecCopy=function(t,...n){return r.assert(2===n.length)&&g(t,t),e?(t.x=n[0],t.y=n[1]):(t[0]=n[0],t[1]=n[1]),t},o.vec2Rot=function(t,n,r){g(t,r||t);let i=Math.cos(n),s=Math.sin(n);return e?x(t,i,s,r):y(t,i,s,r)},o.vec2RotSelf=function(t,n,r){g(t,r||t);let i=Math.cos(n),s=Math.sin(n);return e?x(t,i,s,r,1):y(t,i,s,r,1)},o.vec2Cross=function(t,r){return e?function(t,e){return t instanceof n&&e instanceof n?t.x*e.y-t.y*e.x:t instanceof n&&i.num(a)?h(e*t.y,-e*t.x):i.num(t)&&e instanceof n?h(-t*e.y,t*e.x):void 0}(t,r):function(t,e){return i.vec(t)&&i.vec(e)?(g(t,e),t[0]*e[1]-t[1]*e[0]):i.vec(t)&&i.num(a)?(g(t,t),h(e*t[1],-e*t[0])):i.num(t)&&i.vec(e)?(g(e,e),h(-t*e[1],t*e[0])):void 0}(t,r)},o.vecAngle=function(t,e){return Math.acos(this.vecDot(t,e)/(this.vecLen(t)*this.vecLen(e)))},o.perpSelf=function(t,n){g(t,t);let r=e?t.x:t[0];return e?n?(t.x=-t.y,t.y=r):(t.x=t.y,t.y=-r):n?(t[0]=-t[1],t[1]=r):(t[0]=t[1],t[1]=-r),t},o.perp=function(t,n){return g(t,t),e?n?h(-t.y,t.x):h(t.y,-t.x):n?h(-t[1],t[0]):h(t[1],-t[0])},o.proj=function(t,e){return this.vecDot(t,e)/this.vecLen(e)},o.vecProj=function(t,e){let n=this.vecUnit(e);return this.vecMulSelf(n,this.vecDot(t,n))},o.vecPerp=function(t,e){return this.vecSub(t,this.vecProj(t,e))},o.vecReflect=function(t,e){return this.vecSub(t,this.vecMul(e,2*this.vecDot(t,e)))},o.vecFlip=function(t){return this.vecMul(t,-1)},o.vecFlipSelf=function(t){return this.vecMulSelf(t,-1)},o.vecNormal=function(t,n){g(t,t);let r,i;return e?(r=t.y-0,i=t.x-0):(r=t[1]-0,i=t[0]-0),n?h(-r,i):h(r,-i)},o.translate=function(t,...e){let n=!1;return 1===e.length&&i.vec(e[0])&&(e=e[0],n=!0),1!==e.length||n?e.map(e=>this.V2(t[0]+e[0],t[1]+e[1])):this.V2(t[0]+e[0][0],t[1]+e[0][1])},s.Vec2=o}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports),t["io/czlab/mcfud/matrix"]=function(){const{u:e,is:n}=t["io/czlab/mcfud/core"](),r=t["io/czlab/mcfud/math"]();if(r.Matrix)return r.Matrix;const i=Math.atan2,s=Math.cos,o=Math.sin,l=Math.tan,c={V3:function(t,e,n){return[t||0,e||0,n||0]},vecDot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]+e[2]},vecCross:function(t,e){return this.V3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},vecLen2:function(t){return this.vecDot(t,t)},vecLen:function(t){return Math.sqrt(this.vecLen2(t))},vecUnit:function(t){let e=this.vecLen(t),n=this.V3();return e>EPSILON&&(n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e),n},vecSub:function(t,e){return n.num(e)?this.V3(t[0]-e,t[1]-e,t[2]-e):this.V3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},vecAdd:function(t,e){return n.num(e)?this.V3(t[0]+e,t[1]+e,t[2]+e):this.V3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},vecMul:function(t,e){return n.num(e)?this.V3(t[0]*e,t[1]*e,t[2]*e):this.V3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},vecDiv:function(t,e){return n.num(e)?this.V3(t[0]/e,t[1]/e,t[2]/e):this.V3(t[0]/e[0],t[1]/e[1],t[2]/e[2])}};function u(t){return t%2!=0}function a(t,e,n,r){return r-1+(n-1)*e}function h(t,e,n){return{dim:[t,e],cells:n}}return c.matrix=function([t,n],...r){let i=t*n;return 0===r.length?function(t,n){return h(t,n,e.fill(new Array(t*n),0))}(t,n):e.assert(i===r.length)&&h(t,n,r)},c.matIdentity=function(t){let n=e.fill(new Array(t*t),0);for(let e=0;e<t;++e)n[a(0,t,e+1,e+1)]=1;return h(t,t,n)},c.matZero=function(t){return e.assert(t>0)&&h(t,t,e.fill(new Array(t*t),0))},c.mat2=function(t,e,n,r){return this.matrix([2,2],t,e,n,r)},c.mat3=function(t,e,n,r,i,s,o,l,c){return this.matrix([3,3],t,e,n,r,i,s,o,l,c)},c.mat4=function(t,e,n,r,i,s,o,l,c,u,a,h,f,p,m,d){return this.matrix([4,4],t,e,n,r,i,s,o,l,c,u,a,h,f,p,m,d)},c.matEq=function(t,e){return t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&function(t,e){for(let n=0;n<t.length;++n)if(!r.fuzzyEq(t[n],e[n]))return!1;return!0}(t.cells,e.cells)},c.matNeq=function(t,e){return!this.matEq(t,e)},c.matXpose=function(t){let[e,n]=t.dim,r=e*n,i=[];for(let s=0;s<r;++s)i.push(t.cells[s/e+n*(s%e)]);return h(n,e,i)},c.mat3FastInverse=function(t){return e.assert(3===t.dim[0]&&3===t.dim[1])&&this.matXpose(t)},c.mat4FastInverse=function(t){_assert(4===t.dim[0]&&4===t.dim[1]);let n=this.matXpose(t),[r,i]=t.dim,s=e.partition(i,t.cells),o=s[0],l=s[1],c=s[2],u=s[3],h=o.slice(0,3),f=l.slice(0,3),p=c.slice(0,3),m=u.slice(0,3);return t.cells[a(0,4,1,4)]=0,t.cells[a(0,4,2,4)]=0,t.cells[a(0,4,3,4)]=0,t.cells[a(0,4,4,1)]=-this.vecDot(h,m),t.cells[a(0,4,4,2)]=-this.vecDot(f,m),t.cells[a(0,4,4,3)]=-this.vecDot(p,m),n},c.matScale=function(t,e){return h(t.dim[0],t.dim[1],t.cells.map(t=>t*e))},c.matMult=function(t,n){let[r,i]=t.dim,[s,o]=n.dim,l=t.cells,c=n.cells;e.assert(i===s,"mismatch matrices");let u=new Array(r*o);for(let t=0;t<r;++t)for(let n=0;n<o;++n)u[n+t*o]=e.range(s).reduce((e,r)=>e+l[r+t*i]*c[n+r*o],0);return h(r,o,u)},c.matDet=function(t){let[n,r]=t.dim,i=[];for(let n=0;n<r;++n)e.conj(i,this.matDet(this.matCut(t,1,n+1)));return e.range(r).reduce((e,n)=>{let r=i[n];return e+t.cells[n]*(u(n)?-r:r)},0)},c.matDet2x2=function(t){return e.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]},c.matCut=function(t,n,r){let[i,s]=t.dim,o=n-1,l=r-1,c=[];for(let n=0;n<i;++n)for(let r=0;r<s;++r)n!==o&&r!==l&&e.conj(c,t.cells[r+n*s]);return h(i-1,s-1,c)},c.matMinor=function(t){let[n,r]=t.dim,i=[];for(let s=0;s<n;++s)for(let n=0;n<r;++n)e.conj(i,this.matDet(this.matCut(t,s+1,n+1)));return h(n,r,i)},c.matMinor2x2=function(t){return e.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},c.matCofactor=function(t){let e=this.matMinor(t),[n,r]=e.dim,i=t.cells.slice();for(let t=n*r,e=0;e<t;++e)u(e)&&(i[e]=-i[e]);return h(n,r,i)},c.matAdjugate=function(t){return this.matXpose(this.matCofactor(t))},c.matInverse2x2=function(t){let[n,i]=t.dim;e.assert(4===t.cells.length&&2===n&&2===i);let s,o=t.cells,l=o[0]*o[3]-o[1]*o[2];if(r.fuzzyZero(l))s=this.matIdentity(n);else{let t=1/l;s=this.mat2(o[3]*t,-o[1]*t,-o[2]*t,o[0]*t)}return s},c.matInverse=function(t){let[e,n]=t.dim,i=this.matDet(t);return r.fuzzyZero(i)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/i)},c.matFromColMajor=function(t){return this.matXpose(t)},c.matToColMajor=function(t){return this.matXpose(t)},c.mat4Txlate=function(t){let n=e.assert(3===t.length)&&this.matIdentity(4);return n.cells[a(0,4,4,1)]=t[0],n.cells[a(0,4,4,2)]=t[1],n.cells[a(0,4,4,3)]=t[2],n},c.matFromMX_3x3=function(t){e.assert(9===t.cells.length);let[n,r]=t.dim,i=e.partition(r,t.cells),s=i[0],o=i[1],l=i[2];return h(n+1,r+1,s.concat(0,o,0,l,0,[0,0,0,1]))},c.getTranslation4x4=function(t){e.assert(16===t.cells.length);let n=t.cells;return this.V3(n[a(0,4,4,1)],n[a(0,4,4,2)],n[a(0,4,4,3)])},c.matFromVX_V3=function(t){e.assert(3===t.length);let n=this.matIdentity(4),r=n.cells;return r[a(0,4,1,1)]=t[0],r[a(0,4,2,2)]=t[1],r[a(0,4,3,3)]=t[2],n},c.getScaleFromMX_4x4=function(t){e.assert(16===t.cells.length);let[n,r]=t.dim,i=e.partition(r,t.cells),s=i[0],o=i[1],l=i[2];return this.V3(s[0],o[1],l[2])},c.matVMult=function(t,n){let r=t.dim[1],i=n.length;e.assert(r===i);let s=this.matMult(t,h(i,1,n)),o=s.cells;return s.cells=null,o},c.rotation2x2=function(t){return this.mat2(s(t),-o(t),o(t),s(t))},c.yawPitchRoll=function(t,e,n){return this.mat4(s(n)*s(t)+o(n)*o(e)*o(t),o(n)*s(e),s(n)*-o(t)+o(n)*o(e)*s(t),0,-o(n)*s(t)+s(n)*o(e)*o(t),s(n)*s(e),o(n)*o(t)+s(n)*o(e)*s(t),0,s(e)*o(t),-o(e),s(e)*s(t),0,0,0,0,1)},c.xRotation=function(t){return this.mat4(1,0,0,0,0,s(t),o(t),0,0,-o(t),s(t),0,0,0,0,1)},c.xRotation3x3=function(t){return this.mat3(1,0,0,0,s(t),o(t),0,-o(t),s(t))},c.yRotation=function(t){return this.mat4(s(t),0,-o(t),0,0,1,0,0,o(t),0,s(t),0,0,0,0,1)},c.yRotation3x3=function(t){return this.mat3(s(t),0,-o(t),0,1,0,o(t),0,s(t))},c.zRotation=function(t){return this.mat4(s(t),o(t),0,0,-o(t),s(t),0,0,0,0,1,0,0,0,0,1)},c.zRotation3x3=function(t){return this.mat3(s(t),o(t),0,-o(t),s(t),0,0,0,1)},c.mat4Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation(n),this.xRotation(t)),this.yRotation(e))},c.mat3Rotation=function(t,e,n){return this.matMult(this.matMult(this.zRotation3x3(n),this.xRotation3x3(t)),this.yRotation3x3(e))},c.matOrthogonal4x4=function(t){e.assert(16===t.cells.length);let[n,r]=t.dim,i=e.partition(r,t.cells),s=i[0],o=i[1],l=i[2],c=i[3],u=s.slice(0,3),a=o.slice(0,3),h=this.vecCross(u,a),f=this.vecCross(a,h),p=this.vecCross(h,u),m=this.vecCross(u,a);return this.mat4(f[0],f[1],f[2],s[3],p[0],p[1],p[2],o[3],m[0],m[1],m[2],l[3],c[0],c[1],c[2],c[3])},c.matOrthogonal3x3=function(t){e.assert(9===t.cells.length);let[n,r]=t.dim,i=e.partition(r,t.cells),s=i[0],o=i[1],l=(i[2],s),c=o,u=this.vecCross(l,c),a=this.vecCross(c,u),h=this.vecCross(u,l),f=this.vecCross(l,c);return this.mat3(a[0],a[1],a[2],h[0],h[1],h[2],f[0],f[1],f[2])},c.mat4AxisAngle=function(t,n){e.assert(3===t.length);let i=t[0],l=t[1],c=t[2],u=this.vecLen(t),a=s(n),h=o(n),f=1-a;if(!r.fuzzyEq(u,1)){let t=1/u;i*=t,l*=t,c*=t}return this.mat4(a+f*i*i,f*i*l+h*c,f*i*c-h*l,0,f*i*l-h*c,a+f*l*l,f*l*c+h*i,0,f*i*c+h*l,f*l*c-h*i,a+f*c*c,0,0,0,0,1)},c.axisAngle3x3=function(t,n){e.assert(3===t.length);let i=t[0],l=t[1],c=t[2],u=s(n),a=o(n),h=1-u,f=this.vecLen(t);if(!r.fuzzyEq(f,1)){let t=1/f;i*=t,l*=t,c*=t}return this.mat3(u+h*i*i,h*i*l+a*c,h*i*c-a*l,h*i*l-a*c,u+h*l*l,h*l*c+a*i,h*i*c+a*l,h*l*c-a*i,u+h*c*c)},c.matMultV3M4=function(t,n){e.assert(3===t.length&&16===n.cells.length);let r=t[0],i=t[1],s=t[2],o=e.partition(4,n.cells),l=o[0],c=o[1],u=o[2],a=o[3];return this.V3(r*l[0]+i*c[0]+s*u[0]+1*a[0],r*l[1]+i*c[1]+s*u[1]+1*a[1],r*l[2]+i*c[2]+s*u[2]+1*a[2])},c.mat3MultVX_4x4=function(t,n){e.assert(3===t.length&&16===n.cells.length);let r=t[0],i=t[1],s=t[2],o=e.partition(4,n.cells),l=o[0],c=o[1],u=o[2],a=o[3];return[r*l[0]+i*c[0]+s*u[0]+0*a[0],r*l[1]+i*c[1]+s*u[1]+0*a[1],r*l[2]+i*c[2]+s*u[2]+0*a[2]]},c.mat3MultVX_3x3=function(t,n){e.assert(3===t.length&&9===n.cells.length);t[0],t[1],t[2];let r=e.partition(3,n.cells),i=r[0],s=r[1],o=r[2];return[this.vecDot(t,this.V3(i[0],s[0],o[0])),this.vecDot(t,this.V3(i[1],s[1],o[1])),this.vecDot(t,this.V3(i[2],s[2],o[2]))]},c.mat4TxformViaRotation=function(t,n,r){e.assert(3===n.length);let i=n[0],s=n[1],o=n[2];return this.matMult(this.matMult(this.matFromVX(t),this.mat4Rotation(i,s,o)),this.mat4Txlate(r))},c.mat4TxformViaAxisAngle=function(t,e,n,r){return this.matMult(this.matMult(this.matFromVX(t),this.mat4AxisAngle(e,n)),this.mat4Txlate(r))},c.mat4LookAt=function(t,e,n){let r=this.vecUnit(this.vecSub(e,t)),i=this.vecUnit(this.vecCross(n,r)),s=this.vecCross(r,i);return this.mat4(i[0],s[0],r[0],0,i[1],s[1],r[1],0,i[2],s[2],r[2],0,-this.vecDot(i,t),-this.vecDot(s,t),-this.vecDot(r,t),1)},c.mat4Proj=function(t,e,n,r){let i=1/l(.5*t),s=i/e,o=r/(r-n),c=this.matIdentity(4);return c.cells[a(0,4,1,1)]=s,c.cells[a(0,4,2,2)]=i,c.cells[a(0,4,3,3)]=o,c.cells[a(0,4,3,4)]=1,c.cells[a(0,4,4,3)]=-n*o,c.cells[a(0,4,4,4)]=0,c},c.mat4Ortho=function(t,e,n,r,i,s){let o=(e-t)/2,l=(r-n)/2,c=(s-i)/1,u=(t+e)/(t-e),a=(r+n)/(n-r),h=i/(i-s);return this.mat4(o,0,0,0,0,l,0,0,0,0,c,0,u,a,h,1)},c.matDecompose3x3=function(t){let n=this.matXpose(t),r=e.partition(3,n),s=r[0],o=r[1],l=r[2],c=Math.sqrt(s[0]*s[0]+o[0]*o[0]);return c<1e-6?this.V3(i(-o[2],o[1]),i(-l[0],c),0):this.V3(i(l[1],l[2]),i(-l[0],c),i(o[0],s[0]))},r.Matrix=c}}(this),function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;const n=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",r=n.length;t["io/czlab/mcfud/crypt"]=function(){if(e)return e;const{u:i}=t["io/czlab/mcfud/core"](),s={};function o(t){return Math.abs(t)%r}function l(t,e){return(e||n).charAt(t)}function c(t){for(let e=0;e<r;++e)if(charat(e)===t)return e;return-1}function u(t,e){let n=e+t;return l(n>=r?n-r:n)}function a(t,e){let n=e-t;return l(n<0?r+n:n)}return s.encrypt=function(t,e){if(0===e)return t;let n=[],r=o(e);return t.split().forEach(t=>{let i=c(t);n.push(i<0?t:function(t,e,n){return t<0?u(e,n):a(e,n)}(e,r,i))}),n.join("")},s.decrypt=function(t,e){if(0===e)return t;let n,r=[],i=o(e);return t.split("").forEach(t=>{n=c(t),r.push(n<0?t:function(t,e,n){return t<0?a(e,n):u(e,n)}(e,i,n))}),r.join("")},e=s}}(this),function(t){"use strict";let e;"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports),t["io/czlab/mcfud/fsm"]=function(){if(e)return e;return e={fsm(t){let e=t.initState();return{state:()=>e,process(){let n=t[e];n&&n.run&&n.run()},trigger(n){let r=t[e];n=n||"change";let i=r&&r.transitions[n];if(i){let n=i.target,s=t[n];if(s)return r.egress&&r.egress(),s.ingress&&s.ingress(),i.action&&i.action(),e=n}}}}}}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io/czlab/mcfud/gfx"]=function(){if(e)return e;const{u:n}=t["io/czlab/mcfud/core"](),r=(t["io/czlab/mcfud/math"](),{}),i=2*Math.PI;r.textStyle=function(t,e,n,r){return{font:t,fill:e,align:n,base:r}},r.drawShape=function(t,e,...n){e.draw&&e.draw(t,...n)},r.cfgStyle=function(t,e){if(e){let n=e.line,r=e.stroke;n&&(n.cap&&(t.lineCap=n.cap),n.width&&(t.lineWidth=n.width)),r&&r.style&&(t.strokeStyle=r.style)}},r.drawPoints=function(t,e,n){void 0===n&&(n=e.length),t.beginPath();for(let r=0;r<n;++r){let i=(r+1)%n,s=e[r],o=e[i];t.moveTo(s[0],s[1]),t.lineTo(o[0],o[1])}t.stroke()},r.drawShapePoly=function(t,e){return this.drawPoints(t,e.points)},r.drawCircle=function(t,e,n,r){t.beginPath(),t.arc(e,n,r,0,i,!0),t.closePath(),t.stroke()},r.drawShapeCircle=function(t,e){this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},r.drawRect=function(t,e,n,r,i,s){let o=e,l=n-i;t.save(),t.translate(o,l),t.rotate(s),t.strokeRect(0,0,r,i),t.restore()},r.drawShapeRect=function(t,e){return this.drawRet(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},r.drawLine=function(t,e,n,r,i){t.beginPath(),t.moveTo(e,n),t.lineTo(r,i),t.stroke()},r.drawShapeLine=function(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])};return e=n.inject(r,{TXMatrix2d:class{constructor(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]}identity(){let t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this}clone(t){let e=this.m,n=t.m;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],this}multiply(t){let e=this.m,n=t.m,r=e[0]*n[0]+e[1]*n[3],i=e[0]*n[1]+e[1]*n[4],s=e[0]*n[2]+e[1]*n[5]+e[2],o=e[3]*n[0]+e[4]*n[3],l=e[3]*n[1]+e[4]*n[4],c=e[3]*n[2]+e[4]*n[5]+e[5];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=l,e[5]=c,this}rotate(t){if(0===t)return this;let e=Math.cos(t),n=Math.sin(t),r=this.m,i=r[0]*e+r[1]*n,s=r[0]*-n+r[1]*e,o=r[3]*e+r[4]*n,l=r[3]*-n+r[4]*e;return r[0]=i,r[1]=s,r[3]=o,r[4]=l,this}rotateDeg(t){return 0===t?this:this.rotate(Math.PI*t/180)}scale(t,e){let n=this.m;return void 0===e&&(e=t),n[0]*=t,n[1]*=e,n[3]*=t,n[4]*=e,this}translate(t,e){let n=this.m;return n[2]+=n[0]*t+n[1]*e,n[5]+=n[3]*t+n[4]*e,this}transform(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]}transformPoint(t){let e=t.x,n=t.y;return t.x=e*this.m[0]+n*this.m[1]+this.m[2],t.y=e*this.m[3]+n*this.m[4]+this.m[5],t}transformArray(t,e){let n=t[0],r=t[1];return e[0]=n*this.m[0]+r*this.m[1]+this.m[2],e[1]=n*this.m[3]+r*this.m[4]+this.m[5],e}transformX(t,e){return t*this.m[0]+e*this.m[1]+this.m[2]}transformY(t,e){return t*this.m[3]+e*this.m[4]+this.m[5]}setContextTransform(t){let e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}}})}}(this),function(t){"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io/czlab/mcfud/geo2d"]=function(){if(e)return e;const{u:n}=t["io/czlab/mcfud/core"](),r=t["io/czlab/mcfud/math"](),i=t["io/czlab/mcfud/vec2"](),s={};class o{constructor(t,e,n,r){2===arguments.length?(this.width=t,this.height=e,this.pos=i.V2()):(this.pos=i.V2(t,e),this.width=n,this.height=r)}}class l{constructor(t,e){this.width=t,this.height=e}half(){return new l(this.width/2,this.height/2)}}s.polyArea=function(t){let e=0;for(let n,r,i,s=t.length,o=0;o<s;++o)i=(o+1)%s,n=poly.points[o],r=poly.points[i],e+=n[0]*r[1]-r[0]*n[1];return Math.abs(e)/2},s.calcPolyCenter=function(t){let e=6*this.polyArea(t),n=0,r=0;for(let e,i,s,o=0,l=t.length;o<l;++o)s=(o+1)%l,e=t[o],i=t[s],n+=(e[0]+i[0])*(e[0]*i[1]-i[0]*e[1]),r+=(e[1]+i[1])*(e[0]*i[1]-i[0]*e[1]);return i.V2(n/e,r/e)};class c{constructor(t,e,n,r){this.p=i.V2(t,e),this.q=i.V2(n,r)}}class u{constructor(t,e){this.orient=0,this.pos=i.V2(),this.setPos(t,e)}setPos(t,e){return i.vecCopy(this.pos,t||0,e||0),this}set(t){t=function(t){let e=t.length;n.assert(e>2&&e<=64);let s=0,o=t[0][0];for(let n,i=1;i<e;++i)n=t[i][0],n>o?(o=n,s=i):r.fuzzyEq(n,o)&&t[i][1]<t[s][1]&&(s=i);let l=new Array(64),c=0,u=s;for(;;){l[c]=u;let n=0;for(let s=1;s<e;++s){if(n===u){n=s;continue}let e=i.vecSub(t[n],t[l[c]]),o=i.vecSub(t[s],t[l[c]]),a=i.vec2Cross(e,o);a<0&&(n=s),r.fuzzyZero(a)&&i.vecLen2(o)>i.vecLen2(e)&&(n=s)}if(++c,u=n,n===s)break}const a=[];for(let e=0;e<c;++e)a.push(i.vecClone(t[l[e]]));return a}(t),this.calcPoints?this.calcPoints.length=0:this.calcPoints=[],this.normals?this.normals.length=0:this.normals=[],this.edges?this.edges.length=0:this.edges=[];for(let e=0;e<t.length;++e)this.calcPoints.push(i.V2()),this.edges.push(i.V2()),this.normals.push(i.V2());return this.points=t,this._recalc(),this}setOrient(t){return this.orient=t,this._recalc(),this}translate(t,e){if(this.points){for(let n=0;n<this.points.length;++n)this.points[n][0]+=t,this.points[n][1]+=e;this._recalc()}return this}_recalc(){if(this.points){for(let t=0;t<this.points.length;++t)i.vecSet(this.calcPoints[t],this.points[t]),r.fuzzyZero(this.orient)||i.vec2RotSelf(this.calcPoints[t],this.orient);for(let t,e,n,r=0;r<this.points.length;++r)e=this.calcPoints[r],t=(r+1)%this.calcPoints.length,n=this.calcPoints[t],this.edges[r]=i.vecSub(n,e),this.normals[r]=i.vecUnit(i.perp(this.edges[r]))}return this}}class a extends o{constructor(t,e,n,r){super(t,e,n,r)}toPolygon(){return new u(this.pos[0],this.pos[1]).set([i.V2(this.width,0),i.V2(this.width,this.height),i.V2(0,this.height),i.V2()])}}class h{constructor(t,e){this.A=t,this.B=e,this.overlapN=i.V2(),this.overlapV=i.V2(),this.clear()}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function f(t,e){let n=1/0,r=-1/0;for(let s,o=0;o<t.length;++o)s=i.vecDot(t[o],e),s<n&&(n=s),s>r&&(r=s);return i.takeV2(n,r)}function p(t,e){let n=i.vecDot(e,t),r=i.vecLen2(t);return n<0?-1:n>r?1:0}function m(t,e,n,r,s,o){let l,c=i.vecSub(n,t),u=i.vecDot(c,s),[a,h]=f(e,s),[p,m]=f(r,s);if(p+=u,m+=u,a>m||p>h)l=!0;else if(o){let t=0;if(a<p)if(o.AInB=!1,h<m)t=h-p,o.BInA=!1;else{let[e,n]=[h-p,m-a];t=e<n?e:-n}else if(o.BInA=!1,h>m)t=a-m,o.AInB=!1;else{let[e,n]=[h-p,m-a];t=e<n?e:-n}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,i.vecSet(o.overlapN,s),t<0&&i.vecFlipSelf(o.overlapN))}return i.dropV2(c),l}s.getAABB=function(t){if(n.has(t,"radius"))return new s.Rect(t.pos[0]-t.radius,t.pos[1]-t.radius,2*t.radius,2*t.radius);{let e=i.translate(t.pos,t.calcPoints),n=e[0][0],r=e[0][1],o=n,l=r;for(let t,i=1;i<e.length;++i)t=e[i],t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return new s.Rect(n,r,o-n,l-r)}},s.shiftPoints=function(t,e){return t.map(t=>i.vecAdd(t,e))},s.rotPoints=function(t,e,n){return t.map(t=>i.vec2Rot(t,e,n))},s.calcRectPoints=function(t,e){return[i.V2(hw,-hh),i.V2(hw,hh),i.V2(-hw,hh),i.V2(-hw,-hh)]},s.line=function(t,e,n,r){return new c(t,e,n,r)},s.rectEqRect=function(t,e){return t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1]},s.rectContainsRect=function(t,e){return!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height)},s.rectGetMaxX=function(t){return t.pos[0]+t.width},s.rectGetMidX=function(t){return t.pos[0]+t.width/2},s.rectGetMinX=function(t){return t.pos[0]},s.rectGetMaxY=function(t){return t.pos[1]+t.height},s.rectGetMidY=function(t){return t.pos[1]+t.height/2},s.rectGetMinY=function(t){return t.pos[1]},s.containsPoint=function(t,e,n){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&n>=this.rectGetMinY(t)&&n<=this.rectGetMaxY(t)},s.rectIntersectsRect=function(t,e){return!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1])},s.rectUnionsRect=function(t,e){let n=Math.min(t.pos[0],e.pos[0]),r=Math.min(t.pos[1],e.pos[1]);return new o(n,r,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-r)},s.rectIntersectsRect=function(t,e){let n=Math.max(t.pos[0],e.pos[0]),r=Math.max(t.pos[1],e.pos[1]);return new o(n,r,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-n,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-r)},s.hitTestPointCircle=function(t,e){return i.vecLen2(i.vecSub(t,e.pos))<=e.radius*e.radius};const d=new h,g=new a(0,0,1,1).toPolygon();function v(t,e,n){let r=t.radius+e.radius,s=i.vecSub(e.pos,t.pos),o=r*r,l=i.vecLen2(s),c=!(l>o);if(c&&n){let o=Math.sqrt(l);n.A=t,n.B=e,n.overlap=r-o,i.vecSet(n.overlapN,i.vecUnitSelf(s)),i.vecSet(n.overlapV,i.vecMul(s,n.overlap)),n.AInB=t.radius<=e.radius&&o<=e.radius-t.radius,n.BInA=e.radius<=t.radius&&o<=t.radius-e.radius}return i.dropV2(s),c}function y(t,e,n){let r,s=i.vecSub(e.pos,t.pos),o=e.radius*e.radius,l=t.calcPoints,c=i.takeV2();for(let u=l.length,a=0;a<u;++a){let h=a===u-1?0:a+1,f=0===a?u-1:a-1,m=0,d=null;i.vecSet(c,t.edges[a]),r=i.vecSub(s,l[a]),n&&i.vecLen2(r)>o&&(n.AInB=!1);let g=p(c,r);if(-1===g){i.vecSet(c,t.edges[f]);let o=i.vecSub(s,l[f]);if(g=p(c,o),1===g){let t=i.vecLen(r);if(t>e.radius)return i.dropV2(s,c,r,o),!1;n&&(n.BInA=!1,d=i.vecUnit(r),m=e.radius-t)}i.dropV2(o)}else if(1===g){if(i.vecSet(c,t.edges[h]),i.vecSubSelf(i.vecSet(r,s),l[h]),g=p(c,r),-1===g){let t=i.vecLen(r);if(t>e.radius)return i.dropV2(s,c,r),!1;n&&(n.BInA=!1,d=i.vecUnit(r),m=e.radius-t)}}else{let t=i.vecUnitSelf(i.perp(c)),o=i.vecDot(r,t),l=Math.abs(o);if(o>0&&l>e.radius)return i.dropV2(s,t,r),!1;n&&(d=t,m=e.radius-o,(o>=0||m<2*e.radius)&&(n.BInA=!1))}d&&n&&Math.abs(m)<Math.abs(n.overlap)&&(n.overlap=m,i.vecSet(n.overlapN,d))}return n&&(n.A=t,n.B=e,i.vecMulSelf(i.vecSet(n.overlapV,n.overlapN),n.overlap)),i.dropV2(s,c,r),!0}function x(t,e,n){let r=y(e,t,n);if(r&&n){let t=n.A,e=n.AInB;i.vecFlipSelf(n.overlapN),i.vecFlipSelf(n.overlapV),n.A=n.B,n.B=t,n.AInB=n.BInA,n.BInA=e}return r}function b(t,e,n){let s=t.calcPoints,o=e.calcPoints;for(let r=0;r<s.length;++r)if(m(t.pos,s,e.pos,o,t.normals[r],n))return!1;for(let r=0;r<o.length;++r)if(m(t.pos,s,e.pos,o,e.normals[r],n))return!1;if(n){if(0===n.overlap||r.fuzzyZero(n.overlap))return!1;n.A=t,n.B=e,i.vecSet(n.overlapV,n.overlapN),i.vecMulSelf(n.overlapV,n.overlap)}return!0}return s.hitTestPointPolygon=function(t,e){return i.vecSet(g.pos,t),!!this.hitTestPolygonPolygon(g,e,d.clear())&&d.AInB},s.hitCircleCircle=function(t,e){let n=new h;return v(t,e,n)?n:null},s.hitTestCircleCircle=function(t,e){return v(t,e,new h)},s.hitPolygonCircle=function(t,e){let n=new h;return y(t,e,n)?n:null},s.hitTestPolygonCircle=function(t,e){return y(t,e,new h)},s.hitCirclePolygon=function(t,e){let n=new h;return x(t,e,n)?n:null},s.hitTestCirclePolygon=function(t,e){return x(t,e,new h)},s.hitPolygonPolygon=function(t,e){let n=new h;return b(t,e,n)?n:null},s.hitTestPolygonPolygon=function(t,e){return b(t,e,new h)},e=n.inject(s,{Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=i.V2()}setOrient(t){return this.orient=t,this}setPos(t,e){return i.vecCopy(this.pos,t,e),this}},Line:c,Box:a,Manifold:h,Polygon:u,Rect:o,Area:l})}}(this),function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io/czlab/mcfud/qtree"]=function(){if(e)return e;class t{constructor(t,e,n,r,i,s){this.maxCount=i||12,this.maxDepth=s||5,this.objects=[],this.boxes=null,this.level=0,this.x1=t,this.x2=n,this.y1=e,this.y2=r,this.midX=(t+n)/2,this.midY=(e+r)/2}_ctree(e,n,r,i){let s=new t(e,n,r,i,this.maxCount,this.maxDepth);return s.level=this.level+1,s}_split(){_.assert(null===this.boxes),this.boxes=[this._ctree(this.midX,this.y1,this.x2,this.midY),this._ctree(this.midX,this.midY,this.x2,this.y2),this._ctree(this.x1,this.midY,this.midX,this.y2),this._ctree(this.x1,this.y1,this.midX,this.midY)]}_locate(t){let e=t.y<this.midY,n=t.x<this.midX,r=t.x+t.width>this.midX,i=t.y+t.height>this.midY;return e&&(n&&out.push(3),r&&out.push(0)),i&&(n&&out.push(2),r&&out.push(1)),out}insert(t){this.boxes?this._locate(t).forEach(e=>{this.boxes[e].insert(t)}):(this.objects.push(t),this.objects.length>this.maxCount&&this.level<this.maxDepth&&(this._split(),this.objects.forEach(t=>{this._locate(t).forEach(e=>{this.boxes[e].insert(t)})}),this.objects.length=0))}search(t){let e=new Map,n=[];return this.boxes&&this._locate(t).forEach(r=>{this.boxes[r].search(t).forEach(t=>{e.has(t)||(e.set(t,null),n.push(t))})}),this.objects.forEach(t=>{e.has(t)||(e.set(t,null),n.push(t))}),n}reset(){this.objects.length=0,this.boxes&&this.boxes.forEach(t=>{t.reset()}),this.boxes=null}}return e={quadtree:(e,n,r)=>new t(e.x1,e.y1,e.x2,e.y2,n,r)}}}(this),function(t){"use strict";"object"==typeof module&&module&&"object"==typeof module.exports?t=module.exports:"object"==typeof exports&&exports&&(t=exports);let e=null;t["io/czlab/mcfud/negamax"]=function(){if(e)return e;const{u:n}=t["io/czlab/mcfud/core"](),r={};class i{constructor(){this.lastBestMove=null,this.state=null,this.other=0,this.cur=0}clone(){let t=new i;return t.state=n.deepCopyArray(this.state),t.lastBestMove=this.lastBestMove,t.other=this.other,t.cur=this.cur,t}}function s(t,e,n,r,i,o){if(0===r||t.isOver(e)){let n=t.evalScore(e);return 0!==n&&(n-=.01*r*Math.abs(n)/n),n}let l=t.getNextMoves(e),c=e,u=-1/0,a=l[0];r===n&&(e.lastBestMove=l[0]);for(let h,f,p=0;p<l.length&&(t.undoMove||(e=c.clone()),f=l[p],t.makeMove(e,f),t.switchPlayer(e),h=-s(t,e,n,r-1,-o,-i),t.undoMove&&(t.switchPlayer(e),t.undoMove(e,f)),u<h&&(u=h,a=f),!(i<h&&(i=h,r===n&&(e.lastBestMove=f),i>=o)));++p);return u}return r.evalNegaMax=function(t){let e=t.takeFFrame();return s(t,e,t.depth,t.depth,-1/0,1/0),e.lastBestMove},e=n.inject(r,{FFrame:i,GameBoard:class{constructor(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}makeMove(t,e){}switchPlayer(t){}takeFFrame(){}}})}}(this);