!function(t,e,r){var n,s=256,i="random",o=r.pow(s,6),l=r.pow(2,52),c=2*l,u=255;function a(u,a,p){function g(){for(var t=b.g(6),e=o,r=0;t<l;)t=(t+r)*s,e*=s,r=b.g(1);for(;c<=t;)t/=2,e/=2,r>>>=1;return(t+r)/e}var y=[],v=d(function t(e,r){var n,s=[],i=typeof e;if(r&&"object"==i)for(n in e)try{s.push(t(e[n],r-1))}catch(t){}return s.length?s:"string"==i?e:e+"\0"}((a=1==a?{entropy:!0}:a||{}).entropy?[u,m(e)]:null==u?function(){try{var r;return n&&(r=n.randomBytes)?r=r(s):(r=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(r)),m(r)}catch(r){var i=t.navigator,o=i&&i.plugins;return[+new Date,t,o,t.screen,m(e)]}}():u,3),y),b=new h(y);return g.int32=function(){return 0|b.g(4)},g.quick=function(){return b.g(4)/4294967296},g.double=g,d(m(b.S),e),(a.pass||p||function(t,e,n,s){return s&&(s.S&&f(s,b),t.state=function(){return f(b,{})}),n?(r[i]=t,e):t})(g,v,"global"in a?a.global:this==r,a.state)}function h(t){var e,r=t.length,n=this,i=0,o=n.i=n.j=0,l=n.S=[];for(r||(t=[r++]);i<s;)l[i]=i++;for(i=0;i<s;i++)l[i]=l[o=u&o+t[i%r]+(e=l[i])],l[o]=e;(n.g=function(t){for(var e,r=0,i=n.i,o=n.j,l=n.S;t--;)e=l[i=u&i+1],r=r*s+l[u&(l[i]=l[o=u&o+e])+(l[o]=e)];return n.i=i,n.j=o,r})(s)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function d(t,e){for(var r,n=t+"",s=0;s<n.length;)e[u&s]=u&(r^=19*e[u&s])+n.charCodeAt(s++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(d(r.random(),e),"object"==typeof module&&module.exports){module.exports=a;try{n=require("crypto")}catch(a){}}else"function"==typeof define&&define.amd?define((function(){return a})):r["seed"+i]=a}("undefined"!=typeof self?self:this,[],Math),function(t,e,r){"use strict";function n(){const[n,s]=[Array.prototype.slice,Object.prototype.toString],i=Math.floor;function o(t){return"[object Object]"==s.call(t)}function l(t){return"[object Function]"==s.call(t)}function c(t){return"[object Array]"==s.call(t)}function u(t){return"[object Map]"==s.call(t)}function a(t){return"[object String]"==s.call(t)}function h(t){return"[object Number]"==s.call(t)}function f(t){return t>0?t%2==0:-t%2==0}function d(t){return c(t)||u(t)||o(t)}let m=r?r():new Math.seedrandom;function p(t,e){for(let r,n=0;n<t.length;++n)if(r=t[n],!r[0](r[1]))throw new TypeError("wanted "+e);return!0}function g(t,e){for(let e,r=0;r<t.length;++r)if(e=t[r],e[0](e[1]))return!0;throw new TypeError("wanted "+e)}function y(t,e,r){if(!t(e))throw new TypeError("wanted "+r);return!0}const v=/(\/|\\\\)([^(\/|\\\\)]+)$/g,b=/(\.[^\.\/\?\\]*)(\?.*)?$/;function x(t,e){let r=b.exec(t);return r&&r[1]?(r=r[1].toLowerCase(),e||(r=r.substring(1))):r="",r}let w=0;function M(t,e,r){let n=t(e);switch(r.length){case 0:return n;case 1:return n&&t(r[0]);case 2:return n&&t(r[0])&&t(r[1]);case 3:return n&&t(r[0])&&t(r[1])&&t(r[2]);default:return n&&r.every(e=>t(e))}}const j={fun:(t,...e)=>M(l,t,e),str:(t,...e)=>M(a,t,e),void0:t=>void 0===t,undef:t=>void 0===t,some:t=>S.size(t)>0,none:t=>0===S.size(t),map:(t,...e)=>M(u,t,e),num:(t,...e)=>M(h,t,e),vec:(t,...e)=>M(c,t,e),obj:(t,...e)=>M(o,t,e),own:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},S={srand(){m=r?r():new Math.seedrandom},feq0:t=>Math.abs(t)<1e-10,feq:(t,e)=>Math.abs(t-e)<1e-10,pack:t=>JSON.stringify(t),unpack:t=>JSON.parse(t),v2:(t=0,e=0)=>[t,e],p2:(t=0,e=0)=>({x:t,y:e}),numOrZero:t=>isNaN(t)?0:t,or:(t,e)=>void 0===t?e:t,toNumber(t,e){const r=parseFloat(t);return isNaN(r)&&h(e)?e:r},splitVerStr(t){const e=(""+(t||"")).split(".").filter(t=>t.length>0);return[this.toNumber(e[0],0),this.toNumber(e[1],0),this.toNumber(e[2],0)]},cmpVerStrs(t,e){let r=this.splitVerStr(""+t),n=this.splitVerStr(""+e);return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]>n[1]?1:r[1]<n[1]?-1:r[2]>n[2]?1:r[2]<n[2]?-1:0},pdef:t=>(t.configurable=!0)&&(t.enumerable=!0)&&t,findFiles:(t,e)=>t.filter(t=>e.indexOf(x(t,1))>-1),partition(t,e){const r=[];for(let n,s,i=0;;){for(n=[],s=0;s<t;++s){if(!(i<e.length)){s=-1;break}n.push(e[i++])}if(n.length>0&&r.push(n),s<0)break}return r},keys:t=>u(t)?Array.from(t.keys()):o(t)?Object.keys(t):[],selectNotKeys(t,e){g([[u,t],[o,t]],"map/object");const r=u(t)?new Map:{};return e=this.seq(e),this.doseq(t,(t,n)=>!e.includes(n)&&this.assoc(r,n,t)),r},selectKeys(t,e){g([[u,t],[o,t]],"map/object");const r=u(t)?new Map:{};return this.seq(e).forEach(e=>{u(t)?t.has(e)&&r.set(e,t.get(e)):j.own(t,e)&&(r[e]=t[e])}),r},assertNot(t,...e){return this.assert(!t,...e)},assert(t,...e){if(!t)throw 0===e.length?"Assertion!":e.join("");return!0},noSuchKeys(t,e){return!this.some(this.seq(t),t=>this.has(e,t)?t:null)},randInt2:function(t,e){return i(m()*(e-t+1)+t)},randFloat:(t,e)=>t+m()*(e-t),randMinus1To1:()=>2*(m()-.5),randInt:t=>i(m()*t),rand:()=>m(),randSign:()=>m()>.5?-1:1,inst:(t,e)=>e instanceof t,hashCode(t){let e=0;for(let r=0;r<t.length;++r)e=Math.imul(31,e)+t.charCodeAt(r);return e},randItem(t){if(t&&t.length>0)return 1===t.length?t[0]:t[i(m()*t.length)]},isPerc:t=>a(t)&&t.match(/^([0-9])(\.?[0-9]+|[0-9]*)%$/),isEven:f,jsMap(...t){y(f,t.length,"even n# of args");let e=new Map;for(let r=0;r<t.length;)e.set(t[r],t[r+1]),r+=2;return e},jsObj(...t){y(f,t.length,"even n# of args");let e={};for(let r=0;r<t.length;)e[t[r]]=t[r+1],r+=2;return e},jsVec:(...t)=>0===t.length?[]:t.slice(),lastIndex:t=>c(t)&&t.length>0?t.length-1:-1,first(t){if(c(t)&&t.length>0)return t[0]},last(t){if(c(t)&&t.length>0)return t[t.length-1]},head(t){return this.first(t)},tail(t){return this.last(t)},floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),abs:t=>Math.abs(t),sqrt:t=>Math.sqrt(t),min:(...t)=>Math.min(...t),max:(...t)=>Math.max(...t),slice:(t,e)=>n.call(t,e),every(t,e){y(c,t,"array");for(let r=0;r<t.length;++r)if(l(e)){if(!e(t[r]))return!1}else if(t[r]!==e)return!1;return t.length>0},notAny(t,e){y(c,t,"array");for(let r=0;r<t.length;++r)if(l(e)){if(e(t[r]))return!1}else if(t[r]===e)return!1;return t.length>0},copy(t,e=[]){p([[c,t],[c,e]],"arrays");const r=Math.min(t.length,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t},append(t,e=[]){p([[c,t],[c,e]],"arrays");for(let r=0;r<e.length;++r)t.push(e[r]);return t},fill(t,e){if(h(t)&&(t=new Array(t)),c(t))for(let r=0;r<t.length;++r)t[r]=l(e)?e():e;return t},size(t){return c(t)||a(t)?t.length:u(t)?t.size:t?this.keys(t).length:0},nextId:()=>++w,now:()=>Date.now(),fileExt:t=>x(t),fileBase(t){let e,r,n=t.indexOf("?");return n>0&&(t=t.substring(0,n)),t=t.replace(/(\/|\\\\)$/,""),r=v.exec(t),e="",r&&(e=r[2],n=e.lastIndexOf("."),n>0&&(e=e.substring(0,n))),e},range(t,e,r=1){1===arguments.length&&(e=t,t=0,r=1);let n=(e-t)/r;const s=[];n=Math.ceil(n),n=Math.max(0,n),s.length=n;for(let e=0;e<n;++e)s[e]=t,t+=r;return s},shuffle(t){y(c,t,"array");const e=n.call(t,0);for(let t,r,n=e.length-1;n>0;--n)r=i(m()*(n+1)),t=e[n],e[n]=e[r],e[r]=t;return this.copy(t,e)},uniq:t=>(y(c,t,"array"),Array.from(new Set(t))),map(t,e,r){if(y(d,t,"array/map/object"),c(t))return t.map(e,r);{const n={};return this.doseq(t,(s,i)=>{n[i]=e.call(r,s,i,t)}),n}},find(t,e,r){let s,i=!0,o=n.call(arguments,3);return this.doseq(t,(t,n)=>{i&&e.apply(r,[t,n].concat(o))&&(s=[n,t],i=!1)}),s},some(t,e,r){let s,i=!0,o=n.call(arguments,3);return this.doseq(t,(t,n)=>{i&&(s=e.apply(r,[t,n].concat(o)),s?i=!1:s=void 0)}),s},invoke(t,e){let r=n.call(arguments,2);c(t)&&t.forEach(t=>t[e].apply(t,r))},delay:(t,e)=>setTimeout(e,t),timer:(t,e=0,r=!1)=>({repeat:!!r,id:r?setInterval(t,e):setTimeout(t,e)}),clear(t){t&&(t.repeat?clearInterval(t.id):clearTimeout(t.id))},rseq(t,e,r){if(y(c,t,"array"),t.length>0)for(let n=t.length-1;n>=0;--n)e.call(r,t[n],n,t)},doseq(t,e,r){c(t)?t.forEach(e,r):u(t)?t.forEach((n,s)=>e.call(r,n,s,t)):o(t)&&Object.keys(t).forEach(n=>e.call(r,t[n],n,t))},doseqEx(t,e,r){this.doseq(t,(n,s)=>null!=n&&e.call(r,n,s,t))},dissoc(t,e){if(arguments.length>2){let e,r=1;for(;r<arguments.length;++r)e=this.dissoc(t,arguments[r]);return e}{let r;return u(t)?(r=t.get(e),t.delete(e)):o(t)&&(r=t[e],delete t[e]),r}},get(t,e){if(void 0!==e){if(u(t))return t.get(e);if(t)return t[e]}},assoc(t,e,r){if(arguments.length>3){if((arguments.length-1)%2!=0)throw"wanted even count of args";let e,r=1;for(;r<arguments.length;)e=this.assoc(t,arguments[r],arguments[r+1]),r+=2;return e}{let n;return u(t)?(n=t.get(e),t.set(e,r)):t&&(n=t[e],t[e]=r),n}},disj(t,e){const r=t?t.indexOf(e):-1;return r>-1&&t.splice(r,1),r>-1},conj:(t,...e)=>(t&&e.forEach(e=>t.push(e)),t),seq:(t,e=/[,; \t\n]+/)=>("string"==typeof t&&(t=t.split(e).map(t=>t.trim()).filter(t=>t.length>0)),c(t)||(t=[t]),t),has(t,e){return 1!==arguments.length&&(u(t)?t.has(e):c(t)?-1!==t.indexOf(e):!!o(t)&&j.own(t,e))},patch(t,e){return y(o,t=t||{},"object"),e&&Object.keys(e).forEach(r=>{this.has(t,r)||(t[r]=e[r])}),t},clone(t){return t?this.unpack(this.pack(t)):t},inject:(t,...e)=>(t=t||{},e.forEach(e=>e&&Object.assign(t,e)),t),deepCopyArray(t){y(c,t,"array");const e=[];for(let r=0,n=t.length;r<n;++r)e[r]=c(t[r])?this.deepCopyArray(t[r]):t[r];return e},mergeEx(t,e){return this.merge(this.merge({},t),e)},merge(t,e){let r;return Object.keys(e).forEach(n=>{r=e[n],"object"==typeof r&&null!==r&&t[n]?("object"!=typeof t[n]&&(t[n]=r instanceof Array?[]:{}),this.merge(t[n],r)):t[n]=r}),t},throttle(t,e,r){let n=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return o(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),this.debounce(t,e,{leading:n,trailing:s,maxWait:e})},debounce(t,e,r){let n,s,i,o,l,c,u=0,a=!1,h=!1,f=!0;const d=!e&&0!==e&&"function"==typeof root.requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){const r=n,i=s;return n=s=void 0,u=e,o=t.apply(i,r),o}function p(t,e){return d?(root.cancelAnimationFrame(l),root.requestAnimationFrame(t)):setTimeout(t,e)}function g(t){const r=t-c;return void 0===c||r>=e||r<0||h&&t-u>=i}function y(){const t=Date.now();if(g(t))return v(t);l=p(y,function(t){const r=t-u,n=e-(t-c);return h?Math.min(n,i-r):n}(t))}function v(t){return l=void 0,f&&n?m(t):(n=s=void 0,o)}function b(...t){const r=Date.now(),i=g(r);if(n=t,s=this,c=r,i){if(void 0===l)return function(t){return u=t,l=p(y,e),a?m(t):o}(c);if(h)return l=p(y,e),m(c)}return void 0===l&&(l=p(y,e)),o}return e=+e||0,isObject(r)&&(a=!!r.leading,h="maxWait"in r,i=h?Math.max(+r.maxWait||0,e):i,f="trailing"in r?!!r.trailing:f),b.cancel=function(){void 0!==l&&function(t){if(d)return root.cancelAnimationFrame(t);clearTimeout(t)}(l),u=0,n=c=s=l=void 0},b.flush=function(){return void 0===l?o:v(Date.now())},b.pending=function(){return void 0!==l},b},negate:t=>(y(l,t,"function"),function(...e){return!t.apply(this,e)}),strPadRight:(t,e,r)=>(e-=t.length)>0?t+new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e):t,strPadLeft:(t,e,r)=>(e-=t.length)>0?new Array(Math.ceil(e/r.length)+1).join(r).substr(0,e)+t:t,safeSplit:(t,e)=>(t||"").trim().split(e).filter(t=>t.length>0),capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),prettyNumber(t,e=2){return this.strPadLeft(Number(t).toString(),e,"0")},prettyMillis(t){let e,r,n=i(t/1e3);r=i(n/60),t-=1e3*n,n-=60*r,e=i(r/60),r-=60*e;let s=[];return s.push(`${n}.${t} secs`),(r>0||e>0)&&s.push(r+" mins, "),e>0&&s.push(e+" hrs, "),s.reverse().join("")},dropArgs:(t,e)=>t.length>e?n.call(t,e):[],isSSL:()=>t&&t.location&&t.location.protocol.indexOf("https")>=0,isMobile:t=>t&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),isSafari:t=>t&&/Safari/.test(t.userAgent)&&/Apple Computer/.test(t.vendor),isCrossOrigin(e){let r=t;if(2===arguments.length&&911===arguments[1].hack&&(r=arguments[1]),r&&r.location&&e){const t=e.indexOf("://");if(t>0){let n=e.indexOf("/",t+3);return(n<0?e:e.substring(0,n))!=r.location.origin}}}};e&&(S.addEvent=function(t,e,r,n){c(t)&&1===arguments.length?t.forEach(t=>this.addEvent.apply(this,t)):e.addEventListener(t,r,n)},S.delEvent=function(t,e,r,n){c(t)&&1===arguments.length?t.forEach(t=>this.delEvent.apply(this,t)):e.removeEventListener(t,r,n)});const q={qSelector:t=>e.querySelectorAll(t),qId:t=>e.getElementById(t),parent(t){if(t)return t.parentNode},conj:(t,e)=>t.appendChild(e),byTag:(t,r)=>a(r)?e.getElementsByTagNameNS(r,t):e.getElementsByTagName(id),attrs(t,e){return!o(e)&&e?(arguments.length>2&&t.setAttribute(e,arguments[2]),t.getAttribute(e)):(e&&S.doseq(e,(e,r)=>t.setAttribute(r,e)),t)},css(t,e){return!o(e)&&e?(arguments.length>2&&(t.style[e]=arguments[2]),t.style[e]):(e&&S.doseq(e,(e,r)=>t.style[r]=e),t)},wrap(t,e){const r=t.parentNode;return e.appendChild(t),r.appendChild(e),e},newElm(t,r,n){const s=e.createElement(t);return this.attrs(s,r),this.css(s,n),s},newTxt(t,r,n){const s=e.createTextNode(t);return this.attrs(s,r),this.css(s,n),s}};return{is:j,u:S,dom:e?q:{},EventBus:function(){let t=S.jsMap(),e={},r=[];return{sub(r,n,s,i){let o=r[0],l=r[1];S.seq(o).forEach(r=>{if(n||(n=r),a(n)&&(n=(s=s||l)[n]),!n)throw"Error: no callback for sub()";t.has(r)||t.set(r,S.jsMap());let o=t.get(r);l=l||e,!o.has(l)&&o.set(l,[]),o.get(l).push([n,s,i])})},pub(n,...s){let i,o,l=n[0],c=n[1]||e;S.seq(l).forEach(e=>{o=t.get(e),i=o&&o.get(c),i&&i.forEach(t=>{t[0].apply(t[1],s.concat(t[2]||r))})})},reset(){t.clear()},unsub(r,n,s){let i,o,l=r[0],c=r[1]||e;S.seq(l).forEach(e=>{if(i=t.get(e),o=i&&i.get(c),o)if(a(n)&&(n=(s=s||c)[n]),n)for(let t=o.length-1;t>=0;--t)o[t][0]===n&&o[t][1]===s&&o.splice(t,1);else;})}}}}}"object"==typeof module&&module.exports?r=require("../tpcl/seedrandom.min"):e=t.document,"object"==typeof module&&module.exports?module.exports=n():t["io/czlab/mcfud/core"]=n}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const r=360,n=2*Math.PI,{is:s,u:i}=(Math.PI,e);function o(t){return t<0?- -t%r:t%r}return{lerp:(t,e,r)=>(1-r)*t+r*e,xmod:(t,e)=>t<0?t- -(e+e*Math.floor(-t/e)):t%e,clamp:(t,e,r)=>r<t?t:r>e?e:r,sqr:t=>t*t,fuzzyEq:(t,e)=>i.feq(t,e),fuzzyZero:t=>i.feq0(t),radToDeg:t=>o(r*t/n),degToRad:t=>n*o(t)/r,pythag2:(t,e)=>t*t+e*e,pythag:(t,e)=>Math.sqrt(t*t+e*e),wrap:(t,e)=>(t+1)%e,biasGreater:(t,e)=>t>=.95*e+.01*t}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/math"]=e}(this),function(t){"use strict";function e(e=!1,r=null){class n{constructor(){this.x=0,this.y=0}}r||(r=t["io/czlab/mcfud/core"]());const{u:s,is:i}=r;function o(){return e?new n:[0,0]}let l=s.fill(96,o);function c(...t){for(let r,s=0;s<t.length&&(r=t[s],l.length<96);++s)(e&&r instanceof n||!e&&r&&2===r.length)&&l.push(r)}function u(t=0,r=0){const n=l.length>0?l.pop():o();return e?(n.x=t,n.y=r):(n[0]=t,n[1]=r),n}const a=(t,e)=>t+e,h=(t,e)=>t-e,f=(t,e)=>t*e,d=(t,e)=>t/e;function m(t,r,o){return 0===o||i.num(r)&&(r=t),e?s.assert(t instanceof n&&r instanceof n):s.assert(2===t.length&&i.vec(r)&&t.length===r.length),!0}function p(t,r,n,l,c){let u=m(r,n)?c?r:o():null,a=i.num(n);return i.num(l)?s.assert(i.num(n),"wanted number"):a&&(l=n),e?(u.x=t(r.x,a?n:n.x),u.y=t(r.y,a?l:n.y)):(u[0]=t(r[0],a?n:n[0]),u[1]=t(r[1],a?l:n[1])),u}function g(t,e,r,n,s){const i=n?n[0]:0,o=n?n[1]:0,l=t[0]-i,c=t[1]-o,a=i+(l*e-c*r),h=o+(l*r+c*e);return s?(t[0]=a,t[1]=h):t=u(a,h),t}function y(t,e,r,n,s){const i=n?n.x:0,o=n?n.y:0,l=t.x-i,c=t.y-o,a=i+(l*e-c*r),h=o+(l*r+c*e);return s?(t.x=a,t.y=h):t=u(a,h),t}return{_switchMode(t,r=16){e=t,l=s.fill(r||96,o)},_checkPoolSize:()=>l.length,take:u,reclaim:c,vec:(t,e)=>u(t,e),add:(t,e,r)=>p(a,t,e,r),add$:(t,e,r)=>p(a,t,e,r,1),sub:(t,e,r)=>p(h,t,e,r),sub$:(t,e,r)=>p(h,t,e,r,1),mul:(t,e,r)=>p(f,t,e,r),mul$:(t,e,r)=>p(f,t,e,r,1),div:(t,e,r)=>p(d,t,e,r),div$:(t,e,r)=>p(d,t,e,r,1),dot(t,r){if(m(t,r,0))return e?t.x*r.x+t.y*r.y:t[0]*r[0]+t[1]*r[1]},vecAB(t,r){if(m(t,r,0))return e?u(r.x-t.x,r.y-t.y):u(r[0]-t[0],r[1]-t[1])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},dist2(t,e){let r=this.sub(e,t),n=this.len2(r);return c(r),n},dist(t,e){return Math.sqrt(this.dist2(t,e))},unit(t){let r=this.len(t),n=o();return s.feq0(r)||(e?(n.x=t.x/r,n.y=t.y/r):(n[0]=t[0]/r,n[1]=t[1]/r)),n},unit$(t){let r=this.len(t);return s.feq0(r)||(e?(t.x/=r,t.y/=r):(t[0]/=r,t[1]/=r)),t},set:(t,r)=>(m(t,r,0),e?(t.x=r.x,t.y=r.y):(t[0]=r[0],t[1]=r[1]),t),clone(t){return this.set(o(),t)},copy:(t,r,n)=>(s.assert(i.num(r)&&i.num(n),"wanted numbers"),e?(t.x=r,t.y=n):(t[0]=r,t[1]=n),t),rot(t,r,n){m(t,n||t,0);const s=Math.cos(r),i=Math.sin(r);return e?y(t,s,i,n):g(t,s,i,n)},rot$(t,r,n){m(t,n||t,0);const s=Math.cos(r),i=Math.sin(r);return e?y(t,s,i,n,1):g(t,s,i,n,1)},cross:(t,r)=>e?function(t,e){return t instanceof n&&e instanceof n?t.x*e.y-t.y*e.x:t instanceof n&&i.num(e)?u(e*t.y,-e*t.x):i.num(t)&&e instanceof n?u(-t*e.y,t*e.x):void s.assert(!1,"cross(): bad args")}(t,r):function(t,e){return i.vec(t)&&i.vec(e)?(m(t,e),t[0]*e[1]-t[1]*e[0]):i.vec(t)&&i.num(e)?(m(t,t),u(e*t[1],-e*t[0])):i.num(t)&&i.vec(e)?(m(e,e),u(-t*e[1],t*e[0])):void s.assert(!1,"cross(): bad args")}(t,r),angle(t,e){return Math.acos(this.dot(t,e)/(this.len(t)*this.len(e)))},normal:(t,r=!1)=>(m(t,t),e?r?u(-t.y,t.x):u(t.y,-t.x):r?u(-t[1],t[0]):u(t[1],-t[0])),normal$(t,r=!1){m(t,t);const n=e?t.x:t[0];return e?r?(t.x=-t.y,t.y=n):(t.x=t.y,t.y=-n):r?(t[0]=-t[1],t[1]=n):(t[0]=t[1],t[1]=-n),t},proj_scalar(t,e){return this.dot(t,e)/this.len(e)},proj(t,e){const r=this.unit(e);return this.mul$(r,this.dot(t,r))},perp(t,e){return this.sub(t,this.proj(t,e))},reflect(t,e){return this.sub(t,this.mul(e,2*this.dot(t,e)))},flip(t){return this.mul(t,-1)},flip$(t){return this.mul$(t,-1)},translate(t,...r){m(t,t);let n,s=!1;if(1===r.length&&i.vec(r[0])&&(r=r[0],s=!0),r.length>0)return m(t,r[0],0),n=1===r.length&&!s,e?n?this.vec(t.x+r[0].x,t.y+r[0].y):r.map(e=>this.vec(t.x+e.x,t.y+e.y)):n?this.vec(t[0]+r[0][0],t[1]+r[0][1]):r.map(e=>this.vec(t[0]+e[0],t[1]+e[1]))}}}"object"==typeof module&&module.exports?module.exports=e(!1,require("./core")):t["io/czlab/mcfud/vec2"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());Math.atan2;const r=Math.cos,n=Math.sin,s=(Math.tan,Math.floor),{u:i,is:o}=e;function l(t){return t%2!=0}function c(t,e,r,n){return n-1+(r-1)*e}function u(t,e,r){return{dim:[t,e],cells:r}}function a(t,e){return u(t,e,i.fill(t*e,0))}return{V4:(t=0,e=0,r=0,n=0)=>[t,e,r,n],V3:(t=0,e=0,r=0)=>[t,e,r],dot:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],cross(t,e){return this.V3(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])},len2(t){return this.dot(t,t)},len(t){return Math.sqrt(this.len2(t))},unit(t){let e=this.len(t),r=this.V3();return i.feq0(e)||(r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e),r},sub(t,e){return o.num(e)?this.V3(t[0]-e,t[1]-e,t[2]-e):this.V3(t[0]-e[0],t[1]-e[1],t[2]-e[2])},add(t,e){return o.num(e)?this.V3(t[0]+e,t[1]+e,t[2]+e):this.V3(t[0]+e[0],t[1]+e[1],t[2]+e[2])},mul(t,e){return o.num(e)?this.V3(t[0]*e,t[1]*e,t[2]*e):this.V3(t[0]*e[0],t[1]*e[1],t[2]*e[2])},div(t,e){return o.num(e)?this.V3(t[0]/e,t[1]/e,t[2]/e):this.V3(t[0]/e[0],t[1]/e[1],t[2]/e[2])},matrix([t,e],...r){const n=t*e;return 0===r.length?a(t,e):i.assert(n===r.length)&&u(t,e,r)},matIdentity(t){const e=i.fill(t*t,0);for(let r=0;r<t;++r)e[c(0,t,r+1,r+1)]=1;return u(t,t,e)},matZero:t=>i.assert(t>0)&&u(t,t,i.fill(t*t,0)),matRowMajors(t){const[e,r]=t.dim;return i.partition(r,t.cells)},matColMajors(t){const[e,r]=t.dim,n=[];for(let s,i=0;i<r;++i){s=[];for(let n=0;n<e;++n)s.push(t.cells[n*r+i]);n.push(s)}return n},mat2(t,e,r,n){return this.matrix([2,2],t,e,r,n)},mat3(t,e,r,n,s,i,o,l,c){return this.matrix([3,3],t,e,r,n,s,i,o,l,c)},mat4(t,e,r,n,s,i,o,l,c,u,a,h,f,d,m,p){return this.matrix([4,4],t,e,r,n,s,i,o,l,c,u,a,h,f,d,m,p)},matEq:(t,e)=>t.dim[0]===e.dim[0]&&t.dim[1]===e.dim[1]&&function(t,e){for(let r=0;r<t.length;++r)if(!i.feq(t[r],e[r]))return!1;return!0}(t.cells,e.cells),matNEq(t,e){return!this.matEq(t,e)},matXpose(t){const[e,r]=t.dim,n=e*r,i=[];for(let o=0;o<n;++o)i.push(t.cells[s(o/e)+r*(o%e)]);return u(r,e,i)},matScale:(t,e)=>u(t.dim[0],t.dim[1],t.cells.map(t=>t*e)),matMult(t,e){let[r,n]=t.dim,[s,o]=e.dim,l=t.cells,c=e.cells;i.assert(n===s,"mismatch matrices");let a=new Array(r*o);for(let t=0;t<r;++t)for(let e=0;e<o;++e)a[e+t*o]=i.range(s).reduce((r,s)=>r+l[s+t*n]*c[e+s*o],0);return u(r,o,a)},matDet(t){let[e,r]=t.dim,n=[];if(2===r)return this.matDet2x2(t);for(let e=0;e<r;++e)i.conj(n,this.matDet(this.matCut(t,1,e+1)));return i.range(r).reduce((e,r)=>{let s=n[r];return e+t.cells[r]*(l(r)?-s:s)},0)},matDet2x2:t=>(i.assert(4===t.cells.length),t.cells[0]*t.cells[3]-t.cells[1]*t.cells[2]),matCut(t,e,r){let[n,s]=t.dim,o=e-1,l=r-1,c=[];for(let e=0;e<n;++e)for(let r=0;r<s;++r)e!==o&&r!==l&&i.conj(c,t.cells[r+e*s]);return u(n-1,s-1,c)},matMinor(t){let[e,r]=t.dim,n=[];if(2===r)return this.matMinor2x2(t);for(let s=0;s<e;++s)for(let e=0;e<r;++e)i.conj(n,this.matDet(this.matCut(t,s+1,e+1)));return u(e,r,n)},matMinor2x2(t){return i.assert(4===t.cells.length)&&this.mat2(t.cells[3],t.cells[2],t.cells[1],t.cells[0])},matCofactor(t){let e=this.matMinor(t),[r,n]=e.dim,s=e.cells.slice();for(let t=0;t<r;++t)for(let e,r=0;r<n;++r)e=t*n+r,l(t+r)&&(s[e]=-s[e]);return u(r,n,s)},matAdjugate(t){return this.matXpose(this.matCofactor(t))},_minv2x2(t){let[e,r]=t.dim;i.assert(4===t.cells.length&&2===e&&2===r);let n,s=t.cells,o=s[0]*s[3]-s[1]*s[2];if(i.feq0(o))n=this.matIdentity(e);else{let t=1/o;n=this.mat2(s[3]*t,-s[1]*t,-s[2]*t,s[0]*t)}return n},matInverse(t){let[e,r]=t.dim;if(2===r)return this._minv2x2(t);let n=this.matDet(t);return i.feq0(n)?this.matIdentity(e):this.matScale(this.matAdjugate(t),1/n)},matFromColMajor(t,e){i.assert(t.length%e==0);let r=t.length/e,n=a(r,e);for(let i,o,l=0;l<t.length;++l)i=l%r,o=s(l/r),n.cells[i*e+o]=t[l];return n},matToColMajor(t){const[e,r]=t.dim,n=t.cells.slice();for(let s=0,i=0;i<r;++i)for(let o=0;o<e;++o)n[s++]=t.cells[o*r+i];return{cells:n,depth:e}},scale3D(t){let e=this.matIdentity(4);return e.cells[c(0,4,1,1)]=t[0],e.cells[c(0,4,2,2)]=t[1],e.cells[c(0,4,3,3)]=t[2],e},translate3D(t){let e=this.matIdentity(4);return e.cells[c(0,4,4,1)]=t[0],e.cells[c(0,4,4,2)]=t[1],e.cells[c(0,4,4,3)]=t[2],e},rot3D(t,e,r){return this.matMult(this.zRot3D(r),this.matMult(this.yRot3D(e),this.xRot3D(t)))},matVMult(t,e){let r=t.dim[1],n=e.length;i.assert(r===n);let s=this.matMult(t,u(n,1,e)),o=s.cells;return s.cells=null,o},rot2D(t){return this.mat2(r(t),-n(t),n(t),r(t))},xRot3D(t){return this.mat4(1,0,0,0,0,r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1)},yRot3D(t){return this.mat4(r(t),0,n(t),0,0,1,0,0,-n(t),0,r(t),0,0,0,0,1)},zRot3D(t){return this.mat4(r(t),-n(t),0,0,n(t),r(t),0,0,0,0,1,0,0,0,0,1)},isIdentity(t){const[e,r]=t.dim;if(e===r){for(let n,s=0;s<e;++s)for(let e=0;e<r;++e)if(n=t.cells[s*r+e],s+1===e+1){if(1!==n)return!1}else if(0!==n)return!1;return!0}return!1},isOrthogonal(t){let e=this.matDet(t);return 1===Math.abs(e)&&this.isIdentity(this.matMult(this.matXpose(t),this.matInverse(t)))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/matrix"]=e}(this),function(t){"use strict";const e=" @N/\\Ri2}aP`(xeT4F3mt;8~%r0v:L5$+Z{'V)\"CKIc>z.*fJEwSU7juYg<klO&1?[h9=n,yoQGsW]BMHpXb6A|D#q^_d!-",r=e.length;function n(n){n||(n=t["io/czlab/mcfud/core"]());const{u:s}=n;function i(t){return Math.abs(t)%r}function o(t,r){return(r||e).charAt(t)}function l(t){for(let e=0;e<r;++e)if(o(e)===t)return e;return-1}function c(t,e){let n=e+t;return o(n>=r?n-r:n)}function u(t,e){let n=e-t;return o(n<0?r+n:n)}return{encrypt(t,e){if(0===e)return t;let r,n=[],s=i(e);return t.split("").forEach(t=>{r=l(t),n.push(r<0?t:function(t,e,r){return t<0?c(e,r):u(e,r)}(e,s,r))}),n.join("")},decrypt(t,e){if(0===e)return t;let r,n=[],s=i(e);return t.split("").forEach(t=>{r=l(t),n.push(r<0?t:function(t,e,r){return t<0?u(e,r):c(e,r)}(e,s,r))}),n.join("")}}}"object"==typeof module&&module.exports?module.exports=n(require("./core")):t["io/czlab/mcfud/crypt"]=n}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());return{fsm(t){let e=t.initState();return{state:()=>e,process(){const r=t[e];r&&r.run&&r.run()},trigger(r="change"){const n=t[e],s=n&&n.transitions[r];if(s){const r=s.target,i=t[r];if(i)return n.exit&&n.exit(),i.enter&&i.enter(),s.action&&s.action(),e=r}}}}}}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/fsm"]=e}(this),function(t){"use strict";function e(e,r){e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]());const n=2*Math.PI,{u:s}=e,i={textStyle:function(t,e,r,n){return{font:t,fill:e,align:r,base:n}},drawShape:function(t,e,...r){e.draw&&e.draw(t,...r)},cfgStyle:function(t,e){if(e){let r=e.line,n=e.stroke;r&&(r.cap&&(t.lineCap=r.cap),r.width&&(t.lineWidth=r.width)),n&&n.style&&(t.strokeStyle=n.style)}},drawPoints:function(t,e,r){void 0===r&&(r=e.length),t.beginPath();for(let n=0;n<r;++n){let s=(n+1)%r,i=e[n],o=e[s];t.moveTo(i[0],i[1]),t.lineTo(o[0],o[1])}t.stroke()},drawShapePoly:function(t,e){return this.drawPoints(t,e.points)},drawCircle:function(t,e,r,s){t.beginPath(),t.arc(e,r,s,0,n,!0),t.closePath(),t.stroke()},drawShapeCircle:function(t,e){this.drawCircle(t,e.pos[0],e.pos[1],e.radius)},drawRect:function(t,e,r,n,s,i){let o=e,l=r-s;t.save(),t.translate(o,l),t.rotate(i),t.strokeRect(0,0,n,s),t.restore()},drawShapeRect:function(t,e){return this.drawRet(t,e.pos[0],e.pos[1],e.width,e.height,e.rotation)},drawLine:function(t,e,r,n,s){t.beginPath(),t.moveTo(e,r),t.lineTo(n,s),t.stroke()},drawShapeLine:function(t,e){return this.drawLine(t,e.p[0],e.p[1],e.q[0],e.q[1])}};return s.inject(i,{TXMatrix2d:class{constructor(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]}identity(){let t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this}clone(t){let e=this.m,r=t.m;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],this}multiply(t){let e=this.m,r=t.m,n=e[0]*r[0]+e[1]*r[3],s=e[0]*r[1]+e[1]*r[4],i=e[0]*r[2]+e[1]*r[5]+e[2],o=e[3]*r[0]+e[4]*r[3],l=e[3]*r[1]+e[4]*r[4],c=e[3]*r[2]+e[4]*r[5]+e[5];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=l,e[5]=c,this}rotate(t){if(0===t)return this;let e=Math.cos(t),r=Math.sin(t),n=this.m,s=n[0]*e+n[1]*r,i=n[0]*-r+n[1]*e,o=n[3]*e+n[4]*r,l=n[3]*-r+n[4]*e;return n[0]=s,n[1]=i,n[3]=o,n[4]=l,this}rotateDeg(t){return 0===t?this:this.rotate(Math.PI*t/180)}scale(t,e){let r=this.m;return void 0===e&&(e=t),r[0]*=t,r[1]*=e,r[3]*=t,r[4]*=e,this}translate(t,e){let r=this.m;return r[2]+=r[0]*t+r[1]*e,r[5]+=r[3]*t+r[4]*e,this}transform(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]}transformPoint(t){let e=t.x,r=t.y;return t.x=e*this.m[0]+r*this.m[1]+this.m[2],t.y=e*this.m[3]+r*this.m[4]+this.m[5],t}transformArray(t,e){let r=t[0],n=t[1];return e[0]=r*this.m[0]+n*this.m[1]+this.m[2],e[1]=r*this.m[3]+n*this.m[4]+this.m[5],e}transformX(t,e){return t*this.m[0]+e*this.m[1]+this.m[2]}transformY(t,e){return t*this.m[3]+e*this.m[4]+this.m[5]}setContextTransform(t){let e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}}})}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math")):t["io/czlab/mcfud/gfx"]=e}(this),function(t){"use strict";function e(e,r,n){const[s,i,o]=[1,0,-1];e||(e=t["io/czlab/mcfud/core"]()),r||(r=t["io/czlab/mcfud/math"]()),n||(n=t["io/czlab/mcfud/vec2"]());const{u:l}=e,c={};class u{constructor(t,e,r,s){switch(arguments.length){case 2:this.pos=n.vec2(),this.width=t,this.height=e;break;case 4:this.pos=n.vec2(t,e),this.width=r,this.height=s;break;default:throw"Error: bad input to Rect()"}}}class a{constructor(t,e){this.width=t,this.height=e}half(){return new a(this.width/2|0,this.height/2|0)}}c.polyArea=function(t){let e=0;for(let r,n,s,i=t.length,o=0;o<i;++o)s=(o+1)%i,r=t[o],n=t[s],e+=r[0]*n[1]-n[0]*r[1];return Math.abs(e)/2|0},c.calcPolyCenter=function(t){let e=6*c.polyArea(t),r=0,s=0;for(let e,n,i,o=0,l=t.length;o<l;++o)i=(o+1)%l,e=t[o],n=t[i],r+=(e[0]+n[0])*(e[0]*n[1]-n[0]*e[1]),s+=(e[1]+n[1])*(e[0]*n[1]-n[0]*e[1]);return n.vec2(r/e|0,s/e|0)};class h{constructor(t,e,r,s){this.p=n.vec2(t,e),this.q=n.vec2(r,s)}}class f{constructor(t,e){this.calcPoints=null,this.normals=null,this.edges=null,this.points=null,this.orient=0,this.pos=n.vec2(),this.setPos(t,e)}setPos(t=0,e=0){return n.vecCopy(this.pos,t,e),this}set(t){return this.calcPoints=this.calcPoints||[],this.normals=this.normals||[],this.edges=this.edges||[],this.calcPoints.length=0,this.normals.length=0,this.edges.length=0,this.points=function(t){let e=t.length;l.assert(e>2&&e<=36);let r=0,s=t[0][0];for(let n,i=1;i<e;++i)n=t[i][0],n>s?(s=n,r=i):l.feq(n,s)&&t[i][1]<t[r][1]&&(r=i);let i=new Array(36),o=r,c=0;for(;;){i[c]=o;let s=0;for(let r=1;r<e;++r){if(s===o){s=r;continue}let e=n.vecSub(t[s],t[i[c]]),u=n.vecSub(t[r],t[i[c]]),a=n.vec2Cross(e,u);a<0&&(s=r),l.feq0(a)&&n.vecLen2(u)>n.vecLen2(e)&&(s=r)}if(++c,o=s,s===r)break}const u=[];for(let e=0;e<c;++e)u.push(n.vecClone(t[i[e]]));return u}(t),l.doseq(this.points,t=>{this.calcPoints.push(n.vec2()),this.edges.push(n.vec2()),this.normals.push(n.vec2())}),this._recalc()}setOrient(t){return this.orient=t,this._recalc()}translate(t,e){return l.doseq(this.points,r=>{r[0]+=t,r[1]+=e}),this._recalc()}_recalc(){if(this.points){let t,e,r;l.doseq(this.points,(t,e)=>{n.vecSet(this.calcPoints[e],t),l.feq0(this.orient)||n.vec2RotSelf(this.calcPoints[e],this.orient)}),l.doseq(this.points,(s,i)=>{t=(i+1)%this.calcPoints.length,e=this.calcPoints[i],r=this.calcPoints[t],this.edges[i]=n.vecSub(r,e),this.normals[i]=n.vecUnit(n.perp(this.edges[i]))})}return this}}class d{constructor(t,e){this.overlapN=n.vec2(),this.overlapV=n.vec2(),this.A=t,this.B=e,this.clear()}clear(){return this.overlap=1/0,this.AInB=!0,this.BInA=!0,this}}function m(t,e){let r=1/0,s=-1/0;for(let i,o=0;o<t.length;++o)i=n.vecDot(t[o],e),i<r&&(r=i),i>s&&(s=i);return n.take(r,s)}function p(t,e){let r=n.vecDot(e,t),l=n.vecLen2(t);return r<0?s:r>l?o:i}function g(t,e,r,s,i,o){let[l,c]=m(e,i),[u,a]=m(s,i),h=n.vecSub(r,t),f=n.vecDot(h,i);if(u+=f,a+=f,n.reclaim(h),l>a||u>c)return!0;if(o){let t=0;if(l<u)if(o.AInB=!1,c<a)t=c-u,o.BInA=!1;else{let[e,r]=[c-u,a-l];t=e<r?e:-r}else if(o.BInA=!1,c>a)t=l-a,o.AInB=!1;else{let[e,r]=[c-u,a-l];t=e<r?e:-r}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,n.vecSet(o.overlapN,i),t<0&&n.vecFlipSelf(o.overlapN))}}c.getAABB=function(t){if(l.has(t,"radius"))return new c.Rect(t.pos[0]-t.radius,t.pos[1]-t.radius,2*t.radius,2*t.radius);{let e=n.translate(t.pos,t.calcPoints),r=e[0][0],s=e[0][1],i=r,o=s;for(let t,n=1;n<e.length;++n)t=e[n],t[0]<r&&(r=t[0]),t[0]>i&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>o&&(o=t[1]);return new c.Rect(r,s,i-r,o-s)}},c.shiftPoints=function(t,e){return t.map(t=>n.vecAdd(t,e))},c.rotPoints=function(t,e,r){return t.map(t=>n.vec2Rot(t,e,r))},c.calcRectPoints=function(t,e){let r=t/2|0,s=e/2|0;return[n.vec2(r,-s),n.vec2(r,s),n.vec2(-r,s),n.vec2(-r,-s)]},c.line=function(t,e,r,n){return new h(t,e,r,n)},c.rectEqRect=function(t,e){return t.width===e.width&&t.height===e.height&&t.pos[0]===e.pos[0]&&t.pos[1]===e.pos[1]},c.rectContainsRect=function(t,e){return!(t.pos[0]>=e.pos[0]||t.pos[1]>=e.pos[1]||t.pos[0]+t.width<=e.pos[0]+e.width||t.pos[1]+t.height<=e.pos[1]+e.height)},c.rectGetMaxX=function(t){return t.pos[0]+t.width},c.rectGetMidX=function(t){return t.pos[0]+t.width/2|0},c.rectGetMinX=function(t){return t.pos[0]},c.rectGetMaxY=function(t){return t.pos[1]+t.height},c.rectGetMidY=function(t){return t.pos[1]+t.height/2|0},c.rectGetMinY=function(t){return t.pos[1]},c.rectContainsPoint=function(t,e,r){return e>=this.rectGetMinX(t)&&e<=this.rectGetMaxX(t)&&r>=this.rectGetMinY(t)&&r<=this.rectGetMaxY(t)},c.rectIntersectsRect=function(t,e){return!(t.pos[0]+t.width<e.pos[0]||e.pos[0]+e.width<t.pos[0]||t.pos[1]+t.height<e.pos[1]||e.pos[1]+e.height<t.pos[1])},c.rectUnionsRect=function(t,e){const r=Math.min(t.pos[0],e.pos[0]),n=Math.min(t.pos[1],e.pos[1]);return new u(r,n,Math.max(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.max(t.pos[1]+t.height,e.pos[1]+e.height)-n)},c.rectIntersectsRect=function(t,e){const r=Math.max(t.pos[0],e.pos[0]),n=Math.max(t.pos[1],e.pos[1]);return new u(r,n,Math.min(t.pos[0]+t.width,e.pos[0]+e.width)-r,Math.min(t.pos[1]+t.height,e.pos[1]+e.height)-n)},c.hitTestPointCircle=function(t,e){return n.vecLen2(n.vecSub(t,e.pos))<=e.radius*e.radius};const y=new d,v=(b=new u(0,0,1,1),new f(b.pos[0],b.pos[1]).set([n.vec2(b.width,0),n.vec2(b.width,b.height),n.vec2(0,b.height),n.vec2()]));var b;function x(t,e,r){let s=t.radius+e.radius,i=n.vecSub(e.pos,t.pos),o=s*s,l=n.vecLen2(i),c=!(l>o);if(c&&r){let o=Math.sqrt(l);r.A=t,r.B=e,r.overlap=s-o,n.vecSet(r.overlapN,n.vecUnitSelf(i)),n.vecSet(r.overlapV,n.vecMul(i,r.overlap)),r.AInB=t.radius<=e.radius&&o<=e.radius-t.radius,r.BInA=e.radius<=t.radius&&o<=t.radius-e.radius}return n.reclaim(i),c}function w(t,e,r){let i,l=n.vecSub(e.pos,t.pos),c=e.radius*e.radius,u=t.calcPoints,a=n.take();for(let h=u.length,f=0;f<h;++f){let d=f===h-1?0:f+1,m=0===f?h-1:f-1,g=0,y=null;n.vecSet(a,t.edges[f]),i=n.vecSub(l,u[f]),r&&n.vecLen2(i)>c&&(r.AInB=!1);let v=p(a,i);if(v===s){n.vecSet(a,t.edges[m]);let s=n.vecSub(l,u[m]);if(v=p(a,s),v===o){let t=n.vecLen(i);if(t>e.radius)return n.reclaim(l,a,i,s),!1;r&&(r.BInA=!1,y=n.vecUnit(i),g=e.radius-t)}n.reclaim(s)}else if(v===o){if(n.vecSet(a,t.edges[d]),n.vecSubSelf(n.vecSet(i,l),u[d]),v=p(a,i),v===s){let t=n.vecLen(i);if(t>e.radius)return n.reclaim(l,a,i),!1;r&&(r.BInA=!1,y=n.vecUnit(i),g=e.radius-t)}}else{let t=n.vecUnitSelf(n.perp(a)),s=n.vecDot(i,t),o=Math.abs(s);if(s>0&&o>e.radius)return n.reclaim(l,t,i),!1;r&&(y=t,g=e.radius-s,(s>=0||g<2*e.radius)&&(r.BInA=!1))}y&&r&&Math.abs(g)<Math.abs(r.overlap)&&(r.overlap=g,n.vecSet(r.overlapN,y))}return r&&(r.A=t,r.B=e,n.vecMulSelf(n.vecSet(r.overlapV,r.overlapN),r.overlap)),n.reclaim(l,a,i),!0}function M(t,e,r){let s=w(e,t,r);if(s&&r){let t=r.A,e=r.AInB;n.vecFlipSelf(r.overlapN),n.vecFlipSelf(r.overlapV),r.A=r.B,r.B=t,r.AInB=r.BInA,r.BInA=e}return s}function j(t,e,s){let i=t.calcPoints,o=e.calcPoints;for(let r=0;r<i.length;++r)if(g(t.pos,i,e.pos,o,t.normals[r],s))return!1;for(let r=0;r<o.length;++r)if(g(t.pos,i,e.pos,o,e.normals[r],s))return!1;if(s){if(0===s.overlap||r.fuzzyZero(s.overlap))return!1;s.A=t,s.B=e,n.vecSet(s.overlapV,s.overlapN),n.vecMulSelf(s.overlapV,s.overlap)}return!0}return c.hitTestPointPolygon=function(t,e){return n.vecSet(v.pos,t),!!c.hitTestPolygonPolygon(v,e,y.clear())&&y.AInB},c.hitCircleCircle=function(t,e){let r=new d;return x(t,e,r)?r:null},c.hitTestCircleCircle=function(t,e){return x(t,e,new d)},c.hitPolygonCircle=function(t,e){let r=new d;return w(t,e,r)?r:null},c.hitTestPolygonCircle=function(t,e){return w(t,e,new d)},c.hitCirclePolygon=function(t,e){let r=new d;return M(t,e,r)?r:null},c.hitTestCirclePolygon=function(t,e){return M(t,e,new d)},c.hitPolygonPolygon=function(t,e){let r=new d;return j(t,e,r)?r:null},c.hitTestPolygonPolygon=function(t,e){return j(t,e,new d)},l.inject(c,{Circle:class{constructor(t){this.radius=t,this.orient=0,this.pos=n.vec2()}setOrient(t){return this.orient=t,this}setPos(t,e){return n.vecCopy(this.pos,t,e),this}},Line:h,Box:Box,Manifold:d,Polygon:f,Rect:u,Area:a})}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("./math"),require("./vec2")):t["io/czlab/mcfud/geo2d"]=e}(this),function(t){"use strict";function e(){class t{constructor(t,e,r,n,s,i){this.maxCount=s||12,this.maxDepth=i||5,this.objects=[],this.boxes=null,this.level=0,this.x1=t,this.x2=r,this.y1=e,this.y2=n,this.midX=(t+r)/2,this.midY=(e+n)/2}_ctree(e,r,n,s){let i=new t(e,r,n,s,this.maxCount,this.maxDepth);return i.level=this.level+1,i}_split(){_.assert(null===this.boxes),this.boxes=[this._ctree(this.midX,this.y1,this.x2,this.midY),this._ctree(this.midX,this.midY,this.x2,this.y2),this._ctree(this.x1,this.midY,this.midX,this.y2),this._ctree(this.x1,this.y1,this.midX,this.midY)]}_locate(t){let e=t.y<this.midY,r=t.x<this.midX,n=t.x+t.width>this.midX,s=t.y+t.height>this.midY;return e&&(r&&out.push(3),n&&out.push(0)),s&&(r&&out.push(2),n&&out.push(1)),out}insert(t){this.boxes?this._locate(t).forEach(e=>{this.boxes[e].insert(t)}):(this.objects.push(t),this.objects.length>this.maxCount&&this.level<this.maxDepth&&(this._split(),this.objects.forEach(t=>{this._locate(t).forEach(e=>{this.boxes[e].insert(t)})}),this.objects.length=0))}search(t){let e=new Map,r=[];return this.boxes&&this._locate(t).forEach(n=>{this.boxes[n].search(t).forEach(t=>{e.has(t)||(e.set(t,null),r.push(t))})}),this.objects.forEach(t=>{e.has(t)||(e.set(t,null),r.push(t))}),r}reset(){this.objects.length=0,this.boxes&&this.boxes.forEach(t=>{t.reset()}),this.boxes=null}}return{quadtree:(e,r,n)=>new t(e.x1,e.y1,e.x2,e.y2,r,n)}}"object"==typeof module&&module.exports?module.exports=e():t["io/czlab/mcfud/qtree"]=e}(this),function(t){"use strict";function e(e){e||(e=t["io/czlab/mcfud/core"]());const{u:r}=e,n={};class s{constructor(){this.lastBestMove=null,this.state=null,this.other=0,this.cur=0}clone(){let t=new s;return t.state=r.deepCopyArray(this.state),t.lastBestMove=this.lastBestMove,t.other=this.other,t.cur=this.cur,t}}function i(t,e,r,n,s,o){if(0===n||t.isOver(e)){let r=t.evalScore(e);return 0!==r&&(r-=.01*n*Math.abs(r)/r),r}let l=t.getNextMoves(e),c=e,u=-1/0,a=l[0];n===r&&(e.lastBestMove=l[0]);for(let h,f,d=0;d<l.length&&(t.undoMove||(e=c.clone()),f=l[d],t.makeMove(e,f),t.switchPlayer(e),h=-i(t,e,r,n-1,-o,-s),t.undoMove&&(t.switchPlayer(e),t.undoMove(e,f)),u<h&&(u=h,a=f),!(s<h&&(s=h,n===r&&(e.lastBestMove=f),s>=o)));++d);return u}return n.evalNegaMax=function(t){let e=t.takeFFrame();return i(t,e,t.depth,t.depth,-1/0,1/0),e.lastBestMove},r.inject(n,{FFrame:s,GameBoard:class{constructor(){}getFirstMove(t){}getNextMoves(t){}evalScore(t){}isStalemate(t){}isOver(t){}makeMove(t,e){}switchPlayer(t){}takeFFrame(){}}})}"object"==typeof module&&module.exports?module.exports=e(require("./core")):t["io/czlab/mcfud/negamax"]=e}(this),function(t){"use strict";function e(e,r){if(e||(e=t["io/czlab/mcfud/core"]()),!r)throw"Fatal: No Colors!";const{is:n,u:s}=e;function i(t,e){let r="";for(;t>0;)r+=e,--t;return r}function o(t,e){let r=a;return e&&(n.str(t)?r="any"===t||t===e?h:a:t instanceof e&&(r=h)),r}function l(t,e,r){return new Promise((n,s)=>{let i;try{i=r.call(t),i instanceof Promise?i.then((function(t){n(`${t?h:a}: ${e}`)})):(i=i?709394===i?u:h:a,n(`${i}: ${e}`))}catch(t){i=a,n(`${i}: ${e}`)}})}function c(t,e,r,n){return new Promise((s,i)=>{let l;try{l=r.call(t),l=709394===l?h:o(n,null)}catch(t){l=o(n,t)}s(`${l}: ${e}`)})}const[u,a,h]=["Skippd","Failed","Passed"];return{prn(t){const e=t.passed.length,n=t.total,o=e/n*100;console.log(r.white(i(78,"+"))),console.log(r.white.bold(t.title)),console.log(r.white(t.date)),console.log(r.white(i(78,"+"))),t.passed.length>0&&console.log(r.green(t.passed.join("\n"))),t.skippd.length>0&&console.log(r.grey(t.skippd.join("\n"))),t.failed.length>0&&console.log(r.magenta(t.failed.join("\n"))),console.log(r.white(i(78,"="))),console.log(r.yellow(["Passed: ",e,"/",n," [",0|o,"%]"].join(""))),console.log(r.magenta("Failed: "+(n-e))),console.log(r.white(["cpu-time: ",s.prettyMillis(t.duration)].join(""))),console.log(r.white(i(78,"=")))},deftest(t){let e=null,r=null,n=null,s=null,i={ensure:(t,e)=>(n.push([1,t,e]),i),eerror:(t,e)=>(n.push([911,t,e]),i),begin:t=>(s={},n=[],e=t,i),end(i){r=i;let o=function(){return new Promise((t,i)=>{e&&e(s);let o,u=[];for(let t,e,r=0;r<n.length;++r){switch(e=n[r],e[0]){case 1:t=l(s,e[1],e[2]);break;case 911:t=c(s,e[1],e[2],"any")}o=o?o.then((function(e){return u.push(e),t})):t}o&&o.then((function(e){u.push(e),n.length=0,r&&r(s),t(u)}))})};return(o.title=t)&&o}};return i},_run:t=>new Promise((e,r)=>{t().then((function(t){e(t)}))}),runtest(t,e){const r=Date.now();return this._run(t).then((function(n){const s=Date.now(),i={title:e||t.title,date:(new Date).toString(),total:n.length,duration:s-r,passed:n.filter(t=>"P"===t[0]),skippd:n.filter(t=>"S"===t[0]),failed:n.filter(t=>"F"===t[0])};return new Promise((t,e)=>{t(i)})}))}}}"object"==typeof module&&module.exports?module.exports=e(require("./core"),require("colors/safe")):t["io/czlab/mcfud/test"]=e}(this);